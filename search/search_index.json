{"config":{"lang":["de"],"separator":"[\\s\\-\\._,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"RootService","text":"<p>Wir bieten Service, Support, HowTos und andere n\u00fctzliche Informationen rund um die Administration von FreeBSD und Linux basierten Servern.</p>"},{"location":"howtos/freebsd/mfsbsd_image/","title":"mfsBSD Image","text":""},{"location":"howtos/freebsd/mfsbsd_image/#einleitung","title":"Einleitung","text":"<p>In diesem HowTo beschreibe ich step-by-step das Erstellen eines mfsBSD Images mit dem die Remote Installation von FreeBSD 64Bit auf einem dedizierten Server durchgef\u00fchrt werden kann.</p>"},{"location":"howtos/freebsd/mfsbsd_image/#das-referenzsystem","title":"Das Referenzsystem","text":"<p>Als Referenzsystem f\u00fcr dieses HowTo habe ich mich f\u00fcr eine virtuelle Maschine auf Basis von Oracle VirtualBox unter Microsoft Windows 11 Pro (64Bit) entschieden. So l\u00e4sst sich ohne gr\u00f6sseren Aufwand ein handels\u00fcblicher dedizierter Server simulieren und anschliessend kann diese virtuelle Maschine als kosteng\u00fcnstiges lokales Testsystem weiter genutzt werden.</p> <p>Trotzdem habe ich dieses HowTo so ausgelegt, dass es sich nahezu unver\u00e4ndert auf handels\u00fcbliche dedizierte Server \u00fcbertragen l\u00e4sst und dieses auch auf mehreren dedizierten Servern getestet.</p> <p>Obwohl Microsoft Windows 11 Pro einen eigenen OpenSSH-Client mitbringt, greife ich lieber auf das sehr empfehlenswerte PuTTY (64 Bit) zur\u00fcck.</p> <p>VirtualBox (inklusive dem Extensionpack) und PuTTY werden mit den jeweiligen Standardoptionen installiert.</p> PowerShell<pre><code>winget install PuTTY.PuTTY\nwinget install Oracle.VirtualBox\n\n$Env:vbox_ver=((winget show Oracle.VirtualBox) -match '^Version:' -split '\\s+' | Select-Object -Last 1)\ncurl -o \"Oracle_VM_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\" -L \"https://download.virtualbox.org/virtualbox/${Env:vbox_ver}/Oracle_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" extpack install --replace Oracle_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\nrm Oracle_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\n$Env:vbox_ver=''\n</code></pre>"},{"location":"howtos/freebsd/mfsbsd_image/#die-virtuelle-maschine","title":"Die Virtuelle Maschine","text":"<p>Als Erstes \u00f6ffnen wir eine neue PowerShell und legen manuell eine neue virtuelle Maschine an. Diese virtuelle Maschine bekommt den Namen <code>mfsBSD</code> und wird mit einer UEFI-Firmware, einem Quad-Core Prozessor, Intels ICH9-Chipsatz, 8192MB RAM, 64MB VideoRAM, einer 64GB SSD-Festplatte, einem DVD-Player, einer Netzwerkkarte, einem NVMe-Controller sowie einem AHCI-Controller und einem TPM 2.0 ausgestattet. Zudem setzen wir die RTC (Real-Time Clock) der virtuellen Maschine auf UTC (Coordinated Universal Time), aktivieren den HPET (High Precision Event Timer) und legen die Bootreihenfolge fest.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createvm --name \"mfsBSD\" --ostype FreeBSD_64 --register\n\ncd \"${Env:USERPROFILE}\\VirtualBox VMs\\mfsBSD\"\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createmedium disk --filename \"mfsBSD1.vdi\" --format VDI --size 64536\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"mfsBSD\" --firmware efi --memory 8192 --vram 64 --cpus 4 --hpet on --hwvirtex on --chipset ICH9 --iommu automatic --tpm-type 2.0 --rtc-use-utc on\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"mfsBSD\" --cpu-profile host --apic on --ioapic on --x2apic on --pae on --long-mode on --nested-paging on --large-pages on --vtx-vpid on --vtx-ux on\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"mfsBSD\" --nic1 nat --nic-type1 virtio --nat-pf1 \"VBoxSSH,tcp,,2222,,22\" --nat-pf1 \"VBoxHTTP,tcp,,8080,,80\" --nat-pf1 \"VBoxHTTPS,tcp,,8443,,443\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"mfsBSD\" --graphicscontroller vmsvga --audio-enabled off --usb-ehci off --usb-ohci off --usb-xhci off --boot1 dvd --boot2 disk --boot3 none --boot4 none\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storagectl \"mfsBSD\" --name \"NVMe Controller\" --add pcie --controller NVMe --portcount 4 --bootable on --hostiocache off\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storagectl \"mfsBSD\" --name \"AHCI Controller\" --add sata --controller IntelAHCI --portcount 4 --bootable on --hostiocache off\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"mfsBSD\" --storagectl \"NVMe Controller\" --port 0 --device 0 --type hdd --nonrotational on --medium \"mfsBSD1.vdi\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"mfsBSD\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type dvddrive --medium emptydrive\n</code></pre> <p>Als n\u00e4chstes ben\u00f6tigen wir die FreeBSD 64Bit Installations-CD, welche wir mittels des mit Windows mitgelieferten cURL-Client herunterladen und unserer virtuellen Maschine als Bootmedium zuweisen.</p> PowerShell<pre><code>cd \"${Env:USERPROFILE}\\VirtualBox VMs\\mfsBSD\"\n\ncurl -o \"FreeBSD-14.3-RELEASE-amd64-disc1.iso\" -L \"https://download.freebsd.org/releases/ISO-IMAGES/14.3/FreeBSD-14.3-RELEASE-amd64-disc1.iso\"\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"mfsBSD\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type dvddrive --medium \"FreeBSD-14.3-RELEASE-amd64-disc1.iso\"\n</code></pre> <p>Nachdem die virtuelle Maschine nun fertig konfiguriert ist, wird es Zeit diese zu booten.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" startvm \"mfsBSD\"\n</code></pre> <p>Im Bootmen\u00fc wird die erste Option durch Dr\u00fccken der Taste \"Enter\" beziehungsweise \"Return\", oder automatisch nach 10 Sekunden gew\u00e4hlt.</p> <p>Es w\u00fcrde f\u00fcr unsere Zwecke durchaus gen\u00fcgen, einfach stumpf dem Installationsprogramm BSDInstall zu folgen, aber wir werden die Installation manuell durchf\u00fchren, um ein paar Optionen zu nutzen, welche mit BSDInstall derzeit nicht verf\u00fcgbar sind.</p> <p>Aus diesem Grund werden wir, wenn der Bootvorgang abgeschlossen ist und wir den ersten Auswahldialog pr\u00e4sentiert bekommmen, \"Shell\" ausw\u00e4hlen und best\u00e4tigen.</p> Hint <p>Diese Shell nutzt das amerikanische Tastaturlayout, welches einige Tasten anders belegt als das deutsche</p> <p>Tastaturlayout.</p> Text Only<pre><code>Um auf das deutsche Tastaturlayout zu wechseln, w\u00e4hlen wir mittels `kbdmap` das Layout \"German (accent keys)\" aus:\n\n```shell\n/usr/sbin/kbdmap -K\n```\n</code></pre>"},{"location":"howtos/freebsd/mfsbsd_image/#minimalsystem-installieren","title":"Minimalsystem installieren","text":"<p>Als Erstes m\u00fcssen wir die Festplatte partitionieren, was wir mittels <code>gpart</code> erledigen werden. Zuvor m\u00fcssen wir dies aber dem Kernel mittels <code>sysctl</code> mitteilen, da er uns andernfalls dazwischenfunken w\u00fcrde.</p> <p>Wir werden vier Partitionen anlegen, die Erste f\u00fcr den GPT-Bootcode, die Zweite f\u00fcr den EFI-Bootcode, die Dritte als Swap und die Vierte als Systempartition. Dabei werden wir die Partitionen auch gleich f\u00fcr modernere Festplatten mit 4K-Sektoren optimieren und statt den veralteten \"MBR Partition Tables\" die aktuelleren \"GUID Partition Tables (GPT)\" verwenden.</p> Bash<pre><code>sysctl kern.geom.debugflags=0x10\n\ngpart create -s gpt nvd0\n\ngpart add -t freebsd-boot  -b      40 -s     216 -l bootfs nvd0\ngpart add -t efi           -b     256 -s    3840 -l efiesp nvd0\ngpart add -t freebsd-swap  -b    4096 -s 8388608 -l swapfs nvd0\ngpart add -t freebsd-ufs   -b 8392704            -l rootfs nvd0\n\ngpart set -a bootme -i 4 nvd0\n</code></pre> <p>Nun m\u00fcssen wir noch die Systempartition mit \"UFS2\" und einer 4K-Blockgr\u00f6sse formatieren und aktivieren auch gleich die \"soft-updates\".</p> Bash<pre><code>newfs -U -l -t /dev/gpt/rootfs\n</code></pre> <p>Die Systempartition mounten wir nach <code>/mnt</code> und entpacken darauf ein FreeBSD-Minimalsystem mit dem wir problemlos weiterarbeiten k\u00f6nnen.</p> Bash<pre><code>mount -t ufs /dev/gpt/rootfs /mnt\n\ntar Jxpvf /usr/freebsd-dist/base.txz   -C /mnt/\ntar Jxpvf /usr/freebsd-dist/kernel.txz -C /mnt/\ntar Jxpvf /usr/freebsd-dist/lib32.txz  -C /mnt/\ntar Jxpvf /usr/freebsd-dist/src.txz    -C /mnt/\n\ncp -a /usr/freebsd-dist /mnt/usr/\n</code></pre> <p>Unser System soll nat\u00fcrlich auch von der Festplatte booten k\u00f6nnen, weshalb wir jetzt den Bootcode und Bootloader in der Bootpartittion installieren.</p> Bash<pre><code>newfs_msdos /dev/gpt/efiesp\n\nmount -t msdosfs /dev/gpt/efiesp /mnt/boot/efi\n\nmkdir -p /mnt/boot/efi/EFI/BOOT\ncp /mnt/boot/loader.efi /mnt/boot/efi/EFI/BOOT/BOOTX64.efi\nefibootmgr -a -c -l vtbd0p2:/EFI/BOOT/BOOTX64.efi -L FreeBSD\numount /mnt/boot/efi\n\ngpart bootcode -b /mnt/boot/pmbr -p /mnt/boot/gptboot -i 1 nvd0\n</code></pre> <p>Vor dem Wechsel in die Chroot-Umgebung m\u00fcssen wir noch die <code>resolv.conf</code> in die Chroot-Umgebung kopieren und das Device-Filesysteme dorthin mounten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/resolv.conf\nnameserver 127.0.0.1\nnameserver ::1\noptions edns0 ndots:1 timeout:0.3 attempts:1 rotate\n\nEOF\n\ncp /etc/resolv.conf /mnt/etc/resolv.conf\n\nmount -t devfs devfs /mnt/dev\n</code></pre> <p>Das neu installierte System selbstverst\u00e4ndlich noch konfiguriert werden, bevor wir es nutzen k\u00f6nnen. Dazu werden wir jetzt in das neue System chrooten und eine minimale Grundkonfiguration vornehmen.</p> Bash<pre><code>chroot /mnt /usr/bin/env -i HOME=/root TERM=$TERM /bin/tcsh\n</code></pre> <p>Zun\u00e4chst setzen wir die Systemzeit (CMOS clock) mittels <code>tzsetup</code> auf \"UTC\" (Universal Time Code).</p> Bash<pre><code>/usr/sbin/tzsetup UTC\n</code></pre> <p>Wir bringen etwas Farbe in die Console, passen den Prompt an und legen <code>ee</code> statt <code>vi</code> als Default-Editor fest:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.cshrc\n#\n# .cshrc - csh resource script, read at beginning of execution by each shell\n#\n# see also csh(1), environ(7).\n# more examples available at /usr/share/examples/csh/\n#\n\nalias h         history 25\nalias j         jobs -l\nalias la        ls -aF\nalias lf        ls -FA\nalias ll        ls -lAF\nalias ls        ls -FGIPTW\nalias l         ls -FGIPTWahl\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# set path = (/sbin /bin /usr/sbin /usr/bin /usr/local/sbin /usr/local/bin $HOME/bin)\n# A righteous umask\n# umask 22\n\nsetenv  EDITOR  ee\nsetenv  PAGER   less\nsetenv  LSCOLORS \"Dxfxcxdxbxegedabagacad\"\n\nif ($?prompt) then\n        # An interactive shell -- set some stuff up\n        set prompt = \"[%B%n%b@%B%m%b:%B%~%b] %# \"\n        set promptchars = \"%#\"\n\n        set filec\n        set history = 50000\n        set savehist = (5000 merge)\n        set autolist = ambiguous\n        # Use history to aid expansion\n        set autoexpand\n        set autorehash\n        set mail = (/var/mail/$USER)\n        if ( $?tcsh ) then\n                bindkey \"^W\" backward-delete-word\n                bindkey -k up history-search-backward\n                bindkey -k down history-search-forward\n        endif\nendif\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.shrc\n#\n# .shrc - bourne shell startup file\n#\n# This file will be used if the shell is invoked for interactive use and\n# the environment variable ENV is set to this file.\n#\n# see also sh(1), environ(7).\n#\n\n\n# file permissions: rwxr-xr-x\n#\n# umask 022\n\n# Uncomment this to enable the builtin vi(1) command line editor in sh(1),\n# e.g. ESC to go into visual mode.\n# set -o vi\n\n\n# some useful aliases\nalias h='fc -l'\nalias j=jobs\nalias m=\"$PAGER\"\nalias ll='ls -laFo'\nalias l='ls -l'\nalias g='egrep -i'\nalias ls='ls -FGIPTW'\nalias l='ls -FGIPTWahl'\n\n# # be paranoid\n# alias cp='cp -ip'\n# alias mv='mv -i'\n# alias rm='rm -i'\n\n# # csh like history on arrow up and down\nbind ^[[A ed-search-prev-history\nbind ^[[B ed-search-next-history\n\n# # ctrl+arrow allow to jump from words to words\nbind \"\\\\e[1;5C\" em-next-word\nbind \"\\\\e[1;5D\" ed-prev-word\nalias history='fc -l'\n\n# Fix home/del for mobaxterm\nbind ^[[5~ ed-move-to-beg\nbind ^[[6~ ed-move-to-end\n\n# set prompt: ``username@hostname:directory $ ''\nPS1=\"\\[\\e[1;36m\\][\\[\\e[1;33m\\]\\u@\\h:\\[\\e[1;36m\\]\\w] \\\\$ \\[\\e[0m\\]\"\n\n# search path for cd(1)\n# CDPATH=:$HOME\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.mailrc\n#\n# .mailrc - mail resources\n#\n# see also mail(1)\n#\n\nset append ask autoprint\nset indentprefix=\"&gt; \"\nset PAGER=less\nset EDITOR=ee\nset VISUAL=ee\nset folder=Mail\nretain bcc cc date from subject to\n\n# include your private mail aliases\nsource ~/.mail_aliases\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.profile\n#\n# .profile - Bourne Shell startup script for login shells\n#\n# see also sh(1), environ(7).\n#\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:$HOME/bin; export PATH\n\n# Setting TERM is normally done through /etc/ttys.  Do only override\n# if you're sure that you'll never log in via telnet or xterm or a\n# serial line.\n# TERM=xterm;   export TERM\n\nEDITOR=ee;                           export EDITOR\nPAGER=less;                          export PAGER\nCLICOLORS=\"YES\";                     export CLICOLOR\nLSCOLORS=\"Dxfxcxdxbxegedabagacad\";   export LSCOLORS\nCOLORFGBG=\"15;0\";                    export COLORFGBG\nCOLORTERM=truecolor;                 export COLORTERM\nTERM=${TERM:-xterm-256color};        export TERM\nMANCOLOR=\"1\";                        export MANCOLOR\nMANWIDTH=tty;                        export MANWIDTH\n\n# set ENV to a file invoked each time sh is started for interactive use.\nENV=$HOME/.shrc; export ENV\n\n# Let sh(1) know it's at home, despite /home being a symlink.\nif [ \"$PWD\" != \"$HOME\" ] &amp;&amp; [ \"$PWD\" -ef \"$HOME\" ] ; then cd ; fi\n\n# Query terminal size; useful for serial lines.\nif [ -x /usr/bin/resizewin ] ; then /usr/bin/resizewin -z ; fi\n\n# Display a random cookie on each login.\nif [ -x /usr/bin/fortune ] ; then /usr/bin/fortune freebsd-tips ; fi\n\nEOF\n</code></pre> <p>Jetzt nochmal f\u00fcr <code>root</code>:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /root/.cshrc\n#\n# .cshrc - csh resource script, read at beginning of execution by each shell\n#\n# see also csh(1), environ(7).\n# more examples available at /usr/share/examples/csh/\n#\n\nalias h         history 25\nalias j         jobs -l\nalias la        ls -aF\nalias lf        ls -FA\nalias ll        ls -lAF\nalias ls        ls -FGIPTW\nalias l         ls -FGIPTWahl\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# set path = (/sbin /bin /usr/sbin /usr/bin /usr/local/sbin /usr/local/bin $HOME/bin)\n# A righteous umask\n# umask 22\n\nsetenv  EDITOR  ee\nsetenv  PAGER   less\nsetenv  LSCOLORS \"Dxfxcxdxbxegedabagacad\"\n\nif ($?prompt) then\n        # An interactive shell -- set some stuff up\n        set prompt = \"[%B%n%b@%B%m%b:%B%~%b] %# \"\n        set promptchars = \"%#\"\n\n        set filec\n        set history = 50000\n        set savehist = (5000 merge)\n        set autolist = ambiguous\n        # Use history to aid expansion\n        set autoexpand\n        set autorehash\n        set mail = (/var/mail/$USER)\n        if ( $?tcsh ) then\n                bindkey \"^W\" backward-delete-word\n                bindkey -k up history-search-backward\n                bindkey -k down history-search-forward\n        endif\nendif\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /root/.shrc\n#\n# .shrc - bourne shell startup file\n#\n# This file will be used if the shell is invoked for interactive use and\n# the environment variable ENV is set to this file.\n#\n# see also sh(1), environ(7).\n#\n\n\n# file permissions: rwxr-xr-x\n#\n# umask 022\n\n# Uncomment this to enable the builtin vi(1) command line editor in sh(1),\n# e.g. ESC to go into visual mode.\n# set -o vi\n\n\n# some useful aliases\nalias h='fc -l'\nalias j=jobs\nalias m=\"$PAGER\"\nalias ll='ls -laFo'\nalias l='ls -l'\nalias g='egrep -i'\nalias ls='ls -FGIPTW'\nalias l='ls -FGIPTWahl'\n\n# # be paranoid\n# alias cp='cp -ip'\n# alias mv='mv -i'\n# alias rm='rm -i'\n\n# # csh like history on arrow up and down\nbind ^[[A ed-search-prev-history\nbind ^[[B ed-search-next-history\n\n# # ctrl+arrow allow to jump from words to words\nbind \"\\\\e[1;5C\" em-next-word\nbind \"\\\\e[1;5D\" ed-prev-word\nalias history='fc -l'\n\n# Fix home/del for mobaxterm\nbind ^[[5~ ed-move-to-beg\nbind ^[[6~ ed-move-to-end\n\n# set prompt: ``username@hostname:directory $ ''\nPS1=\"\\[\\e[1;36m\\][\\[\\e[1;33m\\]\\u@\\h:\\[\\e[1;36m\\]\\w] \\\\$ \\[\\e[0m\\]\"\n\n# search path for cd(1)\n# CDPATH=:$HOME\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /root/.mailrc\n#\n# .mailrc - mail resources\n#\n# see also mail(1)\n#\n\nset append ask autoprint\nset indentprefix=\"&gt; \"\nset PAGER=less\nset EDITOR=ee\nset VISUAL=ee\nset folder=Mail\nretain bcc cc date from subject to\n\n# include your private mail aliases\nsource ~/.mail_aliases\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /root/.profile\n#\n# .profile - Bourne Shell startup script for login shells\n#\n# see also sh(1), environ(7).\n#\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:$HOME/bin; export PATH\n\n# Setting TERM is normally done through /etc/ttys.  Do only override\n# if you're sure that you'll never log in via telnet or xterm or a\n# serial line.\n# TERM=xterm;   export TERM\n\nEDITOR=ee;                           export EDITOR\nPAGER=less;                          export PAGER\nCLICOLORS=\"YES\";                     export CLICOLOR\nLSCOLORS=\"Dxfxcxdxbxegedabagacad\";   export LSCOLORS\nCOLORFGBG=\"15;0\";                    export COLORFGBG\nCOLORTERM=truecolor;                 export COLORTERM\nTERM=${TERM:-xterm-256color};        export TERM\nMANCOLOR=\"1\";                        export MANCOLOR\nMANWIDTH=tty;                        export MANWIDTH\n\n# set ENV to a file invoked each time sh is started for interactive use.\nENV=$HOME/.shrc; export ENV\n\n# Let sh(1) know it's at home, despite /home being a symlink.\nif [ \"$PWD\" != \"$HOME\" ] &amp;&amp; [ \"$PWD\" -ef \"$HOME\" ] ; then cd ; fi\n\n# Query terminal size; useful for serial lines.\nif [ -x /usr/bin/resizewin ] ; then /usr/bin/resizewin -z ; fi\n\n# Display a random cookie on each login.\nif [ -x /usr/bin/fortune ] ; then /usr/bin/fortune freebsd-tips ; fi\n\nEOF\n</code></pre> <p>Wir setzen ein paar Defaults f\u00fcr \"root\" neu:</p> Bash<pre><code>pw useradd -D -g '' -M 0700 -s sh -w no\npw usermod -n root -s sh -w none\n</code></pre> <p>Das Home-Verzeichnis des Users root ist standardm\u00e4ssig leider nicht ausreichend restriktiv in seinen Zugriffsrechten, was wir mit einem entsprechenden Aufruf von <code>chmod</code> schnell \u00e4ndern. Bevor wir es vergessen, setzen wir bei dieser Gelegenheit gleich ein sicheres Passwort f\u00fcr root.</p> Bash<pre><code>chmod 0700 /root\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for systemuser root: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\npasswd root\n</code></pre> <p>Die aliases-Datenbank f\u00fcr FreeBSDs DMA m\u00fcssen wir mittels <code>newaliases</code> anlegen, auch wenn wir sp\u00e4ter DMA gar nicht verwenden m\u00f6chten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/mail/aliases\n#       @(#)aliases     5.3 (Berkeley) 5/24/90\n#\n#  Aliases in this file will NOT be expanded in the header from\n#  Mail, but WILL be visible over networks.\n#\n#       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      The program \"newaliases\" must be run after\n#       &gt;&gt; NOTE &gt;&gt;      this file is updated for any changes to\n#       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      show through to sendmail.\n#\n#\n# See also RFC 2142, `MAILBOX NAMES FOR COMMON SERVICES, ROLES\n# AND FUNCTIONS', May 1997\n#       http://tools.ietf.org/html/rfc2142\n\n# Pretty much everything else in this file points to \"root\", so\n# you would do well in either reading root's mailbox or forwarding\n# root's email from here.\n\nroot:    admin@example.com\n\n# Basic system aliases -- these MUST be present\nMAILER-DAEMON: postmaster\npostmaster: root\n\n# General redirections for pseudo accounts\n_dhcp:  root\n_pflogd: root\nauditdistd:     root\nbin:    root\nbind:   root\ndaemon: root\ngames:  root\nhast:   root\nkmem:   root\nmailnull: postmaster\nman:    root\nnews:   root\nnobody: root\noperator: root\npop:    root\nproxy:  root\nsmmsp:  postmaster\nsshd:   root\nsystem: root\ntoor:   root\ntty:    root\nusenet: news\nuucp:   root\n\n# Well-known aliases -- these should be filled in!\n# manager:\n# dumper:\n\n# BUSINESS-RELATED MAILBOX NAMES\n# info:\n# marketing:\n# sales:\n# support:\n\n# NETWORK OPERATIONS MAILBOX NAMES\nabuse:  root\n# noc:          root\nsecurity:       root\n\n# SUPPORT MAILBOX NAMES FOR SPECIFIC INTERNET SERVICES\nftp:            root\nftp-bugs:       ftp\nhostmaster:     root\nwebmaster:      root\nwww:            webmaster\n\n# NOTE: /var/msgs and /var/msgs/bounds must be owned by sendmail's\n#       DefaultUser (defaults to mailnull) for the msgs alias to work.\n#\n# msgs: \"| /usr/bin/msgs -s\"\n\n# bit-bucket: /dev/null\n# dev-null: bit-bucket\nvmail: root\nclamav: root\nvscan: root\n\nEOF\n\nnewaliases\n</code></pre> <p>Die <code>fstab</code> ist bei unserem minimalistischen Partitionslayout zwar nicht zwingend n\u00f6tig, aber wir m\u00f6chten sp\u00e4ter keine unerwarteten \u00dcberraschungen erleben, also legen wir sie vorsichtshalber an.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/fstab\n# Device           Mountpoint    FStype     Options      Dump    Pass\n# Custom /etc/fstab for FreeBSD VM images\n/dev/gpt/rootfs    /             ufs        rw           1       1\n/dev/gpt/swapfs    none          swap       sw           0       0\n/dev/gpt/efiesp    /boot/efi     msdosfs    rw           2       2\n\nEOF\n</code></pre> <p>In der <code>rc.conf</code> werden diverse Grundeinstellungen f\u00fcr das System und die installierten Dienste vorgenommen. Wir legen sie daher mittela <code>ee /etc/rc.conf</code> mit folgendem Inhalt an.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/rc.conf\n##############################################################\n###  Important initial Boot-time options  ####################\n##############################################################\n#kern_securelevel_enable=\"YES\"\n#kern_securelevel=\"1\"\nkld_list=\"accf_data accf_http accf_dns\"\nfsck_y_enable=\"YES\"\ngrowfs_enable=\"YES\"\ndmesg_enable=\"YES\"\nzfs_enable=\"YES\"\nzpool_reguid=\"zroot\"\nzpool_upgrade=\"zroot\"\ndumpdev=\"AUTO\"\ncloudinit_enable=\"YES\"\nqemu_guest_agent_enable=\"YES\"\n\n##############################################################\n###  Network configuration sub-section  ######################\n##############################################################\nhostname=\"devnull.example.com\"\n\n##### IPv4\ndefaultrouter=\"__GATEWAY4__\"\nifconfig_DEFAULT=\"inet __IPADDR4__\"\n\n##### IPv6\nipv6_defaultrouter=\"__GATEWAY6__\"\nifconfig_DEFAULT_ipv6=\"inet6 __IPADDR6__ accept_rtadv\"\n\n##### Additional IP Addresses\n### specify additional IPv4 and IPv6 addresses one per line\n#ifconfig_DEFAULT_aliases=\"\\\n#        inet IPV4 netmask NETMASK \\\n#        inet IPV4 netmask NETMASK \\\n#        inet6 IPV6 prefixlen PREFLEN \\\n#        inet6 IPV6 prefixlen PREFLEN\"\n\n##############################################################\n###  Paketfilter (PF) options  ###############################\n##############################################################\npf_enable=\"YES\"\npf_rules=\"/etc/pf.conf\"\npflog_enable=\"YES\"\n\n##############################################################\n###  System console options  #################################\n##############################################################\nkeymap=\"de.acc.kbd\"\n\n##############################################################\n###  Mail Transfer Agent (MTA) options  ######################\n##############################################################\nsendmail_enable=\"NONE\"\nsendmail_cert_create=\"NO\"\nsendmail_submit_enable=\"NO\"\nsendmail_outbound_enable=\"NO\"\nsendmail_msp_queue_enable=\"NO\"\nsendmail_rebuild_aliases=\"NO\"\ndma_flushq_enable=\"YES\"\n\n##############################################################\n###  Miscellaneous administrative options  ###################\n##############################################################\nsyslogd_flags=\"-ss\"\nclear_tmp_enable=\"YES\"\ncron_flags=\"$cron_flags -j 0 -J 0 -m root\"\nupdate_motd=\"YES\"\nnscd_enable=\"YES\"\nntpd_enable=\"YES\"\nntpd_sync_on_start=\"YES\"\nresolv_enable=\"NO\"\n\n##############################################################\n### Jail Configuration #######################################\n##############################################################\n\n##############################################################\n###  System services options  ################################\n##############################################################\nlocal_unbound_enable=\"YES\"\nlocal_unbound_tls=\"NO\"\nblacklistd_enable=\"NO\"\nsshd_enable=\"YES\"\n\nEOF\n</code></pre> <p>Es folgt ein wenig Voodoo, um die Netzwerkkonfiguration in der <code>/etc/rc.conf</code> zu vervollst\u00e4ndigen.</p> Bash<pre><code># Default Interface\nroute -n get -inet default | awk '/interface/ {print $2}' | \\\n    xargs -I % sed -e 's|DEFAULT|%|g' -i '' /etc/rc.conf\n\n# IPv4\nroute -n get -inet default | awk '/gateway/ {print $2}' | \\\n    xargs -I % sed -e 's|__GATEWAY4__|%|g' -i '' /etc/rc.conf\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /etc/rc.conf\n\n# IPv6\nroute -n get -inet6 default | awk '/gateway/ {print $2}' | \\\n    xargs -I % sed -e 's|__GATEWAY6__|%|g' -i '' /etc/rc.conf\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /etc/rc.conf\n</code></pre> <p>Wir richten die <code>/etc/hosts</code> ein.</p> Bash<pre><code># localhost\nsed -e 's|my.domain/example.com/g' -i '' /etc/hosts\n\n# IPv4\necho '__IPADDR4__   devnull.example.com   devnull' &gt;&gt; /etc/hosts\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /etc/hosts\n\n# IPv6\necho '__IPADDR6__   devnull.example.com   devnull' &gt;&gt; /etc/hosts\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /etc/hosts\n</code></pre> <p>Da dies lediglich ein lokales tempor\u00e4res System zum Erzeugen unseres mfsBSD-Images wird, k\u00f6nnen wir den OpenSSH-Dienst bedenkenlos etwas komfortabler aber dadurch zwangsl\u00e4ufig auch etwas unsicherer konfigurieren, indem wir den Login per Passwort zulassen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/ssh/sshd_config\n#       $OpenBSD: sshd_config,v 1.104 2021/07/02 05:11:21 dtucker Exp $\n\n# This is the sshd server system-wide configuration file.  See\n# sshd_config(5) for more information.\n\n# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin\n\n# The strategy used for options in the default sshd_config shipped with\n# OpenSSH is to specify options with their default value where\n# possible, but leave them commented.  Uncommented options override the\n# default value.\n\n# Note that some of FreeBSD's defaults differ from OpenBSD's, and\n# FreeBSD has a few additional options.\n\nPort 22\n#AddressFamily any\n#ListenAddress 0.0.0.0\n#ListenAddress ::\n\n#HostKey /etc/ssh/ssh_host_rsa_key\n#HostKey /etc/ssh/ssh_host_ecdsa_key\n#HostKey /etc/ssh/ssh_host_ed25519_key\n\n# Ciphers and keying\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com\nMacs hmac-sha2-512,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-256-etm@openssh.com\nKexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256\n#RekeyLimit default none\n\n# Logging\n#SyslogFacility AUTH\n#LogLevel INFO\n\n# Authentication:\n\n#LoginGraceTime 2m\nPermitRootLogin prohibit-password\n#StrictModes yes\n#MaxAuthTries 6\n#MaxSessions 10\n\nPubkeyAuthentication yes\n\n# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2\n# but this is overridden so installations will only check .ssh/authorized_keys\nAuthorizedKeysFile      .ssh/authorized_keys\n\n#AuthorizedPrincipalsFile none\n\n#AuthorizedKeysCommand none\n#AuthorizedKeysCommandUser nobody\n\n# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts\n#HostbasedAuthentication no\n# Change to yes if you don't trust ~/.ssh/known_hosts for\n# HostbasedAuthentication\n#IgnoreUserKnownHosts no\n# Don't read the user's ~/.rhosts and ~/.shosts files\n#IgnoreRhosts yes\n\n# Change to yes to enable built-in password authentication.\n# Note that passwords may also be accepted via KbdInteractiveAuthentication.\nPasswordAuthentication no\nPermitEmptyPasswords no\n\n# Change to no to disable PAM authentication\nKbdInteractiveAuthentication no\n\n# Kerberos options\n#KerberosAuthentication no\n#KerberosOrLocalPasswd yes\n#KerberosTicketCleanup yes\n#KerberosGetAFSToken no\n\n# GSSAPI options\n#GSSAPIAuthentication no\n#GSSAPICleanupCredentials yes\n\n# Set this to 'no' to disable PAM authentication, account processing,\n# and session processing. If this is enabled, PAM authentication will\n# be allowed through the KbdInteractiveAuthentication and\n# PasswordAuthentication.  Depending on your PAM configuration,\n# PAM authentication via KbdInteractiveAuthentication may bypass\n# the setting of \"PermitRootLogin prohibit-password\".\n# If you just want the PAM account and session checks to run without\n# PAM authentication, then enable this but set PasswordAuthentication\n# and KbdInteractiveAuthentication to 'no'.\nUsePAM no\n\nAllowAgentForwarding no\nAllowTcpForwarding no\nGatewayPorts no\nX11Forwarding no\n#X11DisplayOffset 10\n#X11UseLocalhost yes\n#PermitTTY yes\n#PrintMotd yes\n#PrintLastLog yes\n#TCPKeepAlive yes\nPermitUserEnvironment no\n#Compression delayed\nClientAliveInterval 10\nClientAliveCountMax 6\n#UseDNS yes\nPidFile /var/run/sshd.pid\nMaxStartups 10:30:100\nPermitTunnel no\nChrootDirectory %h\nUseBlacklist no\nVersionAddendum none\n\n# no default banner path\n#Banner none\n\n# override default of no subsystems\n#Subsystem      sftp    /usr/libexec/sftp-server\n\n# Example of overriding settings on a per-user basis\n#Match User anoncvs\n#       X11Forwarding no\n#       AllowTcpForwarding no\n#       PermitTTY no\n#       ForceCommand cvs server\n\nSubsystem sftp internal-sftp -u 0027\n\nAllowGroups wheel admin sshusers sftponly\n\nMatch User root\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group admin\n    ChrootDirectory none\n    PasswordAuthentication yes\n\nMatch Group sshusers\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group sftponly\n    ChrootDirectory /home\n    PasswordAuthentication yes\n    ForceCommand internal-sftp -d %u\n\nEOF\n\nrm -f /etc/ssh/ssh_host_*_key*\nssh-keygen -q -t rsa -b 4096 -f \"/etc/ssh/ssh_host_rsa_key\" -N \"\"\nssh-keygen -l -f \"/etc/ssh/ssh_host_rsa_key.pub\"\nssh-keygen -q -t ecdsa -b 384 -f \"/etc/ssh/ssh_host_ecdsa_key\" -N \"\"\nssh-keygen -l -f \"/etc/ssh/ssh_host_ecdsa_key.pub\"\nssh-keygen -q -t ed25519 -f \"/etc/ssh/ssh_host_ed25519_key\" -N \"\"\nssh-keygen -l -f \"/etc/ssh/ssh_host_ed25519_key.pub\"\n\nmkdir -p /root/.ssh\nchmod 0700 /root/.ssh\nssh-keygen -t ed25519 -O clear -O permit-pty -f \"/root/.ssh/id_ed25519\" -N \"\"\ncat /root/.ssh/id_ed25519.pub &gt;&gt; /root/.ssh/authorized_keys\nssh-keygen -t ecdsa -b 384 -O clear -O permit-pty -f \"/root/.ssh/id_ecdsa\" -N \"\"\ncat /root/.ssh/id_ecdsa.pub &gt;&gt; /root/.ssh/authorized_keys\nssh-keygen -t rsa -b 4096 -O clear -O permit-pty -f \"/root/.ssh/id_rsa\" -N \"\"\ncat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys\n</code></pre> <p>Das System ist nun f\u00fcr unsere Zwecke ausreichend konfiguriert, so dass wir das Chroot nun verlassen und die Systempartition unmounten k\u00f6nnen.</p> Bash<pre><code>exit\n\numount /mnt/dev\numount /mnt\n\nexit\n</code></pre> <p>Abschliessend beenden wir die virtuelle Maschine und werfen die Installations-DVD aus.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" controlvm \"mfsBSD\" acpipowerbutton\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" controlvm \"mfsBSD\" poweroff\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"mfsBSD\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type dvddrive --medium emptydrive\n</code></pre>"},{"location":"howtos/freebsd/mfsbsd_image/#einloggen-ins-virtuelle-system","title":"Einloggen ins virtuelle System","text":"<p>Nachdem wir unser frisch installiertes System gebootet haben, sollten wir uns mittels PuTTY als <code>root</code> einloggen k\u00f6nnen.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" startvm \"mfsBSD\"\n\nputty -ssh -P 2222 root@127.0.0.1\n</code></pre>"},{"location":"howtos/freebsd/mfsbsd_image/#ports-mgmtpkg-installieren","title":"ports-mgmt/pkg installieren","text":"<p>Wir installieren pkg via pkg.</p> Bash<pre><code>pkg bootstrap -y\n</code></pre>"},{"location":"howtos/freebsd/mfsbsd_image/#mfsbsd-erzeugen","title":"mfsBSD erzeugen","text":"<p>Wir werden nun unser mfsBSD-Image erzeugen, um damit sp\u00e4ter unser eigentliches dediziertes System booten und installieren zu k\u00f6nnen. Hierzu legen uns zun\u00e4chst ein Arbeitsverzeichnis an.</p> Bash<pre><code>mkdir -p /usr/local/mfsbsd\n</code></pre> <p>Nun fehlt noch das mfsBSD-Buildscript, welches wir jetzt mittels <code>fetch</code> in unserem Arbeitsverzeichnis downloaden und dann entpacken.</p> Bash<pre><code>cd /usr/local/mfsbsd\n\nfetch -4 -q -o \"mfsbsd-master.tar.gz\" --no-verify-peer \"https://github.com/mmatuska/mfsbsd/archive/master.tar.gz\"\n\ntar xf mfsbsd-master.tar.gz\nchown -R root:wheel mfsbsd-master\ncd mfsbsd-master\n</code></pre> <p>Um uns sp\u00e4ter per SSH in unserem mfsBSD-Image einloggen zu k\u00f6nnen, legen wir das Passwort <code>mfsroot</code> f\u00fcr root fest.</p> Bash<pre><code>sed -e 's/^#\\(mfsbsd.rootpw=\\).*$/\\1\"mfsroot\"/' conf/loader.conf.sample &gt; conf/loader.conf\n</code></pre> <p>F\u00fcr unsere Zwecke reicht die Standardkonfiguration des mfsBSD-Buildscripts aus, so dass wir unser mfsBSD-Image direkt erzeugen k\u00f6nnen.</p> Bash<pre><code>make BASE=/usr/freebsd-dist RELEASE=14.3-RELEASE ARCH=amd64 PKG_STATIC=/usr/local/sbin/pkg-static MFSROOT_MAXSIZE=120m\n</code></pre> <p>Anschliessend liegt unter <code>/usr/local/mfsbsd/mfsbsd-master/mfsbsd-14.3-RELEASE-amd64.img</code> unser fertiges mfsBSD-Image. Dieses kopieren wir nun per PuTTY auf den Windows Host.</p> PowerShell<pre><code>pscp -P 2222 root@127.0.0.1:/usr/local/mfsbsd/mfsbsd-master/mfsbsd-14.3-RELEASE-amd64.img \"${Env:USERPROFILE}\\VirtualBox VMs\\mfsBSD\\mfsbsd-14.3-RELEASE-amd64.img\"\n</code></pre> <p>Die virtuelle Maschine k\u00f6nnen wir an dieser Stelle nun beenden.</p> Bash<pre><code>exit\n</code></pre> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" controlvm \"mfsBSD\" acpipowerbutton\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" controlvm \"mfsBSD\" poweroff\n</code></pre> <p>Fertig.</p> <p>Viel Spass mit dem neuen mfsBSD Image</p>"},{"location":"howtos/freebsd/hosting_system/intro/","title":"Hosting System","text":""},{"location":"howtos/freebsd/hosting_system/intro/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird am Ende folgende Dienste umfassen.</p> <ul> <li>CertBot 4.0.0 (LetsEncrypt ACME API 2.0)</li> <li>OpenSSH 10.0p1 (Public-Key-Auth)</li> <li>Unbound 1.22.0 (DNScrypt, DNS over TLS)</li> <li>PostgreSQL 17.5</li> <li>MySQL 8.0.42 (InnoDB, GTID)</li> <li>Apache 2.4.63 (MPM-Event, HTTP/2, mod_brotli)</li> <li>NGinx 1.28.0 (HTTP/2, HTTP/3, mod_brotli)</li> <li>PHP 8.3.22 (PHP-FPM, Composer, PEAR)</li> <li>NodeJS 22.16.0 (NPM, YARN)</li> <li>Dovecot 2.3.21 (IMAP only, Pigeonhole)</li> <li>PostfixAdmin 4.0.0 (PostgreSQL, Vacation)</li> <li>Postfix 3.10.2 (Dovecot-SASL, postscreen)</li> <li>OpenDKIM 2.10.3 (VBR, 2048 Bit RSA)</li> <li>OpenDMARC 1.4.2 (SPF2, FailureReports)</li> <li>SpamAssassin 4.0.1 (SpamAss-Milter)</li> <li>Amavisd</li> <li>ClamAV</li> </ul> <p>Folgende Punkte sind in allen folgenden HowTos zu beachten.</p> <ul> <li>Alle Dienste werden mit einem m\u00f6glichst minimalen und bew\u00e4hrten Funktionsumfang installiert.</li> <li>Alle Dienste werden mit einer m\u00f6glichst sicheren und dennoch flexiblen Konfiguration versehen.</li> <li>Alle Konfigurationen sind selbstst\u00e4ndig auf notwendige individuelle Anpassungen zu kontrollieren.</li> <li>Alle Benutzernamen werden als <code>__USERNAME__</code> dargestellt und sind selbstst\u00e4ndig passend zu ersetzen.</li> <li>Alle Passworte werden als <code>__PASSWORD__</code> dargestellt und sind selbstst\u00e4ndig durch sichere Passworte zu ersetzen.</li> <li>Die Domain des Servers lautet <code>example.com</code> und ist selbstst\u00e4ndig durch die eigene Domain zu ersetzen.</li> <li>Der Hostname des Servers lautet <code>devnull</code> und ist selbstst\u00e4ndig durch den eigenen Hostnamen zu ersetzen   (FQDN=devnull.example.com).</li> <li>Es werden die FQDNs <code>devnull.example.com</code>, <code>mail.example.com</code> und <code>www.example.com</code> verwendet und sind selbstst\u00e4ndig   im DNS zu registrieren.</li> <li>Die prim\u00e4re IPv4 Adresse des Systems wird als <code>__IPADDR4__</code> dargestellt und ist selbstt\u00e4ndig zu ersetzen.</li> <li>Die prim\u00e4re IPv6 Adresse des Systems wird als <code>__IPADDR6__</code> dargestellt und ist selbstt\u00e4ndig zu ersetzen.</li> <li>Postfix und Dovecot teilen sich sowohl den FQDN <code>mail.example.com</code> als auch das SSL-Zertifikat.</li> </ul>"},{"location":"howtos/freebsd/hosting_system/intro/#voraussetzungen","title":"Voraussetzungen","text":"<p>Diese HowTos setzen ein wie in [Remote Installation]((/howtos/freebsd/remote_install/intro) beschriebenes, installiertes und konfiguriertes FreeBSD Basissystem voraus.</p> Important <p>An diesem Punkt m\u00fcssen wir uns entscheiden, ob wir die Pakete/Ports in Zukunft bequem als vorkompiliertes</p> <p>Binary-Paket per <code>pkg install &lt;category/portname&gt;</code> mit den Default-Optionen installieren wollen oder ob wir die Optionen und somit auch den Funktionsumfang beziehungsweise die Features unserer Pakete/Ports selbst bestimmen wollen.</p> <p>In diesem HowTo werden wir uns f\u00fcr die zweite Variante entscheiden, da uns dies viele Probleme durch unn\u00f6tige oder fehlende Features und Abh\u00e4ngigkeiten ersparen wird. Andererseits verlieren wir dadurch den Komfort von <code>pkg</code> bei der Installation und den Updates der Pakete/Ports. Ebenso m\u00fcssen wir zwangsweise f\u00fcr alle Pakete/Ports die gew\u00fcnschten Optionen manuell setzen und die Pakete/Ports auch selbst kompilieren.</p> <p>Dieses Vorgehen ist deutlich zeitaufwendiger und erfordert auch etwas mehr Wissen \u00fcber die jeweiligen Pakete/Ports und deren Features, daf\u00fcr entsch\u00e4digt es uns aber mit einem schlankeren, schnelleren und stabileren System und bietet uns gegebenenfalls n\u00fctzliche/erforderliche zus\u00e4tzliche Funktionen und Sicherheitsfeatures. Auch die potentielle Gefahr f\u00fcr Sicherheitsl\u00fccken sinkt dadurch, da wir unn\u00fctze Pakete/Ports gar nicht erst als Abh\u00e4ngigkeiten mitinstallieren m\u00fcssen.</p> <p>Sofern noch nicht geschehen, deaktivieren wir also zuerst das Default-Repository von <code>pkg</code>, um versehentlichen Installationen von Binary-Paketen durch <code>pkg</code> vorzubeugen.</p> Bash<pre><code>mkdir -p /usr/local/etc/pkg/repos\nsed -e 's|quarterly|latest|g' /etc/pkg/FreeBSD.conf &gt; /usr/local/etc/pkg/repos/FreeBSD.conf\nsed -e 's|\\(enabled:\\)[[:space:]]*yes|\\1 no|g' -i '' /usr/local/etc/pkg/repos/FreeBSD.conf\n</code></pre> <p>Die von uns jeweils gew\u00fcnschten Build-Optionen der Ports legen wir dabei mittels der <code>options</code>-Files des Portkonfigurationsframeworks <code>OptionsNG</code> fest.</p> <p>Da wir unsere Nutzdaten weitestgehend unter <code>/data</code> ablegen werden, legen wir ein paar hierf\u00fcr ben\u00f6tigte Verzeichnisse an, sofern nicht bereits geschehen.</p> Bash<pre><code>mkdir -p /data\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/intro/#dns-records","title":"DNS Records","text":"<p>F\u00fcr diese HowTos m\u00fcssen zuvor folgende DNS-Records angelegt werden, sofern sie noch nicht existieren, oder entsprechend ge\u00e4ndert werden, sofern sie bereits existieren.</p> Text Only<pre><code>example.com.                     IN  A       __IPADDR4__\nexample.com.                     IN  AAAA    __IPADDR6__\n\ndevnull.example.com.             IN  A       __IPADDR4__\ndevnull.example.com.             IN  AAAA    __IPADDR6__\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/intro/#voraussetzungen-f\u00fcr-den-abschnitt-security","title":"Voraussetzungen f\u00fcr den Abschnitt Security","text":"<p>Es m\u00fcssen zuerst noch DNS-Records angelegt werden, sofern sie noch nicht existieren, oder entsprechend ge\u00e4ndert werden, sofern sie bereits existieren.</p> Text Only<pre><code>example.com.                     IN  CAA     0 issue \"letsencrypt.org\"\nexample.com.                     IN  CAA     0 issuewild \"letsencrypt.org\"\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/intro/#voraussetzungen-f\u00fcr-den-abschnitt-datenbanken","title":"Voraussetzungen f\u00fcr den Abschnitt Datenbanken","text":"<p>Da wir unsere Nutzdaten weitestgehend unter <code>/data</code> ablegen werden, legen wir ein paar hierf\u00fcr ben\u00f6tigte Verzeichnisse an, sofern nicht bereits geschehen.</p> Bash<pre><code>mkdir -p /data/db\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/intro/#voraussetzungen-f\u00fcr-den-abschnitt-webserver","title":"Voraussetzungen f\u00fcr den Abschnitt Webserver","text":"<p>Es m\u00fcssen zuerst noch DNS-Records angelegt werden, sofern sie noch nicht existieren, oder entsprechend ge\u00e4ndert werden, sofern sie bereits existieren.</p> Text Only<pre><code>www.example.com.                 IN  A       __IPADDR4__\nwww.example.com.                 IN  AAAA    __IPADDR6__\n</code></pre> <p>Da wir unsere Nutzdaten weitestgehend unter <code>/data</code> ablegen werden, legen wir ein paar hierf\u00fcr ben\u00f6tigte Verzeichnisse an, sofern nicht bereits geschehen.</p> Bash<pre><code>mkdir -p /data/www\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/intro/#voraussetzungen-f\u00fcr-den-abschnitt-mailserver","title":"Voraussetzungen f\u00fcr den Abschnitt Mailserver","text":"<p>Es m\u00fcssen zuerst noch DNS-Records angelegt werden, sofern sie noch nicht existieren, oder entsprechend ge\u00e4ndert werden, sofern sie bereits existieren.</p> Text Only<pre><code>example.com.                     IN  MX  10  mail.example.com.\n\nmail.example.com.                IN  A       __IPADDR4__\nmail.example.com.                IN  AAAA    __IPADDR6__\n\n_imap._tcp.example.com.          IN  SRV     0 0 .\n_imaps._tcp.example.com.         IN  SRV     1 993 mail.example.com.\n_pop3._tcp.example.com.          IN  SRV     0 0 .\n_pop3s._tcp.example.com.         IN  SRV     0 0 .\n_submission._tcp.example.com.    IN  SRV     1 587 mail.example.com.\n_submissions._tcp.example.com.   IN  SRV     1 465 mail.example.com.\n\nexample.com.                     IN  TXT     \"v=spf1 a mx ptr ~all\"\n\n_dmarc.example.com.              IN  TXT     \"v=DMARC1; p=none; sp=none; np=reject; adkim=s; aspf=s; fo=1; rua=mailto:postmaster@example.com!50m; ruf=mailto:postmaster@example.com!50m\"\n_report._dmarc.example.com.      IN  TXT     \"v=DMARC1;\"\n\n_adsp._domainkey.example.com.    IN  TXT     \"dkim=all\"\n</code></pre> <p>Wir ben\u00f6tigen f\u00fcr unsere Nutzdaten einen eigenen Systembenutzer <code>vmail</code>, welchen wir nun anlegen, sofern nicht bereits geschehen.</p> Bash<pre><code>pw groupadd -n vmail -g 5000\npw useradd -n vmail -u 5000 -g vmail -c 'Virtual Mailuser' -d /nonexistent -s /usr/sbin/nologin -w no\n\npw groupadd -n vacation -g 65501\npw useradd -n vacation -u 65501 -g vacation -c 'Vacation Notice' -d /nonexistent -s /usr/sbin/nologin -w no\n</code></pre> <p>Da wir unsere Nutzdaten weitestgehend unter <code>/data</code> ablegen werden, legen wir ein paar hierf\u00fcr ben\u00f6tigte Verzeichnisse an, sofern nicht bereits geschehen.</p> Bash<pre><code>mkdir -p /data/vmail\nchmod 0750 /data/vmail\nchown vmail:vmail /data/vmail\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/intro/#los-geht-es","title":"Los geht es","text":"<p>Die einzelnen HowTos bauen aufeinander auf, daher sollten sie in der Reihenfolge von oben nach unten bis zum Ende abgearbeitet werden.</p>"},{"location":"howtos/freebsd/hosting_system/databases/mysql/","title":"MySQL","text":""},{"location":"howtos/freebsd/hosting_system/databases/mysql/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>MySQL 8.0.42 (InnoDB, GTID)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/databases/mysql/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/databases/mysql/#installation","title":"Installation","text":"<p>MySQL unterst\u00fctzt mehrere Engines, dieses HowTo beschr\u00e4nkt sich allerdings auf die am H\u00e4ufigsten verwendete: InnoDB</p> <p>Wir installieren <code>databases/mysql80-server</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/comms_hidapi\ncat &lt;&lt;'EOF' &gt; /var/db/ports/comms_hidapi/options\n_OPTIONS_READ=hidapi-0.15.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/net_openldap26-client\ncat &lt;&lt;'EOF' &gt; /var/db/ports/net_openldap26-client/options\n_OPTIONS_READ=openldap26-client-2.6.10\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG DOCS FETCH GSSAPI\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=FETCH\nOPTIONS_FILE_UNSET+=GSSAPI\n\nEOF\n\nmkdir -p /var/db/ports/security_cyrus-sasl2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_cyrus-sasl2/options\n_OPTIONS_READ=cyrus-sasl-2.1.28\n_FILE_COMPLETE_OPTIONS_LIST=ALWAYSTRUE AUTHDAEMOND DOCS KEEP_DB_OPEN  OBSOLETE_CRAM_ATTR OBSOLETE_DIGEST_ATTR  OPIE SASLDB_IN_VAR BDB1 BDB GDBM LMDB ANONYMOUS CRAM DIGEST LOGIN NTLM OTP PLAIN SCRAM\nOPTIONS_FILE_UNSET+=ALWAYSTRUE\nOPTIONS_FILE_SET+=AUTHDAEMOND\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=KEEP_DB_OPEN\nOPTIONS_FILE_SET+=OBSOLETE_CRAM_ATTR\nOPTIONS_FILE_SET+=OBSOLETE_DIGEST_ATTR\nOPTIONS_FILE_UNSET+=OPIE\nOPTIONS_FILE_UNSET+=SASLDB_IN_VAR\nOPTIONS_FILE_UNSET+=BDB1\nOPTIONS_FILE_SET+=BDB\nOPTIONS_FILE_UNSET+=GDBM\nOPTIONS_FILE_UNSET+=LMDB\nOPTIONS_FILE_SET+=ANONYMOUS\nOPTIONS_FILE_SET+=CRAM\nOPTIONS_FILE_SET+=DIGEST\nOPTIONS_FILE_SET+=LOGIN\nOPTIONS_FILE_SET+=NTLM\nOPTIONS_FILE_SET+=OTP\nOPTIONS_FILE_SET+=PLAIN\nOPTIONS_FILE_SET+=SCRAM\n\nEOF\n\nmkdir -p /var/db/ports/textproc_groff\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_groff/options\n_OPTIONS_READ=groff-1.23.0\n_FILE_COMPLETE_OPTIONS_LIST=UCHARDET\nOPTIONS_FILE_SET+=UCHARDET\n\nEOF\n\nmkdir -p /var/db/ports/print_gsfonts\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_gsfonts/options\n_OPTIONS_READ=gsfonts-8.11\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/databases_mysql80-client\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_mysql80-client/options\n_OPTIONS_READ=mysql80-client-8.0.42\n_FILE_COMPLETE_OPTIONS_LIST= SASLCLIENT\nOPTIONS_FILE_SET+=SASLCLIENT\n\nEOF\n\nmkdir -p /var/db/ports/databases_mysql80-server\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_mysql80-server/options\n_OPTIONS_READ=mysql80-server-8.0.42\n_FILE_COMPLETE_OPTIONS_LIST= ARCHIVE BLACKHOLE EXAMPLE FEDERATED INNOBASE PARTITION PERFSCHEMA PERFSCHM\nOPTIONS_FILE_UNSET+=ARCHIVE\nOPTIONS_FILE_UNSET+=BLACKHOLE\nOPTIONS_FILE_UNSET+=EXAMPLE\nOPTIONS_FILE_UNSET+=FEDERATED\nOPTIONS_FILE_UNSET+=INNOBASE\nOPTIONS_FILE_UNSET+=PARTITION\nOPTIONS_FILE_UNSET+=PERFSCHEMA\nOPTIONS_FILE_SET+=PERFSCHM\n\nEOF\n\n\nportmaster -w -B -g --force-config databases/mysql80-server  -n\n\n\ncp -a /var/db/mysql* /data/db/\n\nsysrc mysql_enable=YES\nsysrc mysql_dbdir=\"/data/db/mysql\"\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/mysql/#konfiguration","title":"Konfiguration","text":"Note <p>Die Konfiguration orientiert sich an diesem RootForum Community Forenbeitrag.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/mysql/my.cnf\n[client]\nport                            = 3306\nsocket                          = /tmp/mysql.sock\n\n[mysqld]\nuser                            = mysql\nport                            = 3306\nsocket                          = /tmp/mysql.sock\nbind_address                    = 127.0.0.1,::1\nbasedir                         = /usr/local\ndatadir                         = /data/db/mysql\ntmpdir                          = /data/db/mysql_tmpdir\nsecure_file_priv                = /data/db/mysql_secure\nlog_bin                         = mysql-bin\nlog_output                      = TABLE,FILE\nrelay_log_recovery              = ON\nslow_query_log                  = OFF\nslow_query_log_file             = slow-query.log\nserver_id                       = 1\nsync_binlog                     = 1\nsync_relay_log                  = 1\nbinlog_cache_size               = 256K\nbinlog_stmt_cache_size          = 256K\nenforce_gtid_consistency        = ON\ngtid_mode                       = ON\nmax_connections                 = 101\nsafe_user_create                = ON\nlower_case_table_names          = 1\nmyisam_recover_options          = FORCE,BACKUP\nnet_retry_count                 = 16384\nopen_files_limit                = 32768\ntable_open_cache                = 8192\ntable_definition_cache          = 4096\njoin_buffer_size                = 512K\nsort_buffer_size                = 2048K\nread_buffer_size                = 256K\nread_rnd_buffer_size            = 512K\nmax_heap_table_size             = 256M\ntmp_table_size                  = 256M\nlong_query_time                 = 0.05\ninnodb_thread_concurrency       = 8\ninnodb_buffer_pool_size         = 2G\ninnodb_buffer_pool_instances    = 2\ninnodb_data_home_dir            = /data/db/mysql\ninnodb_log_group_home_dir       = /data/db/mysql\ninnodb_data_file_path           = ibdata1:1G;ibdata2:1G;ibdata3:128M:autoextend\ninnodb_temp_data_file_path      = ibtmp1:128M:autoextend\ninnodb_flush_method             = O_DIRECT\ninnodb_log_file_size            = 256M\ninnodb_sort_buffer_size         = 2048K\n#innodb_force_recovery           = 1\n#log_queries_not_using_indexes   = ON\nskip_name_resolve               = ON\n\nmysqlx                          = OFF\nmysqlx_port                     = 33060\nmysqlx_socket                   = /tmp/mysqlx.sock\nmysqlx_bind_address             = 127.0.0.1,::1\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/mysql/#sicherheit","title":"Sicherheit","text":"<p>MySQL wird nun zum ersten Mal gestartet, was durch das Erzeugen der InnoDB-Files einige Minuten dauern kann.</p> Bash<pre><code>service mysql-server start\n</code></pre> <p>Abschliessend wird das MySQL root-Passwort neu gesetzt und mittels <code>mysql_config_editor</code> verschl\u00fcsselt in <code>/root/.mylogin.cnf</code> gespeichert.</p> Bash<pre><code># Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for MySQL user root: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\n# First set new MySQL-root password\nmysqladmin -h localhost -uroot password --default-auth=caching_sha2_password\n\n# Setup /root/.mylogin.cnf\nmysql_config_editor set --login-path=client --host=::1 --host=127.0.0.1 --host=127.0.0.1 --socket=/tmp/mysql.sock --user=root --password\n</code></pre> <p>Wir erlauben dem MySQL-root User das Einloggen von <code>::1</code>, <code>127.0.0.1</code> und <code>localhost</code> mit dem zuvor festgelegtem Passwort.</p> Bash<pre><code>mysql -uroot\n\nALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY '__PASSWORD__' PASSWORD EXPIRE NEVER;\nCREATE USER 'root'@'127.0.0.1' IDENTIFIED WITH caching_sha2_password BY '__PASSWORD__' PASSWORD EXPIRE NEVER;\nCREATE USER 'root'@'::1' IDENTIFIED WITH caching_sha2_password BY '__PASSWORD__' PASSWORD EXPIRE NEVER;\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'127.0.0.1' WITH GRANT OPTION;\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'::1' WITH GRANT OPTION;\n\nFLUSH PRIVILEGES;\nQUIT;\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/mysql/#abschluss","title":"Abschluss","text":"<p>MySQL sollte abschliessend einmal neu gestartet werden.</p> Bash<pre><code>service mysql-server restart\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/postgresql/","title":"PostgreSQL","text":""},{"location":"howtos/freebsd/hosting_system/databases/postgresql/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>PostgreSQL 17.5</li> </ul>"},{"location":"howtos/freebsd/hosting_system/databases/postgresql/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/databases/postgresql/#installation","title":"Installation","text":"<p>Wir installieren <code>databases/postgresql17-server</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_postgresql17-client\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_postgresql7-client/options\n_OPTIONS_READ=postgresql17-client-17.5\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG DOCS GSSAPI LIBEDIT NLS OPTIMIZED_CFLAGS PAM SSL\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=GSSAPI\nOPTIONS_FILE_SET+=LIBEDIT\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=OPTIMIZED_CFLAGS\nOPTIONS_FILE_UNSET+=PAM\nOPTIONS_FILE_SET+=SSL\n\nEOF\n\nmkdir -p /var/db/ports/databases_postgresql17-server\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_postgresql17-server/options\n_OPTIONS_READ=postgresql17-server-17.5\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG DOCS DTRACE GSSAPI LDAP LLVM LZ4 NLS OPTIMIZED_CFLAGS PAM SSL TZDATA XML ZSTD\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=DTRACE\nOPTIONS_FILE_UNSET+=GSSAPI\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_UNSET+=LLVM\nOPTIONS_FILE_SET+=LZ4\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=OPTIMIZED_CFLAGS\nOPTIONS_FILE_UNSET+=PAM\nOPTIONS_FILE_SET+=SSL\nOPTIONS_FILE_UNSET+=TZDATA\nOPTIONS_FILE_SET+=XML\nOPTIONS_FILE_SET+=ZSTD\n\nEOF\n\n\nportmaster -w -B -g --force-config databases/postgresql17-server  -n\nportmaster -w -B -g --force-config databases/postgresql17-contrib  -n\n\n\ncp -a /var/db/postgres* /data/db/\n\nsysrc postgresql_enable=YES\nsysrc postgresql_data=\"/data/db/postgres/data17\"\nsysrc postgresql_initdb_flags=\"--encoding=utf-8 --lc-collate=C --auth=scram-sha-256 --pwprompt\"\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/postgresql/#konfiguration","title":"Konfiguration","text":"<p>PostgreSQL wird nun zum ersten Mal gestartet, was einige Minuten dauern kann.</p> Bash<pre><code># Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostgreSQL initdb: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\nservice postgresql initdb\n\nservice postgresql start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/postgresql/#sicherheit","title":"Sicherheit","text":"Bash<pre><code># Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostgreSQL user postges: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\npasswd postgres\n\n\ncat &lt;&lt;'EOF' &gt;&gt; /data/db/postgres/data17/pg_hba.conf\n#\n# test_db databases\n#\n# TYPE  DATABASE        USER            ADDRESS                 METHOD\n#\nlocal   test_db         admin                                   scram-sha-256\nhost    test_db         admin           127.0.0.1/32            scram-sha-256\nhost    test_db         admin           ::1/128                 scram-sha-256\n#\nEOF\n\nsu - postgres\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostgreSQL user admin: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\ncreateuser -U postgres -S -D -R -P -e admin\n\ncreatedb -U postgres -E unicode -O admin test_db\n\npsql test_db\n\nGRANT ALL PRIVILEGES ON DATABASE test_db TO admin;\nQUIT;\n\nexit\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/databases/postgresql/#abschluss","title":"Abschluss","text":"<p>PostgreSQL sollte abschliessend einmal neu gestartet werden.</p> Bash<pre><code>service postgresql restart\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/amavisd/","title":"Amavisd","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/amavisd/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>Amavisd</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/amavisd/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/amavisd/#installation","title":"Installation","text":"<p>Wir installieren <code>security/amavisd-new</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/archivers_7-zip\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_7-zip/options\n_OPTIONS_READ=7-zip-24.09\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_arc\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_arc/options\n_OPTIONS_READ=arc-5.21q\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_arj\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_arj/options\n_OPTIONS_READ=arj-3.10.22\n_FILE_COMPLETE_OPTIONS_LIST=DOCS LOCALE_DE LOCALE_EN LOCALE_RU\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=LOCALE_DE\nOPTIONS_FILE_SET+=LOCALE_EN\nOPTIONS_FILE_UNSET+=LOCALE_RU\n\nEOF\n\nmkdir -p /var/db/ports/archivers_cabextract\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_cabextract/options\n_OPTIONS_READ=cabextract-1.11\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_lzop\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_lzop/options\n_OPTIONS_READ=lzop-1.04\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_lzo2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_lzo2/options\n_OPTIONS_READ=lzo2-2.10\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/archivers_unarj\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_unarj/options\n_OPTIONS_READ=unarj-2.65\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_unrar\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_unrar/options\n_OPTIONS_READ=unrar-7.11\n_FILE_COMPLETE_OPTIONS_LIST=OPENSSL_AES\nOPTIONS_FILE_SET+=OPENSSL_AES\n\nEOF\n\nmkdir -p /var/db/ports/net-mgmt_p0f\ncat &lt;&lt;'EOF' &gt; /var/db/ports/net-mgmt_p0f/options\n_OPTIONS_READ=p0f-3.09b\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/security_amavisd-new\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_amavisd-new/options\n_OPTIONS_READ=amavisd-new-2.13.1\n_FILE_COMPLETE_OPTIONS_LIST=7ZIP ARC ARJ BDB CAB DOCS FILE IPV6 LDAP LHA LZOP MSWORD MYSQL NOMARCH P0F PGSQL RAR RPM SASL SNMP SPAMASSASSIN SQLITE TNEF UNARJ UNRAR UNZOO ZOO\nOPTIONS_FILE_SET+=7ZIP\nOPTIONS_FILE_SET+=ARC\nOPTIONS_FILE_SET+=ARJ\nOPTIONS_FILE_SET+=BDB\nOPTIONS_FILE_SET+=CAB\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=FILE\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=LHA\nOPTIONS_FILE_SET+=LZOP\nOPTIONS_FILE_SET+=MSWORD\nOPTIONS_FILE_SET+=MYSQL\nOPTIONS_FILE_UNSET+=NOMARCH\nOPTIONS_FILE_SET+=P0F\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_UNSET+=RAR\nOPTIONS_FILE_SET+=RPM\nOPTIONS_FILE_UNSET+=SASL\nOPTIONS_FILE_UNSET+=SNMP\nOPTIONS_FILE_SET+=SPAMASSASSIN\nOPTIONS_FILE_UNSET+=SQLITE\nOPTIONS_FILE_UNSET+=TNEF\nOPTIONS_FILE_SET+=UNARJ\nOPTIONS_FILE_SET+=UNRAR\nOPTIONS_FILE_SET+=UNZOO\nOPTIONS_FILE_SET+=ZOO\n\nEOF\n\n\nportmaster -w -B -g --force-config security/amavisd-new  -n\n\n\nsysrc amavisd_enable=\"YES\"\nsysrc amavisd_pidfile=\"/var/amavis/var/amavisd.pid\"\nsysrc amavis_milter_enable=\"YES\"\nsysrc amavis_p0fanalyzer_enable=\"YES\"\nsysrc amavis_p0fanalyzer_p0f_filter=\"tcp dst port 25\"\n</code></pre> <p>Datenbanken installieren.</p> Bash<pre><code>mkdir -p /data/db/postgres\n\ncat &lt;&lt;'EOF' &gt; /tmp/amavisd_mail_prefs_shema.sql\nCREATE TABLE policy (\n  id            serial PRIMARY KEY, -- 'id' is the _only_ required field\n  policy_name   varchar(32),        -- not used by amavis, a comment\n\n  virus_lover           char(1) default NULL,     -- Y/N\n  spam_lover            char(1) default NULL,     -- Y/N\n  unchecked_lover       char(1) default NULL,     -- Y/N\n  banned_files_lover    char(1) default NULL,     -- Y/N\n  bad_header_lover      char(1) default NULL,     -- Y/N\n\n  bypass_virus_checks   char(1) default NULL,     -- Y/N\n  bypass_spam_checks    char(1) default NULL,     -- Y/N\n  bypass_banned_checks  char(1) default NULL,     -- Y/N\n  bypass_header_checks  char(1) default NULL,     -- Y/N\n\n  virus_quarantine_to      varchar(64) default NULL,\n  spam_quarantine_to       varchar(64) default NULL,\n  banned_quarantine_to     varchar(64) default NULL,\n  unchecked_quarantine_to  varchar(64) default NULL,\n  bad_header_quarantine_to varchar(64) default NULL,\n  clean_quarantine_to      varchar(64) default NULL,\n  archive_quarantine_to    varchar(64) default NULL,\n\n  spam_tag_level  real default NULL, -- higher score inserts spam info headers\n  spam_tag2_level real default NULL, -- inserts 'declared spam' header fields\n  spam_tag3_level real default NULL, -- inserts 'blatant spam' header fields\n  spam_kill_level real default NULL, -- higher score triggers evasive actions\n                                     -- e.g. reject/drop, quarantine, ...\n                                     -- (subject to final_spam_destiny setting)\n\n  spam_dsn_cutoff_level        real default NULL,\n  spam_quarantine_cutoff_level real default NULL,\n\n  addr_extension_virus      varchar(64) default NULL,\n  addr_extension_spam       varchar(64) default NULL,\n  addr_extension_banned     varchar(64) default NULL,\n  addr_extension_bad_header varchar(64) default NULL,\n\n  warnvirusrecip      char(1)     default NULL, -- Y/N\n  warnbannedrecip     char(1)     default NULL, -- Y/N\n  warnbadhrecip       char(1)     default NULL, -- Y/N\n  newvirus_admin      varchar(64) default NULL,\n  virus_admin         varchar(64) default NULL,\n  banned_admin        varchar(64) default NULL,\n  bad_header_admin    varchar(64) default NULL,\n  spam_admin          varchar(64) default NULL,\n  spam_subject_tag    varchar(64) default NULL,\n  spam_subject_tag2   varchar(64) default NULL,\n  spam_subject_tag3   varchar(64) default NULL,\n  message_size_limit  integer     default NULL, -- max size in bytes, 0 disable\n  banned_rulenames    varchar(64) default NULL, -- comma-separated list of ...\n        -- names mapped through %banned_rules to actual banned_filename tables\n  disclaimer_options  varchar(64) default NULL,\n  forward_method      varchar(64) default NULL,\n  sa_userconf         varchar(64) default NULL,\n  sa_username         varchar(64) default NULL\n);\n\n-- local users\nCREATE TABLE users (\n  id         serial  PRIMARY KEY,  -- unique id\n  priority   integer NOT NULL DEFAULT 7,  -- sort field, 0 is low prior.\n  policy_id  integer NOT NULL DEFAULT 1 CHECK (policy_id &gt;= 0) REFERENCES policy(id),\n  email      bytea   NOT NULL UNIQUE,     -- email address, non-rfc2822-quoted\n  fullname   varchar(255) DEFAULT NULL    -- not used by amavis\n  -- local   char(1)      -- Y/N  (optional, see SQL section in README.lookups)\n);\n\n-- any e-mail address (non- rfc2822-quoted), external or local,\n-- used as senders in wblist\nCREATE TABLE mailaddr (\n  id         serial  PRIMARY KEY,\n  priority   integer NOT NULL DEFAULT 9,  -- 0 is low priority\n  email      bytea   NOT NULL UNIQUE\n);\n\n-- per-recipient whitelist and/or blacklist,\n-- puts sender and recipient in relation wb  (white or blacklisted sender)\nCREATE TABLE wblist (\n  rid        integer NOT NULL CHECK (rid &gt;= 0) REFERENCES users(id),\n  sid        integer NOT NULL CHECK (sid &gt;= 0) REFERENCES mailaddr(id),\n  wb         varchar(10) NOT NULL,  -- W or Y / B or N / space=neutral / score\n  PRIMARY KEY (rid,sid)\n);\n\n-- grant usage rights:\nGRANT select ON policy   TO vscan;\nGRANT select ON users    TO vscan;\nGRANT select ON mailaddr TO vscan;\nGRANT select ON wblist   TO vscan;\nEOF\n\ncat &lt;&lt;'EOF' &gt; /tmp/amavisd_mail_log_shema.sql\n-- R/W part of the dataset (optional)\n--   May reside in the same or in a separate database as lookups database;\n--   REQUIRES SUPPORT FOR TRANSACTIONS; specified in @storage_sql_dsn\n--\n--  Please create additional indexes on keys when needed, or drop suggested\n--  ones as appropriate to optimize queries needed by a management application.\n--  See your database documentation for further optimization hints.\n\n-- provide unique id for each e-mail address, avoids storing copies\nCREATE TABLE maddr (\n  id         serial       PRIMARY KEY,\n  partition_tag integer   DEFAULT 0,   -- see $partition_tag\n  email      bytea        NOT NULL,    -- full e-mail address\n  domain     varchar(255) NOT NULL,    -- only domain part of the email address\n                                       -- with subdomain fields in reverse\n  CONSTRAINT part_email UNIQUE (partition_tag,email)\n);\n\n-- information pertaining to each processed message as a whole;\n-- NOTE: records with a NULL msgs.content should be ignored by utilities,\n--   as such records correspond to messages just being processed, or were lost\nCREATE TABLE msgs (\n  partition_tag integer     DEFAULT 0,  -- see $partition_tag\n  mail_id     bytea         NOT NULL,   -- long-term unique mail id, dflt 12 ch\n  secret_id   bytea         DEFAULT '', -- authorizes release of mail_id, 12 ch\n  am_id       varchar(20)   NOT NULL,   -- id used in the log\n  time_num    integer NOT NULL CHECK (time_num &gt;= 0),\n                                        -- rx_time: seconds since Unix epoch\n  time_iso timestamp WITH TIME ZONE NOT NULL,-- rx_time: ISO8601 UTC ascii time\n  sid         integer NOT NULL CHECK (sid &gt;= 0), -- sender: maddr.id\n  policy      varchar(255)  DEFAULT '', -- policy bank path (like macro %p)\n  client_addr varchar(255)  DEFAULT '', -- SMTP client IP address (IPv4 or v6)\n  size        integer NOT NULL CHECK (size &gt;= 0), -- message size in bytes\n  originating char(1) DEFAULT ' ' NOT NULL,  -- sender from inside or auth'd\n  content     char(1),                   -- content type: V/B/U/S/Y/M/H/O/T/C\n    -- virus/banned/unchecked/spam(kill)/spammy(tag2)/\n    -- /bad-mime/bad-header/oversized/mta-err/clean\n    -- is NULL on partially processed mail\n    -- (prior to 2.7.0 the CC_SPAMMY was logged as 's', now 'Y' is used;\n    --- to avoid a need for case-insenstivity in queries)\n  quar_type  char(1),                   -- quarantined as: ' '/F/Z/B/Q/M/L\n                                        --  none/file/zipfile/bsmtp/sql/\n                                        --  /mailbox(smtp)/mailbox(lmtp)\n  quar_loc   varchar(255)  DEFAULT '',  -- quarantine location (e.g. file)\n  dsn_sent   char(1),                   -- was DSN sent? Y/N/q (q=quenched)\n  spam_level real,                      -- SA spam level (no boosts)\n  message_id varchar(255)  DEFAULT '',  -- mail Message-ID header field\n  from_addr  varchar(255)  DEFAULT '',  -- mail From header field,    UTF8\n  subject    varchar(255)  DEFAULT '',  -- mail Subject header field, UTF8\n  host       varchar(255)  NOT NULL,    -- hostname where amavisd is running\n  CONSTRAINT msgs_partition_mail UNIQUE (partition_tag,mail_id),\n  PRIMARY KEY (partition_tag,mail_id)\n--FOREIGN KEY (sid) REFERENCES maddr(id) ON DELETE RESTRICT\n);\nCREATE INDEX msgs_idx_sid      ON msgs (sid);\nCREATE INDEX msgs_idx_mess_id  ON msgs (message_id); -- useful with pen pals\nCREATE INDEX msgs_idx_time_iso ON msgs (time_iso);\nCREATE INDEX msgs_idx_time_num ON msgs (time_num);   -- optional\n\n-- per-recipient information related to each processed message;\n-- NOTE: records in msgrcpt without corresponding msgs.mail_id record are\n--  orphaned and should be ignored and eventually deleted by external utilities\nCREATE TABLE msgrcpt (\n  partition_tag integer DEFAULT 0,  -- see $partition_tag\n  mail_id    bytea    NOT NULL,     -- (must allow duplicates)\n  rseqnum    integer  DEFAULT 0   NOT NULL, -- recip's enumeration within msg\n  rid        integer  NOT NULL,     -- recipient: maddr.id (duplicates allowed)\n  is_local   char(1)  DEFAULT ' ' NOT NULL, -- recip is: Y=local, N=foreign\n  content    char(1)  DEFAULT ' ' NOT NULL, -- content type V/B/U/S/Y/M/H/O/T/C\n  ds         char(1)  NOT NULL,     -- delivery status: P/R/B/D/T\n                                    -- pass/reject/bounce/discard/tempfail\n  rs         char(1)  NOT NULL,     -- release status: initialized to ' '\n  bl         char(1)  DEFAULT ' ',  -- sender blacklisted by this recip\n  wl         char(1)  DEFAULT ' ',  -- sender whitelisted by this recip\n  bspam_level real,                 -- per-recipient (total) spam level\n  smtp_resp  varchar(255) DEFAULT '', -- SMTP response given to MTA\n  CONSTRAINT msgrcpt_partition_mail_rseq UNIQUE (partition_tag,mail_id,rseqnum),\n  PRIMARY KEY (partition_tag,mail_id,rseqnum)\n--FOREIGN KEY (rid)     REFERENCES maddr(id)     ON DELETE RESTRICT,\n--FOREIGN KEY (mail_id) REFERENCES msgs(mail_id) ON DELETE CASCADE\n);\nCREATE INDEX msgrcpt_idx_mail_id  ON msgrcpt (mail_id);\nCREATE INDEX msgrcpt_idx_rid      ON msgrcpt (rid);\n\n-- mail quarantine in SQL, enabled by $*_quarantine_method='sql:'\n-- NOTE: records in quarantine without corresponding msgs.mail_id record are\n--  orphaned and should be ignored and eventually deleted by external utilities\nCREATE TABLE quarantine (\n  partition_tag integer  DEFAULT 0,      -- see $partition_tag\n  mail_id    bytea   NOT NULL,           -- long-term unique mail id\n  chunk_ind  integer NOT NULL CHECK (chunk_ind &gt;= 0), -- chunk number, 1..\n  mail_text  bytea   NOT NULL,           -- store mail as chunks of octects\n  PRIMARY KEY (partition_tag,mail_id,chunk_ind)\n--FOREIGN KEY (mail_id) REFERENCES msgs(mail_id) ON DELETE CASCADE\n);\n\n-- field msgrcpt.rs is primarily intended for use by quarantine management\n-- software; the value assigned by amavisd is a space;\n-- a short _preliminary_ list of possible values:\n--   'V' =&gt; viewed (marked as read)\n--   'R' =&gt; released (delivered) to this recipient\n--   'p' =&gt; pending (a status given to messages when the admin received the\n--                   request but not yet released; targeted to banned parts)\n--   'D' =&gt; marked for deletion; a cleanup script may delete it\n\n-- grant usage rights:\nGRANT select,insert,update,delete ON maddr        TO vscan;\nGRANT usage,update                ON maddr_id_seq TO vscan;\nGRANT select,insert,update,delete ON msgs         TO vscan;\nGRANT select,insert,update,delete ON msgrcpt      TO vscan;\nGRANT select,insert,update,delete ON quarantine   TO vscan;\nEOF\n\n\ncat &lt;&lt;'EOF' &gt;&gt; /data/db/postgres/data17/pg_hba.conf\n#\n# amavisd databases\n#\n# TYPE  DATABASE        USER            ADDRESS                 METHOD\n#\nlocal   mail_prefs      vscan                                   scram-sha-256\nhost    mail_prefs      vscan           127.0.0.1/32            scram-sha-256\nhost    mail_prefs      vscan           ::1/128                 scram-sha-256\nlocal   mail_log        vscan                                   scram-sha-256\nhost    mail_log        vscan           127.0.0.1/32            scram-sha-256\nhost    mail_log        vscan           ::1/128                 scram-sha-256\n#\nEOF\n\nsu - postgres\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostgreSQL user vscan: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\ncreateuser -U postgres -S -D -R -P -e vscan\n\n\ncreatedb -U postgres -E unicode -O vscan mail_prefs\n\npsql mail_prefs\n\nGRANT ALL PRIVILEGES ON DATABASE mail_prefs TO vscan;\nQUIT;\n\npsql -U vscan mail_prefs &lt; /tmp/amavisd_mail_prefs_shema.sql\n\n\ncreatedb -U postgres -E unicode -O vscan mail_log\n\npsql mail_log\n\nGRANT ALL PRIVILEGES ON DATABASE mail_log TO vscan;\nQUIT;\n\npsql -U vscan mail_log &lt; /tmp/amavisd_mail_log_shema.sql\n\n\nexit\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/amavisd/#konfigurieren","title":"Konfigurieren","text":"<p><code>amavisd.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/amavisd.conf\nuse strict;\n$myprogram_name = $0;\n$myhostname = 'mail.example.com';\n$mydomain = 'example.com';\n$daemon_user = 'vscan';\n$daemon_group = 'vscan';\n$MYHOME = '/var/amavis';\n$TEMPBASE = \"$MYHOME/tmp\";\n$ENV{TMPDIR} = $TEMPBASE;\n$db_home = \"$MYHOME/db\";\n$pid_file  = \"$MYHOME/var/amavisd.pid\";\n$lock_file = \"$MYHOME/var/amavisd.lock\";\n$max_servers = 2;\n$enable_db = 0;\n$nanny_details_level = 2;\n@local_domains_maps = 1;\n@mynetworks = qw(\n    127.0.0.0/8 [::1]/128\n    10.0.0.0/8 [fe80::]/10\n    __IPADDR4__/32 [__IPADDR6__]/64\n);\n$log_level = 3;\n$logfile  = \"$MYHOME/var/amavisd.log\";\n$log_templ = $log_verbose_templ;\n$sa_debug = 1;\n$enable_dkim_verification = 1;\n$myauthservid = $myhostname;\n$enable_dkim_signing = 0;\ndkim_key('example.com', \"20250426\", \"$MYHOME/db/keys/example.com/20250426.pem\");\n@dkim_signature_options_bysender_maps = ({\n    \"example.com\"  =&gt; { d =&gt; \"example.com\", a =&gt; 'rsa-sha256', c =&gt; 'relaxed/simple', ttl =&gt; 10*24*3600 },\n    '.'            =&gt; { d =&gt; 'example.com', a =&gt; 'rsa-sha256', c =&gt; 'relaxed/simple', ttl =&gt; 30*24*3600 },\n});\nfor (qw(Received))                       { $signed_header_fields{lc $_} = 0 }\nfor (qw(Accept-Language Archived-At Auto-Submitted Content-Alternative\n        Content-Base Content-Class Content-Description Content-Disposition\n        Content-Duration Content-Features Content-Id Content-Language\n        Content-Location Content-MD5 Content-Transfer-Encoding In-Reply-To\n        List-Archive List-Help List-Id List-Owner List-Post List-Subscribe\n        List-Unsubscribe Message-Context Message-ID MIME-Version\n        Organisation Organization Original-Message-ID Pics-Label\n        Precedence References Reply-To Resent-Date Resent-From\n        Resent-Message-ID Resent-Sender Sensitivity Solicitation\n        User-Agent VBR-Info X-Mailer))   { $signed_header_fields{lc $_} = 1 }\nfor (qw(From Date Subject Content-Type)) { $signed_header_fields{lc $_} = 2 }\n$unix_socketname = \"$MYHOME/var/amavisd.sock\";\n$inet_socket_port = [ 10024, 10026 ];\n$inet_socket_bind = [ '127.0.0.1', '[::1]' ];\n@inet_acl = qw( 127.0.0.1 [::1] );\n$smtp_connection_cache_enable = 0;\n$localhost_name = $myhostname;\n$forward_method = 'smtp:[127.0.0.1]:10025';\n$final_virus_destiny = D_DISCARD;\n$final_banned_destiny = D_DISCARD;\n$final_spam_destiny   = D_PASS;\n$final_bad_header_destiny = D_PASS;\n$virus_quarantine_method = 'sql:';\n$spam_quarantine_method = 'sql:';\n$banned_files_quarantine_method = 'sql:';\n$bad_header_quarantine_method = 'sql:';\n$QUARANTINEDIR = '/var/virusmails';\n$quarantine_subdir_levels = 2;\n$mailfrom_to_quarantine = '';\n$notify_method = 'smtp:[127.0.0.1]:10025';\n$virus_admin = \"virusalert\\@$mydomain\";\n$mailfrom_notify_admin = \"virusalert\\@$mydomain\";\n$mailfrom_notify_recip = \"virusalert\\@$mydomain\";\n$mailfrom_notify_spamadmin = \"spam.police\\@$mydomain\";\n$defang_virus = 1;\n$defang_banned = 1;\n$altermime = '/usr/local/bin/altermime';\n@altermime_args_disclaimer = qw(--disclaimer=/usr/local/etc/postfix/disclaimer/_OPTION_.txt --disclaimer-html=/usr/local/etc/postfix/disclaimer/_OPTION_.txt --force-for-bad-html);\n@disclaimer_options_bysender_maps = ({\n  '.' =&gt; 'default',\n},);\n$undecipherable_subject_tag = undef;\n$sa_spam_modifies_subj = 1;\n$sa_spam_subject_tag = '[SPAM] ';\n$recipient_delimiter = '+';\n@addr_extension_virus_maps = ('virus');\n@addr_extension_banned_maps = ('banned');\n@addr_extension_spam_maps = ('spam');\n@addr_extension_bad_header_maps = ('badh');\n$bypass_decode_parts = 1;\n@keep_decoded_original_maps = (new_RE(\n  qr'^MAIL$',\n  qr'^MAIL-UNDECIPHERABLE$',\n  qr'^(ASCII(?! cpio)|text|uuencoded|xxencoded|binhex)'i,\n));\n$MAXLEVELS = 14;\n$MAXFILES = 3000;\n$MIN_EXPANSION_QUOTA = 100*1024;\n$MAX_EXPANSION_QUOTA = 500*1024*1024;\n$path = '/usr/local/sbin:/usr/local/bin:/usr/sbin:/sbin:/usr/bin:/bin';\n@decoders = (\n  ['mail', \\&amp;do_mime_decode],\n  ['F',    \\&amp;do_uncompress, ['unfreeze', 'freeze -d', 'melt', 'fcat'] ],\n  ['Z',    \\&amp;do_uncompress, ['uncompress', 'gzip -d', 'zcat'] ],\n  ['gz',   \\&amp;do_uncompress, 'gzip -d'],\n  ['gz',   \\&amp;do_gunzip],\n  ['bz2',  \\&amp;do_uncompress, 'bzip2 -d'],\n  ['xz',   \\&amp;do_uncompress,\n           ['xzdec', 'xz -dc', 'unxz -c', 'xzcat'] ],\n  ['lzma', \\&amp;do_uncompress,\n           ['lzmadec', 'xz -dc --format=lzma',\n            'lzma -dc', 'unlzma -c', 'lzcat', 'lzmadec'] ],\n  ['lrz',  \\&amp;do_uncompress,\n           ['lrzip -q -k -d -o -', 'lrzcat -q -k'] ],\n  ['lzo',  \\&amp;do_uncompress, 'lzop -d'],\n  ['lzip', \\&amp;do_uncompress, ['lzip -d'] ],\n  ['lz4',  \\&amp;do_uncompress, ['lz4c -d'] ],\n  ['rpm',  \\&amp;do_uncompress, ['rpm2cpio.pl', 'rpm2cpio'] ],\n  [['cpio','tar'], \\&amp;do_pax_cpio, ['pax', 'gcpio', 'cpio'] ],\n  ['deb',  \\&amp;do_ar, 'ar'],\n  ['rar',  \\&amp;do_unrar, ['unrar', 'rar'] ],\n  ['arj',  \\&amp;do_unarj, ['unarj', 'arj'] ],\n  ['arc',  \\&amp;do_arc,   ['nomarch', 'arc'] ],\n  ['zoo',  \\&amp;do_zoo,   ['zoo', 'unzoo'] ],\n  ['doc',  \\&amp;do_ole,   'ripole'],\n  ['cab',  \\&amp;do_cabextract, 'cabextract'],\n  ['tnef', \\&amp;do_tnef_ext, 'tnef'],\n  ['tnef', \\&amp;do_tnef],\n  [['zip','kmz'], \\&amp;do_7zip,  ['7za', '7zz', '7z'] ],\n  [['zip','kmz'], \\&amp;do_unzip],\n  ['zst',  \\&amp;do_uncompress, ['unzstd'] ],\n  [[qw(7z lzma xz)],\n           \\&amp;do_7zip,  ['7zr', '7za', '7zz', '7z'] ],\n  [[qw(bz2 Z cab gz tar zst)],\n           \\&amp;do_7zip,  ['7za', '7zz', '7z'] ],\n  [[qw(arj cpio deb iso jar lha rar rpm swf)],\n           \\&amp;do_7zip,  ['7zz', '7z'] ],\n  ['exe',  \\&amp;do_executable, ['unrar','rar'], 'lha', ['unarj','arj'] ],\n);\n$pax = 'pax';\n@av_scanners = (\n  ['ClamAV-clamdscan', 'clamdscan', \"--fdpass --stdout --no-summary {}\",\n    [0], qr/:.*\\sFOUND$/m, qr/^.*?: (?!Infected Archive)(.*) FOUND$/m ],\n);\n@av_scanners_backup = (\n  ['ClamAV-clamscan', 'clamscan',\n    \"--stdout --no-summary -r --tempdir=$TEMPBASE {}\",\n    [0], qr/:.*\\sFOUND$/m, qr/^.*?: (?!Infected Archive)(.*) FOUND$/m ],\n);\n@virus_name_to_spam_score_maps =(new_RE(\n  [ qr'^Structured\\.(SSN|CreditCardNumber)\\b'            =&gt; 0.1 ],\n  [ qr'^(Heuristics\\.)?Phishing\\.'                       =&gt; 0.1 ],\n  [ qr'^(Email|HTML)\\.Phishing\\.(?!.*Sanesecurity)'      =&gt; 0.1 ],\n  [ qr'^Sanesecurity\\.(Malware|Badmacro|Foxhole|Rogue|Trojan)\\.' =&gt; undef ],\n  [ qr'^Sanesecurity\\.Foxhole\\.Zip_exe'                  =&gt; 0.1 ], # F.P.\n  [ qr'^Sanesecurity\\.MalwareHash\\.'                     =&gt; undef ],\n  [ qr'^Sanesecurity.TestSig_'                           =&gt; undef ],\n  [ qr'^Sanesecurity\\.'                                  =&gt; 0.1 ],\n  [ qr'^Email\\.Spam\\.Bounce(\\.[^., ]*)*\\.Sanesecurity\\.' =&gt; 0   ],\n  [ qr'^Email\\.Spammail\\b'                               =&gt; 0.1 ],\n  [ qr'^MSRBL-(Images|SPAM)\\b'                           =&gt; 0.1 ],\n  [ qr'^VX\\.Honeypot-SecuriteInfo\\.com\\.Joke'            =&gt; 0.1 ],\n  [ qr'^VX\\.not-virus_(Hoax|Joke)\\..*-SecuriteInfo\\.com(\\.|\\z)' =&gt; 0.1 ],\n  [ qr'^Email\\.Spam.*-SecuriteInfo\\.com(\\.|\\z)'          =&gt; 0.1 ],\n  [ qr'^Safebrowsing\\.'                                  =&gt; 0.1 ],\n  [ qr'^winnow\\.(Exploit|Trojan|malware)\\.'              =&gt; undef ],\n  [ qr'^winnow\\.(botnet|compromised|trojan)'             =&gt; undef ],\n  [ qr'^winnow\\.(exe|ms|JS)\\.'                           =&gt; undef ],\n  [ qr'^winnow\\.(phish|spam)\\.'                          =&gt; 3.0 ],\n  [ qr'^winnow\\.'                                        =&gt; 0.1 ],\n  [ qr'^INetMsg\\.SpamDomain'                             =&gt; 0.1 ],\n  [ qr'^Doppelstern\\.(Spam|Scam|Phishing|Junk|Lott|Loan)'=&gt; 0.1 ],\n  [ qr'^Bofhland\\.Malware\\.'                             =&gt; undef ],\n  [ qr'^BofhlandMWFile'                                  =&gt; undef ],\n  [ qr'^Bofhland\\.Phishing\\.'                            =&gt; 3.0 ],\n  [ qr'^Bofhland\\.'                                      =&gt; 0.1 ],\n  [ qr'^ScamNailer\\.'                                    =&gt; 0.1 ],\n  [ qr'^HTML/Bankish'                                    =&gt; 0.1 ],\n  [ qr'^Porcupine\\.(Malware|Trojan)\\.'                   =&gt; undef ],\n  [ qr'^Porcupine\\.(Junk|Spammer)\\.'                     =&gt; 3.0 ],\n  [ qr'^Porcupine\\.Phishing\\.'                           =&gt; 3.0 ],\n  [ qr'^Porcupine\\.'                                     =&gt; 0.01 ],\n  [ qr'^PhishTank\\.Phishing\\.'                           =&gt; 3.0 ],\n  [ qr'^SecuriteInfo\\.com\\.Spam'                         =&gt; 3.0 ],\n  [ qr'(-)?SecuriteInfo\\.com(\\.|\\z)'                     =&gt; undef ],\n  [ qr'^MBL_NA\\.UNOFFICIAL'                              =&gt; 0.1 ],\n  [ qr'^MBL_'                                            =&gt; undef ],\n));\n%banned_rules = (\n  'ALLOW_MS_OFFICE'   =&gt; new_RE([qr'.\\.(doc|docx|xls|xlsx|ppt|pptx)$'i =&gt; 0]),\n  'ALLOW_MS_WORD'     =&gt; new_RE([qr'.\\.(doc|docx)$'i =&gt; 0]),\n  'ALLOW_MS_EXCEL'    =&gt; new_RE([qr'.\\.(xls|xlsx)$'i =&gt; 0]),\n  'ALLOW_MS_PPT'      =&gt; new_RE([qr'.\\.(ppt|pptx)$'i =&gt; 0]),\n  'DEFAULT'           =&gt; $banned_filename_re,\n);\n$banned_filename_re = new_RE(\n  qr'^\\.(exe-ms|dll)$',\n  [ qr'^\\.(rpm|cpio|tar)$' =&gt; 0 ],\n  qr'.\\.(pif|scr)$'i,\n  qr'^application/x-msdownload$'i,\n  qr'^application/x-msdos-program$'i,\n  qr'^application/hta$'i,\n  qr'^(?!cid:).*\\.[^./]*[A-Za-z][^./]*\\.\\s*(exe|vbs|pif|scr|bat|cmd|com|cpl|dll)[.\\s]*$'i,\n  qr'.\\.(exe|vbs|pif|scr|cpl)$'i,\n);\n$banned_namepath_re = new_RE(\n  [qr'T=x-(msdownload|msdos-program|msmetafile)(,|\\t)'xmi =&gt; 'DISCARD'],\n  [qr'T=(hta)(,|\\t)'xmi =&gt; 'DISCARD'],\n  [qr'T=(9|386|LeChiffre|aaa|abc|aepl|ani|aru|atm|aut|b64|bat|bhx|bkd|blf|bll|bmw|boo|bps|bqf|breaking_bad|buk|bup|bxz|cc|ccc|ce0|ceo|cfxxe|chm|cih|cla|class|cmd|com|cpl|crinf|crjoker|crypt|cryptolocker|cryptowall|ctbl|cxq|cyw|dbd|delf|dev|dlb|dli|dll|dllx|dom|drv|dx|dxz|dyv|dyz|ecc|exe|exe-ms|exe1|exe_renamed|exx|ezt|ezz|fag|fjl|fnr|fuj|good|gzquar|hlp|hlw|hqx|hsq|hts|iva|iws|jar|js|kcd|keybtc@inbox_com|let|lik|lkh|lnk|locky|lok|lol!|lpaq5|magic|mfu|micro|mim|mjg|mjz|nls|oar|ocx|osa|ozd|pcx|pgm|php2|php3|pid|pif|plc|pr|pzdc|qit|qrn|r5a|rhk|rna|rsc_tmp|s7p|scr|shs|ska|smm|smtmp|sop|spam|ssy|swf|sys|tko|tps|tsa|tti|ttt|txs|upa|uu|uue|uzy|vb|vba|vbe|vbs|vbx|vexe|vxd|vzr|wlpginstall|ws|wsc|wsf|wsh|wss|xdu|xir|xlm|xlv|xnt|xnxx|xtbl|xxe|xxx|xyz|zix|zvz|zzz)(,|\\t)'xmi =&gt; 'DISCARD'],\n  [qr'N=.*\\.(9|386|LeChiffre|aaa|abc|aepl|ani|aru|atm|aut|b64|bat|bhx|bkd|blf|bll|bmw|boo|bps|bqf|breaking_bad|buk|bup|bxz|cc|ccc|ce0|ceo|cfxxe|chm|cih|cla|class|cmd|com|cpl|crinf|crjoker|crypt|cryptolocker|cryptowall|ctbl|cxq|cyw|dbd|delf|dev|dlb|dli|dll|dllx|dom|drv|dx|dxz|dyv|dyz|ecc|exe|exe-ms|exe1|exe_renamed|exx|ezt|ezz|fag|fjl|fnr|fuj|good|gzquar|hlp|hlw|hqx|hsq|hts|iva|iws|jar|js|kcd|keybtc@inbox_com|let|lik|lkh|lnk|locky|lok|lol!|lpaq5|magic|mfu|micro|mim|mjg|mjz|nls|oar|ocx|osa|ozd|pcx|pgm|php2|php3|pid|pif|plc|pr|pzdc|qit|qrn|r5a|rhk|rna|rsc_tmp|s7p|scr|shs|ska|smm|smtmp|sop|spam|ssy|swf|sys|tko|tps|tsa|tti|ttt|txs|upa|uu|uue|uzy|vb|vba|vbe|vbs|vbx|vexe|vxd|vzr|wlpginstall|ws|wsc|wsf|wsh|wss|xdu|xir|xlm|xlv|xnt|xnxx|xtbl|xxe|xxx|xyz|zix|zvz|zzz)$'xmi =&gt; 'DISCARD'],\n);\n@bypass_virus_checks_maps = (0);\n$allowed_header_tests{'multiple'} = 0;\n$allowed_header_tests{'missing'} = 0;\n$helpers_home = \"$MYHOME/var\";\n$sa_mail_body_size_limit = 400*1024;\n@bypass_spam_checks_maps  = (0);\n$sa_tag_level_deflt  = -999;\n$sa_tag2_level_deflt = 6.2;\n$sa_kill_level_deflt = 6.9;\n$sa_dsn_cutoff_level = 10;\n$sa_crediblefrom_dsn_cutoff_level = 18;\n$penpals_threshold_high = $sa_kill_level_deflt;\n@score_sender_maps = ({\n  '.' =&gt; [  # the _first_ matching sender determines the score boost\n   new_RE(  # regexp-type lookup table, just happens to be all soft-blacklist\n    [qr'^(bulkmail|offers|cheapbenefits|earnmoney|foryou)@'i         =&gt; 5.0],\n    [qr'^(greatcasino|investments|lose_weight_today|market\\.alert)@'i=&gt; 5.0],\n    [qr'^(money2you|MyGreenCard|new\\.tld\\.registry|opt-out|opt-in)@'i=&gt; 5.0],\n    [qr'^(optin|saveonlsmoking2002k|specialoffer|specialoffers)@'i   =&gt; 5.0],\n    [qr'^(stockalert|stopsnoring|wantsome|workathome|yesitsfree)@'i  =&gt; 5.0],\n    [qr'^(your_friend|greatoffers)@'i                                =&gt; 5.0],\n    [qr'^(inkjetplanet|marketopt|MakeMoney)\\d*@'i                    =&gt; 5.0],\n   ),\n   { # a hash-type lookup table (associative array)\n     'nobody@cert.org'                        =&gt; -3.0,\n     'cert-advisory@us-cert.gov'              =&gt; -3.0,\n     'owner-alert@iss.net'                    =&gt; -3.0,\n     'slashdot@slashdot.org'                  =&gt; -3.0,\n     'securityfocus.com'                      =&gt; -3.0,\n     'ntbugtraq@listserv.ntbugtraq.com'       =&gt; -3.0,\n     'security-alerts@linuxsecurity.com'      =&gt; -3.0,\n     'mailman-announce-admin@python.org'      =&gt; -3.0,\n     'amavis-user-admin@lists.sourceforge.net'=&gt; -3.0,\n     'amavis-user-bounces@lists.sourceforge.net' =&gt; -3.0,\n     'spamassassin.apache.org'                =&gt; -3.0,\n     'notification-return@lists.sophos.com'   =&gt; -3.0,\n     'owner-postfix-users@postfix.org'        =&gt; -3.0,\n     'owner-postfix-announce@postfix.org'     =&gt; -3.0,\n     'owner-sendmail-announce@lists.sendmail.org'   =&gt; -3.0,\n     'sendmail-announce-request@lists.sendmail.org' =&gt; -3.0,\n     'donotreply@sendmail.org'                =&gt; -3.0,\n     'ca+envelope@sendmail.org'               =&gt; -3.0,\n     'noreply@freshmeat.net'                  =&gt; -3.0,\n     'owner-technews@postel.acm.org'          =&gt; -3.0,\n     'ietf-123-owner@loki.ietf.org'           =&gt; -3.0,\n     'cvs-commits-list-admin@gnome.org'       =&gt; -3.0,\n     'rt-users-admin@lists.fsck.com'          =&gt; -3.0,\n     'clp-request@comp.nus.edu.sg'            =&gt; -3.0,\n     'surveys-errors@lists.nua.ie'            =&gt; -3.0,\n     'emailnews@genomeweb.com'                =&gt; -5.0,\n     'yahoo-dev-null@yahoo-inc.com'           =&gt; -3.0,\n     'returns.groups.yahoo.com'               =&gt; -3.0,\n     'clusternews@linuxnetworx.com'           =&gt; -3.0,\n     lc('lvs-users-admin@LinuxVirtualServer.org')    =&gt; -3.0,\n     lc('owner-textbreakingnews@CNNIMAIL12.CNN.COM') =&gt; -5.0,\n     'sender@example.net'                     =&gt;  3.0,\n     '.example.net'                           =&gt;  1.0,\n   },\n  ],\n});\n@lookup_sql_dsn = ([ 'DBI:Pg:database=mail_prefs;host=127.0.0.1;port=5432', 'vscan', '__PASSWORD_VSCAN__' ]);\n@storage_sql_dsn = ([ 'DBI:Pg:database=mail_log;host=127.0.0.1;port=5432', 'vscan', '__PASSWORD_VSCAN__' ]);\n$timestamp_fmt_mysql = 1;\n$sql_allow_8bit_address = 1;\n%defang_maps_by_ccat = (\n  CC_VIRUS,       sub { c('defang_virus') },\n  CC_BANNED,      sub { c('defang_banned') },\n  CC_UNCHECKED,   sub { c('defang_undecipherable') },\n  CC_SPAM,        sub { c('defang_spam') },\n  CC_SPAMMY,      sub { c('defang_spam') },\n  CC_BADH.',3',   1,\n  CC_BADH.',5',   1,\n  CC_BADH.',6',   1,\n  CC_UNCHECKED.',3', 1,\n  CC_BADH,        sub { c('defang_bad_header') },\n);\n%admin_maps_by_ccat = (\n  CC_VIRUS,       sub { ca('virus_admin_maps') },\n  CC_BANNED,      sub { ca('banned_admin_maps') },\n  CC_SPAM,        sub { ca('spam_admin_maps') },\n  CC_BADH,        sub { ca('bad_header_admin_maps') },\n);\n$policy_bank{'MYNETS'} = {\n  originating =&gt; 1,\n  os_fingerprint_method =&gt; undef,\n};\n$interface_policy{'10026'} = 'ORIGINATING';\n$policy_bank{'ORIGINATING'} = {\n    originating =&gt; 1,\n    allow_disclaimers =&gt; 1,\n    enable_dkim_signing =&gt; 1,\n    warnbadhsender =&gt; 1,\n    forward_method =&gt; 'smtp:[127.0.0.1]:10027',\n    smtpd_discard_ehlo_keywords =&gt; ['8BITMIME'],\n    bypass_banned_checks_maps =&gt; [1],\n    terminate_dsn_on_notify_success =&gt; 0,\n};\n$interface_policy{'SOCK'} = 'AM.PDP-SOCK';\n$policy_bank{'AM.PDP-SOCK'} = {\n  protocol =&gt; 'AM.PDP',\n  auth_required_release =&gt; 0,\n};\n1;  # insure a defined return value\n\nEOF\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /usr/local/etc/amavisd.conf\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /usr/local/etc/amavisd.conf\n\nawk '/^Password for PostgreSQL user vscan:/ {print $NF}' /root/_passwords | \\\n    xargs -I % sed -e 's|__PASSWORD_VSCAN__|%|g' -i '' /usr/local/etc/amavisd.conf\n\n\nmkdir -p /var/amavis/db/keys\n\namavisd genrsa /var/amavis/db/keys/example.com/20250426.pem 2048\n\nchown -R vscan:vscan /var/amavis\n\namavisd showkeys\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/amavisd/#abschluss","title":"Abschluss","text":"<p>Amavisd kann nun gestartet werden.</p> Bash<pre><code>service amavisd start\nservice amavis_p0fanalyzer start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/clamav/","title":"ClamAV","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/clamav/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>ClamAV</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/clamav/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/clamav/#installation","title":"Installation","text":"<p>Wir installieren <code>security/clamav</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/security_clamav\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_clamav/options\n_OPTIONS_READ=clamav-1.4.2\n_FILE_COMPLETE_OPTIONS_LIST=ARC ARJ DOCS EXPERIMENTAL MILTER STDERR TESTS UNRAR UNZOO\nOPTIONS_FILE_SET+=ARC\nOPTIONS_FILE_SET+=ARJ\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXPERIMENTAL\nOPTIONS_FILE_SET+=MILTER\nOPTIONS_FILE_UNSET+=STDERR\nOPTIONS_FILE_UNSET+=TESTS\nOPTIONS_FILE_SET+=UNRAR\nOPTIONS_FILE_SET+=UNZOO\n\nEOF\n\n\nportmaster -w -B -g --force-config security/clamav  -n\n\n\nsysrc clamav_clamd_enable=\"YES\"\nsysrc clamav_freshclam_enable=\"YES\"\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/clamav/#abschluss","title":"Abschluss","text":"<p>ClamAV kann nun gestartet werden.</p> Bash<pre><code>service clamav_freshclam onestart\n\nfreshclam\n\nservice clamav_clamd start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/dovecot/","title":"Dovecot","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/dovecot/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>Dovecot 2.3.21 (IMAP only, Pigeonhole)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/dovecot/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/dovecot/#installation","title":"Installation","text":"<p>Wir installieren <code>mail/dovecot</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/textproc_libexttextcat\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_libexttextcat/options\n_OPTIONS_READ=libexttextcat-3.4.6\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/mail_dovecot\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_dovecot/options\n_OPTIONS_READ=dovecot-2.3.21.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES LIBSODIUM LIBUNWIND LIBWRAP LUA LZ4 GSSAPI_BASE GSSAPI_HEIMDAL GSSAPI_MIT GSSAPI_NONE CDB LDAP MYSQL PGSQL SQLITE ICU LUCENE SOLR TEXTCAT\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=LIBSODIUM\nOPTIONS_FILE_UNSET+=LIBUNWIND\nOPTIONS_FILE_SET+=LIBWRAP\nOPTIONS_FILE_UNSET+=LUA\nOPTIONS_FILE_SET+=LZ4\nOPTIONS_FILE_UNSET+=GSSAPI_BASE\nOPTIONS_FILE_UNSET+=GSSAPI_HEIMDAL\nOPTIONS_FILE_UNSET+=GSSAPI_MIT\nOPTIONS_FILE_SET+=GSSAPI_NONE\nOPTIONS_FILE_SET+=CDB\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=MYSQL\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_UNSET+=SQLITE\nOPTIONS_FILE_SET+=ICU\nOPTIONS_FILE_UNSET+=LUCENE\nOPTIONS_FILE_UNSET+=SOLR\nOPTIONS_FILE_SET+=TEXTCAT\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/dovecot@default  -n\n\n\nsysrc dovecot_enable=YES\n</code></pre> <p>Wir installieren <code>mail/dovecot-pigeonhole</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/mail_dovecot-pigeonhole\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_dovecot-pigeonhole/options\n_OPTIONS_READ=dovecot-pigeonhole-0.5.21.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES LDAP MANAGESIEVE GSSAPI_NONE GSSAPI_BASE GSSAPI_HEIMDAL GSSAPI_MIT\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=MANAGESIEVE\nOPTIONS_FILE_SET+=GSSAPI_NONE\nOPTIONS_FILE_UNSET+=GSSAPI_BASE\nOPTIONS_FILE_UNSET+=GSSAPI_HEIMDAL\nOPTIONS_FILE_UNSET+=GSSAPI_MIT\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/dovecot-pigeonhole@default  -n\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/dovecot/#konfiguration","title":"Konfiguration","text":"<p><code>dovecot.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot.conf\nauth_cache_size = 10M\nauth_cache_verify_password_with_worker = yes\nauth_master_user_separator = *\nauth_mechanisms = PLAIN\nauth_stats = yes\nauth_verbose = yes\nauth_verbose_passwords = sha1:8\ndeliver_log_format = from=%{from}, envelope_from=%{from_envelope}, envelope_to=%{to_envelope}, msgid=%{msgid}, size=%{size}, delivery_time=%{delivery_time}ms, %$\ndisable_plaintext_auth = yes\nfirst_valid_gid = 5000\nfirst_valid_uid = 5000\nhostname = mail.example.com\nimap_id_retain = yes\nimap_client_workarounds = tb-extra-mailbox-sep\nimap_metadata = yes\nlast_valid_gid = 5000\nlast_valid_uid = 5000\nlda_mailbox_autocreate = yes\nlda_mailbox_autosubscribe = yes\nlda_original_recipient_header = X-Original-To\nlisten = * [::]\nlmtp_client_workarounds = whitespace-before-path mailbox-for-path\nlmtp_save_to_detail_mailbox = yes\nlog_core_filter = category=error\nlogin_log_format_elements = user=&lt;%u&gt; method=%m rip=%r lip=%l mpid=%e %c %k session=&lt;%{session}&gt;\nlogin_proxy_max_disconnect_delay = 30 secs\nmail_always_cache_fields = flags date.save imap.envelope mime.parts imap.bodystructure\nmail_attribute_dict = file:%h/dovecot-attributes\nmail_cache_fields = flags date.save imap.envelope mime.parts imap.bodystructure\nmail_gid = 5000\nmail_home = /data/vmail/%d/%n\nmail_location = maildir:%Lh/Maildir/:INDEX=%Lh/Maildir/\nmail_max_userip_connections = 50\nmail_plugins = acl mailbox_alias mail_log notify quota zlib\nmail_uid = 5000\nmail_server_admin = mailto:admin@example.com\nmail_sort_max_read_count = 100\nmailbox_list_index = yes\nprotocol !indexer-worker {\n  mail_vsize_bg_after_count = 100\n}\npop3_client_workarounds = outlook-no-nuls oe-ns-eoh\npop3_uidl_format = %08Xu%08Xv\nprotocols = lmtp imap sieve\nquota_full_tempfail = yes\nsendmail_path = /usr/local/sbin/sendmail\nssl = required\nssl_cert = &lt;/usr/local/etc/letsencrypt/live/mail.example.com/fullchain.pem\nssl_cipher_list = ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\nssl_cipher_suites = TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256\nssl_dh = &lt;/usr/local/etc/dovecot/dh.pem\nssl_key = &lt;/usr/local/etc/letsencrypt/live/mail.example.com/privkey.pem\nssl_min_protocol = TLSv1.2\nssl_prefer_server_ciphers = yes\nsubmission_client_workarounds = mailbox-for-path whitespace-before-path\nverbose_proctitle = yes\n#######################################################################\ndict {\n  quota = pgsql:/usr/local/etc/dovecot/dovecot-dict-quota.conf\n}\n#######################################################################\npassdb {\n  driver = passwd-file\n  args = /usr/local/etc/dovecot/dovecot-master-users\n  deny = no\n  master = yes\n  pass = no\n  skip = authenticated\n  result_failure = continue\n  result_internalfail = continue\n  result_success = continue\n  auth_verbose = default\n}\npassdb {\n  driver = sql\n  args = /usr/local/etc/dovecot/dovecot-pgsql.conf\n  deny = no\n  master = no\n  pass = no\n  skip = authenticated\n  result_failure = continue\n  result_internalfail = continue\n  result_success = return-ok\n  auth_verbose = default\n}\npassdb passwd-file {\n  driver = passwd-file\n  args = scheme=ARGON2ID username_format=%{user} /usr/local/etc/dovecot/passwd\n  default_fields = uid=5000 gid=5000 home=/data/vmail/%d/%n\n  override_fields = uid=5000 gid=5000 home=/data/vmail/%d/%n\n  deny = no\n  master = no\n  pass = no\n  skip = authenticated\n  result_failure = continue\n  result_internalfail = continue\n  result_success = return-ok\n  auth_verbose = default\n}\nuserdb {\n  driver = sql\n  args = /usr/local/etc/dovecot/dovecot-pgsql.conf\n}\nuserdb passwd-file {\n  driver = passwd-file\n  args = username_format=%{user} /usr/local/etc/dovecot/passwd\n  default_fields = uid=5000 gid=5000 home=/data/vmail/%d/%n\n  override_fields = uid=5000 gid=5000 home=/data/vmail/%d/%n\n}\n#######################################################################\nnamespace {\n  inbox = yes\n  location =\n  mailbox {\n    auto = subscribe\n    special_use = \\Archive\n    name = Archive\n  }\n  mailbox {\n    auto = subscribe\n    special_use = \\Archive\n    name = Archives\n  }\n  mailbox {\n    auto = subscribe\n    special_use = \\Drafts\n    name = Drafts\n  }\n  mailbox {\n    auto = subscribe\n    special_use = \\Sent\n    name = Sent\n  }\n  mailbox {\n    auto = subscribe\n    autoexpunge = 4 weeks\n    special_use = \\Junk\n    name = Junk\n  }\n  mailbox {\n    auto = subscribe\n    autoexpunge = 4 weeks\n    special_use = \\Junk\n    name = Spam\n  }\n  mailbox {\n    auto = subscribe\n    autoexpunge = 2 weeks\n    special_use = \\Trash\n    name = Trash\n  }\n  prefix =\n  separator = /\n  type = private\n  name = inbox\n}\nnamespace {\n  list = children\n  location = maildir:%%Lh/Maildir/:INDEX=%%Lh/Maildir/Shared/%%Ld/%%Ln\n  prefix = Shared/%%u/\n  separator = /\n  subscriptions = yes\n  type = shared\n  name = shared\n}\n#######################################################################\nmanagesieve_notify_capability = mailto\nmanagesieve_sieve_capability = fileinto reject envelope encoded-character vacation subaddress comparator-i;ascii-numeric relational regex imap4flags copy include variables body enotify environment mailbox date index ihave duplicate mime foreverypart extracttext\n#######################################################################\nplugin {\n  acl = vfile\n  acl_globals_only = yes\n  mail_log_cached_only = yes\n  mail_log_events = delete undelete expunge copy mailbox_create mailbox_delete mailbox_rename\n  mail_log_fields = uid box msgid size from subject flags\n  quota = dict:storage=2G quota::proxy::quota\n  quota_grace = 10%%\n  quota_rule = *:storage=1G\n  quota_rule2 = Archive:storage=+4G\n  quota_rule3 = Trash:storage=+100M\n  quota_status_nouser = DUNNO\n  quota_status_overquota = 552 5.2.2 Mailbox is full\n  quota_status_success = DUNNO\n  quota_vsizes = yes\n  quota_warning = storage=100%% quota-warning 100 %u\n  quota_warning2 = storage=95%% quota-warning 95 %u\n  quota_warning3 = storage=90%% quota-warning 90 %u\n  quota_warning4 = storage=85%% quota-warning 85 %u\n  sieve = file:~/sieve;active=~/.dovecot.sieve\n  sieve_default = /data/vmail/sieve/default.sieve\n  sieve_default_name = roundcube\n  sieve_global = /data/vmail/sieve/global/\n  sieve_max_redirects = 30\n#  sieve_vacation_send_from_recipient = yes\n  zlib_save_level = 6\n  zlib_save = gz\n}\n#######################################################################\nprotocol lda {\n  mail_plugins = $mail_plugins sieve\n}\nprotocol lmtp {\n  mail_plugins = $mail_plugins sieve\n}\nprotocol imap {\n  mail_plugins = $mail_plugins imap_quota imap_acl imap_zlib\n}\n#######################################################################\nservice auth {\n  unix_listener /var/spool/postfix/private/dovecot-auth {\n    group = postfix\n    mode = 0666\n    user = postfix\n  }\n  unix_listener auth-master {\n    group = vmail\n    mode = 0666\n    user = vmail\n  }\n  unix_listener auth-userdb {\n    group = vmail\n    mode = 0660\n    user = vmail\n  }\n  vsz_limit = 2G\n}\nservice quota-warning {\n  client_limit = 1\n  executable = script /usr/local/bin/dovecot-quota-warning.sh\n  unix_listener quota-warning {\n    group = vmail\n    mode = 0660\n    user = vmail\n  }\n}\nservice managesieve-login {\n  inet_listener sieve {\n    address = 127.0.0.1\n    port = 4190\n  }\n}\nservice dict {\n  unix_listener dict {\n    group = vmail\n    mode = 0660\n    user = vmail\n  }\n}\nservice imap-login {\n  inet_listener imap {\n    port = 0\n  }\n  inet_listener imaps {\n    port = 993\n  }\n}\nservice lmtp {\n  executable = lmtp -L\n  inet_listener lmtp {\n    address = 127.0.0.1\n    port = 24\n  }\n  process_min_avail = 5\n  unix_listener /var/spool/postfix/private/dovecot-lmtp {\n    group = postfix\n    mode = 0600\n    user = postfix\n  }\n  user = vmail\n}\nservice pop3-login {\n  inet_listener pop3 {\n    port = 0\n     name = pop3\n  }\n  inet_listener pop3s {\n    port = 0\n  }\n}\nservice quota-status {\n  client_limit = 1\n  executable = quota-status -p postfix\n  inet_listener {\n    address = 127.0.0.1\n    port = 12340\n    name =\n  }\n}\nservice stats {\n  fifo_listener stats-mail {\n    mode = 0644\n    user = vmail\n  }\n  inet_listener {\n    address = 127.0.0.1\n    port = 24242\n    name =\n  }\n  unix_listener stats-writer {\n    group = vmail\n    mode = 0660\n    user = vmail\n  }\n}\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-sql.conf\nconnect = host=127.0.0.1 port=5432 dbname=postfixadmin user=postfix password=__PASSWORD_POSTFIX__\ndriver = pgsql\ndefault_pass_scheme = ARGON2ID\niterate_query = SELECT username as user FROM mailbox WHERE (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\npassword_query = SELECT username AS user, password FROM mailbox WHERE username = '%u' AND (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\nuser_query = SELECT mailbox.username AS user, mailbox.password, '/data/vmail/' || mailbox.maildir AS home, 5000 AS uid, 5000 AS gid, '*:bytes=' || mailbox.quota AS quota_rule, 'dict:storage=' || floor(quota/1000) || ' quota::proxy::quota' AS quota FROM mailbox, alias WHERE (mailbox.username = '%u' OR (alias.address = '%u' AND alias.goto = mailbox.username)) AND (('%s' = 'smtp' AND mailbox.smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND mailbox.active = true)) LIMIT 1;\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-pgsql.conf\nconnect = host=127.0.0.1 port=5432 dbname=postfixadmin user=postfix password=__PASSWORD_POSTFIX__\ndriver = pgsql\ndefault_pass_scheme = ARGON2ID\niterate_query = SELECT username as user FROM mailbox WHERE (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\npassword_query = SELECT username AS user, password FROM mailbox WHERE username = '%u' AND (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\nuser_query = SELECT mailbox.username AS user, mailbox.password, '/data/vmail/' || mailbox.maildir AS home, 5000 AS uid, 5000 AS gid, '*:bytes=' || mailbox.quota AS quota_rule, 'dict:storage=' || floor(quota/1000) || ' quota::proxy::quota' AS quota FROM mailbox, alias WHERE (mailbox.username = '%u' OR (alias.address = '%u' AND alias.goto = mailbox.username)) AND (('%s' = 'smtp' AND mailbox.smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND mailbox.active = true)) LIMIT 1;\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-dict-quota.conf\nconnect = host=127.0.0.1 port=5432 dbname=postfixadmin user=postfix password=__PASSWORD_POSTFIX__\nmap {\n  pattern = priv/quota/storage\n  table = quota2\n  username_field = username\n  value_field = bytes\n}\nmap {\n  pattern = priv/quota/messages\n  table = quota2\n  username_field = username\n  value_field = messages\n}\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-last-login.conf\nconnect = host=localhost port=5432 dbname=postfixadmin user=postfix password=__PASSWORD_POSTFIX__\ndriver = pgsql\nmap {\n    pattern = shared/last-login/imap/$user/$domain\n    table = last_login\n    value_field = imap\n    value_type = uint\n    fields {\n        username = $user\n        domain = $domain\n    }\n}\nmap {\n    pattern = shared/last-login/pop3/$user/$domain\n    table = last_login\n    value_field = pop3\n    value_type = uint\n    fields {\n        username = $user\n        domain = $domain\n    }\n}\nmap {\n    pattern = shared/last-login/lda/$user/$domain\n    table = last_login\n    value_field = lda\n    value_type = uint\n    fields {\n        username = $user\n        domain = $domain\n    }\n}\nmap {\n    pattern = shared/last-login/lmtp/$user/$domain\n    table = last_login\n    value_field = lda\n    value_type = uint\n    fields {\n        username = $user\n        domain = $domain\n    }\n}\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-share-folder.conf\nconnect = host=localhost port=5432 dbname=postfixadmin user=postfix password=__PASSWORD_POSTFIX__\ndriver = pgsql\nmap {\n    pattern = shared/shared-boxes/user/$to/$from\n    table = share_folder\n    value_field = dummy\n\n    fields {\n        from_user = $from\n        to_user = $to\n    }\n}\nmap {\n    pattern = shared/shared-boxes/anyone/$from\n    table = anyone_shares\n    value_field = dummy\n    fields {\n        from_user = $from\n    }\n}\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-used-quota.conf\nconnect = host=localhost port=5432 dbname=postfixadmin user=postfix password=__PASSWORD_POSTFIX__\ndriver = pgsql\nmap {\n    pattern = priv/quota/storage\n    table = used_quota\n    username_field = username\n    value_field = bytes\n}\nmap {\n    pattern = priv/quota/messages\n    table = used_quota\n    username_field = username\n    value_field = messages\n}\n\nEOF\n\n\nawk '/^Password for PostgreSQL user postfix:/ {print $NF}' /root/_passwords | \\\n    xargs -I % sed -e 's|__PASSWORD_POSTFIX__|%|g' -i '' /usr/local/etc/dovecot/*.conf\n\n\ncat &lt;&lt;'EOF' &gt; /usr/local/bin/dovecot-quota-warning.sh\n#!/usr/local/bin/bash\n# Purpose: Mail to user when his/her quota exceeds specified percentage.\n# Reference: http://wiki2.dovecot.org/Quota/Configuration#Quota_warnings\n\nPERCENT=${1}\nUSER=${2}\n\n# Use \"plugin/quota=maildir:User quota:noenforcing\" for maildir quota.\ncat &lt;&lt; EOF | /usr/local/libexec/dovecot/dovecot-lda -d ${USER} -o \"plugin/quota=dict:storage=2G quota::proxy::quota:noenforcing\"\nFrom: no-reply@$(hostname -f)\nSubject: Warning: Your mailbox is now ${PERCENT}% full.\n\nYour mailbox is now ${PERCENT}% full, please clean up some mails for further incoming mails.\nEOF\n\n# Send a copy to postmaster@ if mailbox is greater than or equal to 95% full.\nif [ ${PERCENT} -ge 95 ]; then\n    DOMAIN=\"$(echo ${USER} | awk -F'@' '{print $2}')\"\n    cat &lt;&lt; EOF | /usr/local/libexec/dovecot/dovecot-lda -d postmaster@${DOMAIN} -o \"plugin/quota=dict:storage=2G quota::proxy::quota:noenforcing\"\nFrom: no-reply@$(hostname -f)\nSubject: Mailbox Quota Warning: ${PERCENT}% full, ${USER}\n\nMailbox (${USER}) is now ${PERCENT}% full, please clean up some mails for\nfurther incoming mails.\nEOF\nfi\n\nEOF\nchmod 0755 /usr/local/bin/dovecot-quota-warning.sh\n\n/usr/local/bin/openssl dhparam 4096 &gt; /usr/local/etc/dovecot/dh.pem\n</code></pre> <p><code>/usr/local/etc/dovecot/passwd</code> einrichten.</p> <p>Wir legen einen neuen Superuser an.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/dovecot-master-users\nsuperuser:__PASSWORD_SUPERUSER__\n\nEOF\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for Dovecot user superuser: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"$newpw\" | xargs -I % doveadm pw -s SSHA512 -p % | xargs -I % echo \"superuser:%\" &gt; /usr/local/etc/dovecot/dovecot-master-users\necho \"Password: $newpw\"\nunset newpw\n</code></pre> <p>Das Anlegen neuer Mailuser wird mittels Script automatisiert.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/dovecot/create_mailuser.sh\n#!/bin/sh\n\ndovecot_user=\"${1}\"\ndovecot_pass=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\ndovecot_hash=\"`echo ${dovecot_pass} | xargs -I % doveadm pw -s ARGON2ID -p %`\"\n\necho \"Password for ${dovecot_user} is: ${dovecot_pass}\"\necho \"${dovecot_user}:${dovecot_hash}:5000:5000::/data/vmail/%d/%n::\" &gt;&gt; /usr/local/etc/dovecot/passwd\n\nexit 0\n\nEOF\nchmod 0755 /usr/local/etc/dovecot/create_mailuser.sh\n\n# admin@example.com anlegen\n/usr/local/etc/dovecot/create_mailuser.sh admin@example.com\n\n### BUGFIX: Das L\u00f6schen von Mailusern muss noch implementiert werden\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/dovecot/#abschluss","title":"Abschluss","text":"<p>Dovecot kann nun gestartet werden.</p> Bash<pre><code>service dovecot start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendkim/","title":"OpenDKIM","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/opendkim/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>OpenDKIM 2.10.3 (VBR, 2048 Bit RSA)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendkim/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendkim/#installation","title":"Installation","text":"<p>Wir installieren <code>mail/opendkim</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_opendbx\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_opendbx/options\n_OPTIONS_READ=opendbx-1.4.6\n_FILE_COMPLETE_OPTIONS_LIST=NLS MYSQL PGSQL SQLITE SQLITE3 MSSQL SYBASE\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_SET+=MYSQL\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_UNSET+=SQLITE\nOPTIONS_FILE_UNSET+=SQLITE3\nOPTIONS_FILE_UNSET+=MSSQL\nOPTIONS_FILE_UNSET+=SYBASE\n\nEOF\n\nmkdir -p /var/db/ports/dns_ldns\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_ldns/options\n_OPTIONS_READ=ldns-1.8.4\n_FILE_COMPLETE_OPTIONS_LIST=DANETAUSAGE DOXYGEN DRILL EXAMPLES GOST RRTYPEAMTRELAY RRTYPEAVC RRTYPENINFO RRTYPERKEY RRTYPETA\nOPTIONS_FILE_SET+=DANETAUSAGE\nOPTIONS_FILE_UNSET+=DOXYGEN\nOPTIONS_FILE_SET+=DRILL\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=GOST\nOPTIONS_FILE_SET+=RRTYPEAMTRELAY\nOPTIONS_FILE_SET+=RRTYPEAVC\nOPTIONS_FILE_UNSET+=RRTYPENINFO\nOPTIONS_FILE_SET+=RRTYPERKEY\nOPTIONS_FILE_SET+=RRTYPETA\n\nEOF\n\nmkdir -p /var/db/ports/textproc_libtre\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_libtre/options\n_OPTIONS_READ=libtre-0.8.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS NLS OPTIMIZED_CFLAGS PGO\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=OPTIMIZED_CFLAGS\nOPTIONS_FILE_UNSET+=PGO\n\nEOF\n\nmkdir -p /var/db/ports/mail_opendkim\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_opendkim/options\n_OPTIONS_READ=opendkim-2.10.3\n_FILE_COMPLETE_OPTIONS_LIST=FILTER CURL GNUTLS JANSSON LDNS LMDB LUA MEMCACHED  BDB_BASE OPENDBX OPENLDAP POPAUTH QUERY_CACHE SASL DOCS STOCK_RESOLVER UNBOUND ALLSYMBOLS CODECOVERAGE DEBUG ADSP_LISTS ATPS DB_HANDLE_POOLS  DEFAULT_SENDER DIFFHEADERS IDENTITY_HEADER  LDAP_CACHING POSTGRES_RECONNECT_HACK  RATE_LIMIT RBL REPLACE_RULES REPRRD  REPUTATION RESIGN SENDER_MACRO  SOCKETDB STATS STATSEXT VBR\nOPTIONS_FILE_SET+=FILTER\nOPTIONS_FILE_SET+=CURL\nOPTIONS_FILE_UNSET+=GNUTLS\nOPTIONS_FILE_UNSET+=JANSSON\nOPTIONS_FILE_SET+=LDNS\nOPTIONS_FILE_SET+=LMDB\nOPTIONS_FILE_SET+=LUA\nOPTIONS_FILE_UNSET+=MEMCACHED\nOPTIONS_FILE_UNSET+=BDB_BASE\nOPTIONS_FILE_SET+=OPENDBX\nOPTIONS_FILE_UNSET+=OPENLDAP\nOPTIONS_FILE_UNSET+=POPAUTH\nOPTIONS_FILE_SET+=QUERY_CACHE\nOPTIONS_FILE_UNSET+=SASL\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=STOCK_RESOLVER\nOPTIONS_FILE_SET+=UNBOUND\nOPTIONS_FILE_UNSET+=ALLSYMBOLS\nOPTIONS_FILE_UNSET+=CODECOVERAGE\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_SET+=ADSP_LISTS\nOPTIONS_FILE_UNSET+=ATPS\nOPTIONS_FILE_UNSET+=DB_HANDLE_POOLS\nOPTIONS_FILE_UNSET+=DEFAULT_SENDER\nOPTIONS_FILE_SET+=DIFFHEADERS\nOPTIONS_FILE_SET+=IDENTITY_HEADER\nOPTIONS_FILE_UNSET+=LDAP_CACHING\nOPTIONS_FILE_UNSET+=POSTGRES_RECONNECT_HACK\nOPTIONS_FILE_UNSET+=RATE_LIMIT\nOPTIONS_FILE_UNSET+=RBL\nOPTIONS_FILE_UNSET+=REPLACE_RULES\nOPTIONS_FILE_UNSET+=REPRRD\nOPTIONS_FILE_UNSET+=REPUTATION\nOPTIONS_FILE_UNSET+=RESIGN\nOPTIONS_FILE_SET+=SENDER_MACRO\nOPTIONS_FILE_UNSET+=SOCKETDB\nOPTIONS_FILE_UNSET+=STATS\nOPTIONS_FILE_UNSET+=STATSEXT\nOPTIONS_FILE_SET+=VBR\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/opendkim  -n\n\n\nsysrc milteropendkim_enable=YES\nsysrc milteropendkim_socket=\"inet:8891@localhost\"\n</code></pre> <p>Bitte example.com ersetzen:</p> Bash<pre><code>mkdir -p /data/db/opendkim/keys/example.com\n\nchown -R mailnull:mailnull /data/db/opendkim\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendkim/#konfiguration","title":"Konfiguration","text":"<p><code>opendkim.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/opendkim.conf\nAlwaysAddARHeader yes\nAuthservID mail.example.com\nAutoRestart Yes\nAutoRestartRate 10/1h\nCanonicalization relaxed/relaxed\nExternalIgnoreList refile:/data/db/opendkim/trustedhosts\nInternalHosts refile:/data/db/opendkim/trustedhosts\nKeyTable /data/db/opendkim/keytable\nLogWhy Yes\nMacroList dameon_name|ORIGINATING\nMode sv\nPidFile /var/run/milteropendkim/pid\nReportAddress \"DKIM Error Postmaster\" &lt;postmaster@example.com&gt;\nReportBccAddress admin@example.com\nSendReports Yes\nSignatureAlgorithm rsa-sha256\nSignHeaders From,Reply-To,To,Cc,In-Reply-To,References,Date,Subject,Content-Type,Content-Transfer-Encoding,MIME-Version\nSigningTable refile:/data/db/opendkim/signingtable\nSMTPURI smtp://localhost\nSocket inet:8891@localhost\nSubDomains Yes\nSyslog Yes\nSyslogFacility  mail\nSyslogSuccess Yes\nTrustAnchorFile /usr/local/etc/unbound/root.key\nUMask 022\nUnboundConfigFile /usr/local/etc/unbound/unbound.conf\nUserID mailnull:mailnull\n\nEOF\n</code></pre> <p>Singning-Key erzeugen.</p> Bash<pre><code>opendkim-genkey --append-domain --bits=2048 --directory=/data/db/opendkim/keys/example.com --domain=example.com --hash-algorithms=sha256 --note=example.com --selector=20250426 --subdomains --verbose\n\nchmod 0600 /data/db/opendkim/keys/*/*.private\n</code></pre> <p>KeyTable anlegen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /data/db/opendkim/keytable\n20250426._domainkey.example.com    example.com:20250426:/data/db/opendkim/keys/example.com/20250426.private\nEOF\n</code></pre> <p>SingingTable anlegen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /data/db/opendkim/signingtable\n*@example.com      20250426._domainkey.example.com\n*@*.example.com    20250426._domainkey.example.com\nEOF\n</code></pre> <p>TrustedHosts anlegen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /data/db/opendkim/trustedhosts\n::1\n127.0.0.1\nfe80::/10\nff02::/16\n10.0.0.0/8\n__IPADDR4__\n__IPADDR6__\nlocalhost\nexample.com\n*.example.com\nEOF\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /data/db/opendkim/trustedhosts\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /data/db/opendkim/trustedhosts\n</code></pre> Bash<pre><code>chown -R mailnull:mailnull /data/db/opendkim\n</code></pre> <p>Es muss noch ein DNS-Record angelegt werden, sofern er noch nicht existiert, oder entsprechend ge\u00e4ndert werden, sofern er bereits existiert.</p> Bash<pre><code>/usr/local/bin/openssl pkey -pubout -outform pem -in /data/db/opendkim/keys/example.com/20250426.private | \\\n    awk '\\!/^-----/ {printf $0}' | awk 'BEGIN{n=1}\\\n        {printf \"\\n20250426._domainkey.example.com.    IN  TXT    ( \\\"v=DKIM1; h=shs256; k=rsa; s=*; t=*; p=\\\"\";\\\n            while(substr($0,n,98)){printf \"\\n        \\\"\" substr($0,n,98) \"\\\"\";n+=98};printf \" )\\n\"}'\n</code></pre> Text Only<pre><code>#\n# The output should look similar to this one, which will be the DNS-Record to publish\n#\n# Note: The folding of the pubkey is necessary as most nameservers have a line-length limit\n#       If you use a DNS-Provider to publish your records, then use their free-text fields\n#       to insert the record into their form\n#\n20250426._domainkey.example.com.    IN  TXT    ( \"v=DKIM1; h=shs256; k=rsa; s=*; t=*; p=\"\n        \"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1Up5Z0TkPpE0mNAc9lf7Uug7P/n28Kk6fXC1V8m93dE+NPgsTKp4k+\"\n        \"t2S3EujANO7J8WyBppE+aTbyQjU5TtaIPC8TS3sBg/6JX/QAw73+Hv03lieutmZ0GO4uuvj+QbOuDqNwHR/DZih3BrV7Mtit4F\"\n        \"bILcz+V1QbJ7YssRQRaZ/LTGZ0Q6QLGr6BG9h3Ro4g1bTirFIuvbaVUuzDK/KxHKRAuAhIB7mmrpPRDQlFjgva9vQYsQUcQtVh\"\n        \"Y/z6YvcGNvEWhme3gaTWzdG20aLTxut4Il17OSWiCbF0wdnUn0bnKins14YeHjkDhOhMoEagd3lWWs0k2KNxnbYljPQwIDAQAB\" )\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendkim/#abschluss","title":"Abschluss","text":"<p>OpenDKIM kann nun gestartet werden.</p> Bash<pre><code>service milter-opendkim start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendmarc/","title":"OpenDMARC","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/opendmarc/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>OpenDMARC 1.4.2 (SPF2, FailureReports)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendmarc/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendmarc/#installation","title":"Installation","text":"<p>Wir installieren <code>mail/opendmarc</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_p5-DBI\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_p5-DBI/options\n_OPTIONS_READ=p5-DBI-1.647\n_FILE_COMPLETE_OPTIONS_LIST=PROXY\nOPTIONS_FILE_SET+=PROXY\n\nEOF\n\nmkdir -p /var/db/ports/mail_opendmarc\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_opendmarc/options\n_OPTIONS_READ=opendmarc-1.4.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS SPF\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=SPF\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/opendmarc  -n\n\n\nsysrc opendmarc_enable=YES\nsysrc opendmarc_socketspec=\"inet:8895@localhost\"\n</code></pre> Bash<pre><code>mkdir -p /data/db/opendmarc\n\nchown -R mailnull:mailnull /data/db/opendmarc\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendmarc/#konfigurieren","title":"Konfigurieren","text":"<p><code>opendmarc.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/opendmarc.conf\nAuthservID mail.example.com\nAutoRestart true\nAutoRestartRate 10/1h\nFailureReports true\nFailureReportsBcc dmarc@example.com\nFailureReportsOnNone true\nFailureReportsSentBy postmaster@example.com\nHistoryFile /data/db/opendmarc/opendmarc.dat\nIgnoreHosts /data/db/opendmarc/ignorehosts\nMacroList daemon_name|VERIFYING\nPidFile /var/run/opendmarc/pid\nPublicSuffixList /usr/local/share/public_suffix_list/public_suffix_list.dat\nRejectFailures false\nRequiredHeaders true\nSocket inet:8895@localhost\nSPFIgnoreResults true\nSPFSelfValidate true\nSyslog true\nSyslogFacility mail\nTrustedAuthservIDs mail.example.com\nUMask 022\nUserID mailnull:mailnull\n\nEOF\n</code></pre> <p>IgnoreHosts anlegen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /data/db/opendmarc/ignorehosts\n::1\n127.0.0.1\nfe80::/10\nff02::/16\n10.0.0.0/8\n__IPADDR4__\n__IPADDR6__\nlocalhost\nexample.com\n*.example.com\nEOF\n\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /data/db/opendmarc/ignorehosts\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /data/db/opendmarc/ignorehosts\n</code></pre> Bash<pre><code>chown -R mailnull:mailnull /data/db/opendmarc\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/opendmarc/#abschluss","title":"Abschluss","text":"<p>OpenDMARC kann nun gestartet werden.</p> Bash<pre><code>service opendmarc start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfix/","title":"Postfix","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/postfix/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>Postfix 3.10.2 (Dovecot-SASL, postscreen)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfix/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfix/#installation","title":"Installation","text":"<p>Wir installieren <code>mail/postfix</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/mail_postfix\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_postfix/options\n_OPTIONS_READ=postfix-3.10.2\n_FILE_COMPLETE_OPTIONS_LIST=BDB BLACKLISTD CDB DOCS EAI INST_BASE LDAP LMDB MONGO MYSQL NIS PCRE2 PGSQL SASL SQLITE TEST TLS TLSRPT SASLKMIT SASLKRB5\nOPTIONS_FILE_SET+=BDB\nOPTIONS_FILE_UNSET+=BLACKLISTD\nOPTIONS_FILE_SET+=CDB\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=EAI\nOPTIONS_FILE_UNSET+=INST_BASE\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=LMDB\nOPTIONS_FILE_UNSET+=MONGO\nOPTIONS_FILE_SET+=MYSQL\nOPTIONS_FILE_UNSET+=NIS\nOPTIONS_FILE_SET+=PCRE2\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_UNSET+=SASL\nOPTIONS_FILE_UNSET+=SQLITE\nOPTIONS_FILE_UNSET+=TEST\nOPTIONS_FILE_SET+=TLS\nOPTIONS_FILE_SET+=TLSRPT\nOPTIONS_FILE_UNSET+=SASLKMIT\nOPTIONS_FILE_UNSET+=SASLKRB5\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/postfix@default  -n\n\n\nsysrc postfix_enable=YES\n\n\ninstall -d /usr/local/etc/mail\ninstall -m 0644 /usr/local/share/postfix/mailer.conf.postfix /usr/local/etc/mail/mailer.conf\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfix/#konfiguration","title":"Konfiguration","text":"<p><code>main.cf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/main.cf\nalias_database = hash:${config_directory}/aliases\nalias_maps = hash:${config_directory}/aliases\nallow_percent_hack = no\nalways_add_missing_headers = yes\namavisfeed_destination_recipient_limit = 2\nbiff = no\nbody_checks = pcre:${config_directory}/body_checks.pcre\ncompatibility_level = 3.6\ndebugger_command = PATH=/bin:/usr/bin:/usr/local/bin ddd\n    $daemon_directory/$process_name $process_id &amp; sleep 5\ndefault_destination_concurrency_limit = 5\ndisable_vrfy_command = yes\ndovecot_destination_recipient_limit = 1\nenable_long_queue_ids = yes\nenable_original_recipient = no\nheader_checks = pcre:${config_directory}/header_checks\nhome_mailbox = .maildir/\ninet_interfaces = all\ninet_protocols = all\ninternal_mail_filter_classes = bounce\nlmtp_tls_mandatory_protocols = &gt;=TLSv1.2\nlmtp_tls_protocols = &gt;=TLSv1.2\nlocal_destination_concurrency_limit = 2\nlocal_header_rewrite_clients = permit_mynetworks permit_sasl_authenticated\nlocal_recipient_maps = $virtual_mailbox_maps\nlocal_transport = virtual\nmail_spool_directory = /data/vmail\nmailbox_size_limit = 0\nmailbox_transport = lmtp:unix:private/dovecot-lmtp\nmasquerade_domains = $mydomain\nmasquerade_exceptions = root mailer-daemon\nmessage_size_limit = 0\nmilter_default_action = accept\nmilter_protocol = 2\nmydestination = $myhostname localhost.$mydomain localhost localhost.localdomain\nmydomain = example.com\nmyhostname = mail.$mydomain\nmynetworks =\n    127.0.0.0/8 [::1]/128\n    10.0.0.0/8 [fe80::]/10\n    __IPADDR4__/32 [__IPADDR6__]/64\nmyorigin = $mydomain\nnotify_classes = data protocol resource software\nopenssl_path = /usr/local/bin/openssl\npolicyd-spf_time_limit = 3600\npostscreen_access_list = permit_mynetworks\n    cidr:${config_directory}/postscreen_access.cidr\n    cidr:${config_directory}/postscreen_whitelist.cidr\npostscreen_bare_newline_action = enforce\npostscreen_bare_newline_enable = yes\npostscreen_blacklist_action = enforce\npostscreen_denylist_action = enforce\npostscreen_dnsbl_action = enforce\npostscreen_dnsbl_allowlist_threshold = 0\npostscreen_dnsbl_reply_map = texthash:${config_directory}/postscreen_dnsbl_reply\npostscreen_dnsbl_sites =\n    list.dnswl.org=127.0.[0..255].0*-2\n    list.dnswl.org=127.0.[0..255].1*-4\n    list.dnswl.org=127.0.[0..255].2*-6\n    list.dnswl.org=127.0.[0..255].3*-8\n    zen.spamhaus.org=127.0.0.20*20\n    zen.spamhaus.org=127.0.0.20*20\n    zen.spamhaus.org=127.0.0.9*99\n    zen.spamhaus.org=127.0.0.3*10\n    zen.spamhaus.org=127.0.0.2*3\n    zen.spamhaus.org=127.0.0.[4..7]*3\n    zen.spamhaus.org=127.0.0.[10..11]*3\n    swl.spamhaus.org*-10\n    bl.mailspike.net=127.0.0.2*10\n    bl.mailspike.net=127.0.0.10*5\n    bl.mailspike.net=127.0.0.11*4\n    bl.mailspike.net=127.0.0.12*3\n    bl.mailspike.net=127.0.0.13*2\n    bl.mailspike.net=127.0.0.14*1\n    wl.mailspike.net=127.0.0.16*-2\n    wl.mailspike.net=127.0.0.17*-4\n    wl.mailspike.net=127.0.0.18*-6\n    wl.mailspike.net=127.0.0.19*-8\n    wl.mailspike.net=127.0.0.20*-10\n    backscatter.spameatingmonkey.net*2\n    bl.ipv6.spameatingmonkey.net*2\n    bl.spameatingmonkey.net*2\n    bl.spamcop.net*2\n    db.wpbl.info*2\n    psbl.surriel.com*2\n    torexit.dan.me.uk*2\n    tor.dan.me.uk*1\npostscreen_dnsbl_threshold = 5\npostscreen_dnsbl_whitelist_threshold = -2\npostscreen_greet_action = enforce\npostscreen_non_smtp_command_enable = yes\npostscreen_pipelining_enable = yes\nproxy_read_maps = $canonical_maps $lmtp_generic_maps $local_recipient_maps\n    $mydestination $mynetworks $recipient_bcc_maps $recipient_canonical_maps\n    $relay_domains $relay_recipient_maps $relocated_maps $sender_bcc_maps\n    $sender_canonical_maps $smtp_generic_maps $smtpd_sender_login_maps\n    $transport_maps $virtual_alias_domains $virtual_alias_maps\n    $virtual_mailbox_domains $virtual_mailbox_maps $smtpd_sender_restrictions\n    $sender_dependent_relayhost_maps\nrbl_reply_maps = hash:${config_directory}/dnsbl_reply_map\n#receive_override_options = no_address_mappings\n#recipient_bcc_maps = proxy:pgsql:${config_directory}/pgsql/recipient_bcc_maps.cf\nrecipient_delimiter = +\nrelay_domains = $mydestination proxy:pgsql:${config_directory}/pgsql/relay_domains.cf\nremote_header_rewrite_domain = domain.invalid\n#sender_bcc_maps = proxy:pgsql:${config_directory}/pgsql/sender_bcc_maps.cf\n#sender_dependent_relayhost_maps = proxy:pgsql:${config_directory}/pgsql/sender_dependent_relayhost_maps.cf\nshow_user_unknown_table_name = no\nsmtp_dns_support_level = enabled\nsmtp_tls_CAfile = /etc/ssl/cert.pem\nsmtp_tls_CApath = /etc/ssl/certs\nsmtp_tls_connection_reuse = yes\nsmtp_tls_loglevel = 1\nsmtp_tls_mandatory_protocols = &gt;=TLSv1.2\nsmtp_tls_note_starttls_offer = yes\nsmtp_tls_protocols = &gt;=TLSv1.2\nsmtp_tls_security_level = may\nsmtpd_client_port_logging = yes\nsmtpd_client_restrictions = permit_mynetworks permit_sasl_authenticated\n    sleep 1\nsmtpd_command_filter = pcre:${config_directory}/command_filter.pcre\nsmtpd_data_restrictions = reject_unauth_pipelining reject_multi_recipient_bounce\nsmtpd_etrn_restrictions = reject\nsmtpd_helo_required = yes\nsmtpd_helo_restrictions = permit_mynetworks permit_sasl_authenticated\n    check_helo_access pcre:${config_directory}/helo_access.pcre\n    reject_non_fqdn_helo_hostname reject_unknown_helo_hostname\nsmtpd_recipient_restrictions = permit_mynetworks permit_sasl_authenticated\n    reject_unauth_destination\n    check_recipient_access      pcre:${config_directory}/recipient_checks.pcre\n    reject_non_fqdn_recipient reject_unlisted_recipient reject_unknown_recipient_domain\n    reject_rhsbl_sender         zen.spamhaus.org=127.0.1.[2..99],\n    reject_rhsbl_helo           zen.spamhaus.org=127.0.1.[2..99],\n    reject_rhsbl_reverse_client zen.spamhaus.org=127.0.1.[2..99],\n    reject_rhsbl_sender         zen.spamhaus.org=127.0.2.[2..24],\n    reject_rhsbl_helo           zen.spamhaus.org=127.0.2.[2..24],\n    reject_rhsbl_reverse_client zen.spamhaus.org=127.0.2.[2..24],\n    reject_rbl_client           zen.spamhaus.org=127.0.0.[2..255]\nsmtpd_reject_unlisted_sender = yes\nsmtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated\n    reject_unauth_destination\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_authenticated_header = yes\nsmtpd_sasl_path = private/dovecot-auth\nsmtpd_sasl_type = dovecot\nsmtpd_sender_login_maps = proxy:pgsql:${config_directory}/pgsql/sender_login_maps.cf\nsmtpd_sender_restrictions = permit_mynetworks permit_sasl_authenticated\n    check_sender_access pcre:${config_directory}/sender_access.pcre\n    reject_sender_login_mismatch reject_non_fqdn_sender\n    reject_unlisted_sender reject_unknown_sender_domain\nsmtpd_tls_CAfile = /etc/ssl/cert.pem\nsmtpd_tls_CApath = /etc/ssl/certs\nsmtpd_tls_auth_only = yes\nsmtpd_tls_chain_files =\n    /usr/local/etc/letsencrypt/live/mail.example.com/privkey.pem\n    /usr/local/etc/letsencrypt/live/mail.example.com/fullchain.pem\nsmtpd_tls_loglevel = 1\nsmtpd_tls_mandatory_protocols = &gt;=TLSv1.2\nsmtpd_tls_protocols = &gt;=TLSv1.2\nsmtpd_tls_received_header = yes\nsmtpd_tls_security_level = may\nsmtputf8_enable = no\nsoft_bounce = yes\nstrict_rfc821_envelopes = yes\nswap_bangpath = no\ntls_eecdh_auto_curves = X448 X25519 secp384r1 prime256v1 secp521r1\ntls_high_cipherlist = CHACHA20 AESGCM !SSLv3 !TLSv1 !DSS !RSA !PSK !aNULL @STRENGTH\ntls_medium_cipherlist = CHACHA20 AESGCM !SSLv3 !TLSv1 !DSS !RSA !PSK !aNULL @STRENGTH\ntls_preempt_cipherlist = yes\ntls_ssl_options = NO_RENEGOTIATION NO_SESSION_RESUMPTION_ON_RENEGOTIATION\ntransport_maps = proxy:pgsql:${config_directory}/pgsql/transport_maps.cf\nvirtual_alias_domains =\n    proxy:pgsql:${config_directory}/pgsql/virtual_alias_domains_maps.cf\n    proxy:pgsql:${config_directory}/pgsql/virtual_alias_domains_catchall_maps.cf\nvirtual_alias_maps =\n    proxy:pgsql:${config_directory}/pgsql/virtual_alias_maps.cf\n    proxy:pgsql:${config_directory}/pgsql/virtual_alias_domains_mailbox_maps.cf\nvirtual_gid_maps = static:5000\nvirtual_mailbox_base = /var/vmail\nvirtual_mailbox_domains = proxy:pgsql:${config_directory}/pgsql/virtual_mailbox_domains.cf\nvirtual_mailbox_maps = proxy:pgsql:${config_directory}/pgsql/virtual_mailbox_maps.cf\nvirtual_minimum_uid = 5000\nvirtual_transport = lmtp:unix:private/dovecot-lmtp\nvirtual_uid_maps = static:5000\n\nEOF\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /usr/local/etc/postfix/main.cf\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /usr/local/etc/postfix/main.cf\n</code></pre> <p><code>master.cf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/master.cf\n#\n# Postfix master process configuration file.  For details on the format\n# of the file, see the master(5) manual page (command: \"man 5 master\" or\n# on-line: https://www.postfix.org/master.5.html).\n#\n# Do not forget to execute \"postfix reload\" after editing this file.\n#\n# ==========================================================================\n# service type  private unpriv  chroot  wakeup  maxproc command + args\n#               (yes)   (yes)   (no)    (never) (100)\n# ==========================================================================\n#smtp      inet  n       -       n       -       -       smtpd\nsmtp      inet  n       -       n       -       1       postscreen\n  -o content_filter=amavisfeed:[127.0.0.1]:10024\n  -o milter_macro_daemon_name=VERIFYING\n  -o receive_override_options=no_address_mappings\nsmtpd     pass  -       -       n       -       -       smtpd\ndnsblog   unix  -       -       n       -       0       dnsblog\ntlsproxy  unix  -       -       n       -       0       tlsproxy\n# Choose one: enable submission for loopback clients only, or for any client.\n#127.0.0.1:submission inet n -   n       -       -       smtpd\nsubmission inet n       -       n       -       -       smtpd\n  -o syslog_name=postfix/submission\n  -o content_filter=amavisfeed:[127.0.0.1]:10026\n  -o local_header_rewrite_clients=static:all\n  -o smtpd_forbid_unauth_pipelining=no\n  -o smtpd_hide_client_session=yes\n  -o smtpd_reject_unlisted_recipient=no\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_tls_auth_only=yes\n  -o smtpd_tls_security_level=encrypt\n#     Instead of specifying complex smtpd_&lt;xxx&gt;_restrictions here,\n#     specify \"smtpd_&lt;xxx&gt;_restrictions=$mua_&lt;xxx&gt;_restrictions\"\n#     here, and specify mua_&lt;xxx&gt;_restrictions in main.cf (where\n#     \"&lt;xxx&gt;\" is \"client\", \"helo\", \"sender\", \"relay\", or \"recipient\").\n#  -o smtpd_client_restrictions=\n#  -o smtpd_helo_restrictions=\n#  -o smtpd_recipient_restrictions=\n#  -o smtpd_relay_restrictions=\n#  -o smtpd_sender_restrictions=\n  -o milter_macro_daemon_name=ORIGINATING\n  -o receive_override_options=no_header_body_checks\n# Choose one: enable submissions for loopback clients only, or for any client.\n#127.0.0.1:submissions inet n  -       n       -       -       smtpd\nsubmissions     inet  n       -       n       -       -       smtpd\n  -o syslog_name=postfix/submissions\n  -o content_filter=amavisfeed:[127.0.0.1]:10026\n  -o smtpd_milters=inet:127.0.0.1:8893\n  -o local_header_rewrite_clients=static:all\n  -o smtpd_forbid_unauth_pipelining=no\n  -o smtpd_hide_client_session=yes\n  -o smtpd_reject_unlisted_recipient=no\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_tls_wrappermode=yes\n#     Instead of specifying complex smtpd_&lt;xxx&gt;_restrictions here,\n#     specify \"smtpd_&lt;xxx&gt;_restrictions=$mua_&lt;xxx&gt;_restrictions\"\n#     here, and specify mua_&lt;xxx&gt;_restrictions in main.cf (where\n#     \"&lt;xxx&gt;\" is \"client\", \"helo\", \"sender\", \"relay\", or \"recipient\").\n#  -o smtpd_client_restrictions=\n#  -o smtpd_helo_restrictions=\n#  -o smtpd_recipient_restrictions=\n#  -o smtpd_relay_restrictions=\n#  -o smtpd_sender_restrictions=\n  -o milter_macro_daemon_name=ORIGINATING\n  -o receive_override_options=no_header_body_checks\n#628       inet  n       -       n       -       -       qmqpd\npickup    unix  n       -       n       60      1       pickup\ncleanup   unix  n       -       n       -       0       cleanup\nqmgr      unix  n       -       n       300     1       qmgr\n#qmgr     unix  n       -       n       300     1       oqmgr\ntlsmgr    unix  -       -       n       1000?   1       tlsmgr\nrewrite   unix  -       -       n       -       -       trivial-rewrite\nbounce    unix  -       -       n       -       0       bounce\ndefer     unix  -       -       n       -       0       bounce\ntrace     unix  -       -       n       -       0       bounce\nverify    unix  -       -       n       -       1       verify\nflush     unix  n       -       n       1000?   0       flush\nproxymap  unix  -       -       n       -       -       proxymap\nproxywrite unix -       -       n       -       1       proxymap\nsmtp      unix  -       -       n       -       -       smtp\nrelay     unix  -       -       n       -       -       smtp\n  -o syslog_name=${multi_instance_name?{$multi_instance_name}:{postfix}}/$service_name\n#  -o smtp_helo_timeout=5 -o smtp_connect_timeout=5\nshowq     unix  n       -       n       -       -       showq\nerror     unix  -       -       n       -       -       error\nretry     unix  -       -       n       -       -       error\ndiscard   unix  -       -       n       -       -       discard\nlocal     unix  -       n       n       -       -       local\nvirtual   unix  -       n       n       -       -       virtual\nlmtp      unix  -       -       n       -       -       lmtp\nanvil     unix  -       -       n       -       1       anvil\nscache    unix  -       -       n       -       1       scache\npostlog   unix-dgram n  -       n       -       1       postlogd\n#\n# ====================================================================\n# Interfaces to non-Postfix software. Be sure to examine the manual\n# pages of the non-Postfix software to find out what options it wants.\n#\n# Many of the following services use the Postfix pipe(8) delivery\n# agent.  See the pipe(8) man page for information about ${recipient}\n# and other message envelope options.\n# ====================================================================\n#\n# maildrop. See the Postfix MAILDROP_README file for details.\n# Also specify in main.cf: maildrop_destination_recipient_limit=1\n#\n#maildrop  unix  -       n       n       -       -       pipe\n#  flags=DRXhu user=vmail argv=/usr/local/bin/maildrop -d ${recipient}\n#\n# ====================================================================\n#\n# Recent Cyrus versions can use the existing \"lmtp\" master.cf entry.\n#\n# Specify in cyrus.conf:\n#   lmtp    cmd=\"lmtpd -a\" listen=\"localhost:lmtp\" proto=tcp4\n#\n# Specify in main.cf one or more of the following:\n#  mailbox_transport = lmtp:inet:localhost\n#  virtual_transport = lmtp:inet:localhost\n#\n# ====================================================================\n#\n# Cyrus 2.1.5 (Amos Gouaux)\n# Also specify in main.cf: cyrus_destination_recipient_limit=1\n#\n#cyrus     unix  -       n       n       -       -       pipe\n#  flags=DRX user=cyrus argv=/cyrus/bin/deliver -e -r ${sender} -m ${extension} ${user}\n#\n# ====================================================================\n#\n# Old example of delivery via Cyrus.\n#\n#old-cyrus unix  -       n       n       -       -       pipe\n#  flags=R user=cyrus argv=/cyrus/bin/deliver -e -m ${extension} ${user}\n#\n# ====================================================================\n#\n# See the Postfix UUCP_README file for configuration details.\n#\n#uucp      unix  -       n       n       -       -       pipe\n#  flags=Fqhu user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)\n#\n# ====================================================================\n#\n# Other external delivery methods.\n#\n#ifmail    unix  -       n       n       -       -       pipe\n#  flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)\n#\n#bsmtp     unix  -       n       n       -       -       pipe\n#  flags=Fq. user=bsmtp argv=/usr/local/sbin/bsmtp -f $sender $nexthop $recipient\n#\n#scalemail-backend unix  -  n    n       -       2       pipe\n#  flags=R user=scalemail argv=/usr/lib/scalemail/bin/scalemail-store\n#  ${nexthop} ${user} ${extension}\n#\n#mailman   unix  -       n       n       -       -       pipe\n#  flags=FRX user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py\n#  ${nexthop} ${user}\n\npolicyd-spf  unix  -    n       n       -       0       spawn\n  user=pyspf-milter argv=/usr/local/bin/policyd-spf\n\ndovecot   unix  -       n       n       -       -       pipe\n  flags=DRXhu user=vmail:vmail argv=/usr/local/libexec/dovecot/dovecot-lda\n  -f ${sender} -a ${recipient} -d ${user}@${nexthop}\n\nvacation  unix  -       n       n       -       -       pipe\n  flags=Rq user=vacation argv=/data/db/postfixadmin/vacation.pl\n  -f ${sender} -- ${recipient}\n\namavisfeed  unix  -     -       n       -       2       smtp\n  -o syslog_name=postfix/amavis\n  -o smtp_data_done_timeout=1200\n  -o smtp_dns_support_level=disabled\n  -o smtp_send_xforward_command=yes\n  -o smtp_tls_note_starttls_offer=no\n  -o max_use=20\n\n127.0.0.1:10025 inet n  -       n       -       -       smtpd\n  -o syslog_name=postfix/10025\n  -o content_filter=\n  -o local_header_rewrite_clients=\n  -o local_recipient_maps=\n  -o mynetworks=127.0.0.0/8\n  -o mynetworks_style=host\n  -o receive_override_options=no_header_body_checks,no_unknown_recipient_checks,no_milters\n  -o relay_recipient_maps=\n  -o smtp_tls_security_level=none\n  -o smtpd_client_connection_count_limit=0\n  -o smtpd_client_connection_rate_limit=0\n  -o smtpd_client_restrictions=permit_mynetworks,reject\n  -o smtpd_data_restrictions=reject_unauth_pipelining\n  -o smtpd_delay_reject=no\n  -o smtpd_end_of_data_restrictions=\n  -o smtpd_error_sleep_time=0\n  -o smtpd_hard_error_limit=1000\n  -o smtpd_helo_restrictions=\n  -o smtpd_milters=\n  -o smtpd_recipient_restrictions=permit_mynetworks,reject\n  -o smtpd_restriction_classes=\n  -o smtpd_sender_restrictions=\n  -o smtpd_soft_error_limit=1001\n  -o smtpd_tls_security_level=none\n  -o strict_rfc821_envelopes=yes\n\n127.0.0.1:10027    inet    n    -    n    -    -    smtpd\n  -o syslog_name=postfix/10027\n  -o content_filter=\n  -o local_recipient_maps=\n  -o relay_recipient_maps=\n  -o smtpd_restriction_classes=\n  -o smtpd_delay_reject=no\n  -o smtpd_client_restrictions=permit_mynetworks,reject\n  -o smtpd_helo_restrictions=\n  -o smtpd_sender_restrictions=\n  -o smtpd_recipient_restrictions=permit_mynetworks,reject\n  -o smtpd_data_restrictions=reject_unauth_pipelining\n  -o smtpd_end_of_data_restrictions=\n  -o mynetworks=127.0.0.0/8\n  -o smtpd_error_sleep_time=0\n  -o smtpd_soft_error_limit=1001\n  -o smtpd_hard_error_limit=1000\n  -o smtpd_client_connection_count_limit=0\n  -o smtpd_client_connection_rate_limit=0\n  -o receive_override_options=no_header_body_checks,no_unknown_recipient_checks\n  -o local_header_rewrite_clients=\n  -o smtpd_milters=inet:127.0.0.1:8891\n  -o mynetworks_style=host\n  -o smtp_tls_security_level=none\n  -o smtpd_tls_security_level=none\n  -o strict_rfc821_envelopes=yes\n\nEOF\n</code></pre> <p><code>pgsql/*.cf</code> einrichten.</p> Bash<pre><code>mkdir -p /usr/local/etc/postfix/pgsql\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/recipient_bcc_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       =\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/relay_domains.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT domain FROM domain WHERE domain='%s' AND backupmx = true AND ('%s' &lt;&gt; 'smtp' AND active = true)\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/sender_bcc_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       =\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/sender_dependent_relayhost_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       =\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/sender_login_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT username FROM mailbox WHERE username='%s' AND (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/transport_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT REPLACE(transport, 'virtual', ':') AS transport FROM domain WHERE domain='%s' AND ('%s' &lt;&gt; 'smtp' AND active = true)\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_alias_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT goto FROM alias WHERE address='%s' AND ('%s' &lt;&gt; 'smtp' AND active = true)\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_alias_domains_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT goto FROM alias, alias_domain WHERE alias_domain.alias_domain = '%d' AND alias.address = '%u' || '@' || alias_domain.target_domain AND ('%s' &lt;&gt; 'smtp' AND alias.active = true) AND ('%s' &lt;&gt; 'smtp' AND alias_domain.active = true)\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_alias_domains_catchall_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT goto FROM alias, alias_domain WHERE alias_domain.alias_domain = '%d' AND alias.address = '%u' || '@' || alias_domain.target_domain AND ('%s' &lt;&gt; 'smtp' AND alias.active = true) AND ('%s' &lt;&gt; 'smtp' AND alias_domain.active = true)\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_alias_domains_mailbox_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT maildir FROM mailbox, alias_domain WHERE alias_domain.alias_domain = '%d' AND mailbox.username = '%u' || '@' || alias_domain.target_domain AND (('%s' = 'smtp' AND mailbox.smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND mailbox.active = true)) AND ('%s' &lt;&gt; 'smtp' AND alias_domain.active = true)\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_mailbox_domains.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT domain FROM domain WHERE domain='%s' AND backupmx = false AND ('%s' &lt;&gt; 'smtp' AND active = true) AND NOT (transport LIKE 'smtp%%' OR transport LIKE 'relay%%')\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_mailbox_limits.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT quota FROM mailbox WHERE username='%s' AND (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/pgsql/virtual_mailbox_maps.cf\nhosts       = 127.0.0.1:5432\nuser        = postfix\npassword    = __PASSWORD_POSTFIX__\ndbname      = postfixadmin\nquery       = SELECT maildir FROM mailbox WHERE username='%s' AND (('%s' = 'smtp' AND smtp_active = true) OR ('%s' &lt;&gt; 'smtp' AND active = true))\n\nEOF\n\n\nawk '/^Password for PostgreSQL user postfix:/ {print $NF}' /root/_passwords | \\\n    xargs -I % sed -e 's|__PASSWORD_POSTFIX__|%|g' -i '' /usr/local/etc/postfix/pgsql/*.cf\n\n\nchmod 0640 /usr/local/etc/postfix/pgsql/*.cf\nchown root:postfix /usr/local/etc/postfix/pgsql/*.cf\n</code></pre> <p>Restriktionen einrichten.</p> Bash<pre><code>cp -a /etc/mail/aliases /usr/local/etc/postfix/aliases\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/postscreen_access.cidr\n127.0.0.0/8 permit\n[::1]/128 permit\n10.0.0.0/8 permit\n[fe80::]/10 permit\n__IPADDR4__/32 permit\n[__IPADDR6__]/64 permit\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/postscreen_whitelist.cidr\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/body_checks.pcre\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/header_checks.pcre\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/command_filter.pcre\n# Work around clients that send `RCPT TO:&lt;'user@domain'&gt;` (Outlook 2003/2007).\n# WARNING: do not lose the parameters that follow the address.\n/^(RCPT\\s+TO:\\s*&lt;)'([^[:space:]]+)'(&gt;.*)/   $1$2$3\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/helo_access.pcre\n#---------------------------------------------------------------------\n# This file is part of iRedMail, which is an open source mail server\n# solution for Red Hat(R) Enterprise Linux, CentOS, Debian and Ubuntu.\n#\n# iRedMail is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# iRedMail is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with iRedMail.  If not, see &lt;http://www.gnu.org/licenses/&gt;.\n#---------------------------------------------------------------------\n\n#\n# Sample Postfix check_helo_access rule. It should be located at:\n#   /etc/postfix/check_helo_access.pcre\n#\n# Shipped within iRedMail project:\n#   * http://www.iredmail.org/\n\n# Prepend HELO hostname of sender server\n#/(.*)/ PREPEND X-Original-Helo: $1 (iRedMail: http://www.iredmail.org/)\n\n# No one will use these in helo command.\n/^(localhost)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/^(localhost.localdomain)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(\\.local)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n\n# Reject who use IP address as helo.\n# Correct:      [xxx.xxx.xxx.xxx]\n# Incorrect:    xxx.xxx.xxx.xxx\n/^([0-9\\.]+)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server sent non RFC compliant HELO identity (${1})\n\n#\n# This is the real HELO identify of these ISPs:\n#   sohu.com    websmtp.sohu.com relay2nd.mail.sohu.com\n#   126.com     m15-78.126.com\n#   sina.com    mail2-209.sinamail.sina.com.cn\n#   gmail.com   xx-out-NNNN.google.com\n/^(126\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server seems to be impersonating another mail server (${1})\n/^(sohu\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server seems to be impersonating another mail server (${1})\n/^(gmail\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server seems to be impersonating another mail server (${1})\n/^(google\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server seems to be impersonating another mail server (${1})\n/^(yahoo\\.com\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server seems to be impersonating another mail server (${1})\n/^(yahoo\\.co\\.jp)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server seems to be impersonating another mail server (${1})\n\n#\n# Spammers.\n#\n/^(728154EA470B4AA\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(taj-co\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(CF8D3DB045C1455\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(dsgsfdg\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(se\\.nit7-ngbo\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(mail\\.goo\\.ne\\.jp)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(n-ong_an\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(meqail\\.teamefs-ine5tl\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(zzg\\.jhf-sp\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(din_glo-ng\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(fda-cnc\\.ie\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(yrtaj-yrco\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(m\\.am\\.biz\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(xr_haig\\.roup\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(hjn\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(we_blf\\.com\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(netvigator\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(mysam\\.biz)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(mail\\.teams-intl\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(seningbo\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(nblf\\.com\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(kdn\\.ktguide\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(zzsp\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(nblongan\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(dpu\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(nbalton\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(cncie\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(xinhaigroup\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/^(wz\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/(\\.zj\\.cn)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n/(\\.kornet)$/ REJECT ACCESS DENIED. Your email was rejected because it appears to come from a known spamming mail server (${1})\n\n/^(dsldevice\\.lan)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/^(system\\.mail)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/^(speedtouch\\.lan)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n\n#\n# Reject adsl spammers.\n#\n# match word `adsl` with word boundary `\\b`.\n/(\\badsl\\b)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n\n# bypass \"[IP_ADDRESS]\"\n/^\\[(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\]$/ OK\n\n# Bypass HELOs used by known big ISPs which contains IP address\n/\\.outbound-(email|mail)\\.sendgrid\\.net$/ OK\n/^\\d{1,3}-\\d{1,3}-\\d{1,3}-\\d{1,3}\\.mail-.*\\.facebook\\.com$/ OK\n/^outbound-\\d{1,3}-\\d{1,3}-\\d{1,3}-\\d{1,3}\\.pinterestmail\\.com$/ OK\n/\\.outbound\\.protection\\.outlook\\.com$/ OK\n/^ec2-\\d{1,3}-\\d{1,3}-\\d{1,3}-\\d{1,3}\\..*\\.compute\\.amazonaws\\.com$/ OK\n/^out\\d{1,3}-\\d{1,3}-\\d{1,3}-\\d{1,3}\\.mail\\.qq\\.com$/ OK\n\n# reject HELO which contains IP address\n/(\\d{1,3}[\\.-]\\d{1,3}[\\.-]\\d{1,3}[\\.-]\\d{1,3})/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(\\d{1,3}\\.ip\\.-\\d{1,3}-\\d{1,3}-\\d{1,3}\\.eu)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(pppoe)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(dsl\\.brasiltelecom\\.net\\.br)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(dsl\\.optinet\\.hr)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(dsl\\.telesp\\.net\\.br)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(dialup)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(dhcp)/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(static-pool-[\\d\\.-]*\\.flagman\\.zp\\.ua)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n\n/(speedy\\.com\\.ar)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(speedyterra\\.com\\.br)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(static\\.sbb\\.rs)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n/(static\\.vsnl\\.net\\.in)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server appears to be on a dynamic IP address that should not be doing direct mail delivery (${1})\n\n/(advance\\.com\\.ar)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(airtelbroadband\\.in)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(bb\\.netvision\\.net\\.il)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(broadband3\\.iol\\.cz)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(cable\\.net\\.co)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(catv\\.broadband\\.hu)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(chello\\.nl)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(chello\\.sk)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(client\\.mchsi\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(comunitel\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(coprosys\\.cz)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(dclient\\.hispeed\\.ch)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(dip0\\.t-ipconnect\\.de)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(domain\\.invalid)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(dyn\\.centurytel\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(embarqhsd\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(emcali\\.net\\.co)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(epm\\.net\\.co)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(fibertel\\.com\\.ar)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(freedom2surf\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(hgcbroadband\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(HINET-IP\\.hinet\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(infonet\\.by)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(is74\\.ru)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(kievnet\\.com\\.ua)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(metrotel\\.net\\.co)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(nw\\.nuvox\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(pldt\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(pool\\.invitel\\.hu)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(pool\\.ukrtel\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(pools\\.arcor-ip\\.net)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(pppoe\\.avangarddsl\\.ru)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(retail\\.telecomitalia\\.it)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(revip2\\.asianet\\.co\\.th)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(tim\\.ro)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(tsi\\.tychy\\.pl)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(ttnet\\.net\\.tr)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(tttmaxnet\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(user\\.veloxzone\\.com\\.br)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(utk\\.ru)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(veloxzone\\.com\\.br)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(virtua\\.com\\.br)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(wanamaroc\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(wbt\\.ru)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(wireless\\.iaw\\.on\\.ca)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(business\\.telecomitalia\\.it)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(cotas\\.com\\.bo)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(marunouchi\\.tokyo\\.ocn\\.ne\\.jp)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(amedex\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/(aageneva\\.com)$/ REJECT ACCESS DENIED. Your email was rejected because the sending mail server does not identify itself correctly (${1})\n/^ylmf-pc/ REJECT ACCESS DENIED\n\n/(\\.*wideragents\\.com)$/ REJECT ACCESS DENIED (${1})\n/(\\.*resumekeep\\.net)$/ REJECT ACCESS DENIED (${1})\n/(\\.*terracedrink\\.com)$/ REJECT ACCESS DENIED (${1})\n/(\\.*sincemessage\\.com)$/ REJECT ACCESS DENIED (${1})\n/(\\.*ordertranquility\\.com)$/ REJECT ACCESS DENIED (${1})\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/recipient_checks.pcre\n/^\\@/             550 Invalid address format.\n/[!%\\@].*\\@/      550 This server disallows weird address syntax.\n/^postmaster\\@/   OK\n/^hostmaster\\@/   OK\n/^security\\@/     OK\n/^abuse\\@/        OK\n/^admin\\@/        OK\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/sender_access.pcre\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/submission_header_checks.pcre\n\n^Received:/             IGNORE\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/postscreen_dnsbl_reply\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/dnsbl_reply_map\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/mx_access\n0.0.0.0/8                REJECT MX in RFC 1122 Broadcast Network\n10.0.0.0/8               REJECT MX in RFC 1918 Private Network\n100.64.0.0/10            REJECT MX in RFC 6598 Shared Address Space\n127.0.0.0/8              REJECT MX in RFC 1122 Loopback Network\n169.254.0.0/16           REJECT MX in RFC 3927 Link Local Network\n172.16.0.0/12            REJECT MX in RFC 1918 Private Network\n192.0.0.0/24             REJECT MX in RFC 6890 IETF Protocol Assignments Network\n192.0.0.0/29             REJECT MX in RFC 6333 DS-Lite Network\n192.0.2.0/24             REJECT MX in RFC 5737 Documentation (TEST-NET-1) Network\n192.168.0.0/16           REJECT MX in RFC 1918 Private Network\n198.18.0.0/15            REJECT MX in RFC 2544 Interconnect Device Benchmark Testing Network\n198.51.100.0/24          REJECT MX in RFC 5737 Documentation (TEST-NET-2) Network\n203.0.113.0/24           REJECT MX in RFC 5737 Documentation (TEST-NET-3) Network\n224.0.0.0/4              REJECT MX in RFC 5771 Multicast Network\n240.0.0.0/4              REJECT MX in RFC 1122 Reserved Network\n255.255.255.255/32       REJECT MX in RFC 919  Limited Broadcast Destination Address\n::/128                   REJECT MX in RFC 4291 Unspecified Address\n::1/128                  REJECT MX in RFC 4291 Loopback Address\n::ffff:0:0/96            REJECT MX in RFC 4291 IPv4-mapped Address\n100::/64                 REJECT MX in RFC 6666 Discard-Only Network\n2001::/23                REJECT MX in RFC 2928 IETF Protocol Assignements Network\n2001::/32                REJECT MX in RFC 4380 TEREDO Network\n2001:2::/48              REJECT MX in RFC 5180 Interconnect Device Benchmark Testing Network\n2001:10::/28             REJECT MX in RFC 4843 ORCHID Network\n2001:db8::/32            REJECT MX in RFC 3849 Documentation Network\nfc00::/7                 REJECT MX in RFC 4193 Unique-Local Network\nfe80::/10                REJECT MX in RFC 4291 Linked-Scoped Unicast Network\nff00::/8                 REJECT MX in RFC 4291 Multicast Network\n\nEOF\n\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /usr/local/etc/postfix/postscreen_access.cidr\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /usr/local/etc/postfix/postscreen_access.cidr\n\n\nchmod 0640 /usr/local/etc/postfix/*.pcre\nchown root:postfix /usr/local/etc/postfix/*.pcre\n\n\npostmap /usr/local/etc/postfix/postscreen_dnsbl_reply\npostmap /usr/local/etc/postfix/dnsbl_reply_map\npostmap /usr/local/etc/postfix/mx_access\n\n/usr/local/bin/newaliases\n</code></pre> <p>Abschliessende Arbeiten.</p> Bash<pre><code>portmaster -w -B -g --force-config dns/rubygem-dnsruby  -n\nportmaster -w -B -g --force-config net/rubygem-ipaddress  -n\nportmaster -w -B -g --force-config devel/rubygem-optparse  -n\nportmaster -w -B -g --force-config devel/rubygem-pp  -n\n\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/postfix/postscreen_whitelist.rb\nEOF\nchmod 0755 /usr/local/etc/postfix/postscreen_whitelist.rb\n\n/usr/local/etc/postfix/postscreen_whitelist.rb -f\n</code></pre> <p>Wir installieren <code>mail/libmilter</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/mail_libmilter\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_libmilter/options\n_OPTIONS_READ=libmilter-8.18.1\n_FILE_COMPLETE_OPTIONS_LIST=IPV6 MILTER_SHARED MILTER_POOL DOCS\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_SET+=MILTER_SHARED\nOPTIONS_FILE_SET+=MILTER_POOL\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/libmilter  -n\n</code></pre> <p>Wir installieren <code>mail/py-spf-engine</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_py-anyio\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_py-anyio/options\n_OPTIONS_READ=py311-anyio-4.9.0\n_FILE_COMPLETE_OPTIONS_LIST=TRIO\nOPTIONS_FILE_SET+=TRIO\n\nEOF\n\nmkdir -p /var/db/ports/devel_py-pyasn1-modules\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_py-pyasn1-modules/options\n_OPTIONS_READ=py311-pyasn1-modules-0.4.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/dns_py-dnspython\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_py-dnspython/options\n_OPTIONS_READ=py311-dnspython-2.7.0\n_FILE_COMPLETE_OPTIONS_LIST=DNSSEC DOH DOQ EXAMPLES IDNA TRIO\nOPTIONS_FILE_SET+=DNSSEC\nOPTIONS_FILE_SET+=DOH\nOPTIONS_FILE_SET+=DOQ\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=IDNA\nOPTIONS_FILE_SET+=TRIO\n\nEOF\n\nmkdir -p /var/db/ports/mail_py-pymilter\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_py-pymilter/options\n_OPTIONS_READ=py311-pymilter-1.0.6\n_FILE_COMPLETE_OPTIONS_LIST= LIBMILTER BASE\nOPTIONS_FILE_SET+=LIBMILTER\nOPTIONS_FILE_UNSET+=BASE\n\nEOF\n\nmkdir -p /var/db/ports/www_py-httpcore\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_py-httpcore/options\n_OPTIONS_READ=py311-httpcore-1.0.9\n_FILE_COMPLETE_OPTIONS_LIST=ASYNCIO HTTP2 SOCKS TRIO\nOPTIONS_FILE_SET+=ASYNCIO\nOPTIONS_FILE_SET+=HTTP2\nOPTIONS_FILE_SET+=SOCKS\nOPTIONS_FILE_SET+=TRIO\n\nEOF\n\nmkdir -p /var/db/ports/www_py-httpx\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_py-httpx/options\n_OPTIONS_READ=py311-httpx-0.28.1\n_FILE_COMPLETE_OPTIONS_LIST=BROTLI CLI HTTP2 SOCKS ZSTD\nOPTIONS_FILE_SET+=BROTLI\nOPTIONS_FILE_SET+=CLI\nOPTIONS_FILE_SET+=HTTP2\nOPTIONS_FILE_SET+=SOCKS\nOPTIONS_FILE_SET+=ZSTD\n\nEOF\n\nmkdir -p /var/db/ports/www_py-requests\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_py-requests/options\n_OPTIONS_READ=py311-requests-2.32.4\n_FILE_COMPLETE_OPTIONS_LIST=SOCKS\nOPTIONS_FILE_SET+=SOCKS\n\nEOF\n\nmkdir -p /var/db/ports/mail_py-spf-engine\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_py-spf-engine/options\n_OPTIONS_READ=py311-spf-engine-3.0.4\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/py-spf-engine  -n\n\n\nsysrc pyspf_milter_enable=\"YES\"\n\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/pyspf-milter/pyspf-milter.conf\ndebugLevel = 1\nTestOnly = 1\nReason_Message = Message {rejectdefer} due to: {spf}. Please see {url}\nMacroList daemon_name|VERIFYING\nHELO_reject = SPF_Not_Pass\nMail_From_reject = Fail\nNo_Mail = False\nPermError_reject = False\nTempError_Defer = False\nskip_addresses = 127.0.0.0/8,::ffff:127.0.0.0/104,::1\nHeader_Type = SPF\nHide_Receiver = Yes\nAuthserv_Id = mail.example.com\nSocket = inet:8893@localhost\nPidFile = /var/run/pyspf-milter/pyspf-milter.pid\nUserID = pyspf-milter\nInternalHosts = 127.0.0.1\nMock = true\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/python-policyd-spf/policyd-spf.conf\ndebugLevel = 1\nTestOnly = 1\nReason_Message = Message {rejectdefer} due to: {spf}. Please see {url}\nMacroList daemon_name|VERIFYING\nHELO_reject = SPF_Not_Pass\nMail_From_reject = Fail\nNo_Mail = False\nPermError_reject = False\nTempError_Defer = False\nskip_addresses = 127.0.0.0/8,::ffff:127.0.0.0/104,::1\nHeader_Type = SPF\nHide_Receiver = Yes\nAuthserv_Id = mail.example.com\nSocket = inet:8893@localhost\nPidFile = /var/run/pyspf-milter/pyspf-milter.pid\nUserID = pyspf-milter\nInternalHosts = 127.0.0.1\nMock = true\n\nEOF\n\n\nservice pyspf-milter start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfix/#abschluss","title":"Abschluss","text":"<p>Postfix kann nun gestartet werden.</p> Bash<pre><code>service postfix start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfixadmin/","title":"PostfixAdmin","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/postfixadmin/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>PostfixAdmin 4.0.0 (PostgreSQL, Vacation)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfixadmin/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfixadmin/#installation","title":"Installation","text":"<p>Wir installieren <code>mail/postfixadmin</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_p5-DBI\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_p5-DBI/options\n_OPTIONS_READ=p5-DBI-1.647\n_FILE_COMPLETE_OPTIONS_LIST=PROXY\nOPTIONS_FILE_SET+=PROXY\n\nEOF\n\nmkdir -p /var/db/ports/dns_p5-Net-DNS\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_p5-Net-DNS/options\n_OPTIONS_READ=p5-Net-DNS-1.50\n_FILE_COMPLETE_OPTIONS_LIST=IDN IDN2 IPV6 SSHFP TSIG\nOPTIONS_FILE_SET+=IDN\nOPTIONS_FILE_SET+=IDN2\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=SSHFP\nOPTIONS_FILE_SET+=TSIG\n\nEOF\n\nmkdir -p /var/db/ports/dns_libidn\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_libidn/options\n_OPTIONS_READ=libidn-1.43\n_FILE_COMPLETE_OPTIONS_LIST=DOCS NLS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/devel_p5-Moo\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_p5-Moo/options\n_OPTIONS_READ=p5-Moo-2.005005\n_FILE_COMPLETE_OPTIONS_LIST=XS\nOPTIONS_FILE_SET+=XS\n\nEOF\n\nmkdir -p /var/db/ports/devel_p5-Class-C3\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_p5-Class-C3/options\n_OPTIONS_READ=p5-Class-C3-0.35\n_FILE_COMPLETE_OPTIONS_LIST=XS\nOPTIONS_FILE_SET+=XS\n\nEOF\n\nmkdir -p /var/db/ports/mail_postfixadmin\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_postfixadmin/options\n_OPTIONS_READ=postfixadmin-php83-3.4.d.20211018\n_FILE_COMPLETE_OPTIONS_LIST=ADDONS DOCS IMAP MYSQL PGSQL SQLITE\nOPTIONS_FILE_SET+=ADDONS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=IMAP\nOPTIONS_FILE_SET+=MYSQL\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_UNSET+=SQLITE\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/postfixadmin  -n\n\n\n\nmkdir -p /data/www/apps/postfixadmin\n\nrm -r /data/www/apps/postfixadmin\ngit clone --depth 1 https://github.com/postfixadmin/postfixadmin.git /data/www/apps/postfixadmin\ngit -C /data/www/apps/postfixadmin pull --rebase\n\ncd /data/www/apps/postfixadmin\n\nsed -e 's|\\(/bin/bash.*\\)$|/usr/local\\1|' \\\n    -e 's|/usr/bin/\\(.*\\)$|/usr/local/bin/\\1|' \\\n    -i '' install.sh\nbash install.sh\ncd\n\nchmod 0750 templates_c\nchown www:www templates_c\n\nln -s /data/www/apps/postfixadmin/public /data/www/vhosts/_default_/data/postfixadmin\n\n\ncat &lt;&lt;'EOF' &gt;&gt; /data/db/postgres/data17/pg_hba.conf\n#\n# postfixadmin databases\n#\n# TYPE  DATABASE        USER            ADDRESS                 METHOD\n#\nlocal   postfixadmin    postfix                                 scram-sha-256\nhost    postfixadmin    postfix         127.0.0.1/32            scram-sha-256\nhost    postfixadmin    postfix         ::1/128                 scram-sha-256\n#\nEOF\n\nsu - postgres\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostgreSQL user postfix: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\ncreateuser -U postgres -S -D -R -P -e postfix\n\ncreatedb -U postgres -E unicode -O postfix postfixadmin\n\npsql postfixadmin\n\nGRANT ALL PRIVILEGES ON DATABASE postfixadmin TO postfix;\nQUIT;\n\nexit\n\n\ncat &lt;&lt;'EOF' &gt; /data/www/apps/postfixadmin/config.local.php\n&lt;?php\n$CONF['database_type'] = 'pgsql';\n$CONF['database_host'] = 'localhost';\n$CONF['database_user'] = 'postfix';\n$CONF['database_password'] = '__PASSWORD_POSTFIX__';\n$CONF['database_name'] = 'postfixadmin';\n$CONF['encrypt'] = 'ARGON2ID';\n$CONF['configured'] = true;\n$CONF['default_language'] = 'de';\n$CONF['setup_password'] = '__SETUP_HASH__';\n$CONF['smtp_server'] = 'localhost';\n$CONF['smtp_port'] = '465';\n$CONF['smtp_type'] = 'tls';\n$CONF['smtp_client'] = 'mail.example.com';\n$CONF['dovecotpw'] = \"/usr/local/sbin/doveadm pw\";\nif(@file_exists('/usr/local/bin/doveadm')) { // @ to silence openbase_dir stuff; see https://github.com/postfixadmin/postfixadmin/issues/171\n    $CONF['dovecotpw'] = \"/usr/local/bin/doveadm pw\"; # debian\n}\n$CONF['password_validation'] = array(\n    '/.{5}/'                                         =&gt; 'password_too_short 5',      # minimum length 5 characters\n    '/([a-zA-Z].*){3}/'                              =&gt; 'password_no_characters 3',  # must contain at least 3 characters\n    '/([0-9].*){2}/'                                 =&gt; 'password_no_digits 2',      # must contain at least 2 digits\n    '/([!\\\".,*&amp;^%$\u00a3)(_+=\\-`\\'#@~\\[\\]\\\\&lt;&gt;\\/].*){1,}/' =&gt; 'password_no_special 1', # must contain at least 1 special character\n    /*  support a 'callable' value which if it returns a non-empty string will be assumed to have failed, non-empty string should be a PALANG key */\n    // 'length_check'                                   =&gt; function($password) { if (strlen(trim($password)) &lt; 3) { return 'password_too_short'; } },\n);\n$CONF['show_password'] = 'YES';\n$CONF['page_size'] = '100';\n$CONF['default_aliases'] = array (\n    'abuse'       =&gt; 'abuse@example.com',\n    'security'    =&gt; 'security@example.com',\n    'hostmaster'  =&gt; 'hostmaster@example.com',\n    'postmaster'  =&gt; 'postmaster@example.com',\n    'webmaster'   =&gt; 'webmaster@example.com',\n    'dmarc'       =&gt; 'dmarc@example.com'\n    'virusalert'  =&gt; 'virusalert@example.com',\n);\n$CONF['aliases'] = '1000';\n$CONF['mailboxes'] = '100';\n$CONF['maxquota'] = '2048';\n$CONF['domain_quota_default'] = '204800';\n$CONF['quota'] = 'YES';\n$CONF['new_quota_table'] = 'YES'\n$CONF['transport'] = 'YES';\n$CONF['transport_options'] = array (\n    'virtual',  // for virtual accounts\n    'local',    // for system accounts\n    'relay',    // for backup mx\n    'vacation'  // for vacation\n);\n$CONF['transport_default'] = 'virtual';\n$CONF['vacation'] = 'YES';\n$CONF['vacation_domain'] = 'autoreply.example.com';\n$CONF['special_alias_control'] = 'YES';\n$CONF['backup'] = 'YES';\n$CONF['sendmail_all_admins'] = 'YES';\n$CONF['show_header_text'] = 'YES';\n$CONF['header_text'] = ':: Postfix Admin on mail.example.com ::';\n$CONF['footer_text'] = 'Return to mail.example.com';\n$CONF['footer_link'] = 'https://mail.example.com';\n$CONF['emailcheck_localaliasonly'] ='YES';\n$CONF['dkim'] = 'YES';\n$CONF['dkim_all_admins'] = 'YES';\n$CONF['recipient_delimiter'] = \"+\";\n$CONF['used_quotas'] = 'YES';\n$CONF['smtp_active_flag'] = 'YES';\n?&gt;\n\nEOF\nchown www:www /data/www/apps/postfixadmin/config.local.php\n\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostfixAdmin setup_hash: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"$newpw\" | xargs -I % php -r \"echo password_hash('%', PASSWORD_DEFAULT);\" | \\\n    xargs -I % sed -e 's|__SETUP_HASH__|%|g' -i '' /data/www/apps/postfixadmin/config.local.php\necho \"Password: $newpw\"\nunset newpw\n\n\nawk '/^Password for PostgreSQL user postfix:/ {print $NF}' /root/_passwords | \\\n    xargs -I % sed -e 's|__PASSWORD_POSTFIX__|%|g' -i '' /data/www/apps/postfixadmin/config.local.php\n\n\nsed -e 's|/usr/bin/perl|/usr/local/bin/perl|' \\\n    -i '' /data/db/postfixadmin/vacation.pl\n\ncat &lt;&lt;'EOF' &gt; /data/db/postfixadmin/vacation.conf\n$db_username = 'postfix';\n$db_password = '__PASSWORD_POSTFIX__';\n$db_name = 'postfixadmin';\n$vacation_domain = 'autoreply.example.com';\n$smtp_server_port = '465';\n$smtp_helo = 'mail.example.com';\n$smtp_ssl = '1';\n$smtp_authid = 'vacation@example.com';\n$smtp_authpwd = '__PASSWORD_VACATION__';\n$friendly_from = 'Vacation Notice';\n$accountname_check = '1';\n$logfile = '/data/db/postfixadmin/vacation.log';\n$log_to_file = '1';\n$custom_noreply_pattern = '1';\n$noreply_pattern = 'bounce|do-not-reply|facebook|linkedin|list-|myspace|twitter';\n$no_vacation_pattern = '';\n1; # required final line - keeps perl happy.\n\nEOF\n\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostfixAdmin user vacation: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"$newpw\" | xargs -I % sed -e 's|__PASSWORD_VACATION__|%|g' -i '' /data/db/postfixadmin/vacation.conf\necho \"Password: $newpw\"\nunset newpw\n\n\nchmod 0750 /data/db/postfixadmin\nchmod 0750 /data/db/postfixadmin/vacation.pl\nchmod 0750 /data/db/postfixadmin/vacation.conf\nchown -R root:vacation /data/db/postfixadmin\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/postfixadmin/#abschluss","title":"Abschluss","text":"<p>Das PostfixAdmin Setup muss nun im Browser gestartet und befolgt werden.</p> Bash<pre><code>https://mail.example.com/postfixadmin/setup.php\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/spamassassin/","title":"SpamAssassin","text":""},{"location":"howtos/freebsd/hosting_system/mailserver/spamassassin/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>SpamAssassin 4.0.1 (SpamAss-Milter)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/mailserver/spamassassin/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/mailserver/spamassassin/#installation","title":"Installation","text":"<p>Wir installieren <code>mail/spamassassin</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_p5-DBD-SQLite\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_p5-DBD-SQLite/options\n_OPTIONS_READ=p5-DBD-SQLite-1.76\n_FILE_COMPLETE_OPTIONS_LIST=BUNDLED_SQLITE\nOPTIONS_FILE_UNSET+=BUNDLED_SQLITE\n\nEOF\n\nmkdir -p /var/db/ports/databases_p5-DBIx-Simple\ncat &lt;&lt;'EOF' &gt; /var/db/ports/db/ports/databases_p5-DBIx-Simple/options\n_OPTIONS_READ=p5-DBIx-Simple-1.37\n_FILE_COMPLETE_OPTIONS_LIST=DBIX_XHTML_TABLE SQL_ABSTRACT SQL_INTERP TEXT_TABLE\nOPTIONS_FILE_UNSET+=DBIX_XHTML_TABLE\nOPTIONS_FILE_UNSET+=SQL_ABSTRACT\nOPTIONS_FILE_UNSET+=SQL_INTERP\nOPTIONS_FILE_UNSET+=TEXT_TABLE\n\nEOF\n\nmkdir -p /var/db/ports/dns_p5-Net-DNS\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_p5-Net-DNS/options\n_OPTIONS_READ=p5-Net-DNS-1.50\n_FILE_COMPLETE_OPTIONS_LIST=IDN IDN2 IPV6 SSHFP TSIG\nOPTIONS_FILE_SET+=IDN\nOPTIONS_FILE_SET+=IDN2\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=SSHFP\nOPTIONS_FILE_SET+=TSIG\n\nEOF\n\nmkdir -p /var/db/ports/devel_p5-Parse-RecDescent\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_p5-Parse-RecDescent/options\n_OPTIONS_READ=p5-Parse-RecDescent-1.967015\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/security_p5-IO-Socket-SSL\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_p5-IO-Socket-SSL/options\n_OPTIONS_READ=p5-IO-Socket-SSL-2.094\n_FILE_COMPLETE_OPTIONS_LIST=CERTS EXAMPLES IDN\nOPTIONS_FILE_SET+=CERTS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=IDN\n\nEOF\n\nmkdir -p /var/db/ports/security_p5-Net-SSLeay\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_p5-Net-SSLeay/options\n_OPTIONS_READ=p5-Net-SSLeay-1.94\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/security_p5-Authen-SASL\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_p5-Authen-SASL/options\n_OPTIONS_READ=p5-Authen-SASL-2.18\n_FILE_COMPLETE_OPTIONS_LIST=KERBEROS\nOPTIONS_FILE_UNSET+=KERBEROS\n\nEOF\n\nmkdir -p /var/db/ports/net_p5-Net-Server\ncat &lt;&lt;'EOF' &gt; /var/db/ports/net_p5-Net-Server/options\n_OPTIONS_READ=p5-Net-Server-2.014\n_FILE_COMPLETE_OPTIONS_LIST=IPV6\nOPTIONS_FILE_SET+=IPV6\n\nEOF\n\nmkdir -p /var/db/ports/devel_p5-Test-NoWarnings\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_p5-Test-NoWarnings/options\n_OPTIONS_READ=p5-Test-NoWarnings-1.06\n_FILE_COMPLETE_OPTIONS_LIST=DEVEL_STACKTRACE\nOPTIONS_FILE_UNSET+=DEVEL_STACKTRACE\n\nEOF\n\nmkdir -p /var/db/ports/www_p5-CGI\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_p5-CGI/options\n_OPTIONS_READ=p5-CGI-4.69\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/www_p5-HTTP-Tiny\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_p5-HTTP-Tiny/options\n_OPTIONS_READ=p5-HTTP-Tiny-0.090\n_FILE_COMPLETE_OPTIONS_LIST=CERTS COOKIE HTTPS IO_SOCKET_IP\nOPTIONS_FILE_SET+=CERTS\nOPTIONS_FILE_SET+=COOKIE\nOPTIONS_FILE_SET+=HTTPS\nOPTIONS_FILE_SET+=IO_SOCKET_IP\n\nEOF\n\nmkdir -p /var/db/ports/devel_p5-Data-Dumper-Concise\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_p5-Data-Dumper-Concise/options\n_OPTIONS_READ=p5-Data-Dumper-Concise-2.023\n_FILE_COMPLETE_OPTIONS_LIST=ARGNAMES\nOPTIONS_FILE_SET+=ARGNAMES\n\nEOF\n\nmkdir -p /var/db/ports/mail_spamassassin\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_spamassassin/options\n_OPTIONS_READ=spamassassin-4.0.1\n_FILE_COMPLETE_OPTIONS_LIST=AS_ROOT DOCS SSL GNUPG_NONE GNUPG GNUPG2 MYSQL PGSQL DCC DKIM DMARC PYZOR RAZOR RELAY_COUNTRY RLIMIT SPF_QUERY\nOPTIONS_FILE_SET+=AS_ROOT\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=SSL\nOPTIONS_FILE_UNSET+=GNUPG_NONE\nOPTIONS_FILE_UNSET+=GNUPG\nOPTIONS_FILE_SET+=GNUPG2\nOPTIONS_FILE_SET+=MYSQL\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_UNSET+=DCC\nOPTIONS_FILE_SET+=DKIM\nOPTIONS_FILE_SET+=DMARC\nOPTIONS_FILE_UNSET+=PYZOR\nOPTIONS_FILE_UNSET+=RAZOR\nOPTIONS_FILE_SET+=RELAY_COUNTRY\nOPTIONS_FILE_UNSET+=RLIMIT\nOPTIONS_FILE_SET+=SPF_QUERY\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/spamassassin  -n\n\n\nsysrc spamd_enable=\"YES\"\nsysrc spamd_flags=\"-c -u spamd -H /var/spool/spamd\"\n</code></pre> <p>Datenbanken installieren.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /tmp/spamass_mail_bayes_shema.sql\nCREATE TABLE bayes_expire (\n  id integer NOT NULL default '0',\n  runtime integer NOT NULL default '0'\n) WITHOUT OIDS;\n\nCREATE INDEX bayes_expire_idx1 ON bayes_expire (id);\n\nCREATE TABLE bayes_global_vars (\n  variable varchar(30) NOT NULL default '',\n  value varchar(200) NOT NULL default '',\n  PRIMARY KEY  (variable)\n) WITHOUT OIDS;\n\nINSERT INTO bayes_global_vars VALUES ('VERSION','3');\n\nCREATE TABLE bayes_seen (\n  id integer NOT NULL default '0',\n  msgid varchar(200) NOT NULL default '',\n  flag character(1) NOT NULL default '',\n  PRIMARY KEY  (id,msgid)\n) WITHOUT OIDS;\n\nCREATE TABLE bayes_token (\n  id integer NOT NULL default '0',\n  token bytea NOT NULL default '',\n  spam_count integer NOT NULL default '0',\n  ham_count integer NOT NULL default '0',\n  atime integer NOT NULL default '0',\n  PRIMARY KEY  (id,token)\n) WITHOUT OIDS;\n\nCREATE INDEX bayes_token_idx1 ON bayes_token (token);\n\nALTER TABLE bayes_token SET (fillfactor=95);\n\nCREATE TABLE bayes_vars (\n  id serial NOT NULL,\n  username varchar(200) NOT NULL default '',\n  spam_count integer NOT NULL default '0',\n  ham_count integer NOT NULL default '0',\n  token_count integer NOT NULL default '0',\n  last_expire integer NOT NULL default '0',\n  last_atime_delta integer NOT NULL default '0',\n  last_expire_reduce integer NOT NULL default '0',\n  oldest_token_age integer NOT NULL default '2147483647',\n  newest_token_age integer NOT NULL default '0',\n  PRIMARY KEY  (id)\n) WITHOUT OIDS;\n\nCREATE UNIQUE INDEX bayes_vars_idx1 ON bayes_vars (username);\n\nCREATE OR REPLACE FUNCTION greatest_int (integer, integer)\n RETURNS INTEGER\n IMMUTABLE STRICT\n AS 'SELECT CASE WHEN $1 &lt; $2 THEN $2 ELSE $1 END;'\n LANGUAGE SQL;\n\nCREATE OR REPLACE FUNCTION least_int (integer, integer)\n RETURNS INTEGER\n IMMUTABLE STRICT\n AS 'SELECT CASE WHEN $1 &lt; $2 THEN $1 ELSE $2 END;'\n LANGUAGE SQL;\n\nCREATE OR REPLACE FUNCTION put_tokens(INTEGER,\n                                      BYTEA[],\n                                      INTEGER,\n                                      INTEGER,\n                                      INTEGER)\nRETURNS VOID AS '\nDECLARE\n  inuserid      ALIAS FOR $1;\n  intokenary    ALIAS FOR $2;\n  inspam_count  ALIAS FOR $3;\n  inham_count   ALIAS FOR $4;\n  inatime       ALIAS FOR $5;\n  _token BYTEA;\n  new_tokens INTEGER := 0;\nBEGIN\n  for i in array_lower(intokenary, 1) .. array_upper(intokenary, 1)\n  LOOP\n    _token := intokenary[i];\n    UPDATE bayes_token\n       SET spam_count = greatest_int(spam_count + inspam_count, 0),\n           ham_count = greatest_int(ham_count + inham_count, 0),\n           atime = greatest_int(atime, inatime)\n     WHERE id = inuserid\n       AND token = _token;\n    IF NOT FOUND THEN\n      -- we do not insert negative counts, just return true\n      IF NOT (inspam_count &lt; 0 OR inham_count &lt; 0) THEN\n        INSERT INTO bayes_token (id, token, spam_count, ham_count, atime)\n        VALUES (inuserid, _token, inspam_count, inham_count, inatime);\n        IF FOUND THEN\n          new_tokens := new_tokens + 1;\n        END IF;\n      END IF;\n    END IF;\n  END LOOP;\n\n  IF new_tokens &gt; 0 AND inatime &gt; 0 THEN\n    UPDATE bayes_vars\n       SET token_count = token_count + new_tokens,\n           newest_token_age = greatest_int(newest_token_age, inatime),\n           oldest_token_age = least_int(oldest_token_age, inatime)\n     WHERE id = inuserid;\n  ELSIF new_tokens &gt; 0 AND NOT inatime &gt; 0 THEN\n    UPDATE bayes_vars\n       SET token_count = token_count + new_tokens\n     WHERE id = inuserid;\n  ELSIF NOT new_tokens &gt; 0 AND inatime &gt; 0 THEN\n    UPDATE bayes_vars\n       SET newest_token_age = greatest_int(newest_token_age, inatime),\n           oldest_token_age = least_int(oldest_token_age, inatime)\n     WHERE id = inuserid;\n  END IF;\n  RETURN;\nEND;\n' LANGUAGE 'plpgsql';\nEOF\n\ncat &lt;&lt;'EOF' &gt; /tmp/spamass_mail_awl_shema.sql\nCREATE TABLE awl (\n  username varchar(100) NOT NULL default '',\n  email varchar(255) NOT NULL default '',\n  ip varchar(40) NOT NULL default '',\n  msgcount bigint NOT NULL default '0',\n  totscore float NOT NULL default '0',\n  signedby varchar(255) NOT NULL default '',\n  last_hit timestamp NOT NULL default CURRENT_TIMESTAMP,\n  PRIMARY KEY (username,email,signedby,ip)\n);\n\ncreate index awl_last_hit on awl (last_hit);\n\ncreate OR REPLACE function update_awl_last_hit()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.last_hit = CURRENT_TIMESTAMP;\n  RETURN NEW;\nEND;\n$$ language 'plpgsql';\n\ncreate TRIGGER update_awl_update_last_hit BEFORE UPDATE\nON awl FOR EACH ROW EXECUTE PROCEDURE\nupdate_awl_last_hit();\n\nALTER TABLE awl SET (fillfactor=95);\nEOF\n\n\ncat &lt;&lt;'EOF' &gt;&gt; /data/db/postgres/data17/pg_hba.conf\n#\n# spamassassin databases\n#\n# TYPE  DATABASE        USER            ADDRESS                 METHOD\n#\nlocal   mail_bayes      spamass                                 scram-sha-256\nhost    mail_bayes      spamass         127.0.0.1/32            scram-sha-256\nhost    mail_bayes      spamass         ::1/128                 scram-sha-256\nlocal   mail_awl        spamass                                 scram-sha-256\nhost    mail_awl        spamass         127.0.0.1/32            scram-sha-256\nhost    mail_awl        spamass         ::1/128                 scram-sha-256\n#\nEOF\n\nsu - postgres\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for PostgreSQL user spamass: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\ncreateuser -U postgres -S -D -R -P -e spamass\n\n\ncreatedb -U postgres -E unicode -O spamass mail_bayes\n\npsql mail_bayes\n\nGRANT ALL PRIVILEGES ON DATABASE mail_bayes TO spamass;\nQUIT;\n\npsql -U spamass mail_bayes &lt; /tmp/spamass_mail_bayes_shema.sql\n\n\ncreatedb -U postgres -E unicode -O spamass mail_awl\n\npsql mail_awl\n\nGRANT ALL PRIVILEGES ON DATABASE mail_awl TO spamass;\nQUIT;\n\npsql -U spamass mail_awl &lt; /tmp/spamass_mail_awl_shema.sql\n\n\nexit\n</code></pre> <p>Wir installieren <code>mail/spamass-milter</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/mail_spamass-milter\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_spamass-milter/options\n_OPTIONS_READ=spamass-milter-0.4.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS LDAP MILTER_PORT\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=MILTER_PORT\n\nEOF\n\n\nportmaster -w -B -g --force-config mail/spamass-milter  -n\n\n\nsysrc spamass_milter_enable=\"YES\"\nsysrc spamass_milter_user=\"spamd\"\nsysrc spamass_milter_group=\"spamd\"\nsysrc spamass_milter_socket=\"/var/run/spamass-milter/spamass-milter.sock\"\nsysrc spamass_milter_socket_owner=\"spamd\"\nsysrc spamass_milter_socket_group=\"mail\"\nsysrc spamass_milter_socket_mode=\"660\"\nsysrc spamass_milter_localflags=\"-r 15 -f -u spamd -- -u spamd\"\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/spamassassin/#konfigurieren","title":"Konfigurieren","text":"<p><code>local.cf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/local.cf\n#\n# See also:\n#    $ man Mail::SpamAssassin::Conf\n#\n\nlock_method         flock\n\nclear_internal_networks\n\ninternal_networks    10.0.0.0/8 [fe80::]/10\ninternal_networks    __IPADDR4__/32 [__IPADDR6__]/64\n\nclear_trusted_networks\n\ntrusted_networks    10.0.0.0/8 [fe80::]/10\ntrusted_networks    __IPADDR4__/32 [__IPADDR6__]/64\n\nclear_headers\n\nadd_header all Flag _YESNOCAPS_\nadd_header all Level _STARS(*)_\nadd_header all Status _YESNO_, score=_SCORE_ required=_REQD_ autolearn=_AUTOLEARN_ tests=_TESTSSCORES_\nadd_header all Report _REPORT_\nadd_header all RBLs _RBL_\nadd_header all Checker-Version SpamAssassin _VERSION_ (_SUBVERSION_) on _HOSTNAME_\n\nreport_safe         0\n\nrequired_score      5.0\nrewrite_header      subject [ SPAM ]\n\nbayes_store_module  Mail::SpamAssassin::BayesStore::PgSQL\nbayes_sql_dsn       DBI:Pg:database=spamass_bayes;host=127.0.0.1;port=5432\nbayes_sql_username  spamass\nbayes_sql_password  __PASSWORD_SPAMASS__\n\nreport_contact      postmaster@example.com\nreport_hostname     mail.example.com\n\nversion_tag         20250426\n\nheader AUTHENTICATED_SENDER Received =~ /Authenticated\\ sender\\:.*by\\ mail\\.example\\.com/\ndescribe AUTHENTICATED_SENDER Header 'Received:' contains 'Authenticated sender:'\nscore AUTHENTICATED_SENDER -3\n\nnormalize_charset 1\n\nbayes_ignore_header X-Bogosity\nbayes_ignore_header X-Spam-Flag\nbayes_ignore_header X-Spam-Status\n\nscore RP_MATCHES_RCVD 0\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/init.pre\nenable_compat welcomelist_blocklist\nloadplugin Mail::SpamAssassin::Plugin::URIDNSBL\nloadplugin Mail::SpamAssassin::Plugin::SPF\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v310.pre\nloadplugin Mail::SpamAssassin::Plugin::AWL\nloadplugin Mail::SpamAssassin::Plugin::AutoLearnThreshold\nloadplugin Mail::SpamAssassin::Plugin::TextCat\nloadplugin Mail::SpamAssassin::Plugin::WelcomeListSubject\nloadplugin Mail::SpamAssassin::Plugin::MIMEHeader\nloadplugin Mail::SpamAssassin::Plugin::ReplaceTags\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v312.pre\n\noadplugin Mail::SpamAssassin::Plugin::DKIM\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v320.pre\nloadplugin Mail::SpamAssassin::Plugin::Check\nloadplugin Mail::SpamAssassin::Plugin::HTTPSMismatch\nloadplugin Mail::SpamAssassin::Plugin::URIDetail\nloadplugin Mail::SpamAssassin::Plugin::Shortcircuit\nloadplugin Mail::SpamAssassin::Plugin::Bayes\nloadplugin Mail::SpamAssassin::Plugin::BodyEval\nloadplugin Mail::SpamAssassin::Plugin::DNSEval\nloadplugin Mail::SpamAssassin::Plugin::HTMLEval\nloadplugin Mail::SpamAssassin::Plugin::HeaderEval\nloadplugin Mail::SpamAssassin::Plugin::MIMEEval\nloadplugin Mail::SpamAssassin::Plugin::RelayEval\nloadplugin Mail::SpamAssassin::Plugin::URIEval\nloadplugin Mail::SpamAssassin::Plugin::WLBLEval\nloadplugin Mail::SpamAssassin::Plugin::VBounce\nloadplugin Mail::SpamAssassin::Plugin::Rule2XSBody\nloadplugin Mail::SpamAssassin::Plugin::ImageInfo\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v330.pre\nloadplugin Mail::SpamAssassin::Plugin::PhishTag\nloadplugin Mail::SpamAssassin::Plugin::FreeMail\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v340.pre\n\noadplugin Mail::SpamAssassin::Plugin::AskDNS\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v341.pre\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v342.pre\nloadplugin Mail::SpamAssassin::Plugin::HashBL\nloadplugin Mail::SpamAssassin::Plugin::FromNameSpoof\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v343.pre\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v400.pre\nloadplugin Mail::SpamAssassin::Plugin::ExtractText\nloadplugin Mail::SpamAssassin::Plugin::DMARC\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/mail/spamassassin/v401.pre\n\noadplugin Mail::SpamAssassin::Plugin::AuthRes\n\nEOF\n\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /usr/local/etc/mail/spamassassin/local.cf\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | cut -d'/' -f 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /usr/local/etc/mail/spamassassin/local.cf\n\n\nawk '/^Password for PostgreSQL user spamass:/ {print $NF}' /root/_passwords | \\\n    xargs -I % sed -e 's|__PASSWORD_SPAMASS__|%|g' -i '' /usr/local/etc/mail/spamassassin/local.cf\n</code></pre> <p>SpamAssassin Datenbank anlegen.</p> Bash<pre><code>/usr/local/bin/sa-update --channel updates.spamassassin.org --refreshmirrors --verbose\n/usr/local/bin/sa-update --channel updates.spamassassin.org --verbose\n/usr/local/bin/sa-update --nogpg --channel kam.sa-channels.mcgrail.com --refreshmirrors --verbose\n/usr/local/bin/sa-update --nogpg --channel kam.sa-channels.mcgrail.com --verbose\n\n/usr/local/bin/sa-compile --quiet\n</code></pre> <p>SpamAssassin Datenbank updaten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/sbin/update-spamassassin\n#!/bin/sh -eu\n#\n#  **********************************************************************************\n#  *                             update-spamassassin.sh                             *\n#  *                            ------------------------                            *\n#  *                                                                                *\n#  **********************************************************************************\n#  *                                                                                *\n#  * MIT License                                                                    *\n#  *                                                                                *\n#  * Copyright \u00a9 2016-2025 Markus Kohlmeyer &lt;rootservice@gmail.com&gt;                 *\n#  *                                                                                *\n#  * Permission is hereby granted, free of charge, to any person obtaining a copy   *\n#  * of this software and associated documentation files (the \"Software\"), to deal  *\n#  * in the Software without restriction, including without limitation the rights   *\n#  * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell      *\n#  * copies of the Software, and to permit persons to whom the Software is          *\n#  * furnished to do so, subject to the following conditions:                       *\n#  *                                                                                *\n#  * The above copyright notice and this permission notice shall be included in all *\n#  * copies or substantial portions of the Software.                                *\n#  *                                                                                *\n#  * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR     *\n#  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,       *\n#  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE    *\n#  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER         *\n#  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,  *\n#  * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  *\n#  * SOFTWARE.                                                                      *\n#  *                                                                                *\n#  **********************************************************************************\n#\n\n# Environment\nexport TZ=UTC\nexport LC_ALL=C\nset -o nounset\nset -o pipefail\n\n####################################################################################\n#                               Configurable Variables                             #\n####################################################################################\nVERSION=\"1.0.0\"\nAUTHORS=\"Markus Kohlmeyer\"\nCONTACT=\"&lt;rootservice@gmail.com&gt;\"\nCOPYRIGHT=\"Copyright (C) 2016-2025 Markus Kohlmeyer\"\nREPORTS=\"https://github.com/RootService/mkdocs\"\n\nALLOWEDOPTS=\"\"\nUSAGEOPTIONS=\"\"\n\n# Files\nLOG_FILE=\"/var/log/$(basename \"$0\").log\"\nTMP_FILE=\"$(mktemp -q /tmp/$(basename \"$0\").XXXXXX)\" || { show_error \"Failed to create temp file\"; exit 1; }\n\n# Directories\nTMP_DIR=\"$(mktemp -d -q /tmp/$(basename \"$0\").XXXXXX)\" || { show_error \"Failed to create temp dir\"; exit 1; }\n\n# Variables\n\n# Commands\nSA_UPDATE_CMD=\"/usr/local/bin/sa-update\"\nSA_COMPILE_CMD=\"/usr/local/bin/sa-compile\"\n\n\n####################################################################################\n#                                   Color Output                                   #\n####################################################################################\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nWHITE='\\033[0;37m'\nNC='\\033[0m'\n\ncecho() { # color, message\n  color=\"$1\"; shift\n  eval printf \\\"%b%s%b\\\\n\\\" \\\"\\$$color\\\" \\\"\\$*\\\" \\\"\\$NC\\\"\n}\ncechon() { # color, message (no newline)\n  color=\"$1\"; shift\n  eval printf \\\"%b%s%b\\\" \\\"\\$$color\\\" \\\"\\$*\\\" \\\"\\$NC\\\"\n}\n\n####################################################################################\n#                                    Logging                                       #\n####################################################################################\nlog() {\n  local level=\"$1\"; shift\n  local message=\"$*\"\n  printf \"%s [%s] %s\\n\" \"$(date '+%Y-%m-%d %H:%M:%S')\" \"${level}\" \"${message}\" &gt;&gt; \"$LOG_FILE\"\n}\n\nshow_text()  { cecho WHITE \"$*\"; log TEXT \"$*\"; }\nshow_info()  { cecho GREEN \"$*\"; log INFO \"$*\"; }\nshow_warn()  { cecho YELLOW \"$*\"; log WARN \"$*\"; }\nshow_error() { cecho RED \"$*\"; log ERROR \"$*\"; }\n\n####################################################################################\n#                               Dependency Checks                                  #\n####################################################################################\nrequire_cmd() {\n  for cmd; do\n    if ! command -v \"$cmd\" &gt;/dev/null 2&gt;&amp;1; then\n      show_error \"Missing dependency: $cmd\"\n      exit 1\n    fi\n  done\n}\nrequire_cmd whoami cat date tr awk sed grep find xargs cut sort uniq head tail\nrequire_cmd cp mv rm chmod chown mktemp service wc make pfctl whois\nrequire_cmd \"$SA_UPDATE_CMD\" \"$SA_COMPILE_CMD\"\n\n####################################################################################\n#                                 Utility Functions                                #\n####################################################################################\ntolower() { [ -n \"${1:-}\" ] &amp;&amp; echo \"$*\" | tr '[:upper:]' '[:lower:]'; }\ntoupper() { [ -n \"${1:-}\" ] &amp;&amp; echo \"$*\" | tr '[:lower:]' '[:upper:]'; }\n\nread_prompt() {\n  local prompt=\"${1}\"\n  local var=\"${2:-REPLY}\"\n  local input=\"\"\n  while :; do\n    read -r -p \"$(cechon WHITE \"$prompt \")\" input\n    if [ -z \"$(printf '%s' \"$input\" | tr -d '\\040-\\176')\" ]; then\n      eval \"$var=\\\"\\$input\\\"\"\n      break\n    else\n      show_warn \"Non-printable char(s) detected! Please retry...\"\n    fi\n  done\n}\n\nread_passwd() {\n  local prompt=\"${1}\"\n  local var=\"${2:-REPLY}\"\n  local input=\"\"\n  while :; do\n    read -s -p \"$(cechon WHITE \"$prompt \")\" input\n    echo\n    if [ -z \"$(printf '%s' \"$input\" | tr -d '\\040-\\176')\" ]; then\n      eval \"$var=\\\"\\$input\\\"\"\n      break\n    else\n      show_warn \"Non-printable char(s) detected! Please retry...\"\n    fi\n  done\n}\n\nrootonly() {\n  [ \"$(id -u)\" = \"0\" ] || { show_error \"You must be root to run this script!\"; exit 1; }\n}\n\nprint_separator() {\n  printf \"================================================================================\\n\"\n}\n\ntrap 'show_error \"Script interrupted. Exiting.\"; exit 1' INT TERM\ntrap 'rm -rf \"$TMP_DIR\" \"$TMP_FILE\"' EXIT\n\n####################################################################################\n#                                 Argument Parsing                                 #\n####################################################################################\nshow_usage() {\n  cat &lt;&lt;EOF &gt;&amp;2\nUsage: $(basename \"$0\") [OPTIONS]\n\nOPTIONS:\n${USAGEOPTIONS}\n  --help            Display this help and exit\n  --version         Output version information and exit\n\n${COPYRIGHT} ${CONTACT}\n\nWritten by ${AUTHORS}\n\nReport any bugs to: ${REPORTS}\nEOF\n  exit 1\n}\n\nshow_version() {\n  cat &lt;&lt;EOF &gt;&amp;2\n$(basename \"$0\") ${VERSION}\n\n${COPYRIGHT} ${CONTACT}\n\nWritten by ${AUTHORS}\n\nMIT License\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\nEOF\n  exit 0\n}\n\nparse_args() {\n  while [ $# -gt 0 ]; do\n    case \"$1\" in\n      --*=*)\n        tmpopt=\"${1#--}\"\n        cmdopt=\"${tmpopt%%=*}\"\n        cmdval=\"${tmpopt#*=}\"\n        if echo \"$ALLOWEDOPTS\" | grep -q -w \"$cmdopt\"; then\n          eval \"$cmdopt=\\\"\\$cmdval\\\"\"\n        else\n          show_usage\n        fi\n        ;;\n      --version|-V) show_version ;;\n      --help|-h) show_usage ;;\n      *) show_usage ;;\n    esac\n    shift\n  done\n}\n\n####################################################################################\n#                                   Main Logic                                     #\n####################################################################################\nrootonly\n\nparse_args \"$@\"\n\nprint_separator\n\nshow_info \"Started updating the spamassassin filters.\"\n\nprint_separator\n\n# Update spamassassin channel updates.spamassassin.org mirrors\nshow_info \"Update spamassassin channel updates.spamassassin.org mirrors...\"\nif ! \"$SA_UPDATE_CMD\" --channel updates.spamassassin.org --refreshmirrors --verbose; then\n  show_warn \"Update spamassassin channel updates.spamassassin.org mirrors failed.\"\n#  exit 1\nfi\n\n# Update spamassassin channel updates.spamassassin.org rules\nshow_info \"Update spamassassin channel updates.spamassassin.org rules...\"\nif ! \"$SA_UPDATE_CMD\" --channel updates.spamassassin.org --verbose; then\n  show_warn \"Update spamassassin channel updates.spamassassin.org rules failed.\"\n#  exit 1\nfi\n\n# Update spamassassin channel kam.sa-channels.mcgrail.com mirrors\nshow_info \"Update spamassassin channel kam.sa-channels.mcgrail.com mirrors...\"\nif ! \"$SA_UPDATE_CMD\" --nogpg --channel kam.sa-channels.mcgrail.com --refreshmirrors --verbose; then\n  show_warn \"Update spamassassin channel kam.sa-channels.mcgrail.com mirrors failed.\"\n#  exit 1\nfi\n\n# Update spamassassin channel kam.sa-channels.mcgrail.com rules\nshow_info \"Update spamassassin channel kam.sa-channels.mcgrail.com rules...\"\nif ! \"$SA_UPDATE_CMD\" --nogpg --channel kam.sa-channels.mcgrail.com --verbose; then\n  show_warn \"Update spamassassin channel kam.sa-channels.mcgrail.com rules failed.\"\n#  exit 1\nfi\n\n# Rebuilding spamassassin rulesets\nshow_info \"Rebuilding spamassassin rulesets...\"\nif ! \"$SA_COMPILE_CMD\" --quiet; then\n  show_warn \"Failed rebuilding spamassassin rulesets.\"\n#  exit 1\nfi\n\nprint_separator\n\n# Restarting sa-spamd\nshow_info \"Restarting sa-spamd...\"\nif ! service sa-spamd restart; then\n  show_warn \"Failed restarting sa-spamd.\"\n#  exit 1\nfi\n\n# Reloading amavisd\nshow_info \"Reloading amavisd...\"\nif ! service amavisd reload; then\n  show_warn \"Failed reloading amavisd.\"\n#  exit 1\nfi\n\nprint_separator\n\nshow_info \"Finished updating the spamassassin filters.\"\n\nprint_separator\n\nexit 0\n\nEOF\nchmod 0755 /usr/local/sbin/update-spamassassin\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/mailserver/spamassassin/#abschluss","title":"Abschluss","text":"<p>SpamAssassin kann nun gestartet werden.</p> Bash<pre><code>mkdir -p /var/run/spamass-milter\nchown spamd:spamd /var/run/spamass-milter\n\nservice sa-spamd start\nservice spamass-milter start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/nameserver/unbound/","title":"Unbound","text":""},{"location":"howtos/freebsd/hosting_system/nameserver/unbound/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird folgende Dienste umfassen.</p> <ul> <li>Unbound 1.22.0 (DNScrypt, DNS over TLS)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/nameserver/unbound/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/nameserver/unbound/#installation","title":"Installation","text":"<p>Wir installieren <code>dns/unbound</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/security_libsodium\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_libsodium/options\n_OPTIONS_READ=libsodium-1.0.19\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_libevent\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_libevent/options\n_OPTIONS_READ=libevent-2.1.12\n_FILE_COMPLETE_OPTIONS_LIST=OPENSSL THREADS\nOPTIONS_FILE_SET+=OPENSSL\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\nmkdir -p /var/db/ports/dns_unbound\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_unbound/options\n_OPTIONS_READ=unbound-1.23.0\n_FILE_COMPLETE_OPTIONS_LIST=DEP-RSA1024 DNSCRYPT DNSTAP DOCS DYNLIB ECDSA EVAPI FILTER_AAAA GOST HIREDIS LIBEVENT MUNIN_PLUGIN PYTHON SUBNET TFOCL TFOSE THREADS\nOPTIONS_FILE_UNSET+=DEP-RSA1024\nOPTIONS_FILE_SET+=DNSCRYPT\nOPTIONS_FILE_SET+=DNSTAP\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=DYNLIB\nOPTIONS_FILE_SET+=ECDSA\nOPTIONS_FILE_SET+=EVAPI\nOPTIONS_FILE_SET+=FILTER_AAAA\nOPTIONS_FILE_SET+=GOST\nOPTIONS_FILE_UNSET+=HIREDIS\nOPTIONS_FILE_SET+=LIBEVENT\nOPTIONS_FILE_UNSET+=MUNIN_PLUGIN\nOPTIONS_FILE_UNSET+=PYTHON\nOPTIONS_FILE_SET+=SUBNET\nOPTIONS_FILE_SET+=TFOCL\nOPTIONS_FILE_SET+=TFOSE\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\n\nportmaster -w -B -g --force-config dns/unbound  -n\n\n\nsysrc local_unbound_enable=NO\nsysrc unbound_enable=YES\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/nameserver/unbound/#konfiguration","title":"Konfiguration","text":"<p>Wir konfigurieren Unbound:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/unbound/unbound.conf\nserver:\n  verbosity: 1\n  num-threads: 4\n  interface: 127.0.0.1\n  interface: ::1\n  port: 53\n  access-control: 0.0.0.0/0 refuse\n  access-control: 127.0.0.0/8 allow\n  access-control: ::0/0 refuse\n  access-control: ::1 allow\n  access-control: ::ffff:127.0.0.1 allow\n  access-control: 10.0.0.0/8 allow\n  access-control: 172.16.0.0/12 allow\n  access-control: 192.168.0.0/16 allow\n  access-control: 169.254.0.0/16 allow\n  access-control: fd00::/8 allow\n  access-control: fe80::/10 allow\n  access-control: ::ffff:0:0/96 allow\n  do-ip4: yes\n  do-ip6: yes\n  do-udp: yes\n  do-tcp: yes\n  logfile: \"/usr/local/etc/unbound/unbound.log\"\n  root-hints: \"/usr/local/etc/unbound/root.hints\"\n  auto-trust-anchor-file: \"/usr/local/etc/unbound/root.key\"\n  tls-cert-bundle: \"/usr/local/share/certs/ca-root-nss.crt\"\n  aggressive-nsec: yes\n  cache-max-ttl: 14400\n  cache-min-ttl: 1200\n  so-rcvbuf: 4m\n  so-sndbuf: 4m\n  msg-cache-size: 128m\n  msg-cache-slabs: 8\n  num-queries-per-thread: 4096\n  outgoing-range: 8192\n  rrset-cache-size: 256m\n  rrset-cache-slabs: 8\n  infra-cache-slabs: 8\n  key-cache-slabs: 8\n  hide-identity: yes\n  hide-version: yes\n  prefetch: yes\n  serve-expired: yes\n  serve-expired-ttl: 86400\n  serve-expired-client-timeout: 1800\n  rrset-roundrobin: yes\n  so-reuseport: yes\n  use-caps-for-id: yes\n  harden-short-bufsize: yes\n  harden-large-queries: yes\n  harden-glue: yes\n  harden-dnssec-stripped: yes\n  harden-below-nxdomain: yes\n  harden-referral-path: yes\n  harden-algo-downgrade: yes\n  qname-minimisation: yes\n  private-address: 10.0.0.0/8\n  private-address: 172.16.0.0/12\n  private-address: 192.168.0.0/16\n  private-address: 169.254.0.0/16\n  private-address: fd00::/8\n  private-address: fe80::/10\n  private-address: ::ffff:0:0/96\n  private-domain: \"example.lan\"\n  unwanted-reply-threshold: 10000\n  do-not-query-localhost: no\n  minimal-responses: yes\n  val-clean-additional: yes\n  local-zone: \"localhost.\" static\n  local-data: \"localhost. 10800 IN NS localhost.\"\n  local-data: \"localhost. 10800 IN SOA localhost. nobody.invalid. 1 3600 1200 604800 10800\"\n  local-data: \"localhost. 10800 IN A 127.0.0.1\"\n  local-zone: \"127.in-addr.arpa.\" static\n  local-data: \"127.in-addr.arpa. 10800 IN NS localhost.\"\n  local-data: \"127.in-addr.arpa. 10800 IN SOA localhost. nobody.invalid. 2 3600 1200 604800 10800\"\n  local-data: \"1.0.0.127.in-addr.arpa. 10800 IN PTR localhost.\"\n\n#forward-zone:\n#  name: \".\"\n#  forward-tls-upstream: yes\n#  forward-addr: 1.0.0.1@853#one.one.one.one\n#  forward-addr: 8.8.4.4@853#dns.google\n#  forward-addr: 149.112.112.112@853#dns.quad9.net\n#  forward-addr: 1.1.1.1@853#one.one.one.one\n#  forward-addr: 8.8.8.8@853#dns.google\n#  forward-addr: 9.9.9.9@853#dns.quad9.net\n\n#forward-zone:\n#  name: \".\"\n#  forward-addr: 1.0.0.1@53#one.one.one.one\n#  forward-addr: 8.8.4.4@53#dns.google\n#  forward-addr: 149.112.112.112@53#dns.quad9.net\n#  forward-addr: 1.1.1.1@53#one.one.one.one\n#  forward-addr: 8.8.8.8@53#dns.google\n#  forward-addr: 9.9.9.9@53#dns.quad9.net\n\nremote-control:\n  control-enable: yes\n  control-interface: 127.0.0.1\n  control-interface: ::1\n  control-port: 8953\n  server-key-file: \"/usr/local/etc/unbound/unbound_server.key\"\n  server-cert-file: \"/usr/local/etc/unbound/unbound_server.pem\"\n  control-key-file: \"/usr/local/etc/unbound/unbound_control.key\"\n  control-cert-file: \"/usr/local/etc/unbound/unbound_control.pem\"\n\nEOF\n\ncurl -o \"/usr/local/etc/unbound/root.hints\" -L \"https://www.internic.net/domain/named.root\"\nchown unbound /usr/local/etc/unbound/root.hints\n\nsudo -u unbound unbound-anchor -a \"/usr/local/etc/unbound/root.key\"\n\nsudo -u unbound unbound-control-setup\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/nameserver/unbound/#abschluss","title":"Abschluss","text":"<p>Unbound kann nun gestartet werden.</p> Bash<pre><code>service local_unbound onestop\n\nservice unbound start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/security/certbot/","title":"CertBot","text":""},{"location":"howtos/freebsd/hosting_system/security/certbot/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird folgende Dienste umfassen.</p> <ul> <li>CertBot 4.0.0 (LetsEncrypt ACME API 2.0)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/security/certbot/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/security/certbot/#installation","title":"Installation","text":"<p>Wir installieren <code>security/py-certbot</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/textproc_py-snowballstemmer\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_py-snowballstemmer/options\n_OPTIONS_READ=py311-snowballstemmer-3.0.1\n_FILE_COMPLETE_OPTIONS_LIST=PYSTEMMER\nOPTIONS_FILE_SET+=PYSTEMMER\n\nEOF\n\nmkdir -p /var/db/ports/security_py-certbot\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_py-certbot/options\n_OPTIONS_READ=py311-certbot-4.0.0\n_FILE_COMPLETE_OPTIONS_LIST=MANPAGES\nOPTIONS_FILE_SET+=MANPAGES\n\nEOF\n\n\nportmaster -w -B -g --force-config security/py-certbot  -n\n\n\ncat &lt;&lt;'EOF' &gt;&gt; /etc/periodic.conf\nweekly_certbot_enable=\"YES\"\nEOF\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/security/certbot/#konfiguration","title":"Konfiguration","text":"<p>Wir konfigurieren CertBot f\u00fcr den Bezug unserer Zertifikate und wir beziehen auch gleich die f\u00fcr dieses HowTo ben\u00f6tigten Zertifikate:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt;&gt; /etc/periodic.conf\nweekly_certbot_enable=\"YES\"\nweekly_certbot_service=\"apache24\"\nweekly_certbot_pre_hook=\"/usr/local/etc/letsencrypt/renewal-hooks/pre/hook.sh\"\nweekly_certbot_post_hook=\"/usr/local/etc/letsencrypt/renewal-hooks/post/hook.sh\"\n#weekly_certbot_deploy_hook=\"/usr/local/etc/letsencrypt/renewal-hooks/deploy/hook.sh\"\nEOF\n\nmkdir -p /usr/local/etc/letsencrypt\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/letsencrypt/cli.ini\nnon-interactive = true\nkey-type = ecdsa\nelliptic-curve = secp384r1\nrsa-key-size = 3072\nemail = admin@example.com\nauthenticator = standalone\n#pre-hook = /usr/local/etc/letsencrypt/renewal-hooks/pre/hook.sh\n#post-hook = /usr/local/etc/letsencrypt/renewal-hooks/post/hook.sh\nserver = https://acme-v02.api.letsencrypt.org/directory\ntext = true\nagree-tos = true\npreferred-challenges = http\n\nEOF\n\ncertbot register --standalone --agree-tos --no-eff-email -m admin@example.com\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/letsencrypt/renewal-hooks/pre/hook.sh\nservice apache24 onestop &gt;/dev/null 2&gt;&amp;1\n\nEOF\nchmod 0755 /usr/local/etc/letsencrypt/renewal-hooks/pre/hook.sh\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/letsencrypt/renewal-hooks/post/hook.sh\nservice apache24 onestart &gt;/dev/null 2&gt;&amp;1\nservice nginx onerestart &gt;/dev/null 2&gt;&amp;1\nservice dovecot onereload &gt;/dev/null 2&gt;&amp;1\nservice postfix onereload &gt;/dev/null 2&gt;&amp;1\n\nEOF\nchmod 0755 /usr/local/etc/letsencrypt/renewal-hooks/post/hook.sh\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/letsencrypt/renewal-hooks/deploy/hook.sh\nEOF\nchmod 0755 /usr/local/etc/letsencrypt/renewal-hooks/deploy/hook.sh\n\ncertbot certonly --standalone -d devnull.example.com\ncertbot certonly --standalone -d mail.example.com\ncertbot certonly --standalone -d www.example.com -d example.com\n\nsed -e 's|^#*\\(pre-hook.*\\)$|\\1|' \\\n    -e 's|^#*\\(post-hook.*\\)$|\\1|' \\\n    -i '' /usr/local/etc/letsencrypt/cli.ini\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/security/certbot/#abschluss","title":"Abschluss","text":"<p>Weitere Zertifikate f\u00fcr einzelne Domains k\u00f6nnen, sobald der Webserver Apache installiert und gestartet ist, dann k\u00fcnftig so erstellt werden:</p> Bash<pre><code>certbot certonly --standalone -d subdomain.example.com\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/security/openssh/","title":"OpenSSH","text":""},{"location":"howtos/freebsd/hosting_system/security/openssh/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird folgende Dienste umfassen.</p> <ul> <li>OpenSSH 10.0p1 (Public-Key-Auth)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/security/openssh/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/security/openssh/#installation","title":"Installation","text":"<p>Wir installieren <code>security/openssh-portable</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/dns_ldns\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_ldns/options\n_OPTIONS_READ=ldns-1.8.4\n_FILE_COMPLETE_OPTIONS_LIST=DANETAUSAGE DOXYGEN DRILL EXAMPLES GOST RRTYPEAMTRELAY RRTYPEAVC RRTYPENINFO RRTYPERKEY RRTYPETA\nOPTIONS_FILE_SET+=DANETAUSAGE\nOPTIONS_FILE_UNSET+=DOXYGEN\nOPTIONS_FILE_SET+=DRILL\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=GOST\nOPTIONS_FILE_SET+=RRTYPEAMTRELAY\nOPTIONS_FILE_SET+=RRTYPEAVC\nOPTIONS_FILE_UNSET+=RRTYPENINFO\nOPTIONS_FILE_SET+=RRTYPERKEY\nOPTIONS_FILE_SET+=RRTYPETA\n\nEOF\n\nmkdir -p /var/db/ports/security_libfido2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_libfido2/options\n_OPTIONS_READ=libfido2-1.16.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/security_openssh-portable\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_openssh-portable/options\n_OPTIONS_READ=openssh-portable-10.0.p1\n_FILE_COMPLETE_OPTIONS_LIST=BLACKLISTD BSM DOCS FIDO_U2F HPN KERB_GSSAPI LDNS LIBEDIT NONECIPHER PAM TCP_WRAPPERS XMSS MIT HEIMDAL HEIMDAL_BASE\nOPTIONS_FILE_UNSET+=BLACKLISTD\nOPTIONS_FILE_UNSET+=BSM\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=FIDO_U2F\nOPTIONS_FILE_UNSET+=HPN\nOPTIONS_FILE_UNSET+=KERB_GSSAPI\nOPTIONS_FILE_SET+=LDNS\nOPTIONS_FILE_SET+=LIBEDIT\nOPTIONS_FILE_UNSET+=NONECIPHER\nOPTIONS_FILE_UNSET+=PAM\nOPTIONS_FILE_SET+=TCP_WRAPPERS\nOPTIONS_FILE_SET+=XMSS\nOPTIONS_FILE_UNSET+=MIT\nOPTIONS_FILE_UNSET+=HEIMDAL\nOPTIONS_FILE_UNSET+=HEIMDAL_BASE\n\nEOF\n\n\nportmaster -w -B -g --force-config security/openssh-portable@default  -n\n\n\nsysrc openssh_dsa_enable=NO\nsysrc openssh_pidfile=\"/var/run/opensshd.pid\"\nsysrc openssh_enable=YES\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/security/openssh/#konfiguration","title":"Konfiguration","text":"<p>Wir konfigurieren OpenSSH:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/ssh/sshd_config\n#\t$OpenBSD: sshd_config,v 1.105 2024/12/03 14:12:47 dtucker Exp $\n\n# This is the sshd server system-wide configuration file.  See\n# sshd_config(5) for more information.\n\n# This sshd was compiled with PATH=\n\n# The strategy used for options in the default sshd_config shipped with\n# OpenSSH is to specify options with their default value where\n# possible, but leave them commented.  Uncommented options override the\n# default value.\n\n# Note that some of FreeBSD's defaults differ from OpenBSD's, and\n# FreeBSD has a few additional options.\n\nInclude sshd_config.d/*.conf\n\nPort 22\n#AddressFamily any\n#ListenAddress 0.0.0.0\n#ListenAddress ::\n\n#HostKey /usr/local/etc/ssh/ssh_host_rsa_key\n#HostKey /usr/local/etc/ssh/ssh_host_ecdsa_key\n#HostKey /usr/local/etc/ssh/ssh_host_ed25519_key\n\n# Ciphers and keying\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com\nMacs hmac-sha2-512,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-256-etm@openssh.com\nKexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256\n\n#RekeyLimit default none\n\n# Logging\n#SyslogFacility AUTH\n#LogLevel INFO\n\n# Authentication:\n\n#LoginGraceTime 2m\nPermitRootLogin prohibit-password\n#StrictModes yes\n#MaxAuthTries 6\n#MaxSessions 10\n\nPubkeyAuthentication yes\n\n# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2\n#AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2\n\n#AuthorizedPrincipalsFile none\n\n#AuthorizedKeysCommand none\n#AuthorizedKeysCommandUser nobody\n\n# For this to work you will also need host keys in /usr/local/etc/ssh/ssh_known_hosts\n#HostbasedAuthentication no\n# Change to yes if you don't trust ~/.ssh/known_hosts for\n# HostbasedAuthentication\n#IgnoreUserKnownHosts no\n# Don't read the user's ~/.rhosts and ~/.shosts files\n#IgnoreRhosts yes\n\n# To enable tunneled clear text passwords, change to yes here!\nPasswordAuthentication no\nPermitEmptyPasswords no\n\n# Change to \"no\" to disable keyboard-interactive authentication.  Depending on\n# the system's configuration, this may involve passwords, challenge-response,\n# one-time passwords or some combination of these and other methods.\nKbdInteractiveAuthentication no\n\n# Kerberos options\n#KerberosAuthentication no\n#KerberosOrLocalPasswd yes\n#KerberosTicketCleanup yes\n#KerberosGetAFSToken no\n\n# GSSAPI options\n#GSSAPIAuthentication no\n#GSSAPICleanupCredentials yes\n\n# Set this to 'no' to disable PAM authentication, account processing,\n# and session processing. If this is enabled, PAM authentication will\n# be allowed through the KbdInteractiveAuthentication and\n# PasswordAuthentication.  Depending on your PAM configuration,\n# PAM authentication via KbdInteractiveAuthentication may bypass\n# the setting of \"PermitRootLogin prohibit-password\".\n# If you just want the PAM account and session checks to run without\n# PAM authentication, then enable this but set PasswordAuthentication\n# and KbdInteractiveAuthentication to 'no'.\nUsePAM no\n\nAllowAgentForwarding no\nAllowTcpForwarding no\nGatewayPorts no\nX11Forwarding no\n#X11DisplayOffset 10\n#X11UseLocalhost yes\n#PermitTTY yes\n#PrintMotd yes\n#PrintLastLog yes\n#TCPKeepAlive yes\nPermitUserEnvironment no\n#Compression delayed\nClientAliveInterval 10\nClientAliveCountMax 6\n#UseDNS no\nPidFile /var/run/opensshd.pid\nMaxStartups 10:30:100\nPermitTunnel no\nChrootDirectory %h\nVersionAddendum none\n\n# no default banner path\n#Banner none\n\n# override default of no subsystems\n#Subsystem\tsftp\t/usr/local/libexec/sftp-server\n\n# Example of overriding settings on a per-user basis\n#Match User anoncvs\n#\tX11Forwarding no\n#\tAllowTcpForwarding no\n#\tPermitTTY no\n#\tForceCommand cvs server\n\nSubsystem sftp internal-sftp -u 0027\n\nAllowGroups wheel admin sshusers sftponly\n\nMatch User root\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group admin\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group sshusers\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group sftponly\n    ChrootDirectory /home\n    PasswordAuthentication yes\n    ForceCommand internal-sftp -d %u\n\nEOF\n\nrm -f /usr/local/etc/ssh/ssh_host_*_key*\nssh-keygen -q -t rsa -b 4096 -f \"/usr/local/etc/ssh/ssh_host_rsa_key\" -N \"\"\nssh-keygen -l -f \"/usr/local/etc/ssh/ssh_host_rsa_key.pub\"\nssh-keygen -q -t ecdsa -b 384 -f \"/usr/local/etc/ssh/ssh_host_ecdsa_key\" -N \"\"\nssh-keygen -l -f \"/usr/local/etc/ssh/ssh_host_ecdsa_key.pub\"\nssh-keygen -q -t ed25519 -f \"/usr/local/etc/ssh/ssh_host_ed25519_key\" -N \"\"\nssh-keygen -l -f \"/usr/local/etc/ssh/ssh_host_ed25519_key.pub\"\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/security/openssh/#abschluss","title":"Abschluss","text":"<p>OpenSSH kann nun gestartet werden.</p> Bash<pre><code>service openssh start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/apache/","title":"Apache","text":""},{"location":"howtos/freebsd/hosting_system/webserver/apache/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>Apache 2.4.63 (MPM-Event, HTTP/2, mod_brotli)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/webserver/apache/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/webserver/apache/#installation","title":"Installation","text":"<p>Wir installieren <code>www/apache24</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/www_apache24\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_apache24/options\n_OPTIONS_READ=apache24-2.4.63\n_FILE_COMPLETE_OPTIONS_LIST=ACCESS_COMPAT ACTIONS ALIAS ALLOWMETHODS ASIS AUTHNZ_FCGI AUTHNZ_LDAP AUTHN_ANON AUTHN_CORE AUTHN_DBD AUTHN_DBM AUTHN_FILE AUTHN_SOCACHE AUTHZ_CORE AUTHZ_DBD AUTHZ_DBM AUTHZ_GROUPFILE AUTHZ_HOST AUTHZ_OWNER AUTHZ_USER AUTH_BASIC AUTH_DIGEST AUTH_FORM AUTOINDEX BROTLI BUFFER CACHE CACHE_DISK CACHE_SOCACHE CERN_META CGI CGID CHARSET_LITE DATA DAV DAV_FS DAV_LOCK DBD DEFLATE DIALUP DIR DOCS DUMPIO ENV EXPIRES EXT_FILTER FILE_CACHE FILTER HEADERS HEARTBEAT HEARTMONITOR HTTP2 IDENT IMAGEMAP INCLUDE INFO IPV4_MAPPED LBMETHOD_BYBUSYNESS LBMETHOD_BYREQUESTS LBMETHOD_BYTRAFFIC LBMETHOD_HEARTBEAT LDAP LOGIO LOG_DEBUG LOG_FORENSIC LUA LUAJIT MACRO MD MIME MIME_MAGIC NEGOTIATION PROXY RATELIMIT REFLECTOR REMOTEIP REQTIMEOUT REQUEST REWRITE SED SESSION SETENVIF SLOTMEM_PLAIN SLOTMEM_SHM SOCACHE_DBM SOCACHE_DC SOCACHE_MEMCACHE SOCACHE_REDIS SOCACHE_SHMCB SPELING SSL STATUS SUBSTITUTE SUEXEC SUEXEC_SYSLOG TLS UNIQUE_ID USERDIR USERTRACK VERSION VHOST_ALIAS WATCHDOG XML2ENC MPM_PREFORK MPM_WORKER MPM_EVENT MPM_SHARED PROXY_AJP PROXY_BALANCER PROXY_CONNECT PROXY_EXPRESS PROXY_FCGI  PROXY_HTTP2 PROXY_FDPASS PROXY_FTP PROXY_HCHECK PROXY_HTML PROXY_HTTP  PROXY_SCGI PROXY_UWSGI PROXY_WSTUNNEL  SESSION_COOKIE SESSION_CRYPTO SESSION_DBD  BUCKETEER CASE_FILTER CASE_FILTER_IN ECHO EXAMPLE_HOOKS EXAMPLE_IPC  OPTIONAL_FN_EXPORT OPTIONAL_FN_IMPORT OPTIONAL_HOOK_EXPORT  OPTIONAL_HOOK_IMPORT\nOPTIONS_FILE_SET+=ACCESS_COMPAT\nOPTIONS_FILE_SET+=ACTIONS\nOPTIONS_FILE_SET+=ALIAS\nOPTIONS_FILE_SET+=ALLOWMETHODS\nOPTIONS_FILE_SET+=ASIS\nOPTIONS_FILE_SET+=AUTHNZ_FCGI\nOPTIONS_FILE_UNSET+=AUTHNZ_LDAP\nOPTIONS_FILE_SET+=AUTHN_ANON\nOPTIONS_FILE_SET+=AUTHN_CORE\nOPTIONS_FILE_SET+=AUTHN_DBD\nOPTIONS_FILE_SET+=AUTHN_DBM\nOPTIONS_FILE_SET+=AUTHN_FILE\nOPTIONS_FILE_SET+=AUTHN_SOCACHE\nOPTIONS_FILE_SET+=AUTHZ_CORE\nOPTIONS_FILE_SET+=AUTHZ_DBD\nOPTIONS_FILE_SET+=AUTHZ_DBM\nOPTIONS_FILE_SET+=AUTHZ_GROUPFILE\nOPTIONS_FILE_SET+=AUTHZ_HOST\nOPTIONS_FILE_SET+=AUTHZ_OWNER\nOPTIONS_FILE_SET+=AUTHZ_USER\nOPTIONS_FILE_SET+=AUTH_BASIC\nOPTIONS_FILE_SET+=AUTH_DIGEST\nOPTIONS_FILE_SET+=AUTH_FORM\nOPTIONS_FILE_SET+=AUTOINDEX\nOPTIONS_FILE_SET+=BROTLI\nOPTIONS_FILE_SET+=BUFFER\nOPTIONS_FILE_SET+=CACHE\nOPTIONS_FILE_SET+=CACHE_DISK\nOPTIONS_FILE_SET+=CACHE_SOCACHE\nOPTIONS_FILE_SET+=CERN_META\nOPTIONS_FILE_SET+=CGI\nOPTIONS_FILE_SET+=CGID\nOPTIONS_FILE_SET+=CHARSET_LITE\nOPTIONS_FILE_SET+=DATA\nOPTIONS_FILE_SET+=DAV\nOPTIONS_FILE_SET+=DAV_FS\nOPTIONS_FILE_SET+=DAV_LOCK\nOPTIONS_FILE_SET+=DBD\nOPTIONS_FILE_SET+=DEFLATE\nOPTIONS_FILE_SET+=DIALUP\nOPTIONS_FILE_SET+=DIR\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=DUMPIO\nOPTIONS_FILE_SET+=ENV\nOPTIONS_FILE_SET+=EXPIRES\nOPTIONS_FILE_SET+=EXT_FILTER\nOPTIONS_FILE_SET+=FILE_CACHE\nOPTIONS_FILE_SET+=FILTER\nOPTIONS_FILE_SET+=HEADERS\nOPTIONS_FILE_SET+=HEARTBEAT\nOPTIONS_FILE_SET+=HEARTMONITOR\nOPTIONS_FILE_SET+=HTTP2\nOPTIONS_FILE_UNSET+=IDENT\nOPTIONS_FILE_SET+=IMAGEMAP\nOPTIONS_FILE_SET+=INCLUDE\nOPTIONS_FILE_SET+=INFO\nOPTIONS_FILE_UNSET+=IPV4_MAPPED\nOPTIONS_FILE_SET+=LBMETHOD_BYBUSYNESS\nOPTIONS_FILE_SET+=LBMETHOD_BYREQUESTS\nOPTIONS_FILE_SET+=LBMETHOD_BYTRAFFIC\nOPTIONS_FILE_SET+=LBMETHOD_HEARTBEAT\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=LOGIO\nOPTIONS_FILE_SET+=LOG_DEBUG\nOPTIONS_FILE_SET+=LOG_FORENSIC\nOPTIONS_FILE_SET+=LUA\nOPTIONS_FILE_UNSET+=LUAJIT\nOPTIONS_FILE_SET+=MACRO\nOPTIONS_FILE_UNSET+=MD\nOPTIONS_FILE_SET+=MIME\nOPTIONS_FILE_SET+=MIME_MAGIC\nOPTIONS_FILE_SET+=NEGOTIATION\nOPTIONS_FILE_SET+=PROXY\nOPTIONS_FILE_SET+=RATELIMIT\nOPTIONS_FILE_SET+=REFLECTOR\nOPTIONS_FILE_SET+=REMOTEIP\nOPTIONS_FILE_SET+=REQTIMEOUT\nOPTIONS_FILE_SET+=REQUEST\nOPTIONS_FILE_SET+=REWRITE\nOPTIONS_FILE_SET+=SED\nOPTIONS_FILE_SET+=SESSION\nOPTIONS_FILE_SET+=SETENVIF\nOPTIONS_FILE_SET+=SLOTMEM_PLAIN\nOPTIONS_FILE_SET+=SLOTMEM_SHM\nOPTIONS_FILE_SET+=SOCACHE_DBM\nOPTIONS_FILE_UNSET+=SOCACHE_DC\nOPTIONS_FILE_SET+=SOCACHE_MEMCACHE\nOPTIONS_FILE_UNSET+=SOCACHE_REDIS\nOPTIONS_FILE_SET+=SOCACHE_SHMCB\nOPTIONS_FILE_SET+=SPELING\nOPTIONS_FILE_SET+=SSL\nOPTIONS_FILE_SET+=STATUS\nOPTIONS_FILE_SET+=SUBSTITUTE\nOPTIONS_FILE_UNSET+=SUEXEC\nOPTIONS_FILE_UNSET+=SUEXEC_SYSLOG\nOPTIONS_FILE_UNSET+=TLS\nOPTIONS_FILE_SET+=UNIQUE_ID\nOPTIONS_FILE_SET+=USERDIR\nOPTIONS_FILE_SET+=USERTRACK\nOPTIONS_FILE_SET+=VERSION\nOPTIONS_FILE_SET+=VHOST_ALIAS\nOPTIONS_FILE_SET+=WATCHDOG\nOPTIONS_FILE_SET+=XML2ENC\nOPTIONS_FILE_UNSET+=MPM_PREFORK\nOPTIONS_FILE_UNSET+=MPM_WORKER\nOPTIONS_FILE_SET+=MPM_EVENT\nOPTIONS_FILE_SET+=MPM_SHARED\nOPTIONS_FILE_SET+=PROXY_AJP\nOPTIONS_FILE_SET+=PROXY_BALANCER\nOPTIONS_FILE_SET+=PROXY_CONNECT\nOPTIONS_FILE_SET+=PROXY_EXPRESS\nOPTIONS_FILE_SET+=PROXY_FCGI\nOPTIONS_FILE_SET+=PROXY_HTTP2\nOPTIONS_FILE_SET+=PROXY_FDPASS\nOPTIONS_FILE_SET+=PROXY_FTP\nOPTIONS_FILE_SET+=PROXY_HCHECK\nOPTIONS_FILE_SET+=PROXY_HTML\nOPTIONS_FILE_SET+=PROXY_HTTP\nOPTIONS_FILE_SET+=PROXY_SCGI\nOPTIONS_FILE_SET+=PROXY_UWSGI\nOPTIONS_FILE_SET+=PROXY_WSTUNNEL\nOPTIONS_FILE_SET+=SESSION_COOKIE\nOPTIONS_FILE_SET+=SESSION_CRYPTO\nOPTIONS_FILE_SET+=SESSION_DBD\nOPTIONS_FILE_UNSET+=BUCKETEER\nOPTIONS_FILE_UNSET+=CASE_FILTER\nOPTIONS_FILE_UNSET+=CASE_FILTER_IN\nOPTIONS_FILE_UNSET+=ECHO\nOPTIONS_FILE_UNSET+=EXAMPLE_HOOKS\nOPTIONS_FILE_UNSET+=EXAMPLE_IPC\nOPTIONS_FILE_UNSET+=OPTIONAL_FN_EXPORT\nOPTIONS_FILE_UNSET+=OPTIONAL_FN_IMPORT\nOPTIONS_FILE_UNSET+=OPTIONAL_HOOK_EXPORT\nOPTIONS_FILE_UNSET+=OPTIONAL_HOOK_IMPORT\n\nEOF\n\n\nportmaster -w -B -g --force-config www/apache24  -n\n\n\nmkdir -p /usr/local/etc/newsyslog.conf.d\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/newsyslog.conf.d/apache24\n/var/log/httpd-*.log                    644  13    *    $W6D0 JCG   /var/run/httpd.pid\n/data/www/vhosts/*/logs/apache_*_log    644  24    *    $M1D0 JCG   /var/run/httpd.pid\n\n\nEOF\n\ncp -a /usr/local/www /data/\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/apache/#konfiguration","title":"Konfiguration","text":"<p>Verzeichnisse f\u00fcr die ersten VirtualHosts erstellen.</p> Bash<pre><code>mkdir -p /data/www/cache\nchmod 1777 /data/www/cache\nchown www:www /data/www/cache\nmkdir -p /data/www/tmp\nchmod 1777 /data/www/tmp\nchown www:www /data/www/tmp\n\n\nmkdir -p /data/www/vhosts/_default_/conf\nmkdir -p /data/www/vhosts/_default_/cron\nmkdir -p /data/www/vhosts/_default_/logs\nmkdir -p /data/www/vhosts/_default_/data/.well-known\nchmod 0750 /data/www/vhosts/_default_/data\nchown www:www /data/www/vhosts/_default_/data\n\nmkdir -p /data/www/vhosts/_localhost_/conf\nmkdir -p /data/www/vhosts/_localhost_/cron\nmkdir -p /data/www/vhosts/_localhost_/logs\nmkdir -p /data/www/vhosts/_localhost_/data/.well-known\nchmod 0750 /data/www/vhosts/_localhost_/data\nchown www:www /data/www/vhosts/_localhost_/data\n\nmkdir -p /data/www/vhosts/mail.example.com/conf\nmkdir -p /data/www/vhosts/mail.example.com/cron\nmkdir -p /data/www/vhosts/mail.example.com/logs\nmkdir -p /data/www/vhosts/mail.example.com/data/.well-known\nchmod 0750 /data/www/vhosts/mail.example.com/data\nchown www:www /data/www/vhosts/mail.example.com/data\n\nmkdir -p /data/www/vhosts/www.example.com/conf\nmkdir -p /data/www/vhosts/www.example.com/cron\nmkdir -p /data/www/vhosts/www.example.com/logs\nmkdir -p /data/www/vhosts/www.example.com/data/.well-known\nchmod 0750 /data/www/vhosts/www.example.com/data\nchown www:www /data/www/vhosts/www.example.com/data\n</code></pre> <p>Die folgende Konfiguration verwendet f\u00fcr den localhost den Pfad <code>/data/www/vhosts/_localhost_</code>, f\u00fcr den Default-Host den Pfad <code>/data/www/vhosts/_default_</code> und f\u00fcr die regul\u00e4ren Virtual-Hosts den Pfad <code>/data/www/vhosts/sub.domain.tld</code>.</p> <p><code>httpd.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/apache24/httpd.conf\nServerRoot \"/usr/local\"\nPidFile \"/var/run/httpd.pid\"\nLoadModule mpm_event_module libexec/apache24/mod_mpm_event.so\n#LoadModule mpm_prefork_module libexec/apache24/mod_mpm_prefork.so\n#LoadModule mpm_worker_module libexec/apache24/mod_mpm_worker.so\nLoadModule authn_file_module libexec/apache24/mod_authn_file.so\n#LoadModule authn_dbm_module libexec/apache24/mod_authn_dbm.so\n#LoadModule authn_anon_module libexec/apache24/mod_authn_anon.so\n#LoadModule authn_dbd_module libexec/apache24/mod_authn_dbd.so\n#LoadModule authn_socache_module libexec/apache24/mod_authn_socache.so\nLoadModule authn_core_module libexec/apache24/mod_authn_core.so\nLoadModule authz_host_module libexec/apache24/mod_authz_host.so\nLoadModule authz_groupfile_module libexec/apache24/mod_authz_groupfile.so\nLoadModule authz_user_module libexec/apache24/mod_authz_user.so\n#LoadModule authz_dbm_module libexec/apache24/mod_authz_dbm.so\n#LoadModule authz_owner_module libexec/apache24/mod_authz_owner.so\n#LoadModule authz_dbd_module libexec/apache24/mod_authz_dbd.so\nLoadModule authz_core_module libexec/apache24/mod_authz_core.so\n#LoadModule authnz_fcgi_module libexec/apache24/mod_authnz_fcgi.so\n#LoadModule access_compat_module libexec/apache24/mod_access_compat.so\nLoadModule auth_basic_module libexec/apache24/mod_auth_basic.so\n#LoadModule auth_form_module libexec/apache24/mod_auth_form.so\nLoadModule auth_digest_module libexec/apache24/mod_auth_digest.so\nLoadModule allowmethods_module libexec/apache24/mod_allowmethods.so\n#LoadModule file_cache_module libexec/apache24/mod_file_cache.so\nLoadModule cache_module libexec/apache24/mod_cache.so\nLoadModule cache_disk_module libexec/apache24/mod_cache_disk.so\nLoadModule cache_socache_module libexec/apache24/mod_cache_socache.so\nLoadModule socache_shmcb_module libexec/apache24/mod_socache_shmcb.so\nLoadModule socache_dbm_module libexec/apache24/mod_socache_dbm.so\n#LoadModule socache_memcache_module libexec/apache24/mod_socache_memcache.so\n#LoadModule watchdog_module libexec/apache24/mod_watchdog.so\n#LoadModule macro_module libexec/apache24/mod_macro.so\n#LoadModule dbd_module libexec/apache24/mod_dbd.so\n#LoadModule dumpio_module libexec/apache24/mod_dumpio.so\nLoadModule buffer_module libexec/apache24/mod_buffer.so\n#LoadModule data_module libexec/apache24/mod_data.so\n#LoadModule ratelimit_module libexec/apache24/mod_ratelimit.so\nLoadModule reqtimeout_module libexec/apache24/mod_reqtimeout.so\n#LoadModule ext_filter_module libexec/apache24/mod_ext_filter.so\n#LoadModule request_module libexec/apache24/mod_request.so\n#LoadModule include_module libexec/apache24/mod_include.so\nLoadModule filter_module libexec/apache24/mod_filter.so\n#LoadModule reflector_module libexec/apache24/mod_reflector.so\nLoadModule substitute_module libexec/apache24/mod_substitute.so\n#LoadModule sed_module libexec/apache24/mod_sed.so\n#LoadModule charset_lite_module libexec/apache24/mod_charset_lite.so\nLoadModule deflate_module libexec/apache24/mod_deflate.so\nLoadModule xml2enc_module libexec/apache24/mod_xml2enc.so\nLoadModule proxy_html_module libexec/apache24/mod_proxy_html.so\nLoadModule brotli_module libexec/apache24/mod_brotli.so\nLoadModule mime_module libexec/apache24/mod_mime.so\nLoadModule log_config_module libexec/apache24/mod_log_config.so\n#LoadModule log_debug_module libexec/apache24/mod_log_debug.so\n#LoadModule log_forensic_module libexec/apache24/mod_log_forensic.so\n#LoadModule logio_module libexec/apache24/mod_logio.so\n#LoadModule lua_module libexec/apache24/mod_lua.so\nLoadModule env_module libexec/apache24/mod_env.so\n#LoadModule mime_magic_module libexec/apache24/mod_mime_magic.so\n#LoadModule cern_meta_module libexec/apache24/mod_cern_meta.so\nLoadModule expires_module libexec/apache24/mod_expires.so\nLoadModule headers_module libexec/apache24/mod_headers.so\n#LoadModule usertrack_module libexec/apache24/mod_usertrack.so\nLoadModule unique_id_module libexec/apache24/mod_unique_id.so\nLoadModule setenvif_module libexec/apache24/mod_setenvif.so\nLoadModule version_module libexec/apache24/mod_version.so\n#LoadModule remoteip_module libexec/apache24/mod_remoteip.so\nLoadModule proxy_module libexec/apache24/mod_proxy.so\n#LoadModule proxy_connect_module libexec/apache24/mod_proxy_connect.so\n#LoadModule proxy_ftp_module libexec/apache24/mod_proxy_ftp.so\nLoadModule proxy_http_module libexec/apache24/mod_proxy_http.so\nLoadModule proxy_fcgi_module libexec/apache24/mod_proxy_fcgi.so\n#LoadModule proxy_scgi_module libexec/apache24/mod_proxy_scgi.so\n#LoadModule proxy_uwsgi_module libexec/apache24/mod_proxy_uwsgi.so\n#LoadModule proxy_fdpass_module libexec/apache24/mod_proxy_fdpass.so\n#LoadModule proxy_wstunnel_module libexec/apache24/mod_proxy_wstunnel.so\n#LoadModule proxy_ajp_module libexec/apache24/mod_proxy_ajp.so\n#LoadModule proxy_balancer_module libexec/apache24/mod_proxy_balancer.so\n#LoadModule proxy_express_module libexec/apache24/mod_proxy_express.so\n#LoadModule proxy_hcheck_module libexec/apache24/mod_proxy_hcheck.so\n#LoadModule session_module libexec/apache24/mod_session.so\n#LoadModule session_cookie_module libexec/apache24/mod_session_cookie.so\n#LoadModule session_crypto_module libexec/apache24/mod_session_crypto.so\n#LoadModule session_dbd_module libexec/apache24/mod_session_dbd.so\n#LoadModule slotmem_shm_module libexec/apache24/mod_slotmem_shm.so\n#LoadModule slotmem_plain_module libexec/apache24/mod_slotmem_plain.so\nLoadModule ssl_module libexec/apache24/mod_ssl.so\n#LoadModule dialup_module libexec/apache24/mod_dialup.so\nLoadModule http2_module libexec/apache24/mod_http2.so\nLoadModule proxy_http2_module libexec/apache24/mod_proxy_http2.so\n#LoadModule lbmethod_byrequests_module libexec/apache24/mod_lbmethod_byrequests.so\n#LoadModule lbmethod_bytraffic_module libexec/apache24/mod_lbmethod_bytraffic.so\n#LoadModule lbmethod_bybusyness_module libexec/apache24/mod_lbmethod_bybusyness.so\n#LoadModule lbmethod_heartbeat_module libexec/apache24/mod_lbmethod_heartbeat.so\nLoadModule unixd_module libexec/apache24/mod_unixd.so\n#LoadModule heartbeat_module libexec/apache24/mod_heartbeat.so\n#LoadModule heartmonitor_module libexec/apache24/mod_heartmonitor.so\n#LoadModule dav_module libexec/apache24/mod_dav.so\nLoadModule status_module libexec/apache24/mod_status.so\n#LoadModule autoindex_module libexec/apache24/mod_autoindex.so\n#LoadModule asis_module libexec/apache24/mod_asis.so\nLoadModule info_module libexec/apache24/mod_info.so\n&lt;IfModule !mpm_prefork_module&gt;\n    LoadModule cgid_module libexec/apache24/mod_cgid.so\n&lt;/IfModule&gt;\n&lt;IfModule mpm_prefork_module&gt;\n    LoadModule cgi_module libexec/apache24/mod_cgi.so\n&lt;/IfModule&gt;\n#LoadModule dav_fs_module libexec/apache24/mod_dav_fs.so\n#LoadModule dav_lock_module libexec/apache24/mod_dav_lock.so\n#LoadModule vhost_alias_module libexec/apache24/mod_vhost_alias.so\nLoadModule negotiation_module libexec/apache24/mod_negotiation.so\nLoadModule dir_module libexec/apache24/mod_dir.so\n#LoadModule imagemap_module libexec/apache24/mod_imagemap.so\n#LoadModule actions_module libexec/apache24/mod_actions.so\n#LoadModule speling_module libexec/apache24/mod_speling.so\n#LoadModule userdir_module libexec/apache24/mod_userdir.so\nLoadModule alias_module libexec/apache24/mod_alias.so\nLoadModule rewrite_module libexec/apache24/mod_rewrite.so\nIncludeOptional \"etc/apache24/modules.d/[0-9][0-9][0-9]_*.conf\"\n&lt;IfModule mpm_prefork_module&gt;\n    StartServers             16\n    MinSpareServers          32\n    MaxSpareServers          64\n    MaxRequestWorkers       256\n    MaxConnectionsPerChild 5000\n&lt;/IfModule&gt;\n&lt;IfModule mpm_worker_module&gt;\n    StartServers             16\n    ServerLimit              64\n    ThreadsPerChild          64\n    ThreadLimit             128\n    MinSpareThreads         128\n    MaxSpareThreads         256\n    MaxRequestWorkers      1024\n    MaxConnectionsPerChild 5000\n&lt;/IfModule&gt;\n&lt;IfModule mpm_event_module&gt;\n    StartServers             16\n    ServerLimit              64\n    ThreadsPerChild          64\n    ThreadLimit             128\n    MinSpareThreads         128\n    MaxSpareThreads         256\n    MaxRequestWorkers      1024\n    MaxConnectionsPerChild 5000\n&lt;/IfModule&gt;\n&lt;IfModule unixd_module&gt;\n    User www\n    Group www\n&lt;/IfModule&gt;\nTraceEnable off\nHttpProtocolOptions Strict LenientMethods Require1.0\n&lt;IfModule http2_module&gt;\n    Protocols h2 http/1.1\n    ProtocolsHonorOrder On\n    H2Padding 2\n    H2EarlyHints On\n    H2PushPriority * After 16\n#    H2PushPriority image/vnd.microsoft.icon Before\n#    H2PushPriority application/manifest+json Before\n    H2PushPriority text/javascript Interleaved\n    H2PushPriority text/css Interleaved\n&lt;/IfModule&gt;\n&lt;IfModule log_config_module&gt;\n    &lt;IfModule logio_module&gt;\n        LogFormat \"%v %a %h %l %u %t \\\"%r\\\" %&gt;s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\" combinedio\n    &lt;/IfModule&gt;\n    LogFormat \"%v %a %h %l %u %t \\\"%r\\\" %&gt;s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined\n    LogFormat \"%v %a %h %l %u %t \\\"%r\\\" %&gt;s %b\" common\n    &lt;IfModule ssl_module&gt;\n        &lt;IfModule logio_module&gt;\n            LogFormat \"%v %a %h %l %u %t \\\"%r\\\" %&gt;s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O %{SSL_PROTOCOL}x %{SSL_CIPHER}x\" combinediossl\n        &lt;/IfModule&gt;\n        LogFormat \"%v %a %h %l %u %t \\\"%r\\\" %&gt;s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %{SSL_PROTOCOL}x %{SSL_CIPHER}x\" combinedssl\n        LogFormat \"%v %a %h %l %u %t \\\"%r\\\" %&gt;s %b %{SSL_PROTOCOL}x %{SSL_CIPHER}x\" commonssl\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\nLogLevel info\n#LogLevel info rewrite:trace8\n&lt;IfModule ssl_module&gt;\n    Listen 443\n&lt;/IfModule&gt;\nListen 80\nTimeout 60\nKeepAlive Off\nKeepAliveTimeout 2\nMaxKeepAliveRequests 100\nUseCanonicalName On\nHostnameLookups Double\nServerTokens OS\nServerSignature Off\nServerName localhost\nServerAdmin webmaster@example.com\nAccessFileName .htaccess\nAllowEncodedSlashes NoDecode\nAddDefaultCharset UTF-8\n&lt;Directory \"/\"&gt;\n    &lt;IfModule allowmethods_module&gt;\n        AllowMethods GET POST OPTIONS\n    &lt;/IfModule&gt;\n    Options None +FollowSymLinks\n    AllowOverride None\n    Require all denied\n&lt;/Directory&gt;\n&lt;LocationMatch \"^/?(.+/)*[\\._]\"&gt;\n    Require all denied\n&lt;/LocationMatch&gt;\n&lt;LocationMatch \"^/?(?:\\.well-known)\"&gt;\n    Require all granted\n&lt;/LocationMatch&gt;\n&lt;IfModule reqtimeout_module&gt;\n    RequestReadTimeout handshake=0 header=20-40,MinRate=500 body=20,MinRate=500\n&lt;/IfModule&gt;\nFileETag None\n&lt;IfModule headers_module&gt;\n    RequestHeader unset Proxy early\n&lt;/IfModule&gt;\n&lt;IfModule dir_module&gt;\n    DirectoryIndex index.html index.htm index.php\n&lt;/IfModule&gt;\n&lt;IfModule cgi_module&gt;\n    &lt;FilesMatch \"\\.(?:cgi|pl|py|rb)$\"&gt;\n        SetHandler cgi-script\n    &lt;/FilesMatch&gt;\n&lt;/IfModule&gt;\n&lt;IfModule cgid_module&gt;\n    &lt;FilesMatch \"\\.(?:cgi|pl|py|rb)$\"&gt;\n        SetHandler cgi-script\n    &lt;/FilesMatch&gt;\n    Scriptsock \"/var/run/cgisock\"\n&lt;/IfModule&gt;\n&lt;IfModule include_module&gt;\n    AddOutputFilter INCLUDES .shtml\n&lt;/IfModule&gt;\n&lt;IfModule mime_module&gt;\n    TypesConfig \"etc/apache24/mime.types\"\n    AddType application/gzip                            gz tgz\n    AddType application/ld+json                         jsonld\n    AddType application/manifest+json                   manifest\n    AddType text/html                                   shtml\n    AddType text/javascript                             js\n    AddType text/ecmascript                             ecma\n    AddType text/markdown                               md\n    &lt;FilesMatch \"favicon\\.ico$\"&gt;\n        AddType image/vnd.microsoft.icon                ico\n    &lt;/FilesMatch&gt;\n    AddEncoding gzip                                    svgz\n    AddHandler type-map                                 var\n    &lt;IfModule negotiation_module&gt;\n        AddLanguage de             .de\n        AddLanguage en             .en\n        DefaultLanguage en\n        LanguagePriority en de\n        ForceLanguagePriority Prefer Fallback\n        AddCharset us-ascii.ascii  .us-ascii\n        AddCharset ISO-8859-1      .iso8859-1   .latin1\n        AddCharset ISO-8859-15     .iso8859-15  .latin9\n        AddCharset UTF-8           .utf8\n        AddCharset UTF-8 .atom \\\n                         .css \\\n                         .js \\\n                         .json \\\n                         .jsonld \\\n                         .md \\\n                         .manifest \\\n                         .rdf \\\n                         .rss \\\n                         .xml \\\n                         .xsl\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\n&lt;IfModule mime_magic_module&gt;\n    MIMEMagicFile \"etc/apache24/magic\"\n&lt;/IfModule&gt;\n&lt;IfModule expires_module&gt;\n    ExpiresActive on\n    ExpiresDefault                                      \"access plus 1 month\"\n    ExpiresByType text/html                             \"access plus 0 seconds\"\n    ExpiresByType application/xhtml+xml                 \"access plus 0 seconds\"\n    ExpiresByType text/css                              \"access plus 1 week\"\n    ExpiresByType text/javascript                       \"access plus 1 week\"\n    ExpiresByType text/ecmascript                       \"access plus 1 week\"\n    ExpiresByType application/javascript                \"access plus 1 week\"\n    ExpiresByType application/ecmascript                \"access plus 1 week\"\n    ExpiresByType text/markdown                         \"access plus 0 seconds\"\n    ExpiresByType application/xml                       \"access plus 0 seconds\"\n    ExpiresByType text/xml                              \"access plus 0 seconds\"\n    ExpiresByType text/xsl                              \"access plus 0 seconds\"\n    ExpiresByType application/atom+xml                  \"access plus 1 hour\"\n    ExpiresByType application/rss+xml                   \"access plus 1 hour\"\n    ExpiresByType application/rdf+xml                   \"access plus 1 hour\"\n    ExpiresByType application/json                      \"access plus 0 seconds\"\n    ExpiresByType application/ld+json                   \"access plus 0 seconds\"\n    ExpiresByType application/schema+json               \"access plus 0 seconds\"\n    ExpiresByType application/manifest+json             \"access plus 1 week\"\n    ExpiresByType image/vnd.microsoft.icon              \"access plus 1 week\"\n&lt;/IfModule&gt;\n&lt;IfModule filter_module&gt;\n    &lt;IfModule brotli_module&gt;\n        FilterDeclare  COMPRESS_BR CONTENT_SET\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^text/html\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^text/plain\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^text/xml\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^text/css\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^text/javascript\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^text/ecmascript\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/json\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/ld+json\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/schema+json\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/manifest+json\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/javascript\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/ecmascript\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/xml\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/xhtml\\+xml\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/rss\\+xml\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^application/atom\\+xml\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^image/svg\\+xml\\b#\"\n        FilterProvider COMPRESS_BR BROTLI_COMPRESS \"%{Content_Type} =~ m#^image/vnd\\.microsoft\\.icon\\b#\"\n        FilterProtocol COMPRESS_BR BROTLI_COMPRESS change=yes;byteranges=no\n    &lt;/IfModule&gt;\n    &lt;IfModule deflate_module&gt;\n        FilterDeclare  COMPRESS_GZ CONTENT_SET\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^text/html\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^text/plain\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^text/xml\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^text/css\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^text/javascript\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^text/ecmascript\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/json\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/ld+json\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/schema+json\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/manifest+json\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/jvascript\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/ecmascript\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/xml\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/xhtml\\+xml\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/rss\\+xml\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^application/atom\\+xml\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^image/svg\\+xml\\b#\"\n        FilterProvider COMPRESS_GZ DEFLATE \"%{Content_Type} =~ m#^image/vnd\\.microsoft\\.icon\\b#\"\n        FilterProtocol COMPRESS_GZ DEFLATE change=yes;byteranges=no\n    &lt;/IfModule&gt;\n    &lt;If \"%{HTTP:Accept-Encoding} =~ /\\bbr\\b/i\"&gt;\n        &lt;IfModule brotli_module&gt;\n            FilterChain COMPRESS_BR\n        &lt;/IfModule&gt;\n        &lt;IfModule !brotli_module&gt;\n            &lt;If \"%{HTTP:Accept-Encoding} =~ /\\bdeflate\\b/i\"&gt;\n                &lt;IfModule deflate_module&gt;\n                    FilterChain COMPRESS_GZ\n                &lt;/IfModule&gt;\n            &lt;/If&gt;\n        &lt;/IfModule&gt;\n    &lt;/If&gt;\n    &lt;ElseIf \"%{HTTP:Accept-Encoding} =~ /\\bdeflate\\b/i\"&gt;\n        &lt;IfModule deflate_module&gt;\n            FilterChain COMPRESS_GZ\n        &lt;/IfModule&gt;\n    &lt;/ElseIf&gt;\n&lt;/IfModule&gt;\n&lt;IfModule proxy_html_module&gt;\n    ProxyHTMLLinks  a               href\n    ProxyHTMLLinks  area            href\n    ProxyHTMLLinks  link            href\n    ProxyHTMLLinks  img             src longdesc usemap\n    ProxyHTMLLinks  object          classid codebase data usemap\n    ProxyHTMLLinks  q               cite\n    ProxyHTMLLinks  blockquote      cite\n    ProxyHTMLLinks  ins             cite\n    ProxyHTMLLinks  del             cite\n    ProxyHTMLLinks  form            action\n    ProxyHTMLLinks  input           src usemap\n    ProxyHTMLLinks  head            profile\n    ProxyHTMLLinks  base            href\n    ProxyHTMLLinks  script          src for\n    ProxyHTMLEvents onclick ondblclick onmousedown onmouseup \\\n                    onmouseover onmousemove onmouseout onkeypress \\\n                    onkeydown onkeyup onfocus onblur onload \\\n                    onunload onsubmit onreset onselect onchange\n&lt;/IfModule&gt;\n&lt;IfModule cache_module&gt;\n    CacheQuickHandler Off\n    CacheStorePrivate On\n    CacheIgnoreNoLastMod On\n    CacheIgnoreCacheControl On\n    CacheIgnoreURLSessionIdentifiers sid SID\n    CacheHeader On\n    &lt;IfModule cache_disk_module&gt;\n        CacheRoot \"/data/www/cache/\"\n    &lt;/IfModule&gt;\n    &lt;IfModule cache_socache_module&gt;\n        CacheSocache shmcb\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\n&lt;IfModule userdir_module&gt;\n    UserDir disabled\n    UserDir public_html\n    &lt;Directory \"/home/*/public_html\"&gt;\n        Options None +SymLinksIfOwnerMatch\n        AllowOverride None\n        Require method GET POST OPTIONS\n        Require all granted\n    &lt;/Directory&gt;\n&lt;/IfModule&gt;\n&lt;IfModule info_module&gt;\n    &lt;Location \"/.well-known/server-info\"&gt;\n        SetHandler server-info\n        &lt;RequireAny&gt;\n            Require host localhost\n        &lt;/RequireAny&gt;\n    &lt;/Location&gt;\n&lt;/IfModule&gt;\n&lt;IfModule status_module&gt;\n    &lt;Location \"/.well-known/server-status\"&gt;\n        SetHandler server-status\n        &lt;RequireAny&gt;\n            Require host localhost\n        &lt;/RequireAny&gt;\n    &lt;/Location&gt;\n    &lt;IfModule http2_module&gt;\n        &lt;Location \"/.well-known/server-status2\"&gt;\n            SetHandler http2-status\n            &lt;RequireAny&gt;\n                Require host localhost\n            &lt;/RequireAny&gt;\n        &lt;/Location&gt;\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\n&lt;IfModule headers_module&gt;\n    Header set Access-Control-Allow-Methods \"GET, POST, OPTIONS\"\n#    Header set Access-Control-Allow-Headers \"Origin, X-Requested-With, Content-Type, Accept, Accept-Encoding\"\n#    Header set Access-Control-Allow-Origin \"null\"\n    &lt;IfModule setenvif_module&gt;\n        SetEnvIf Origin \":\" IS_CORS\n        Header set Access-Control-Allow-Origin \"*\" env=IS_CORS\n    &lt;/IfModule&gt;\n    Header set Access-Control-Max-Age \"600\"\n#    Header set Clear-Site-Data \"\\\"cache\\\", \\\"storage\\\", \\\"executionContexts\\\"\"\n    Header set Clear-Site-Data \"\\\"cache\\\", \\\"executionContexts\\\"\"\n    Header set Content-Security-Policy \"\\\nupgrade-insecure-requests; \\\ndefault-src 'self'; \\\nchild-src 'self'; \\\nconnect-src 'self' https:; \\\nfont-src 'self' https:; \\\nframe-src 'self'; \\\nfenced-frame-src 'self'; \\\nimg-src 'self' https: data:; \\\nmanifest-src 'self'; \\\nmedia-src 'self' https: data:; \\\nobject-src 'none'; \\\nscript-src 'self' https: 'unsafe-inline' 'unsafe-eval' 'report-sample'; \\\nstyle-src 'self' https: 'unsafe-inline' 'unsafe-eval' 'report-sample'; \\\nwebrtc-src 'block'; \\\nworker-src 'self'; \\\nform-action 'self' https:; \\\nframe-ancestors 'self'; \\\nbase-uri 'self'; \\\nsandbox allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation; \\\nreport-uri https://www.example.com/default-endpoint.php; \\\nreport-to default-endpoint\"\n    Header set Cross-Origin-Opener-Policy \"same-origin-allow-popups; report-uri https://www.example.com/default-endpoint.php; report-to=\\\"default-endpoint\\\"\"\n    Header set Cross-Origin-Embedder-Policy \"credentialless; report-uri https://www.example.com/default-endpoint.php; report-to=\\\"default-endpoint\\\"\"\n    Header set Cross-Origin-Resource-Policy \"cross-origin; report-uri https://www.example.com/default-endpoint.php; report-to=\\\"default-endpoint\\\"\"\n    Header set No-Vary-Search \"key-order\"\n    Header Set Permissions-Policy \"\\\naccelerometer=(self), \\\nambient-light-sensor=(self), \\\nattribution-reporting=(self), \\\nautoplay=(self), \\\nbluetooth=(self), \\\nbrowsing-topcs=(self), \\\ncamera=(self), \\\ncompute-pressure=(self), \\\ncross-origin-isolated=(self), \\\ndisplay-capture=(self), \\\ndocument-domain=(self), \\\nencrypted-media=(self), \\\nfullscreen=(self), \\\ngamepad=(self), \\\ngeolocation=(self), \\\ngyroscope=(self), \\\nhid=(self), \\\nidentity-credentials-get=(self), \\\nidle-detection=(self), \\\nlocal-fonts=(self), \\\nmagnetometer=(self), \\\nmicrophone=(self), \\\nmidi=(self), \\\notp-credentials=(self), \\\npayment=(self), \\\npicture-in-picture=(self), \\\npublickey-credentials-create=(self), \\\npublickey-credentials-get=(self), \\\nscreen-wake-lock=(self), \\\nserial=(self), \\\nspeaker-selection=(self), \\\nstorage-access=(self), \\\nusb=(self), \\\nusb-share=(self), \\\nwindow-management=(self), \\\nxr-spatial-tracking=(self), \\\npush=(self), \\\nspeaker=(self), \\\nsync-xhr=(self), \\\nvibrate=(self)\"\n    Header set Referrer-Policy \"strict-origin-when-cross-origin\"\n    Header set Reporting-Endpoints \"default-endpoint=\\\"https://www.example.com/default-endpoint.php\\\"\"\n    Header set Timing-Allow-Origin \"*\"\n    Header set X-Content-Type-Options \"nosniff\"\n    Header set X-DNS-Prefetch-Control \"on\"\n    Header set X-Download-Options \"noopen\"\n    Header set X-Frame-Options \"SAMEORIGIN\"\n    Header set X-Permitted-Cross-Domain-Policies \"none\"\n    Header set X-Robots-Tag \"noai, noimageai, notrain, noarchive, noimageindex, max-snippet:-1, max-image-preview:-1, max-video-preview:-1\"\n    &lt;FilesMatch \"(.+\\.(ico|gif|jpg|png|webp|svg|css|js|json|xml|pdf|woff|woff2).?)(/.*)?$\"&gt;\n        Header set X-Robots-Tag \"noai, noimageai, notrain, noarchive, noimageindex, noindex, nofollow, max-snippet:-1, max-image-preview:-1, max-video-preview:-1\"\n    &lt;/FilesMatch&gt;\n    Header set X-XSS-Protection \"1; mode=block\"\n&lt;/IfModule&gt;\nIncludeOptional \"etc/apache24/modules.d/[0-9][0-9][0-9]_*.conf\"\nIncludeOptional \"etc/apache24/vhosts.conf\"\n&lt;IfModule ssl_module&gt;\n    SSLRandomSeed startup \"file:/dev/urandom\" 65536\n    SSLRandomSeed connect \"file:/dev/urandom\" 65536\n    SSLPassPhraseDialog builtin\n    &lt;IfModule socache_shmcb_module&gt;\n        SSLSessionCache \"shmcb:/var/run/ssl_scache(512000)\"\n    &lt;/IfModule&gt;\n    &lt;IfModule !socache_shmcb_module&gt;\n        &lt;IfModule socache_dbm_module&gt;\n            SSLSessionCache \"dbm:/var/run/ssl_scache\"\n        &lt;/IfModule&gt;\n        &lt;IfModule !socache_dbm_module&gt;\n            SSLSessionCache \"nonenotnull\"\n        &lt;/IfModule&gt;\n    &lt;/IfModule&gt;\n    SSLHonorCipherOrder On\n    SSLStrictSNIVHostCheck On\n    SSLProtocol -ALL +TLSv1.2 +TLSv1.3\n    SSLCipherSuite \"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\"\n    SSLCipherSuite TLSv1.3 \"TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256\"\n    SSLProxyProtocol -ALL +TLSv1.2 +TLSv1.3\n    SSLProxyCipherSuite \"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256\"\n    SSLProxyCipherSuite TLSv1.3 \"TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256\"\n    SSLOpenSSLConfCmd Curves \"X448:X25519:secp384r1:prime256v1:secp521r1\"\n    SSLOptions +StrictRequire +StdEnvVars\n    SSLOCSPEnable On\n    SSLStaplingFakeTryLater Off\n    SSLStaplingResponderTimeout 2\n    SSLStaplingReturnResponderErrors Off\n    SSLStaplingStandardCacheTimeout 86400\n    &lt;IfModule socache_shmcb_module&gt;\n        SSLUseStapling On\n        SSLStaplingCache \"shmcb:/var/run/stapling_cache(128000000)\"\n    &lt;/IfModule&gt;\n    &lt;IfModule !socache_shmcb_module&gt;\n        &lt;IfModule socache_dbm_module&gt;\n            SSLUseStapling On\n            SSLStaplingCache \"dbm:/var/run/stapling_cache\"\n        &lt;/IfModule&gt;\n        &lt;IfModule !socache_dbm_module&gt;\n            SSLUseStapling Off\n        &lt;/IfModule&gt;\n    &lt;/IfModule&gt;\n    IncludeOptional \"etc/apache24/vhosts-ssl.conf\"\n&lt;/IfModule&gt;\n&lt;IfModule headers_module&gt;\n    Header set tdm-reservation \"1\"\n    Header merge Cache-Control \"private\"\n    Header merge Cache-Control \"no-cache\"\n    Header merge Cache-Control \"no-transform\"\n    Header merge Cache-Control \"must-revalidate\"\n    Header merge Cache-Control \"proxy-revalidate\"\n    Header always merge Cache-Control \"private\"\n    Header always merge Cache-Control \"no-cache\"\n    Header always merge Cache-Control \"no-transform\"\n    Header always merge Cache-Control \"must-revalidate\"\n    Header always merge Cache-Control \"proxy-revalidate\"\n    Header edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*HttpOnly)(.*)$\" \"$1$2\"\n    Header edit Set-Cookie \"^(.*)$\" \"$1; HttpOnly\"\n    Header edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*SameSite=[A-Za-z0-9]+)(.*)$\" \"$1$2\"\n    Header edit Set-Cookie \"^(.*)$\" \"$1; SameSite=Lax\"\n    Header always edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*HttpOnly)(.*)$\" \"$1$2\"\n    Header always edit Set-Cookie \"^(.*)$\" \"$1; HttpOnly\"\n    Header always edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*SameSite=[A-Za-z0-9]+)(.*)$\" \"$1$2\"\n    Header always edit Set-Cookie \"^(.*)$\" \"$1; SameSite=Lax\"\n    &lt;If \"%{SSL:HTTPS} =~ /\\bOn\\b/i\"&gt;\n        Header set Public-Key-Pins \"max-age=0; includeSubdomains\"\n        Header set Strict-Transport-Security \"max-age=31536000; includeSubdomains; preload\"\n#        Header set Strict-Transport-Security \"max-age=15768000; includeSubdomains; preload\"\n        Header set X-SSL-PROTOCOL \"expr=%{SSL_PROTOCOL}\"\n        Header set X-SSL-CIPHER \"expr=%{SSL:SSL_CIPHER}\"\n        Header edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*Secure)(.*)$\" \"$1$2\"\n        Header edit Set-Cookie \"^(.*)$\" \"$1; Secure\"\n        Header edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*Partitioned)(.*)$\" \"$1$2\"\n        Header edit Set-Cookie \"^(.*)$\" \"$1; Partitioned\"\n        Header always edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*Secure)(.*)$\" \"$1$2\"\n        Header always edit Set-Cookie \"^(.*)$\" \"$1; Secure\"\n        Header always edit* Set-Cookie \"^(.*)(?i:\\s*;\\s*Partitioned)(.*)$\" \"$1$2\"\n        Header always edit Set-Cookie \"^(.*)$\" \"$1; Partitioned\"\n    &lt;/If&gt;\n    Header unset Pragma\n    Header unset ETag\n    Header always unset Pragma\n    Header always unset ETag\n&lt;/IfModule&gt;\n\nEOF\n</code></pre> <p><code>vhosts.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/apache24/vhosts.conf\n&lt;VirtualHost 127.0.0.1:80&gt;\n    ServerName localhost\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/_localhost_/logs/apache_access_log\" combined\n    ErrorLog \"/data/www/vhosts/_localhost_/logs/apache_error_log\"\n    DocumentRoot \"/data/www/vhosts/_localhost_/data\"\n    &lt;Directory \"/data/www/vhosts/_localhost_/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:80&gt;\n    ServerName devnull.example.com\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/_default_/logs/apache_access_log\" combined\n    ErrorLog \"/data/www/vhosts/_default_/logs/apache_error_log\"\n    DocumentRoot \"/data/www/vhosts/_default_/data\"\n    &lt;Directory \"/data/www/vhosts/_default_/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n    &lt;IfModule rewrite_module&gt;\n        RewriteEngine On\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"https://%{HTTP_HOST}/$1\" [L,QSA,R=308]\n    &lt;/IfModule&gt;\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:80&gt;\n    ServerName www.example.com\n    ServerAlias example.com\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/www.example.com/logs/apache_access_log\" combined\n    ErrorLog \"/data/www/vhosts/www.example.com/logs/apache_error_log\"\n    DocumentRoot \"/data/www/vhosts/www.example.com/data\"\n    &lt;Directory \"/data/www/vhosts/www.example.com/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n    &lt;IfModule rewrite_module&gt;\n        RewriteEngine On\n        RewriteCond \"%{HTTP_HOST}\" \"!^www\\.example\\.com$\" [NC]\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"http://www.example.com/$1\" [L,QSA,R=308]\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"https://%{HTTP_HOST}/$1\" [L,QSA,R=308]\n    &lt;/IfModule&gt;\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:80&gt;\n    ServerName mail.example.com\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/mail.example.com/logs/apache_access_log\" combined\n    ErrorLog \"/data/www/vhosts/mail.example.com/logs/apache_error_log\"\n    DocumentRoot \"/data/www/vhosts/mail.example.com/data\"\n    &lt;Directory \"/data/www/vhosts/mail.example.com/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n    &lt;IfModule rewrite_module&gt;\n        RewriteEngine On\n        RewriteCond \"%{HTTP_HOST}\" \"!^www\\.example\\.com$\" [NC]\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"http://mail.example.com/$1\" [L,QSA,R=308]\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"https://%{HTTP_HOST}/$1\" [L,QSA,R=308]\n    &lt;/IfModule&gt;\n&lt;/VirtualHost&gt;\n\nEOF\n</code></pre> <p><code>vhosts-ssl.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/apache24/vhosts-ssl.conf\n&lt;VirtualHost *:443&gt;\n    ServerName devnull.example.com\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/_default_/logs/apache_ssl_access_log\" combinedssl\n    ErrorLog \"/data/www/vhosts/_default_/logs/apache_ssl_error_log\"\n    DocumentRoot \"/data/www/vhosts/_default_/data\"\n    &lt;Directory \"/data/www/vhosts/_default_/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n    &lt;FilesMatch \"(.+\\.php)(/.*)?$\"&gt;\n        &lt;If \"-f %{REQUEST_FILENAME}\"&gt;\n            SetHandler \"proxy:unix:/var/run/fpm_www.sock|fcgi://localhost\"\n        &lt;/If&gt;\n    &lt;/FilesMatch&gt;\n    SSLEngine on\n    SSLCertificateFile \"/usr/local/etc/letsencrypt/live/devnull.example.com/fullchain.pem\"\n    SSLCertificateKeyFile \"/usr/local/etc/letsencrypt/live/devnull.example.com/privkey.pem\"\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:443&gt;\n    ServerName www.example.com\n    ServerAlias example.com\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/www.example.com/logs/apache_ssl_access_log\" combinedssl\n    ErrorLog \"/data/www/vhosts/www.example.com/logs/apache_ssl_error_log\"\n    DocumentRoot \"/data/www/vhosts/www.example.com/data\"\n    &lt;Directory \"/data/www/vhosts/www.example.com/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n    &lt;IfModule rewrite_module&gt;\n        RewriteEngine On\n        RewriteCond \"%{HTTP_HOST}\" \"!^www\\.example\\.com$\" [NC]\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"https://www.example.com/$1\" [L,QSA,R=308]\n    &lt;/IfModule&gt;\n    &lt;FilesMatch \"(.+\\.php)(/.*)?$\"&gt;\n        &lt;If \"-f %{REQUEST_FILENAME}\"&gt;\n            SetHandler \"proxy:unix:/var/run/fpm_www.sock|fcgi://localhost\"\n        &lt;/If&gt;\n    &lt;/FilesMatch&gt;\n    SSLEngine on\n    SSLCertificateFile \"/usr/local/etc/letsencrypt/live/www.example.com/fullchain.pem\"\n    SSLCertificateKeyFile \"/usr/local/etc/letsencrypt/live/www.example.com/privkey.pem\"\n&lt;/VirtualHost&gt;\n\n&lt;VirtualHost *:443&gt;\n    ServerName mail.example.com\n    ServerAdmin webmaster@example.com\n    CustomLog \"/data/www/vhosts/mail.example.com/logs/apache_ssl_access_log\" combinedssl\n    ErrorLog \"/data/www/vhosts/mail.example.com/logs/apache_ssl_error_log\"\n    DocumentRoot \"/data/www/vhosts/mail.example.com/data\"\n    &lt;Directory \"/data/www/vhosts/mail.example.com/data\"&gt;\n        Options None +FollowSymLinks\n        AllowOverride None\n        Require all granted\n    &lt;/Directory&gt;\n    &lt;IfModule rewrite_module&gt;\n        RewriteEngine On\n        RewriteCond \"%{HTTP_HOST}\" \"!^mail\\.example\\.com$\" [NC]\n        RewriteCond \"%{REQUEST_FILENAME}\" \"!^/?(?:\\.well-known|robots\\.txt)\" [NC]\n        RewriteRule \"^/?(.*)\" \"https://mail.example.com/$1\" [L,QSA,R=308]\n    &lt;/IfModule&gt;\n    &lt;FilesMatch \"(.+\\.php)(/.*)?$\"&gt;\n        &lt;If \"-f %{REQUEST_FILENAME}\"&gt;\n            SetHandler \"proxy:unix:/var/run/fpm_www.sock|fcgi://localhost\"\n        &lt;/If&gt;\n    &lt;/FilesMatch&gt;\n    SSLEngine on\n    SSLCertificateFile \"/usr/local/etc/letsencrypt/live/mail.example.com/fullchain.pem\"\n    SSLCertificateKeyFile \"/usr/local/etc/letsencrypt/live/mail.example.com/privkey.pem\"\n&lt;/VirtualHost&gt;\n\nEOF\n</code></pre> <p><code>default-endpoint.php</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /data/www/vhosts/www.example.com/data/default-endpoint.php\n&lt;?php\n\ndate_default_timezone_set('UTC');\n\n// This script will process incoming Content Security Policy violation reports\n// and send them, nicely formatted, to the email address listed below.\n//\n// Included in the script is a large list of false-positives that are generated\n// by browser addons etc.\n//\n// To activate, emit the proper CSP headers via PHP in all your page-generating scripts,\n// e.g.: header(\"Content-Security-Policy-Report-Only: default-src https: wss: data: 'unsafe-eval' 'unsafe-inline'; report-uri /csp-report.php\");\n// Which we use to track HTTPS mixed-content warnings.\n\n$emailTo='admin@example.com';\n\nhttp_response_code(204);\n\n// Only run if proper input data received\nif ($data=json_decode(file_get_contents('php://input'), true))\n    ksort($data);\n\n    // Prettify the JSON-formatted data\n    $email=json_encode($data, JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES).\"\\r\\n\\r\\n\";\n\n    $email.=sprintf(\"%s (%s)\\r\\n\", $_SERVER['REMOTE_ADDR'], gethostbyaddr($_SERVER['REMOTE_ADDR']));\n    $email.=sprintf(\"%s\\r\\n\\r\\n\", $_SERVER['HTTP_USER_AGENT']);\n\n    // Mail the CSP violation report\n    mail($emailTo, 'CSP Violation', $email, 'Content-Type: text/plain;charset=utf-8');\n?&gt;\n\nEOF\n</code></pre> <p><code>fixperms.sh</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /data/www/vhosts/_default_/cron/fixperms.sh\n#!/bin/tcsh\n\nchown -R root:wheel /data/www/vhosts/_default_/{conf,logs}\nchown -R www:www    /data/www/vhosts/_default_/{cron,data}\n\nfind /data/www/vhosts/_default_/{conf,logs}/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/_default_/{conf,logs}/ -type f -print0 | xargs -0 chmod 0664\n\nfind /data/www/vhosts/_default_/cron/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/_default_/cron/ -type f -print0 | xargs -0 chmod 0755\n\nfind /data/www/vhosts/_default_/data/ -type d -print0 | xargs -0 chmod 6750\nfind /data/www/vhosts/_default_/data/ -type f -print0 | xargs -0 chmod 0640\n\nEOF\nchmod 0750 /data/www/vhosts/_default_/cron/fixperms.sh\n\ncat &lt;&lt;'EOF' &gt; /data/www/vhosts/_localhost_/cron/fixperms.sh\n#!/bin/tcsh\n\nchown -R root:wheel /data/www/vhosts/_localhost_/{conf,logs}\nchown -R www:www    /data/www/vhosts/_localhost_/{cron,data}\n\nfind /data/www/vhosts/_localhost_/{conf,logs}/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/_localhost_/{conf,logs}/ -type f -print0 | xargs -0 chmod 0664\n\nfind /data/www/vhosts/_localhost_/cron/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/_localhost_/cron/ -type f -print0 | xargs -0 chmod 0755\n\nfind /data/www/vhosts/_localhost_/data/ -type d -print0 | xargs -0 chmod 6750\nfind /data/www/vhosts/_localhost_/data/ -type f -print0 | xargs -0 chmod 0640\n\nEOF\nchmod 0750 /data/www/vhosts/_localhost_/cron/fixperms.sh\n\ncat &lt;&lt;'EOF' &gt; /data/www/vhosts/mail.example.com/cron/fixperms.sh\n#!/bin/tcsh\n\nchown -R root:wheel /data/www/vhosts/mail.example.com/{conf,logs}\nchown -R www:www    /data/www/vhosts/mail.example.com/{cron,data}\n\nfind /data/www/vhosts/mail.example.com/{conf,logs}/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/mail.example.com/{conf,logs}/ -type f -print0 | xargs -0 chmod 0664\n\nfind /data/www/vhosts/mail.example.com/cron/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/mail.example.com/cron/ -type f -print0 | xargs -0 chmod 0755\n\nfind /data/www/vhosts/mail.example.com/data/ -type d -print0 | xargs -0 chmod 6750\nfind /data/www/vhosts/mail.example.com/data/ -type f -print0 | xargs -0 chmod 0640\n\nEOF\nchmod 0750 /data/www/vhosts/mail.example.com/cron/fixperms.sh\n\ncat &lt;&lt;'EOF' &gt; /data/www/vhosts/www.example.com/cron/fixperms.sh\n#!/bin/tcsh\n\nchown -R root:wheel /data/www/vhosts/www.example.com/{conf,logs}\nchown -R www:www    /data/www/vhosts/www.example.com/{cron,data}\n\nfind /data/www/vhosts/www.example.com/{conf,logs}/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/www.example.com/{conf,logs}/ -type f -print0 | xargs -0 chmod 0664\n\nfind /data/www/vhosts/www.example.com/cron/ -type d -print0 | xargs -0 chmod 0755\nfind /data/www/vhosts/www.example.com/cron/ -type f -print0 | xargs -0 chmod 0755\n\nfind /data/www/vhosts/www.example.com/data/ -type d -print0 | xargs -0 chmod 6750\nfind /data/www/vhosts/www.example.com/data/ -type f -print0 | xargs -0 chmod 0640\n\nEOF\nchmod 0750 /data/www/vhosts/www.example.com/cron/fixperms.sh\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/apache/#abschluss","title":"Abschluss","text":"<p>Apache kann nun gestartet werden.</p> Bash<pre><code>service apache24 start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/nginx/","title":"NGinx","text":""},{"location":"howtos/freebsd/hosting_system/webserver/nginx/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>NGinx 1.28.0 (HTTP/2, mod_brotli)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/webserver/nginx/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/webserver/nginx/#installation","title":"Installation","text":"Important <p>Der Rest des HowTo ist derzeit nicht auf das Zusammenspiel mit NGinx abgestimmt, daher ist die Verwendung von</p> <p>Apache aktuell zu bevorzugen. NGinx bietet zudem auch keinen wirklichen Mehrwert gegen\u00fcber Apache, so dass Apache generell bevorzugt werden sollte. Die hier gezeigte Konfiguration ist nicht ausreichend getestet, enth\u00e4lt m\u00f6glicherweise sicherheitsrelevante Fehler und ist daher vollkommen unsupportet. Die Verwendung von NGinx erfolgt daher ausschliesslich auf eigenes Risiko und ohne weitere Unterst\u00fctzung durch dieses HowTo.</p> <p>Wir installieren <code>www/nginx</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/graphics_gd\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_gd/options\n_OPTIONS_READ=libgd-2.3.3\n_FILE_COMPLETE_OPTIONS_LIST=PNG JPEG WEBP TIFF XPM HEIF AVIF LIQ FREETYPE FONTCONFIG RAQM ICONV THREADS\nOPTIONS_FILE_SET+=PNG\nOPTIONS_FILE_SET+=JPEG\nOPTIONS_FILE_SET+=WEBP\nOPTIONS_FILE_SET+=TIFF\nOPTIONS_FILE_UNSET+=XPM\nOPTIONS_FILE_UNSET+=HEIF\nOPTIONS_FILE_UNSET+=AVIF\nOPTIONS_FILE_UNSET+=LIQ\nOPTIONS_FILE_SET+=FREETYPE\nOPTIONS_FILE_SET+=FONTCONFIG\nOPTIONS_FILE_SET+=RAQM\nOPTIONS_FILE_SET+=ICONV\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_jpeg-turbo\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_jpeg-turbo/options\n_OPTIONS_READ=jpeg-turbo-3.1.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_png\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_png/options\n_OPTIONS_READ=png-1.6.49\n_FILE_COMPLETE_OPTIONS_LIST=APNG SIMD\nOPTIONS_FILE_SET+=APNG\nOPTIONS_FILE_UNSET+=SIMD\n\nEOF\n\nmkdir -p /var/db/ports/graphics_tiff\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_tiff/options\n_OPTIONS_READ=tiff-4.7.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_libdeflate\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_libdeflate/options\n_OPTIONS_READ=libdeflate-1.24\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_jbigkit\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_jbigkit/options\n_OPTIONS_READ=jbigkit-2.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_webp\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_webp/options\n_OPTIONS_READ=webp-1.5.0\n_FILE_COMPLETE_OPTIONS_LIST=IMGCONV X11\nOPTIONS_FILE_SET+=IMGCONV\nOPTIONS_FILE_UNSET+=X11\n\nEOF\n\nmkdir -p /var/db/ports/graphics_giflib\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_giflib/options\n_OPTIONS_READ=giflib-5.2.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/print_freetype2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_freetype2/options\n_OPTIONS_READ=freetype2-2.13.3\n_FILE_COMPLETE_OPTIONS_LIST=BROTLI DEBUG DOCS LONG_PCF_NAMES PNG TABLE_VALIDATION LCD_FILTERING LCD_RENDERING TT_SIZE_METRICS\nOPTIONS_FILE_SET+=BROTLI\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=LONG_PCF_NAMES\nOPTIONS_FILE_SET+=PNG\nOPTIONS_FILE_UNSET+=TABLE_VALIDATION\nOPTIONS_FILE_UNSET+=LCD_FILTERING\nOPTIONS_FILE_SET+=LCD_RENDERING\nOPTIONS_FILE_UNSET+=TT_SIZE_METRICS\n\nEOF\n\nmkdir -p /var/db/ports/print_libraqm\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_libraqm/options\n_OPTIONS_READ=libraqm-0.10.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/converters_fribidi\ncat &lt;&lt;'EOF' &gt; /var/db/ports/converters_fribidi/options\n_OPTIONS_READ=fribidi-1.0.16\n_FILE_COMPLETE_OPTIONS_LIST=OPTIMIZED_CFLAGS TEST\nOPTIONS_FILE_UNSET+=OPTIMIZED_CFLAGS\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/print_harfbuzz\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_harfbuzz/options\n_OPTIONS_READ=harfbuzz-10.3.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_gobject-introspection\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_gobject-introspection/options\n_OPTIONS_READ=gobject-introspection-1.84.0\n_FILE_COMPLETE_OPTIONS_LIST=TEST\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/x11-fonts_fontconfig\ncat &lt;&lt;'EOF' &gt; /var/db/ports/x11-fonts_fontconfig/options\n_OPTIONS_READ=fontconfig-2.15.0\n_FILE_COMPLETE_OPTIONS_LIST=BITMAPS DOCS NLS TEST HINTING_NONE HINTING_SLIGHT HINTING_MEDIUM HINTING_FULL\nOPTIONS_FILE_SET+=BITMAPS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=TEST\nOPTIONS_FILE_UNSET+=HINTING_NONE\nOPTIONS_FILE_SET+=HINTING_SLIGHT\nOPTIONS_FILE_UNSET+=HINTING_MEDIUM\nOPTIONS_FILE_UNSET+=HINTING_FULL\n\nEOF\n\nmkdir -p /var/db/ports/www_nginx\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_nginx/options\n_OPTIONS_READ=nginx-1.28.0\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG DEBUGLOG DSO FILE_AIO IPV6 NJS NJS_XML OTEL THREADS WWW GSSAPI_HEIMDAL GSSAPI_MIT GOOGLE_PERFTOOLS HTTP HTTP_ADDITION HTTP_AUTH_REQ  HTTP_CACHE HTTP_DAV HTTP_DEGRADATION HTTP_FLV HTTP_GUNZIP_FILTER  HTTP_GZIP_STATIC HTTP_IMAGE_FILTER HTTP_MP4 HTTP_PERL  HTTP_RANDOM_INDEX HTTP_REALIP HTTP_SECURE_LINK HTTP_SLICE HTTP_SSL  HTTP_STATUS HTTP_SUB HTTP_XSLT HTTPV2 HTTPV3 HTTPV3_BORING HTTPV3_LSSL  HTTPV3_QTLS MAIL MAIL_IMAP MAIL_POP3 MAIL_SMTP MAIL_SSL STREAM STREAM_REALIP STREAM_SSL  STREAM_SSL_PREREAD AJP AWS_AUTH BROTLI CACHE_PURGE  DEVEL_KIT ARRAYVAR DRIZZLE DYNAMIC_UPSTREAM ECHO ENCRYPTSESSION  FIPS_CHECK FORMINPUT GRIDFS HEADERS_MORE HTTP_ACCEPT_LANGUAGE HTTP_AUTH_DIGEST  HTTP_AUTH_KRB5 HTTP_AUTH_LDAP HTTP_AUTH_PAM HTTP_DAV_EXT HTTP_EVAL  HTTP_FANCYINDEX HTTP_FOOTER HTTP_GEOIP2 HTTP_IP2LOCATION HTTP_IP2PROXY  HTTP_JSON_STATUS HTTP_MOGILEFS HTTP_NOTICE HTTP_PUSH  HTTP_PUSH_STREAM HTTP_REDIS HTTP_SLICE_AHEAD HTTP_SUBS_FILTER HTTP_TARANTOOL  HTTP_UPLOAD HTTP_UPLOAD_PROGRESS HTTP_UPSTREAM_CHECK HTTP_UPSTREAM_FAIR  HTTP_UPSTREAM_STICKY HTTP_VIDEO_THUMBEXTRACTOR HTTP_ZIP ICONV LET LINK LUA LUASTREAM  MEMC MODSECURITY3 NAXSI PASSENGER POSTGRES RDS_CSV RDS_JSON  REDIS2 RTMP SET_MISC SFLOW SHIBBOLETH SLOWFS_CACHE SRCACHE STS  VOD VTS XSS WEBSOCKIFY\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DEBUGLOG\nOPTIONS_FILE_SET+=DSO\nOPTIONS_FILE_SET+=FILE_AIO\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=NJS\nOPTIONS_FILE_UNSET+=NJS_XML\nOPTIONS_FILE_UNSET+=OTEL\nOPTIONS_FILE_SET+=THREADS\nOPTIONS_FILE_SET+=WWW\nOPTIONS_FILE_UNSET+=GSSAPI_HEIMDAL\nOPTIONS_FILE_UNSET+=GSSAPI_MIT\nOPTIONS_FILE_UNSET+=GOOGLE_PERFTOOLS\nOPTIONS_FILE_SET+=HTTP\nOPTIONS_FILE_SET+=HTTP_ADDITION\nOPTIONS_FILE_SET+=HTTP_AUTH_REQ\nOPTIONS_FILE_SET+=HTTP_CACHE\nOPTIONS_FILE_SET+=HTTP_DAV\nOPTIONS_FILE_UNSET+=HTTP_DEGRADATION\nOPTIONS_FILE_UNSET+=HTTP_FLV\nOPTIONS_FILE_SET+=HTTP_GUNZIP_FILTER\nOPTIONS_FILE_SET+=HTTP_GZIP_STATIC\nOPTIONS_FILE_SET+=HTTP_IMAGE_FILTER\nOPTIONS_FILE_SET+=HTTP_MP4\nOPTIONS_FILE_UNSET+=HTTP_PERL\nOPTIONS_FILE_SET+=HTTP_RANDOM_INDEX\nOPTIONS_FILE_SET+=HTTP_REALIP\nOPTIONS_FILE_SET+=HTTP_SECURE_LINK\nOPTIONS_FILE_SET+=HTTP_SLICE\nOPTIONS_FILE_SET+=HTTP_SSL\nOPTIONS_FILE_SET+=HTTP_STATUS\nOPTIONS_FILE_SET+=HTTP_SUB\nOPTIONS_FILE_UNSET+=HTTP_XSLT\nOPTIONS_FILE_SET+=HTTPV2\nOPTIONS_FILE_SET+=HTTPV3\nOPTIONS_FILE_UNSET+=HTTPV3_BORING\nOPTIONS_FILE_UNSET+=HTTPV3_LSSL\nOPTIONS_FILE_UNSET+=HTTPV3_QTLS\nOPTIONS_FILE_UNSET+=MAIL\nOPTIONS_FILE_UNSET+=MAIL_IMAP\nOPTIONS_FILE_UNSET+=MAIL_POP3\nOPTIONS_FILE_UNSET+=MAIL_SMTP\nOPTIONS_FILE_UNSET+=MAIL_SSL\nOPTIONS_FILE_SET+=STREAM\nOPTIONS_FILE_SET+=STREAM_REALIP\nOPTIONS_FILE_SET+=STREAM_SSL\nOPTIONS_FILE_SET+=STREAM_SSL_PREREAD\nOPTIONS_FILE_UNSET+=AJP\nOPTIONS_FILE_UNSET+=AWS_AUTH\nOPTIONS_FILE_UNSET+=BROTLI\nOPTIONS_FILE_UNSET+=CACHE_PURGE\nOPTIONS_FILE_UNSET+=DEVEL_KIT\nOPTIONS_FILE_UNSET+=ARRAYVAR\nOPTIONS_FILE_UNSET+=DRIZZLE\nOPTIONS_FILE_UNSET+=DYNAMIC_UPSTREAM\nOPTIONS_FILE_UNSET+=ECHO\nOPTIONS_FILE_UNSET+=ENCRYPTSESSION\nOPTIONS_FILE_UNSET+=FIPS_CHECK\nOPTIONS_FILE_UNSET+=FORMINPUT\nOPTIONS_FILE_UNSET+=GRIDFS\nOPTIONS_FILE_UNSET+=HEADERS_MORE\nOPTIONS_FILE_UNSET+=HTTP_ACCEPT_LANGUAGE\nOPTIONS_FILE_UNSET+=HTTP_AUTH_DIGEST\nOPTIONS_FILE_UNSET+=HTTP_AUTH_KRB5\nOPTIONS_FILE_UNSET+=HTTP_AUTH_LDAP\nOPTIONS_FILE_UNSET+=HTTP_AUTH_PAM\nOPTIONS_FILE_UNSET+=HTTP_DAV_EXT\nOPTIONS_FILE_UNSET+=HTTP_EVAL\nOPTIONS_FILE_UNSET+=HTTP_FANCYINDEX\nOPTIONS_FILE_UNSET+=HTTP_FOOTER\nOPTIONS_FILE_UNSET+=HTTP_GEOIP2\nOPTIONS_FILE_UNSET+=HTTP_IP2LOCATION\nOPTIONS_FILE_UNSET+=HTTP_IP2PROXY\nOPTIONS_FILE_UNSET+=HTTP_JSON_STATUS\nOPTIONS_FILE_UNSET+=HTTP_MOGILEFS\nOPTIONS_FILE_UNSET+=HTTP_NOTICE\nOPTIONS_FILE_UNSET+=HTTP_PUSH\nOPTIONS_FILE_UNSET+=HTTP_PUSH_STREAM\nOPTIONS_FILE_UNSET+=HTTP_REDIS\nOPTIONS_FILE_UNSET+=HTTP_SLICE_AHEAD\nOPTIONS_FILE_UNSET+=HTTP_SUBS_FILTER\nOPTIONS_FILE_UNSET+=HTTP_TARANTOOL\nOPTIONS_FILE_UNSET+=HTTP_UPLOAD\nOPTIONS_FILE_UNSET+=HTTP_UPLOAD_PROGRESS\nOPTIONS_FILE_UNSET+=HTTP_UPSTREAM_CHECK\nOPTIONS_FILE_UNSET+=HTTP_UPSTREAM_FAIR\nOPTIONS_FILE_UNSET+=HTTP_UPSTREAM_STICKY\nOPTIONS_FILE_UNSET+=HTTP_VIDEO_THUMBEXTRACTOR\nOPTIONS_FILE_UNSET+=HTTP_ZIP\nOPTIONS_FILE_UNSET+=ICONV\nOPTIONS_FILE_UNSET+=LET\nOPTIONS_FILE_UNSET+=LINK\nOPTIONS_FILE_UNSET+=LUA\nOPTIONS_FILE_UNSET+=LUASTREAM\nOPTIONS_FILE_UNSET+=MEMC\nOPTIONS_FILE_UNSET+=MODSECURITY3\nOPTIONS_FILE_UNSET+=NAXSI\nOPTIONS_FILE_UNSET+=PASSENGER\nOPTIONS_FILE_UNSET+=POSTGRES\nOPTIONS_FILE_UNSET+=RDS_CSV\nOPTIONS_FILE_UNSET+=RDS_JSON\nOPTIONS_FILE_UNSET+=REDIS2\nOPTIONS_FILE_UNSET+=RTMP\nOPTIONS_FILE_UNSET+=SET_MISC\nOPTIONS_FILE_UNSET+=SFLOW\nOPTIONS_FILE_UNSET+=SHIBBOLETH\nOPTIONS_FILE_UNSET+=SLOWFS_CACHE\nOPTIONS_FILE_UNSET+=SRCACHE\nOPTIONS_FILE_UNSET+=STS\nOPTIONS_FILE_UNSET+=VOD\nOPTIONS_FILE_UNSET+=VTS\nOPTIONS_FILE_UNSET+=XSS\nOPTIONS_FILE_UNSET+=WEBSOCKIFY\n\nEOF\n\n\nportmaster -w -B -g --force-config www/nginx  -n\n\n\nsysrc nginx_enable=YES\nsysrc nginxlimits_enable=YES\n\n\nmkdir -p /usr/local/etc/newsyslog.conf.d\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/newsyslog.conf.d/nginx\n/var/log/nginx-*.log                    644  13    *    $W6D0 JCG   /var/run/nginx.pid\n/data/www/vhosts/*/logs/nginx_*_log     644  24    *    $M1D0 JCG   /var/run/nginx.pid\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/nginx/#konfiguration","title":"Konfiguration","text":"<p>Verzeichnisse f\u00fcr die ersten VirtualHosts erstellen.</p> Bash<pre><code>mkdir -p /data/www/cache\nchmod 1777 /data/www/cache\nchown www:www /data/www/cache\nmkdir -p /data/www/tmp\nchmod 1777 /data/www/tmp\nchown www:www /data/www/tmp\n\n\nmkdir -p /data/www/vhosts/_default_/conf\nmkdir -p /data/www/vhosts/_default_/cron\nmkdir -p /data/www/vhosts/_default_/logs\nmkdir -p /data/www/vhosts/_default_/data/.well-known\nchmod 0750 /data/www/vhosts/_default_/data\nchown www:www /data/www/vhosts/_default_/data\n\nmkdir -p /data/www/vhosts/_localhost_/conf\nmkdir -p /data/www/vhosts/_localhost_/cron\nmkdir -p /data/www/vhosts/_localhost_/logs\nmkdir -p /data/www/vhosts/_localhost_/data/.well-known\nchmod 0750 /data/www/vhosts/_localhost_/data\nchown www:www /data/www/vhosts/_localhost_/data\n\nmkdir -p /data/www/vhosts/mail.example.com/conf\nmkdir -p /data/www/vhosts/mail.example.com/cron\nmkdir -p /data/www/vhosts/mail.example.com/logs\nmkdir -p /data/www/vhosts/mail.example.com/data/.well-known\nchmod 0750 /data/www/vhosts/mail.example.com/data\nchown www:www /data/www/vhosts/mail.example.com/data\n\nmkdir -p /data/www/vhosts/www.example.com/conf\nmkdir -p /data/www/vhosts/www.example.com/cron\nmkdir -p /data/www/vhosts/www.example.com/logs\nmkdir -p /data/www/vhosts/www.example.com/data/.well-known\nchmod 0750 /data/www/vhosts/www.example.com/data\nchown www:www /data/www/vhosts/www.example.com/data\n</code></pre> <p>Die folgende Konfiguration verwendet f\u00fcr den localhost den Pfad <code>/data/www/vhosts/_localhost_</code>, f\u00fcr den Default-Host den Pfad <code>/data/www/vhosts/_default_</code> und f\u00fcr die regul\u00e4ren Virtual-Hosts den Pfad <code>/data/www/vhosts/sub.domain.tld</code>.</p> <p><code>nginx.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/nginx/nginx.conf\n#user  nobody;\nworker_processes  1;\n\n# This default error log path is compiled-in to make sure configuration parsing\n# errors are logged somewhere, especially during unattended boot when stderr\n# isn't normally logged anywhere. This path will be touched on every nginx\n# start regardless of error log location configured here. See\n# https://trac.nginx.org/nginx/ticket/147 for more info.\n#\n#error_log  /var/log/nginx/error.log;\n#\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server {\n        listen       8080;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   /data/www/vhosts/_default_/data;\n            index  index.html index.htm;\n        }\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   /data/www/nginx-dist;\n        }\n\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #\n        #location ~ \\.php$ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n}\n\nEOF\n</code></pre> <p><code>vhosts.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/nginx/vhosts.conf\nEOF\n</code></pre> <p><code>vhosts-ssl.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/nginx/vhosts-ssl.conf\nEOF\n</code></pre> <p><code>defaults.conf</code> und <code>headers.conf</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/nginx/defaults.conf\n        location ~* /?(.+/)*[\\._] { return 403; }\n        location ~* /?\\.well-known { allow all; }\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/nginx/headers.conf\n        add_header  Access-Control-Allow-Methods  \"GET, POST, OPTIONS\";\n#        add_header  Access-Control-Allow-Headers \"Origin, X-Requested-With, Content-Type, Accept, Accept-Encoding\"\n        add_header  Access-Control-Allow-Origin  \"*\";\n        add_header  Access-Control-Max-Age  \"600\";\n        add_header  Content-Security-Policy \"\\\nblock-all-mixed-content; \\\nupgrade-insecure-requests; \\\ndefault-src 'self' 'unsafe-inline' https: data: blob: mediastream:; \\\nscript-src 'self' 'unsafe-inline' 'unsafe-eval' https: blob: mediastream:; \\\nform-action 'self' https:; \\\nframe-ancestors 'self'; \\\nsandbox allow-forms allow-modals allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation\"\n        add_header  Referrer-Policy  \"strict-origin-when-cross-origin\";\n        add_header  Timing-Allow-Origin  \"*\";\n        add_header  Upgrade-Insecure-Requests  \"1\";\n        add_header  X-Content-Type-Options  \"nosniff\";\n        add_header  X-DNS-Prefetch-Control  \"on\";\n        add_header  X-Download-Options  \"noopen\";\n        add_header  X-Frame-Options  \"SAMEORIGIN\";\n        add_header  X-Permitted-Cross-Domain-Policies  \"none\";\n        add_header  X-XSS-Protection  \"1; mode=block\";\nEOF\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/nginx/#abschluss","title":"Abschluss","text":"<p>NGinx kann nun gestartet werden.</p> Bash<pre><code>service nginx start\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/nodejs/","title":"NodeJS","text":""},{"location":"howtos/freebsd/hosting_system/webserver/nodejs/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird um folgende Dienste erweitert.</p> <ul> <li>NodeJS 22.16.0 (NPM, YARN)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/webserver/nodejs/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/webserver/nodejs/#installation","title":"Installation","text":"<p>Wir installieren <code>www/node</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/dns_c-ares\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_c-ares/options\n_OPTIONS_READ=c-ares-1.34.5\n_FILE_COMPLETE_OPTIONS_LIST=STATIC TEST\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/www_node22\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_node22/options\n_OPTIONS_READ=node22-22.16.0\n_FILE_COMPLETE_OPTIONS_LIST=BUNDLED_SSL DOCS JIT\nOPTIONS_FILE_UNSET+=BUNDLED_SSL\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=JIT\n\nEOF\n\n\nportmaster -w -B -g --force-config www/node  -n\n\n\nsysrc node_enable=YES\n</code></pre> <p>Wir installieren <code>www/npm</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>portmaster -w -B -g --force-config www/npm  -n\n</code></pre> <p>Wir installieren <code>www/yarn</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/www_yarn-node22\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_yarn-node22/options\n_OPTIONS_READ=yarn-node22-1.22.19\n_FILE_COMPLETE_OPTIONS_LIST=HADOOPCOMPAT\nOPTIONS_FILE_UNSET+=HADOOPCOMPAT\n\nEOF\n\n\nportmaster -w -B -g --force-config www/yarn  -n\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/","title":"PHP-FPM","text":""},{"location":"howtos/freebsd/hosting_system/webserver/php/#einleitung","title":"Einleitung","text":"<p>Unser Hosting System wird folgende Dienste umfassen.</p> <ul> <li>PHP 8.3.22 (PHP-FPM, Composer, PEAR)</li> </ul>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Hosting System</p>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#installation","title":"Installation","text":"<p>Wir installieren <code>lang/php83</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_php83\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_php83/options\n_OPTIONS_READ=php83-8.3.22\n_FILE_COMPLETE_OPTIONS_LIST=CGI CLI DEBUG EMBED FPM IPV6 LINKTHR MYSQLND NOASLR PCRE PHPDBG ZTS\nOPTIONS_FILE_SET+=CGI\nOPTIONS_FILE_SET+=CLI\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_SET+=EMBED\nOPTIONS_FILE_SET+=FPM\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_SET+=LINKTHR\nOPTIONS_FILE_SET+=MYSQLND\nOPTIONS_FILE_UNSET+=NOASLR\nOPTIONS_FILE_SET+=PCRE\nOPTIONS_FILE_UNSET+=PHPDBG\nOPTIONS_FILE_SET+=ZTS\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/php83  -n\n\n\nsysrc php_fpm_enable=YES\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#php-extensions-installieren","title":"PHP-Extensions installieren","text":"<p>Wir installieren <code>lang/php83-extensions</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/graphics_gd\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_gd/options\n_OPTIONS_READ=libgd-2.3.3\n_FILE_COMPLETE_OPTIONS_LIST=PNG JPEG WEBP TIFF XPM HEIF AVIF LIQ FREETYPE FONTCONFIG RAQM ICONV THREADS\nOPTIONS_FILE_SET+=PNG\nOPTIONS_FILE_SET+=JPEG\nOPTIONS_FILE_SET+=WEBP\nOPTIONS_FILE_SET+=TIFF\nOPTIONS_FILE_UNSET+=XPM\nOPTIONS_FILE_UNSET+=HEIF\nOPTIONS_FILE_UNSET+=AVIF\nOPTIONS_FILE_UNSET+=LIQ\nOPTIONS_FILE_SET+=FREETYPE\nOPTIONS_FILE_SET+=FONTCONFIG\nOPTIONS_FILE_SET+=RAQM\nOPTIONS_FILE_SET+=ICONV\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_jpeg-turbo\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_jpeg-turbo/options\n_OPTIONS_READ=jpeg-turbo-3.1.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_png\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_png/options\n_OPTIONS_READ=png-1.6.49\n_FILE_COMPLETE_OPTIONS_LIST=APNG SIMD\nOPTIONS_FILE_SET+=APNG\nOPTIONS_FILE_UNSET+=SIMD\n\nEOF\n\nmkdir -p /var/db/ports/graphics_tiff\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_tiff/options\n_OPTIONS_READ=tiff-4.7.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_libdeflate\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_libdeflate/options\n_OPTIONS_READ=libdeflate-1.24\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_jbigkit\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_jbigkit/options\n_OPTIONS_READ=jbigkit-2.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/graphics_webp\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_webp/options\n_OPTIONS_READ=webp-1.5.0\n_FILE_COMPLETE_OPTIONS_LIST=IMGCONV X11\nOPTIONS_FILE_SET+=IMGCONV\nOPTIONS_FILE_UNSET+=X11\n\nEOF\n\nmkdir -p /var/db/ports/graphics_giflib\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_giflib/options\n_OPTIONS_READ=giflib-5.2.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/print_freetype2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_freetype2/options\n_OPTIONS_READ=freetype2-2.13.3\n_FILE_COMPLETE_OPTIONS_LIST=BROTLI DEBUG DOCS LONG_PCF_NAMES PNG TABLE_VALIDATION LCD_FILTERING LCD_RENDERING TT_SIZE_METRICS\nOPTIONS_FILE_SET+=BROTLI\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=LONG_PCF_NAMES\nOPTIONS_FILE_SET+=PNG\nOPTIONS_FILE_UNSET+=TABLE_VALIDATION\nOPTIONS_FILE_UNSET+=LCD_FILTERING\nOPTIONS_FILE_SET+=LCD_RENDERING\nOPTIONS_FILE_UNSET+=TT_SIZE_METRICS\n\nEOF\n\nmkdir -p /var/db/ports/print_libraqm\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_libraqm/options\n_OPTIONS_READ=libraqm-0.10.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/converters_fribidi\ncat &lt;&lt;'EOF' &gt; /var/db/ports/converters_fribidi/options\n_OPTIONS_READ=fribidi-1.0.16\n_FILE_COMPLETE_OPTIONS_LIST=OPTIMIZED_CFLAGS TEST\nOPTIONS_FILE_UNSET+=OPTIMIZED_CFLAGS\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/print_harfbuzz\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_harfbuzz/options\n_OPTIONS_READ=harfbuzz-10.3.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_gobject-introspection\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_gobject-introspection/options\n_OPTIONS_READ=gobject-introspection-1.84.0\n_FILE_COMPLETE_OPTIONS_LIST=TEST\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/x11-fonts_fontconfig\ncat &lt;&lt;'EOF' &gt; /var/db/ports/x11-fonts_fontconfig/options\n_OPTIONS_READ=fontconfig-2.15.0\n_FILE_COMPLETE_OPTIONS_LIST=BITMAPS DOCS NLS TEST HINTING_NONE HINTING_SLIGHT HINTING_MEDIUM HINTING_FULL\nOPTIONS_FILE_SET+=BITMAPS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=TEST\nOPTIONS_FILE_UNSET+=HINTING_NONE\nOPTIONS_FILE_SET+=HINTING_SLIGHT\nOPTIONS_FILE_UNSET+=HINTING_MEDIUM\nOPTIONS_FILE_UNSET+=HINTING_FULL\n\nEOF\n\nmkdir -p /var/db/ports/mail_panda-cclient\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_panda-cclient/options\n_OPTIONS_READ=panda-cclient-20130621\n_FILE_COMPLETE_OPTIONS_LIST=IPV6 MBX_DEFAULT SSL SSL_AND_PLAINTEXT\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=MBX_DEFAULT\nOPTIONS_FILE_SET+=SSL\nOPTIONS_FILE_UNSET+=SSL_AND_PLAINTEXT\n\nEOF\n\nmkdir -p /var/db/ports/devel_oniguruma\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_oniguruma/options\n_OPTIONS_READ=oniguruma-6.9.10\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/textproc_enchant2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_enchant2/options\n_OPTIONS_READ=enchant2-2.8.2\n_FILE_COMPLETE_OPTIONS_LIST= ASPELL HSPELL HUNSPELL NUSPELL ZEMBEREK\nOPTIONS_FILE_UNSET+=ASPELL\nOPTIONS_FILE_UNSET+=HSPELL\nOPTIONS_FILE_SET+=HUNSPELL\nOPTIONS_FILE_UNSET+=NUSPELL\nOPTIONS_FILE_UNSET+=ZEMBEREK\n\nEOF\n\nmkdir -p /var/db/ports/databases_php83-dba\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_php83-dba/options\n_OPTIONS_READ=php83-dba-8.3.22\n_FILE_COMPLETE_OPTIONS_LIST=CDB DB4 FLATFILE GDBM INIFILE LMDB QDBM TOKYO\nOPTIONS_FILE_SET+=CDB\nOPTIONS_FILE_UNSET+=DB4\nOPTIONS_FILE_SET+=FLATFILE\nOPTIONS_FILE_UNSET+=GDBM\nOPTIONS_FILE_SET+=INIFILE\nOPTIONS_FILE_SET+=LMDB\nOPTIONS_FILE_UNSET+=QDBM\nOPTIONS_FILE_UNSET+=TOKYO\n\nEOF\n\nmkdir -p /var/db/ports/graphics_php83-gd\ncat &lt;&lt;'EOF' &gt; /var/db/ports/graphics_php83-gd/options\n_OPTIONS_READ=php83-gd-8.3.22\n_FILE_COMPLETE_OPTIONS_LIST=JIS WEBP X11\nOPTIONS_FILE_UNSET+=JIS\nOPTIONS_FILE_SET+=WEBP\nOPTIONS_FILE_UNSET+=X11\n\nEOF\n\nmkdir -p /var/db/ports/mail_php83-imap\ncat &lt;&lt;'EOF' &gt; /var/db/ports/mail_php83-imap/options\n_OPTIONS_READ=php83-imap-8.3.19\n_FILE_COMPLETE_OPTIONS_LIST= CCLIENT PANDA\nOPTIONS_FILE_UNSET+=CCLIENT\nOPTIONS_FILE_SET+=PANDA\n\nEOF\n\nmkdir -p /var/db/ports/converters_php83-mbstring\ncat &lt;&lt;'EOF' &gt; /var/db/ports/converters_php83-mbstring/options\n_OPTIONS_READ=php83-mbstring-8.3.22\n_FILE_COMPLETE_OPTIONS_LIST=REGEX\nOPTIONS_FILE_SET+=REGEX\n\nEOF\n\nmkdir -p /var/db/ports/databases_php83-mysqli\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_php83-mysqli/options\n_OPTIONS_READ=php83-mysqli-8.3.19\n_FILE_COMPLETE_OPTIONS_LIST=MYSQLND\nOPTIONS_FILE_SET+=MYSQLND\n\nEOF\n\nmkdir -p /var/db/ports/databases_php83-pdo_mysql\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_php83-pdo_mysql/options\n_OPTIONS_READ=php83-pdo_mysql-8.3.22\n_FILE_COMPLETE_OPTIONS_LIST=MYSQLND\nOPTIONS_FILE_SET+=MYSQLND\n\nEOF\n\nmkdir -p /var/db/ports/lang_php83-extensions\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_php83-extensions/options\n_OPTIONS_READ=php83-extensions-1.0\n_FILE_COMPLETE_OPTIONS_LIST=BCMATH BZ2 CALENDAR CTYPE CURL DBA DOM ENCHANT EXIF FFI FILEINFO FILTER FTP GD GETTEXT GMP ICONV IMAP INTL LDAP MBSTRING MYSQLI ODBC OPCACHE PCNTL PDO PDO_DBLIB PDO_FIREBIRD PDO_MYSQL PDO_ODBC PDO_PGSQL PDO_SQLITE PGSQL PHAR POSIX PSPELL READLINE SESSION SHMOP SIMPLEXML SNMP SOAP SOCKETS SODIUM SQLITE3 SYSVMSG SYSVSEM SYSVSHM TIDY TOKENIZER XML XMLREADER XMLWRITER XSL ZIP ZLIB\nOPTIONS_FILE_SET+=BCMATH\nOPTIONS_FILE_SET+=BZ2\nOPTIONS_FILE_SET+=CALENDAR\nOPTIONS_FILE_SET+=CTYPE\nOPTIONS_FILE_SET+=CURL\nOPTIONS_FILE_SET+=DBA\nOPTIONS_FILE_SET+=DOM\nOPTIONS_FILE_SET+=ENCHANT\nOPTIONS_FILE_SET+=EXIF\nOPTIONS_FILE_SET+=FFI\nOPTIONS_FILE_SET+=FILEINFO\nOPTIONS_FILE_SET+=FILTER\nOPTIONS_FILE_SET+=FTP\nOPTIONS_FILE_SET+=GD\nOPTIONS_FILE_SET+=GETTEXT\nOPTIONS_FILE_SET+=GMP\nOPTIONS_FILE_SET+=ICONV\nOPTIONS_FILE_SET+=IMAP\nOPTIONS_FILE_SET+=INTL\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=MBSTRING\nOPTIONS_FILE_SET+=MYSQLI\nOPTIONS_FILE_UNSET+=ODBC\nOPTIONS_FILE_SET+=OPCACHE\nOPTIONS_FILE_SET+=PCNTL\nOPTIONS_FILE_SET+=PDO\nOPTIONS_FILE_UNSET+=PDO_DBLIB\nOPTIONS_FILE_UNSET+=PDO_FIREBIRD\nOPTIONS_FILE_SET+=PDO_MYSQL\nOPTIONS_FILE_UNSET+=PDO_ODBC\nOPTIONS_FILE_SET+=PDO_PGSQL\nOPTIONS_FILE_SET+=PDO_SQLITE\nOPTIONS_FILE_SET+=PGSQL\nOPTIONS_FILE_SET+=PHAR\nOPTIONS_FILE_SET+=POSIX\nOPTIONS_FILE_UNSET+=PSPELL\nOPTIONS_FILE_SET+=READLINE\nOPTIONS_FILE_SET+=SESSION\nOPTIONS_FILE_SET+=SHMOP\nOPTIONS_FILE_SET+=SIMPLEXML\nOPTIONS_FILE_UNSET+=SNMP\nOPTIONS_FILE_SET+=SOAP\nOPTIONS_FILE_SET+=SOCKETS\nOPTIONS_FILE_SET+=SODIUM\nOPTIONS_FILE_SET+=SQLITE3\nOPTIONS_FILE_SET+=SYSVMSG\nOPTIONS_FILE_SET+=SYSVSEM\nOPTIONS_FILE_SET+=SYSVSHM\nOPTIONS_FILE_UNSET+=TIDY\nOPTIONS_FILE_SET+=TOKENIZER\nOPTIONS_FILE_SET+=XML\nOPTIONS_FILE_SET+=XMLREADER\nOPTIONS_FILE_SET+=XMLWRITER\nOPTIONS_FILE_SET+=XSL\nOPTIONS_FILE_SET+=ZIP\nOPTIONS_FILE_SET+=ZLIB\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/php83-extensions  -n\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#konfiguration","title":"Konfiguration","text":"<p>Die Konfiguration entspricht weitestgehend den Empfehlungen der PHP-Entwickler und ist sowohl auf Security als auch auf Performance getrimmt.</p> <p><code>php.ini</code> einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/php.ini\narg_separator.input = \";&amp;\"\narg_separator.output = \"&amp;amp;\"\nassert.active = \"0\"\ncli_server.color = \"1\"\ncurl.cainfo = \"/usr/local/share/certs/ca-root-nss.crt\"\ndate.default_latitude = \"53.5500\"\ndate.default_longitude = \"10.0000\"\ndate.timezone = \"Europe/Berlin\"\ndisplay_errors = \"0\"\ndisplay_startup_errors = \"0\"\nenable_dl = \"0\"\nerror_log = \"/var/log/php_error.log\"\nerror_reporting = \"E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT\"\nexif.encode_jis = \"UTF-8\"\nexif.encode_unicode = \"UTF-8\"\nexpose_php = \"0\"\nfrom = \"anonymous@example.com\"\nhtml_errors = \"0\"\niconv.input_encoding = \"UTF-8\"\niconv.output_encoding = \"UTF-8\"\niconv.internal_encoding = \"UTF-8\"\ninput_encoding = \"UTF-8\"\ninternal_encoding = \"UTF-8\"\nlog_errors = \"1\"\nmail.add_x_header = \"1\"\nmail.log = \"/var/log/php_sendmail.log\"\nmax_execution_time = \"60\"\nmax_input_time = \"60\"\nmbstring.detect_order = \"auto\"\nmbstring.strict_detection = \"1\"\nmemory_limit = \"512M\"\nopcache.enable_cli = \"1\"\nopcache.enable_file_override = \"1\"\nopcache.error_log = \"/var/log/php_opcache.log\"\nopcache.interned_strings_buffer = \"16\"\nopcache.log_verbosity_level = \"2\"\nopcache.max_accelerated_files = \"32768\"\nopcache.revalidate_freq = \"60\"\nopcache.revalidate_path = \"1\"\nopenssl.cafile = \"/usr/local/share/certs/ca-root-nss.crt\"\noutput_buffering = \"4096\"\noutput_encoding = \"UTF-8\"\npcre.backtrack_limit = \"8000000\"\npdo_mysql.cache_size = \"2000\"\npost_max_size = \"511M\"\nregister_argc_argv = \"0\"\nrequest_order = \"GP\"\nsession.cookie_httponly = \"1\"\nsession.cookie_samesite = \"Strict\"\nsession.cookie_secure = \"1\"\nsession.gc_divisor = \"1000\"\nsession.save_path = \"/data/www/tmp\"\nsession.sid_bits_per_character = \"6\"\nsession.sid_length = \"48\"\nsession.use_strict_mode = \"1\"\nshort_open_tag = \"0\"\nsoap.wsdl_cache_dir = \"/data/www/tmp\"\nsys_temp_dir = \"/data/www/tmp\"\nupload_max_filesize = \"511M\"\nupload_tmp_dir = \"/data/www/tmp\"\nurl_rewriter.tags = \"a=href,area=href,frame=src,form=fakeentry,input=src\"\nuser_ini.filename = None\nvariables_order = \"GPCS\"\nzend.assertions = \"-1\"\nzend.multibyte = \"1\"\nzend.script_encoding = \"UTF-8\"\n\nEOF\n</code></pre> <p><code>php-fpm.conf</code> einrichten.</p> Bash<pre><code>sed -e 's|^;[[:space:]]*\\(events.mechanism =\\).*$|;\\1 kqueue|' \\\n    /usr/local/etc/php-fpm.conf.default &gt; /usr/local/etc/php-fpm.conf\n</code></pre> <p><code>php-fpm.d/www.conf</code> einrichten.</p> Bash<pre><code>sed -e 's|^\\(listen =\\).*$|\\1 /var/run/fpm_www.sock|' \\\n    -e 's|^;\\(listen.owner =\\).*$|\\1 www|' \\\n    -e 's|^;\\(listen.group =\\).*$|\\1 www|' \\\n    -e 's|^;\\(listen.mode =\\).*$|\\1 0660|' \\\n    -e 's|^\\(pm.max_children =\\).*$|\\1 128|' \\\n    -e 's|^\\(pm.start_servers =\\).*$|\\1 16|' \\\n    -e 's|^\\(pm.min_spare_servers =\\).*$|\\1 4|' \\\n    -e 's|^\\(pm.max_spare_servers =\\).*$|\\1 16|' \\\n    -e 's|^;\\(pm.max_requests =\\).*$|\\1 500|' \\\n    /usr/local/etc/php-fpm.d/www.conf.default &gt; /usr/local/etc/php-fpm.d/www.conf\n</code></pre> <p>Abschliessende Arbeiten.</p> Bash<pre><code>touch /var/log/php_error.log\nchmod 0664 /var/log/php_error.log\nchown root:www /var/log/php_error.log\ntouch /var/log/php_opcache.log\nchmod 0664 /var/log/php_opcache.log\nchown root:www /var/log/php_opcache.log\ntouch /var/log/php_sendmail.log\nchmod 0664 /var/log/php_sendmail.log\nchown root:www /var/log/php_sendmail.log\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#php-composer-installieren","title":"PHP Composer installieren","text":"<p>Wir installieren <code>devel/php-composer</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_php-composer\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_php-composer/options\n_OPTIONS_READ=php83-composer-2.8.9\n_FILE_COMPLETE_OPTIONS_LIST=CURL\nOPTIONS_FILE_SET+=CURL\n\nEOF\n\n\nportmaster -w -B -g --force-config devel/php-composer  -n\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#php-pear-installieren","title":"PHP-PEAR installieren","text":"<p>Wir installieren <code>devel/pear</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_pear\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_pear/options\n_OPTIONS_READ=php83-pear-1.10.13\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\n\nportmaster -w -B -g --force-config devel/pear  -n\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#php-pecl-yaml-installieren","title":"PHP-PECL-YAML installieren","text":"<p>Wir installieren <code>textproc/pecl-yaml</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>portmaster -w -B -g --force-config textproc/pecl-yaml  -n\n</code></pre>"},{"location":"howtos/freebsd/hosting_system/webserver/php/#abschluss","title":"Abschluss","text":"<p>PHP-FPM kann nun gestartet werden.</p> Bash<pre><code>service php-fpm start\n</code></pre>"},{"location":"howtos/freebsd/remote_install/baseports/","title":"BasePorts","text":""},{"location":"howtos/freebsd/remote_install/baseports/#einleitung","title":"Einleitung","text":"<p>In diesem HowTo beschreibe ich step-by-step die Installation einiger Ports (Packages / Pakete) welche auf keinem FreeBSD 64Bit BaseSystem auf einem dedizierten Server fehlen sollten.</p> <p>Unsere BasePorts werden am Ende folgende Dienste umfassen.</p> <ul> <li>Portmaster 3.30</li> <li>Perl 5.40.2</li> <li>OpenSSL 3.5.0</li> <li>LUA 5.4.7</li> <li>TCL 8.6.16</li> <li>Python 3.11.13</li> <li>Bash 5.2.37</li> <li>cURL 8.14.1</li> <li>LLVM 19.1.7</li> <li>Rust 1.87.0</li> <li>Ruby 3.3.8</li> <li>Go 1.24.4</li> </ul>"},{"location":"howtos/freebsd/remote_install/baseports/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Remote Installation</p>"},{"location":"howtos/freebsd/remote_install/baseports/#einloggen-und-zu-root-werden","title":"Einloggen und zu <code>root</code> werden","text":"PowerShell<pre><code>putty -ssh -P 2222 -i \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\\ssh\\id_ed25519.ppk\" admin@127.0.0.1\n</code></pre> Bash<pre><code>su - root\n</code></pre>"},{"location":"howtos/freebsd/remote_install/baseports/#software-installieren","title":"Software installieren","text":"Important <p>An diesem Punkt m\u00fcssen wir uns entscheiden, ob wir die Pakete/Ports in Zukunft bequem als vorkompiliertes</p> <p>Binary-Paket per <code>pkg install &lt;category/portname&gt;</code> mit den Default-Optionen installieren wollen oder ob wir die Optionen und somit auch den Funktionsumfang beziehungsweise die Features unserer Pakete/Ports selbst bestimmen wollen.</p> <p>In diesem HowTo werden wir uns f\u00fcr die zweite Variante entscheiden, da uns dies viele Probleme durch unn\u00f6tige oder fehlende Features und Abh\u00e4ngigkeiten ersparen wird. Andererseits verlieren wir dadurch den Komfort von <code>pkg</code> bei der Installation und den Updates der Pakete/Ports. Ebenso m\u00fcssen wir zwangsweise f\u00fcr alle Pakete/Ports die gew\u00fcnschten Optionen manuell setzen und die Pakete/Ports auch selbst kompilieren.</p> <p>Dieses Vorgehen ist deutlich zeitaufwendiger und erfordert auch etwas mehr Wissen \u00fcber die jeweiligen Pakete/Ports und deren Features, daf\u00fcr entsch\u00e4digt es uns aber mit einem schlankeren, schnelleren und stabileren System und bietet uns gegebenenfalls n\u00fctzliche/erforderliche zus\u00e4tzliche Funktionen und Sicherheitsfeatures. Auch die potentielle Gefahr f\u00fcr Sicherheitsl\u00fccken sinkt dadurch, da wir unn\u00fctze Pakete/Ports gar nicht erst als Abh\u00e4ngigkeiten mitinstallieren m\u00fcssen.</p> <p>Wir deaktivieren also zuerst das Default-Repository von <code>pkg</code>, um versehentlichen Installationen von Binary-Paketen durch <code>pkg</code> vorzubeugen.</p> Bash<pre><code>mkdir -p /usr/local/etc/pkg/repos\nsed -e 's|quarterly|latest|' /etc/pkg/FreeBSD.conf &gt; /usr/local/etc/pkg/repos/FreeBSD.conf\nsed -e 's|\\(enabled:\\)[[:space:]]*yes|\\1 no|g' -i '' /usr/local/etc/pkg/repos/FreeBSD.conf\n</code></pre> <p>So ganz ohne komfortable Tools ist das Basis-System etwas m\u00fchselig zu administrieren. Deshalb werden wir aus den Ports nun ein paar etwas h\u00e4ufiger ben\u00f6tigte Anwendungen installiert.</p> <p>Die von uns jeweils gew\u00fcnschten Build-Optionen der Ports legen wir dabei mittels der <code>options</code>-Files des Portkonfigurationsframeworks <code>OptionsNG</code> fest.</p> <p>Dieser Cronjob pr\u00fcft t\u00e4glich um 7:00 Uhr ob es Updates f\u00fcr die installierten Pakete gibt und ob darin gegebenenfalls wichtige Sicherheitsupdates enthalten sind. Das Ergebnis wird automatisch per Mail an <code>root</code> (siehe <code>/etc/mail/aliases</code>) gesendet.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt;&gt; /etc/crontab\n0       7       *       *       *       root    /usr/local/bin/git -C /usr/ports pull --rebase --quiet &amp;&amp; /usr/bin/make -C /usr/ports fetchindex &amp;&amp; /usr/local/sbin/pkg version -vIL= &amp;&amp; /usr/local/sbin/pkg audit -F\nEOF\n</code></pre> <p>Wir installieren <code>ports-mgmt/pkg</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/ports-mgmt_pkg\ncat &lt;&lt;'EOF' &gt; /var/db/ports/ports-mgmt_pkg/options\n_OPTIONS_READ=pkg-2.2.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmake -C /usr/ports/ports-mgmt/pkg/ all install clean-depends clean\n</code></pre> <p>Wir installieren <code>ports-mgmt/portmaster</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/ports-mgmt_portmaster\ncat &lt;&lt;'EOF' &gt; /var/db/ports/ports-mgmt_portmaster/options\n_OPTIONS_READ=portmaster-3.30\n_FILE_COMPLETE_OPTIONS_LIST=BASH ZSH\nOPTIONS_FILE_SET+=BASH\nOPTIONS_FILE_SET+=ZSH\n\nEOF\n\nmake -C /usr/ports/ports-mgmt/portmaster/ all install clean-depends clean\n</code></pre> <p>Wir installieren <code>ports-mgmt/pkg</code> und <code>ports-mgmt/portmaster</code> und ihre Abh\u00e4ngigkeiten mittels <code>portmaster</code> erneut.</p> Bash<pre><code>portmaster -w -b -g --force-config ports-mgmt/pkg\nportmaster -w -b -g --force-config ports-mgmt/portconfig\nportmaster -w -b -g --force-config ports-mgmt/portmaster\n</code></pre> <p>Wir installieren <code>lang/perl5.40</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_perl5.40\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_perl5.40/options\n_OPTIONS_READ=perl5-5.40.2\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG DOT_INC GDBM MULTIPLICITY PERL_64BITINT PERL_MALLOC SITECUSTOMIZE THREADS\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOT_INC\nOPTIONS_FILE_UNSET+=GDBM\nOPTIONS_FILE_SET+=MULTIPLICITY\nOPTIONS_FILE_SET+=PERL_64BITINT\nOPTIONS_FILE_UNSET+=PERL_MALLOC\nOPTIONS_FILE_UNSET+=SITECUSTOMIZE\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/perl5.40  -n\n</code></pre> <p>Wir installieren <code>security/openssl35</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt;&gt; /etc/make.conf\nDEFAULT_VERSIONS+=ssl=openssl35\nEOF\n\n\nmkdir -p /var/db/ports/security_openssl35\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_openssl35/options\n_OPTIONS_READ=openssl35-3.5.0\n_FILE_COMPLETE_OPTIONS_LIST=ASYNC CT FIPS-JITTER KTLS MAN3 RFC3779 SHARED ARIA DES GOST IDEA SM4 RC2 RC4 RC5 TLS-DEPRECATED-EC WEAK-SSL-CIPHERS BROTLI ZLIB ZSTD MD2 MD4 MDC2 RMD160 SM2 SM3 FIPS LEGACY ASM SSE2 THREADS THREADPOOL ML-DSA ML-KEM SLH-DSA NEXTPROTONEG QUIC SCTP SSL3 TLS1 TLS1_1 TLS1_2\nOPTIONS_FILE_SET+=ASYNC\nOPTIONS_FILE_SET+=CT\nOPTIONS_FILE_UNSET+=FIPS-JITTER\nOPTIONS_FILE_UNSET+=KTLS\nOPTIONS_FILE_SET+=MAN3\nOPTIONS_FILE_SET+=RFC3779\nOPTIONS_FILE_SET+=SHARED\nOPTIONS_FILE_UNSET+=ARIA\nOPTIONS_FILE_SET+=DES\nOPTIONS_FILE_SET+=GOST\nOPTIONS_FILE_UNSET+=IDEA\nOPTIONS_FILE_UNSET+=SM4\nOPTIONS_FILE_SET+=RC2\nOPTIONS_FILE_SET+=RC4\nOPTIONS_FILE_UNSET+=RC5\nOPTIONS_FILE_UNSET+=TLS-DEPRECATED-EC\nOPTIONS_FILE_UNSET+=WEAK-SSL-CIPHERS\nOPTIONS_FILE_UNSET+=BROTLI\nOPTIONS_FILE_UNSET+=ZLIB\nOPTIONS_FILE_UNSET+=ZSTD\nOPTIONS_FILE_UNSET+=MD2\nOPTIONS_FILE_SET+=MD4\nOPTIONS_FILE_UNSET+=MDC2\nOPTIONS_FILE_SET+=RMD160\nOPTIONS_FILE_UNSET+=SM2\nOPTIONS_FILE_UNSET+=SM3\nOPTIONS_FILE_SET+=FIPS\nOPTIONS_FILE_UNSET+=LEGACY\nOPTIONS_FILE_SET+=ASM\nOPTIONS_FILE_SET+=SSE2\nOPTIONS_FILE_SET+=THREADS\nOPTIONS_FILE_SET+=THREADPOOL\nOPTIONS_FILE_SET+=ML-DSA\nOPTIONS_FILE_SET+=ML-KEM\nOPTIONS_FILE_SET+=SLH-DSA\nOPTIONS_FILE_SET+=NEXTPROTONEG\nOPTIONS_FILE_SET+=QUIC\nOPTIONS_FILE_SET+=SCTP\nOPTIONS_FILE_UNSET+=SSL3\nOPTIONS_FILE_SET+=TLS1\nOPTIONS_FILE_SET+=TLS1_1\nOPTIONS_FILE_SET+=TLS1_2\n\nEOF\n\n\nportmaster -w -B -g --force-config security/openssl35  -n\n</code></pre> <p>Wir installieren <code>security/ca_root_nss</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/security_ca_root_nss\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_ca_root_nss/options\n_OPTIONS_READ=ca_root_nss-3.108\n_FILE_COMPLETE_OPTIONS_LIST=ETCSYMLINK\nOPTIONS_FILE_SET+=ETCSYMLINK\n\nEOF\n\n\nportmaster -w -B -g --force-config security/ca_root_nss  -n\n</code></pre> <p>Wir installieren <code>devel/pcre2</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_autoconf\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_autoconf/options\n_OPTIONS_READ=autoconf-2.72\n_FILE_COMPLETE_OPTIONS_LIST=INFO\nOPTIONS_FILE_UNSET+=INFO\n\nEOF\n\nmkdir -p /var/db/ports/devel_m4\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_m4/options\n_OPTIONS_READ=m4-1.4.19\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES INFO LIBSIGSEGV NLS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_UNSET+=INFO\nOPTIONS_FILE_UNSET+=LIBSIGSEGV\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/devel_gettext-runtime\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_gettext-runtime/options\n_OPTIONS_READ=gettext-runtime-0.23.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_gettext-tools\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_gettext-tools/options\n_OPTIONS_READ=gettext-tools-0.23.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES THREADS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\nmkdir -p /var/db/ports/devel_libtextstyle\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_libtextstyle/options\n_OPTIONS_READ=libtextstyle-0.23.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_automake\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_automake/options\n_OPTIONS_READ=automake-1.17\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_gmake\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_gmake/options\n_OPTIONS_READ=gmake-4.4.1\n_FILE_COMPLETE_OPTIONS_LIST=NLS\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/devel_pkgconf\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_pkgconf/options\n_OPTIONS_READ=pkgconf-2.4.3\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_pcre2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_pcre2/options\n_OPTIONS_READ=pcre2-10.45\n_FILE_COMPLETE_OPTIONS_LIST=DOCS LIBBZ2 LIBZ LIBEDIT READLINE\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=LIBBZ2\nOPTIONS_FILE_SET+=LIBZ\nOPTIONS_FILE_SET+=LIBEDIT\nOPTIONS_FILE_UNSET+=READLINE\n\nEOF\n\n\nportmaster -w -B -g --force-config devel/pcre2  -n\n</code></pre> <p>Wir installieren <code>lang/lua54</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_lua54\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_lua54/options\n_OPTIONS_READ=lua54-5.4.7\n_FILE_COMPLETE_OPTIONS_LIST= EDITNONE LIBEDIT_DL LIBEDIT READLINE DOCS ASSERT APICHECK\nOPTIONS_FILE_UNSET+=EDITNONE\nOPTIONS_FILE_SET+=LIBEDIT_DL\nOPTIONS_FILE_UNSET+=LIBEDIT\nOPTIONS_FILE_UNSET+=READLINE\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=ASSERT\nOPTIONS_FILE_UNSET+=APICHECK\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/lua54  -n\n</code></pre> <p>Wir installieren <code>lang/tcl86</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_tcl86\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_tcl86/options\n_OPTIONS_READ=tcl86-8.6.16\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG TCLMAN THREADS TZDATA\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_SET+=TCLMAN\nOPTIONS_FILE_SET+=THREADS\nOPTIONS_FILE_SET+=TZDATA\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/tcl86  -n\n</code></pre> <p>Wir installieren <code>lang/python</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_readline\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_readline/options\n_OPTIONS_READ=readline-8.2.13\n_FILE_COMPLETE_OPTIONS_LIST=BRACKETEDPASTE DOCS\nOPTIONS_FILE_SET+=BRACKETEDPASTE\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/math_mpdecimal\ncat &lt;&lt;'EOF' &gt; /var/db/ports/math_mpdecimal/options\n_OPTIONS_READ=mpdecimal-4.0.0\n_FILE_COMPLETE_OPTIONS_LIST=OPTIONS_FILE_UNSET+=%2\nOPTIONS_FILE_UNSET+=OPTIONS_FILE_UNSET+=%2\n\nEOF\n\nmkdir -p /var/db/ports/lang_python311\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_python311/options\n_OPTIONS_READ=python311-3.11.13\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG IPV6 LIBMPDEC LTO NLS PYMALLOC FNV SIPHASH\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_SET+=LIBMPDEC\nOPTIONS_FILE_UNSET+=LTO\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_SET+=PYMALLOC\nOPTIONS_FILE_UNSET+=FNV\nOPTIONS_FILE_UNSET+=SIPHASH\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/python  -n\n</code></pre> <p>Wir installieren <code>devel/py-pip</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_py-pip\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_py-pip/options\n_OPTIONS_READ=py311-pip-23.3.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nportmaster -w -B -g --force-config devel/py-pip  -n\n</code></pre> <p>Wir installieren <code>devel/re2c</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_cmake-core\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_cmake-core/options\n_OPTIONS_READ=cmake-core-3.31.7\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_ninja\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_ninja/options\n_OPTIONS_READ=ninja-1.11.1\n_FILE_COMPLETE_OPTIONS_LIST=BASH DOCS ZSH\nOPTIONS_FILE_SET+=BASH\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=ZSH\n\nEOF\n\nmkdir -p /var/db/ports/devel_libunistring\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_libunistring/options\n_OPTIONS_READ=libunistring-1.3\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/misc_help2man\ncat &lt;&lt;'EOF' &gt; /var/db/ports/misc_help2man/options\n_OPTIONS_READ=help2man-1.49.3\n_FILE_COMPLETE_OPTIONS_LIST=NLS\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/print_texinfo\ncat &lt;&lt;'EOF' &gt; /var/db/ports/print_texinfo/options\n_OPTIONS_READ=texinfo-7.1\n_FILE_COMPLETE_OPTIONS_LIST=NLS\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/converters_libiconv\ncat &lt;&lt;'EOF' &gt; /var/db/ports/converters_libiconv/options\n_OPTIONS_READ=libiconv-1.17\n_FILE_COMPLETE_OPTIONS_LIST=DOCS ENCODINGS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=ENCODINGS\n\nEOF\n\nmkdir -p /var/db/ports/devel_p5-Locale-libintl\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_p5-Locale-libintl/options\n_OPTIONS_READ=p5-Locale-libintl-1.35\n_FILE_COMPLETE_OPTIONS_LIST=NLS\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/security_rhash\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_rhash/options\n_OPTIONS_READ=rhash-1.4.4\n_FILE_COMPLETE_OPTIONS_LIST=DOCS NLS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/textproc_expat2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_expat2/options\n_OPTIONS_READ=expat-2.7.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS STATIC TEST\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/devel_re2c\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_re2c/options\n_OPTIONS_READ=re2c-4.1\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nportmaster -w -B -g --force-config devel/re2c  -n\n</code></pre> <p>Wir installieren <code>shells/bash</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_bison\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_bison/options\n_OPTIONS_READ=bison-3.8.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES NLS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/shells_bash\ncat &lt;&lt;'EOF' &gt; /var/db/ports/shells_bash/options\n_OPTIONS_READ=bash-5.2.37\n_FILE_COMPLETE_OPTIONS_LIST=DOCS FDESCFS HELP NLS PORTS_READLINE STATIC SYSBASHRC SYSLOG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=FDESCFS\nOPTIONS_FILE_SET+=HELP\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_SET+=PORTS_READLINE\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_UNSET+=SYSBASHRC\nOPTIONS_FILE_UNSET+=SYSLOG\n\nEOF\n\n\nportmaster -w -B -g --force-config shells/bash  -n\n</code></pre> <p>Wir installieren <code>ftp/curl</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/archivers_brotli\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_brotli/options\n_OPTIONS_READ=brotli-1.1.0\n_FILE_COMPLETE_OPTIONS_LIST=STATIC\nOPTIONS_FILE_UNSET+=STATIC\n\nEOF\n\nmkdir -p /var/db/ports/archivers_zstd\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_zstd/options\n_OPTIONS_READ=zstd-1.5.7\n_FILE_COMPLETE_OPTIONS_LIST=OPTIMIZED_CFLAGS\nOPTIONS_FILE_UNSET+=OPTIMIZED_CFLAGS\n\nEOF\n\nmkdir -p /var/db/ports/archivers_liblz4\ncat &lt;&lt;'EOF' &gt; /var/db/ports/archivers_liblz4/options\n_OPTIONS_READ=liblz4-1.10.0\n_FILE_COMPLETE_OPTIONS_LIST=TEST\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/security_libssh2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_libssh2/options\n_OPTIONS_READ=libssh2-1.11.1\n_FILE_COMPLETE_OPTIONS_LIST=STATIC TRACE GCRYPT OPENSSL\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_UNSET+=TRACE\nOPTIONS_FILE_UNSET+=GCRYPT\nOPTIONS_FILE_SET+=OPENSSL\n\nEOF\n\nmkdir -p /var/db/ports/dns_libpsl\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_libpsl/options\n_OPTIONS_READ=libpsl-0.21.5\n_FILE_COMPLETE_OPTIONS_LIST= ICU IDN IDN2\nOPTIONS_FILE_SET+=ICU\nOPTIONS_FILE_UNSET+=IDN\nOPTIONS_FILE_UNSET+=IDN2\n\nEOF\n\nmkdir -p /var/db/ports/ftp_curl\ncat &lt;&lt;'EOF' &gt; /var/db/ports/ftp_curl/options\n_OPTIONS_READ=curl-8.14.1\n_FILE_COMPLETE_OPTIONS_LIST=ALTSVC COOKIES CURL_DEBUG DEBUG DOCS EXAMPLES IDN IPV6 LIBUV NTLM PROXY PSL STATIC TLS_SRP GSSAPI_BASE GSSAPI_HEIMDAL GSSAPI_MIT GSSAPI_NONE CARES THREADED_RESOLVER GNUTLS OPENSSL WOLFSSL BROTLI ZSTD DICT FTP GOPHER HTTP HTTP2 IMAP IPFS LDAP LDAPS LIBSSH LIBSSH2 MQTT POP3 RTSP SMB SMTP TELNET TFTP WEBSOCKET\nOPTIONS_FILE_SET+=ALTSVC\nOPTIONS_FILE_SET+=COOKIES\nOPTIONS_FILE_UNSET+=CURL_DEBUG\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=IDN\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=LIBUV\nOPTIONS_FILE_UNSET+=NTLM\nOPTIONS_FILE_SET+=PROXY\nOPTIONS_FILE_SET+=PSL\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_SET+=TLS_SRP\nOPTIONS_FILE_UNSET+=GSSAPI_BASE\nOPTIONS_FILE_UNSET+=GSSAPI_HEIMDAL\nOPTIONS_FILE_UNSET+=GSSAPI_MIT\nOPTIONS_FILE_SET+=GSSAPI_NONE\nOPTIONS_FILE_UNSET+=CARES\nOPTIONS_FILE_SET+=THREADED_RESOLVER\nOPTIONS_FILE_UNSET+=GNUTLS\nOPTIONS_FILE_SET+=OPENSSL\nOPTIONS_FILE_UNSET+=WOLFSSL\nOPTIONS_FILE_SET+=BROTLI\nOPTIONS_FILE_SET+=ZSTD\nOPTIONS_FILE_SET+=DICT\nOPTIONS_FILE_SET+=FTP\nOPTIONS_FILE_SET+=GOPHER\nOPTIONS_FILE_SET+=HTTP\nOPTIONS_FILE_SET+=HTTP2\nOPTIONS_FILE_SET+=IMAP\nOPTIONS_FILE_SET+=IPFS\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_UNSET+=LDAPS\nOPTIONS_FILE_UNSET+=LIBSSH\nOPTIONS_FILE_SET+=LIBSSH2\nOPTIONS_FILE_UNSET+=MQTT\nOPTIONS_FILE_SET+=POP3\nOPTIONS_FILE_SET+=RTSP\nOPTIONS_FILE_UNSET+=SMB\nOPTIONS_FILE_SET+=SMTP\nOPTIONS_FILE_SET+=TELNET\nOPTIONS_FILE_SET+=TFTP\nOPTIONS_FILE_SET+=WEBSOCKET\n\nEOF\n\n\nportmaster -w -B -g --force-config ftp/curl  -n\n</code></pre> <p>Wir installieren <code>devel/llvm</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_binutils\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_binutils/options\n_OPTIONS_READ=binutils-2.44\n_FILE_COMPLETE_OPTIONS_LIST=ELFU INFO RELRO\nOPTIONS_FILE_UNSET+=ELFU\nOPTIONS_FILE_UNSET+=INFO\nOPTIONS_FILE_UNSET+=RELRO\n\nEOF\n\nmkdir -p /var/db/ports/math_gmp\ncat &lt;&lt;'EOF' &gt; /var/db/ports/math_gmp/options\n_OPTIONS_READ=gmp-6.3.0\n_FILE_COMPLETE_OPTIONS_LIST=CPU_OPTS INFO\nOPTIONS_FILE_UNSET+=CPU_OPTS\nOPTIONS_FILE_UNSET+=INFO\n\nEOF\n\nmkdir -p /var/db/ports/math_mpfr\ncat &lt;&lt;'EOF' &gt; /var/db/ports/math_mpfr/options\n_OPTIONS_READ=mpfr-4.2.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS INFO\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=INFO\n\nEOF\n\nmkdir -p /var/db/ports/lang_lua53\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_lua53/options\n_OPTIONS_READ=lua53-5.3.6\n_FILE_COMPLETE_OPTIONS_LIST= EDITNONE LIBEDIT_DL LIBEDIT READLINE DOCS ASSERT APICHECK\nOPTIONS_FILE_UNSET+=EDITNONE\nOPTIONS_FILE_SET+=LIBEDIT_DL\nOPTIONS_FILE_UNSET+=LIBEDIT\nOPTIONS_FILE_UNSET+=READLINE\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=ASSERT\nOPTIONS_FILE_UNSET+=APICHECK\n\nEOF\n\nmkdir -p /var/db/ports/devel_llvm19\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_llvm19/options\n_OPTIONS_READ=llvm19-19.1.7\n_FILE_COMPLETE_OPTIONS_LIST=BE_AMDGPU BE_WASM CLANG COMPILER_RT DOCS EXTRAS FLANG LIT LLD LLDB MLIR OPENMP POLLY PYCLANG STATIC_LIBS BE_FREEBSD BE_NATIVE BE_STANDARD\nOPTIONS_FILE_SET+=BE_AMDGPU\nOPTIONS_FILE_SET+=BE_WASM\nOPTIONS_FILE_SET+=CLANG\nOPTIONS_FILE_SET+=COMPILER_RT\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=EXTRAS\nOPTIONS_FILE_UNSET+=FLANG\nOPTIONS_FILE_SET+=LIT\nOPTIONS_FILE_SET+=LLD\nOPTIONS_FILE_SET+=LLDB\nOPTIONS_FILE_SET+=MLIR\nOPTIONS_FILE_SET+=OPENMP\nOPTIONS_FILE_SET+=POLLY\nOPTIONS_FILE_SET+=PYCLANG\nOPTIONS_FILE_SET+=STATIC_LIBS\nOPTIONS_FILE_UNSET+=BE_FREEBSD\nOPTIONS_FILE_SET+=BE_NATIVE\nOPTIONS_FILE_UNSET+=BE_STANDARD\n\nEOF\n\nmkdir -p /var/db/ports/devel_llvm\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_llvm/options\n_OPTIONS_READ=llvm-19\n_FILE_COMPLETE_OPTIONS_LIST=CLANG EXTRAS LIT LLD LLDB\nOPTIONS_FILE_SET+=CLANG\nOPTIONS_FILE_SET+=EXTRAS\nOPTIONS_FILE_SET+=LIT\nOPTIONS_FILE_SET+=LLD\nOPTIONS_FILE_SET+=LLDB\n\nEOF\n\nportmaster -w -B -g --force-config devel/llvm  -n\n</code></pre> <p>Wir installieren <code>lang/rust</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_rust\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_rust/options\n_OPTIONS_READ=rust-1.87.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS GDB LTO PORT_LLVM SOURCES WASM\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=GDB\nOPTIONS_FILE_UNSET+=LTO\nOPTIONS_FILE_UNSET+=PORT_LLVM\nOPTIONS_FILE_SET+=SOURCES\nOPTIONS_FILE_SET+=WASM\n\nEOF\n\nportmaster -w -B -g --force-config lang/rust  -n\n</code></pre> <p>Wir installieren <code>lang/ruby33</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_ruby33\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_ruby33/options\n_OPTIONS_READ=ruby-3.3.8\n_FILE_COMPLETE_OPTIONS_LIST=CAPIDOCS DEBUG DOCS EXAMPLES GMP RDOC YJIT\nOPTIONS_FILE_UNSET+=CAPIDOCS\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=GMP\nOPTIONS_FILE_UNSET+=RDOC\nOPTIONS_FILE_UNSET+=YJIT\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/ruby33  -n\n</code></pre> <p>Wir installieren <code>devel/ruby-gems</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_ruby-gems\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_ruby-gems/options\n_OPTIONS_READ=ruby33-gems-3.6.9\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\n\nportmaster -w -B -g --force-config devel/ruby-gems  -n\n</code></pre> <p>Wir installieren <code>sysutils/rubygem-bundler</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>portmaster -w -B -g --force-config sysutils/rubygem-bundler  -n\n</code></pre> <p>Wir installieren <code>lang/go</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/lang_go124\ncat &lt;&lt;'EOF' &gt; /var/db/ports/lang_go124/options\n_OPTIONS_READ=go124-1.24.4\n_FILE_COMPLETE_OPTIONS_LIST= V1 V2 V3 V4\nOPTIONS_FILE_SET+=V1\nOPTIONS_FILE_UNSET+=V2\nOPTIONS_FILE_UNSET+=V3\nOPTIONS_FILE_UNSET+=V4\n\nEOF\n\n\nportmaster -w -B -g --force-config lang/go  -n\n</code></pre> <p>Wir installieren <code>sysutils/cpu-microcode</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/sysutils_cpu-microcode-intel\ncat &lt;&lt;'EOF' &gt; /var/db/ports/sysutils_cpu-microcode-intel/options\n_OPTIONS_READ=cpu-microcode-intel-20250512\n_FILE_COMPLETE_OPTIONS_LIST=RC SPLIT\nOPTIONS_FILE_SET+=RC\nOPTIONS_FILE_SET+=SPLIT\n\nEOF\n\n\nportmaster -w -B -g --force-config sysutils/cpu-microcode  -n\n\n\nsysrc microcode_update_enable=YES\n</code></pre>"},{"location":"howtos/freebsd/remote_install/baseports/#wie-geht-es-weiter","title":"Wie geht es weiter?","text":"<p>Viel Spass mit den neuen FreeBSD BasePorts.</p>"},{"location":"howtos/freebsd/remote_install/basesystem/","title":"BaseSystem","text":""},{"location":"howtos/freebsd/remote_install/basesystem/#einleitung","title":"Einleitung","text":"<p>In diesem HowTo beschreibe ich step-by-step die Remote Installation des FreeBSD 64BIT BaseSystem mittels mfsBSD auf einem dedizierten Server. Um eine weitere Republikation der offiziellen FreeBSD Dokumentation zu vermeiden, werde ich in diesem HowTo nicht alle Punkte bis ins Detail erl\u00e4utern.</p> <p>Unser BaseSystem wird folgende Dienste umfassen.</p> <ul> <li>FreeBSD 14.3-RELEASE 64Bit</li> <li>OpenSSL 3.0.16</li> <li>OpenSSH 9.9p2</li> <li>Unbound 1.22.0</li> </ul>"},{"location":"howtos/freebsd/remote_install/basesystem/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Remote Installation</p>"},{"location":"howtos/freebsd/remote_install/basesystem/#rescuesystem-booten","title":"RescueSystem booten","text":"<p>Um unser mfsBSD Image installieren zu k\u00f6nnen, m\u00fcssen wir unsere virtuelle Maschine mit einem RescueSystem booten. Hierf\u00fcr eignet sich die auf Arch Linux basierende SystemRescueCD am Besten, welche wir mittels des mit Windows mitgelieferten cURL-Client herunterladen und unserer virtuellen Maschine als Bootmedium zuweisen.</p> PowerShell<pre><code>cd \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\"\n\ncurl -o \"systemrescue-12.01-amd64.iso\" -L \"https://fastly-cdn.system-rescue.org/releases/12.01/systemrescue-12.01-amd64.iso\"\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"FreeBSD\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type dvddrive --medium \"systemrescue-12.01-amd64.iso\"\n</code></pre> <p>Wir k\u00f6nnen das RescueSystem jetzt booten.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" startvm \"FreeBSD\"\n</code></pre> <p>Im Bootmen\u00fc w\u00e4hlen wir die erste Option \"Boot with default options\" aus.</p> <p>Ist der Bootvorgang abgeschlossen, wird als Erstes das root-Passwort f\u00fcr das RescueSystem gesetzt und die Firewall deaktiviert.</p> Bash<pre><code>setkmap de\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for systemuser root: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\npasswd root\n\nsystemctl stop iptables\nsystemctl stop ip6tables\n</code></pre> <p>Jetzt sollten wir uns mittels PuTTY als <code>root</code> in das RescueSystem einloggen und mit der Installation unseres mfsBSD Image fortfahren k\u00f6nnen.</p> PowerShell<pre><code>putty -ssh -P 2222 root@127.0.0.1\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#mfsbsd-installieren","title":"mfsBSD installieren","text":"<p>Um unsere umfangreichen Vorbereitungen nun abzuschliessen, m\u00fcssen wir nur noch unser mfsBSD Image installieren und booten.</p> <p>Als Erstes kopieren wir mittels PuTTYs SCP-Client (<code>pscp</code>) das mfsBSD Image in das RescueSystem.</p> PowerShell<pre><code>pscp -P 2222 \"${Env:USERPROFILE}\\VirtualBox VMs\\mfsBSD\\mfsbsd-14.3-RELEASE-amd64.img\" root@127.0.0.1:/tmp/mfsbsd-14.3-RELEASE-amd64.img\n</code></pre> <p>Jetzt k\u00f6nnen wir das mfsBSD Image mittels <code>dd</code> auf der ersten Festplatte (<code>/dev/nvme0n1</code>) unserer virtuellen Maschine installieren und uns anschliessend wieder aus dem RescueSystem ausloggen.</p> Bash<pre><code>dd if=/dev/zero of=/dev/nvme0n1 count=512 bs=1M\n\ndd if=/tmp/mfsbsd-14.3-RELEASE-amd64.img of=/dev/nvme0n1 bs=1M\n\nexit\n</code></pre> <p>Abschliessend stoppen wir die virtuelle Maschine vor\u00fcbergehend und entfernen die SystemRescueCD aus dem virtuellen DVD-Laufwerk.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" controlvm \"FreeBSD\" poweroff\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"FreeBSD\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type dvddrive --medium emptydrive\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#freebsd-installieren","title":"FreeBSD installieren","text":"<p>Nachdem nun alle Vorbereitungen abgeschlossen sind, k\u00f6nnen wir endlich mit der eigentlichen FreeBSD Remote Installation beginnen, indem wir die virtuelle Maschine wieder booten.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" startvm \"FreeBSD\"\n</code></pre> <p>Jetzt sollten wir uns mittels PuTTY als <code>root</code> mit dem Passwort <code>mfsroot</code> in das mfsBSD Image einloggen und mit der Installation von FreeBSD beginnen k\u00f6nnen.</p> PowerShell<pre><code>putty -ssh -P 2222 root@127.0.0.1\n</code></pre> Hint <p>Diese Shell nutzt das amerikanische Tastaturlayout, welches einige Tasten anders belegt als das deutsche</p> <p>Tastaturlayout.</p> Text Only<pre><code>Um auf das deutsche Tastaturlayout zu wechseln, w\u00e4hlen wir mittels `kbdmap` das Layout \"German (accent keys)\" aus:\n\n```shell\n/usr/sbin/kbdmap -K\n```\n</code></pre> <p>Zun\u00e4chst setzen wir die Systemzeit (CMOS clock) mittels <code>tzsetup</code> auf \"UTC\" (Universal Time Code).</p> Bash<pre><code>/usr/sbin/tzsetup UTC\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#partitionieren-der-festplatte","title":"Partitionieren der Festplatte","text":"<p>Bevor wir anfangen, bereinigen wir die Festplatten von jeglichen Datenr\u00fcckst\u00e4nden, indem wir sie mit Nullen \u00fcberschreiben. Je nach Festplattengr\u00f6sse kann dies einige Stunden bis Tage in Anspruch nehmen. Aus diesem Grund verlegen wir diese Jobs mittels <code>nohup</code> in den Hintergrund, so dass wir uns zwischenzeitlich ausloggen k\u00f6nnen ohne dass dabei die Jobs automatisch von der Shell abgebrochen werden. Ob die Jobs fertig sind, l\u00e4sst dann mittels <code>ps -auxfwww</code> und <code>top -atCP</code> ermitteln.</p> Bash<pre><code>nohup dd if=/dev/zero of=/dev/nvd0 bs=1M  &amp;\nnohup dd if=/dev/zero of=/dev/nvd1 bs=1M  &amp;\n</code></pre> <p>Da jeder Administrator andere Pr\u00e4ferenzen an sein Partitionslayout stellt und wir andernfalls mit diesem HowTo nicht weiterkommen, verwenden wir im Folgenden ein Standard-Partitionslayout. Fortgeschrittenere FreeBSD-Administratoren k\u00f6nnen dieses Partitionslayout selbstverst\u00e4ndlich an ihre eigenen Bed\u00fcrfnisse anpassen.</p> Partition Mountpunkt Filesystem Gr\u00f6sse /dev/mirror/root / UFS2 60 GB /dev/mirror/swap none SWAP 4 GB <p>Als Erstes m\u00fcssen wir die Festplatte partitionieren, was wir mittels <code>gpart</code> erledigen werden. Zuvor m\u00fcssen wir dies aber dem Kernel mittels <code>sysctl</code> mitteilen, da er uns andernfalls dazwischenfunken w\u00fcrde.</p> <p>Wir werden auf beiden Festplatten jeweils vier Partitionen anlegen, die Erste f\u00fcr den GPT-Bootcode, die Zweite f\u00fcr den EFI-Bootcode, die Dritte als Swap und die Vierte als Systempartition. Dabei werden wir die Partitionen auch gleich f\u00fcr modernere Festplatten mit 4K-Sektoren optimieren und statt den veralteten \"MBR Partition Tables\" die aktuelleren \"GUID Partition Tables (GPT)\" verwenden.</p> Bash<pre><code>sysctl kern.geom.debugflags=0x10\n\ngpart destroy -F nvd0\ngpart destroy -F nvd1\n\ngpart create -s gpt nvd0\ngpart create -s gpt nvd1\n\ngpart add -t freebsd-boot  -b      40 -s     216 -l bootfs0 nvd0\ngpart add -t efi           -b     256 -s    3840 -l efiesp0 nvd0\ngpart add -t freebsd-swap  -b    4096 -s 8388608 -l swapfs0 nvd0\ngpart add -t freebsd-ufs   -b 8392704            -l rootfs0 nvd0\n\ngpart add -t freebsd-boot  -b      40 -s     216 -l bootfs1 nvd1\ngpart add -t efi           -b     256 -s    3840 -l efiesp1 nvd1\ngpart add -t freebsd-swap  -b    4096 -s 8388608 -l swapfs1 nvd1\ngpart add -t freebsd-ufs   -b 8392704            -l rootfs1 nvd1\n\ngpart set -a bootme -i 4 nvd0\ngpart set -a bootme -i 4 nvd1\n</code></pre> <p>F\u00fcr eine leicht erh\u00f6hte Datensicherheit legen wir mittels <code>gmirror</code> ein Software-RAID1 an.</p> Bash<pre><code>kldload geom_mirror\nkldload zfs\n\nsysctl vfs.zfs.min_auto_ashift=12\n\ngmirror label -b load efiesp nvd0p2 nvd1p2\ngmirror label -b load rootfs nvd0p4 nvd1p4\ngmirror label -b prefer -F swapfs nvd0p3 nvd1p3\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#formatieren-der-partitionen","title":"Formatieren der Partitionen","text":"<p>Nun m\u00fcssen wir noch die Systempartition und die Partition f\u00fcr die Nutzdaten mit \"UFS2\" und einer 4K-Blockgr\u00f6sse formatieren und aktivieren auch gleich die \"soft-updates\".</p> Bash<pre><code>newfs -U -l -t /dev/mirror/rootfs\ntunefs -a enable /dev/mirror/rootfs\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#mounten-der-partitionen","title":"Mounten der Partitionen","text":"<p>Die Partitionen mounten wir unterhalb von <code>/mnt</code>.</p> Bash<pre><code>mount -t ufs /dev/mirror/rootfs /mnt\nmkdir -p /mnt/data\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#installation-der-chroot-umgebung","title":"Installation der Chroot-Umgebung","text":"<p>Auf die gemounteten Partitionen entpacken wir ein FreeBSD Basesystem mit dem wir problemlos weiterarbeiten k\u00f6nnen. Je nach Auslastung des FreeBSD FTP-Servers kann dies ein wenig dauern, bitte nicht ungeduldig werden.</p> Bash<pre><code>fetch -4 -q -o - --no-verify-peer \"https://download.freebsd.org/releases/amd64/14.3-RELEASE/base.txz\"   | tar Jxpvf - -C /mnt/\nfetch -4 -q -o - --no-verify-peer \"https://download.freebsd.org/releases/amd64/14.3-RELEASE/kernel.txz\" | tar Jxpvf - -C /mnt/\n\ncp -a /mnt/boot/kernel /mnt/boot/GENERIC\n</code></pre> <p>Unser System soll nat\u00fcrlich auch von den Festplatten booten k\u00f6nnen, weshalb wir jetzt den Bootcode und Bootloader in den Bootpartitionen installieren.</p> <p>Festplatte 1:</p> Bash<pre><code>newfs_msdos /dev/gpt/efiesp0\n\nmount -t msdosfs /dev/gpt/efiesp0 /mnt/boot/efi\n\nmkdir -p /mnt/boot/efi/EFI/BOOT\ncp /mnt/boot/loader.efi /mnt/boot/efi/EFI/BOOT/BOOTX64.efi\nefibootmgr -a -c -l vtbd0p2:/EFI/BOOT/BOOTX64.efi -L FreeBSD\n\numount /mnt/boot/efi\n\ngpart bootcode -b /mnt/boot/pmbr -p /mnt/boot/gptboot -i 1 nvd0\n</code></pre> <p>Festplatte 2:</p> Bash<pre><code>newfs_msdos /dev/gpt/efiesp1\n\nmount -t msdosfs /dev/gpt/efiesp1 /mnt/boot/efi\n\nmkdir -p /mnt/boot/efi/EFI/BOOT\ncp /mnt/boot/loader.efi /mnt/boot/efi/EFI/BOOT/BOOTX64.efi\nefibootmgr -a -c -l vtbd0p2:/EFI/BOOT/BOOTX64.efi -L FreeBSD\n\numount /mnt/boot/efi\n\ngpart bootcode -b /mnt/boot/pmbr -p /mnt/boot/gptboot -i 1 nvd1\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#vorbereiten-der-chroot-umgebung","title":"Vorbereiten der Chroot-Umgebung","text":"<p>Vor dem Wechsel in die Chroot-Umgebung m\u00fcssen wir noch die <code>resolv.conf</code> in die Chroot-Umgebung kopieren und das Device-Filesysteme dorthin mounten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/resolv.conf\nnameserver 127.0.0.1\nnameserver ::1\noptions edns0 ndots:1 timeout:0.3 attempts:1 rotate\n\nEOF\n\ncp /etc/resolv.conf /mnt/etc/resolv.conf\n\nmount -t devfs devfs /mnt/dev\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#betreten-der-chroot-umgebung","title":"Betreten der Chroot-Umgebung","text":"<p>Das neu installierte System selbstverst\u00e4ndlich noch konfiguriert werden, bevor wir es nutzen k\u00f6nnen. Dazu werden wir jetzt in das neue System chrooten und eine minimale Grundkonfiguration vornehmen.</p> <p>Beim Betreten der Chroot-Umgebung setzen wir mittels <code>/usr/bin/env -i</code> erstmal alle Environment-Variablen zur\u00fcck. Andererseits ben\u00f6tigen wir aber die Environment-Variablen <code>HOME</code> und <code>TERM</code>, welche wir manuell auf sinnvolle Defaults setzen.</p> <p>Wir bringen etwas Farbe in die Console, passen den Prompt an und legen <code>ee</code> statt <code>vi</code> als Default-Editor fest:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /mnt/root/.cshrc\n#\n# .cshrc - csh resource script, read at beginning of execution by each shell\n#\n# see also csh(1), environ(7).\n# more examples available at /usr/share/examples/csh/\n#\n\nalias h         history 25\nalias j         jobs -l\nalias la        ls -aF\nalias lf        ls -FA\nalias ll        ls -lAF\nalias ls        ls -FGIPTW\nalias l         ls -FGIPTWahl\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# set path = (/sbin /bin /usr/sbin /usr/bin /usr/local/sbin /usr/local/bin $HOME/bin)\n# A righteous umask\n# umask 22\n\nsetenv  EDITOR  ee\nsetenv  PAGER   less\nsetenv  LSCOLORS \"Dxfxcxdxbxegedabagacad\"\n\nif ($?prompt) then\n        # An interactive shell -- set some stuff up\n        set prompt = \"[%B%n%b@%B%m%b:%B%~%b] %# \"\n        set promptchars = \"%#\"\n\n        set filec\n        set history = 50000\n        set savehist = (5000 merge)\n        set autolist = ambiguous\n        # Use history to aid expansion\n        set autoexpand\n        set autorehash\n        set mail = (/var/mail/$USER)\n        if ( $?tcsh ) then\n                bindkey \"^W\" backward-delete-word\n                bindkey -k up history-search-backward\n                bindkey -k down history-search-forward\n        endif\nendif\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /mnt/root/.shrc\n#\n# .shrc - bourne shell startup file\n#\n# This file will be used if the shell is invoked for interactive use and\n# the environment variable ENV is set to this file.\n#\n# see also sh(1), environ(7).\n#\n\n\n# file permissions: rwxr-xr-x\n#\n# umask 022\n\n# Uncomment this to enable the builtin vi(1) command line editor in sh(1),\n# e.g. ESC to go into visual mode.\n# set -o vi\n\n\n# some useful aliases\nalias h='fc -l'\nalias j=jobs\nalias m=\"$PAGER\"\nalias ll='ls -laFo'\nalias l='ls -l'\nalias g='egrep -i'\nalias ls='ls -FGIPTW'\nalias l='ls -FGIPTWahl'\n\n# # be paranoid\n# alias cp='cp -ip'\n# alias mv='mv -i'\n# alias rm='rm -i'\n\n# # csh like history on arrow up and down\nbind ^[[A ed-search-prev-history\nbind ^[[B ed-search-next-history\n\n# # ctrl+arrow allow to jump from words to words\nbind \"\\\\e[1;5C\" em-next-word\nbind \"\\\\e[1;5D\" ed-prev-word\nalias history='fc -l'\n\n# Fix home/del for mobaxterm\nbind ^[[5~ ed-move-to-beg\nbind ^[[6~ ed-move-to-end\n\n# set prompt: ``username@hostname:directory $ ''\nPS1=\"\\[\\e[1;36m\\][\\[\\e[1;33m\\]\\u@\\h:\\[\\e[1;36m\\]\\w] \\\\$ \\[\\e[0m\\]\"\n\n# search path for cd(1)\n# CDPATH=:$HOME\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /mnt/root/.mailrc\n#\n# .mailrc - mail resources\n#\n# see also mail(1)\n#\n\nset append ask autoprint\nset indentprefix=\"&gt; \"\nset PAGER=less\nset EDITOR=ee\nset VISUAL=ee\nset folder=Mail\nretain bcc cc date from subject to\n\n# include your private mail aliases\nsource ~/.mail_aliases\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /mnt/root/.profile\n#\n# .profile - Bourne Shell startup script for login shells\n#\n# see also sh(1), environ(7).\n#\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:$HOME/bin; export PATH\n\n# Setting TERM is normally done through /etc/ttys.  Do only override\n# if you're sure that you'll never log in via telnet or xterm or a\n# serial line.\n# TERM=xterm;   export TERM\n\nEDITOR=ee;                           export EDITOR\nPAGER=less;                          export PAGER\nCLICOLORS=\"YES\";                     export CLICOLOR\nLSCOLORS=\"Dxfxcxdxbxegedabagacad\";   export LSCOLORS\nCOLORFGBG=\"15;0\";                    export COLORFGBG\nCOLORTERM=truecolor;                 export COLORTERM\nTERM=${TERM:-xterm-256color};        export TERM\nMANCOLOR=\"1\";                        export MANCOLOR\nMANWIDTH=tty;                        export MANWIDTH\n\n# set ENV to a file invoked each time sh is started for interactive use.\nENV=$HOME/.shrc; export ENV\n\n# Let sh(1) know it's at home, despite /home being a symlink.\nif [ \"$PWD\" != \"$HOME\" ] &amp;&amp; [ \"$PWD\" -ef \"$HOME\" ] ; then cd ; fi\n\n# Query terminal size; useful for serial lines.\nif [ -x /usr/bin/resizewin ] ; then /usr/bin/resizewin -z ; fi\n\n# Display a random cookie on each login.\nif [ -x /usr/bin/fortune ] ; then /usr/bin/fortune freebsd-tips ; fi\n\nEOF\n</code></pre> Bash<pre><code>chroot /mnt /usr/bin/env -i HOME=/root TERM=$TERM /bin/tcsh\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#zeitzone-einrichten","title":"Zeitzone einrichten","text":"<p>Zun\u00e4chst setzen wir die Systemzeit (CMOS clock) mittels <code>tzsetup</code> auf \"UTC\" (Universal Time Code).</p> Bash<pre><code>/usr/sbin/tzsetup UTC\n</code></pre> <p>Cronjobs zur regelm\u00e4ssigen Syncronisation mit einem Zeitserver einrichten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/crontab\n# /etc/crontab - root's crontab for FreeBSD\n#\n#\nSHELL=/bin/sh\nPATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin\n#\n#minute hour    mday    month   wday    who     command\n#\n# Save some entropy so that /dev/random can re-seed on boot.\n*/11    *       *       *       *       operator /usr/libexec/save-entropy\n#\n# Rotate log files every hour, if necessary.\n0       *       *       *       *       root    newsyslog\n#\n# Perform daily/weekly/monthly maintenance.\n1       3       *       *       *       root    periodic daily\n15      4       *       *       6       root    periodic weekly\n30      5       1       *       *       root    periodic monthly\n#\n# Adjust the time zone if the CMOS clock keeps local time, as opposed to\n# UTC time.  See adjkerntz(8) for details.\n1,31    0-5     *       *       *       root    adjkerntz -a\n#\n57      */4     *       *       *       root    /usr/sbin/sntp -S ptbtime1.ptb.de &gt;/dev/null 2&gt;&amp;1\n58      */4     *       *       *       root    /usr/sbin/sntp -S ptbtime2.ptb.de &gt;/dev/null 2&gt;&amp;1\n59      */4     *       *       *       root    /usr/sbin/sntp -S ptbtime3.ptb.de &gt;/dev/null 2&gt;&amp;1\n#\n#10      7       *       *       *       root    /usr/local/bin/git -C /usr/ports pull --quiet &amp;&amp; /usr/bin/make -C /usr/ports fetchindex &amp;&amp; /usr/local/sbin/pkg version -vIL= &amp;&amp; /usr/local/sbin/pkg audit -F\n#10      7       *       *       *       root    /usr/local/sbin/pkg update -f &amp;&amp; /usr/local/sbin/pkg audit -F # &amp;&amp; /usr/local/sbin/pkg upgrade\n#\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#shell-einrichten","title":"Shell einrichten","text":"<p>Wir bringen etwas Farbe in die Console, passen den Prompt an und legen <code>ee</code> statt <code>vi</code> als Default-Editor fest:</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.cshrc\n#\n# .cshrc - csh resource script, read at beginning of execution by each shell\n#\n# see also csh(1), environ(7).\n# more examples available at /usr/share/examples/csh/\n#\n\nalias h         history 25\nalias j         jobs -l\nalias la        ls -aF\nalias lf        ls -FA\nalias ll        ls -lAF\nalias ls        ls -FGIPTW\nalias l         ls -FGIPTWahl\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# set path = (/sbin /bin /usr/sbin /usr/bin /usr/local/sbin /usr/local/bin $HOME/bin)\n# A righteous umask\n# umask 22\n\nsetenv  EDITOR  ee\nsetenv  PAGER   less\nsetenv  LSCOLORS \"Dxfxcxdxbxegedabagacad\"\n\nif ($?prompt) then\n        # An interactive shell -- set some stuff up\n        set prompt = \"[%B%n%b@%B%m%b:%B%~%b] %# \"\n        set promptchars = \"%#\"\n\n        set filec\n        set history = 50000\n        set savehist = (5000 merge)\n        set autolist = ambiguous\n        # Use history to aid expansion\n        set autoexpand\n        set autorehash\n        set mail = (/var/mail/$USER)\n        if ( $?tcsh ) then\n                bindkey \"^W\" backward-delete-word\n                bindkey -k up history-search-backward\n                bindkey -k down history-search-forward\n        endif\nendif\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.shrc\n#\n# .shrc - bourne shell startup file\n#\n# This file will be used if the shell is invoked for interactive use and\n# the environment variable ENV is set to this file.\n#\n# see also sh(1), environ(7).\n#\n\n\n# file permissions: rwxr-xr-x\n#\n# umask 022\n\n# Uncomment this to enable the builtin vi(1) command line editor in sh(1),\n# e.g. ESC to go into visual mode.\n# set -o vi\n\n\n# some useful aliases\nalias h='fc -l'\nalias j=jobs\nalias m=\"$PAGER\"\nalias ll='ls -laFo'\nalias l='ls -l'\nalias g='egrep -i'\nalias ls='ls -FGIPTW'\nalias l='ls -FGIPTWahl'\n\n# # be paranoid\n# alias cp='cp -ip'\n# alias mv='mv -i'\n# alias rm='rm -i'\n\n# # csh like history on arrow up and down\nbind ^[[A ed-search-prev-history\nbind ^[[B ed-search-next-history\n\n# # ctrl+arrow allow to jump from words to words\nbind \"\\\\e[1;5C\" em-next-word\nbind \"\\\\e[1;5D\" ed-prev-word\nalias history='fc -l'\n\n# Fix home/del for mobaxterm\nbind ^[[5~ ed-move-to-beg\nbind ^[[6~ ed-move-to-end\n\n# set prompt: ``username@hostname:directory $ ''\nPS1=\"\\[\\e[1;36m\\][\\[\\e[1;33m\\]\\u@\\h:\\[\\e[1;36m\\]\\w] \\\\$ \\[\\e[0m\\]\"\n\n# search path for cd(1)\n# CDPATH=:$HOME\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.mailrc\n#\n# .mailrc - mail resources\n#\n# see also mail(1)\n#\n\nset append ask autoprint\nset indentprefix=\"&gt; \"\nset PAGER=less\nset EDITOR=ee\nset VISUAL=ee\nset folder=Mail\nretain bcc cc date from subject to\n\n# include your private mail aliases\nsource ~/.mail_aliases\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /usr/share/skel/dot.profile\n#\n# .profile - Bourne Shell startup script for login shells\n#\n# see also sh(1), environ(7).\n#\n\n# These are normally set through /etc/login.conf.  You may override them here\n# if wanted.\n# PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:$HOME/bin; export PATH\n\n# Setting TERM is normally done through /etc/ttys.  Do only override\n# if you're sure that you'll never log in via telnet or xterm or a\n# serial line.\n# TERM=xterm;   export TERM\n\nEDITOR=ee;                           export EDITOR\nPAGER=less;                          export PAGER\nCLICOLORS=\"YES\";                     export CLICOLOR\nLSCOLORS=\"Dxfxcxdxbxegedabagacad\";   export LSCOLORS\nCOLORFGBG=\"15;0\";                    export COLORFGBG\nCOLORTERM=truecolor;                 export COLORTERM\nTERM=${TERM:-xterm-256color};        export TERM\nMANCOLOR=\"1\";                        export MANCOLOR\nMANWIDTH=tty;                        export MANWIDTH\n\n# set ENV to a file invoked each time sh is started for interactive use.\nENV=$HOME/.shrc; export ENV\n\n# Let sh(1) know it's at home, despite /home being a symlink.\nif [ \"$PWD\" != \"$HOME\" ] &amp;&amp; [ \"$PWD\" -ef \"$HOME\" ] ; then cd ; fi\n\n# Query terminal size; useful for serial lines.\nif [ -x /usr/bin/resizewin ] ; then /usr/bin/resizewin -z ; fi\n\n# Display a random cookie on each login.\nif [ -x /usr/bin/fortune ] ; then /usr/bin/fortune freebsd-tips ; fi\n\nEOF\n</code></pre> <p>Wir setzen ein paar Defaults f\u00fcr \"root\" neu:</p> Bash<pre><code>pw useradd -D -g '' -M 0700 -s sh -w no\npw usermod -n root -s sh -w none\n</code></pre> <p>Das Home-Verzeichnis des Users root ist standardm\u00e4ssig leider nicht ausreichend restriktiv in seinen Zugriffsrechten, was wir mit einem entsprechenden Aufruf von <code>chmod</code> schnell \u00e4ndern. Bevor wir es vergessen, setzen wir bei dieser Gelegenheit gleich ein sicheres Passwort f\u00fcr root.</p> Bash<pre><code>chmod 0700 /root\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for systemuser root: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\npasswd root\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#systemsicherheit-verst\u00e4rken","title":"Systemsicherheit verst\u00e4rken","text":"<p>Die hier vorgestellten Massnahmen sind \u00e4usserst simple Basics, die aus Hygienegr\u00fcnden auf jedem FreeBSD System selbstverst\u00e4ndlich sein sollten. Um ein FreeBSD System richtig zu h\u00e4rten (Hardened), kommt man jedoch nicht an komplexeren Methoden wie Security Event Auditing und Mandatory Access Control vorbei. Diese Themen werden im FreeBSD Handbuch recht ausf\u00fchrlich besprochen; f\u00fcr den Einstieg empfehle ich hier die Lekt\u00fcre von Chapter 14. Security, f\u00fcr die weiterf\u00fchrenden Themen die Chapter 16. Mandatory Access Control und Chapter 17. Security Event Auditing.</p>"},{"location":"howtos/freebsd/remote_install/basesystem/#openssh-konfigurieren","title":"OpenSSH konfigurieren","text":"<p>Da wir gerade ein Produktiv-System aufsetzen, werden wir den OpenSSH-Dienst recht restriktiv konfigurieren, unter Anderem werden wir den Login per Passwort verbieten und nur per PublicKey zulassen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/ssh/sshd_config\n#       $OpenBSD: sshd_config,v 1.104 2021/07/02 05:11:21 dtucker Exp $\n\n# This is the sshd server system-wide configuration file.  See\n# sshd_config(5) for more information.\n\n# This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin\n\n# The strategy used for options in the default sshd_config shipped with\n# OpenSSH is to specify options with their default value where\n# possible, but leave them commented.  Uncommented options override the\n# default value.\n\n# Note that some of FreeBSD's defaults differ from OpenBSD's, and\n# FreeBSD has a few additional options.\n\nPort 22\n#AddressFamily any\n#ListenAddress 0.0.0.0\n#ListenAddress ::\n\n#HostKey /etc/ssh/ssh_host_rsa_key\n#HostKey /etc/ssh/ssh_host_ecdsa_key\n#HostKey /etc/ssh/ssh_host_ed25519_key\n\n# Ciphers and keying\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com\nMacs hmac-sha2-512,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-256-etm@openssh.com\nKexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256\n#RekeyLimit default none\n\n# Logging\n#SyslogFacility AUTH\n#LogLevel INFO\n\n# Authentication:\n\n#LoginGraceTime 2m\nPermitRootLogin prohibit-password\n#StrictModes yes\n#MaxAuthTries 6\n#MaxSessions 10\n\nPubkeyAuthentication yes\n\n# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2\n# but this is overridden so installations will only check .ssh/authorized_keys\nAuthorizedKeysFile      .ssh/authorized_keys\n\n#AuthorizedPrincipalsFile none\n\n#AuthorizedKeysCommand none\n#AuthorizedKeysCommandUser nobody\n\n# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts\n#HostbasedAuthentication no\n# Change to yes if you don't trust ~/.ssh/known_hosts for\n# HostbasedAuthentication\n#IgnoreUserKnownHosts no\n# Don't read the user's ~/.rhosts and ~/.shosts files\n#IgnoreRhosts yes\n\n# Change to yes to enable built-in password authentication.\n# Note that passwords may also be accepted via KbdInteractiveAuthentication.\nPasswordAuthentication no\nPermitEmptyPasswords no\n\n# Change to no to disable PAM authentication\nKbdInteractiveAuthentication no\n\n# Kerberos options\n#KerberosAuthentication no\n#KerberosOrLocalPasswd yes\n#KerberosTicketCleanup yes\n#KerberosGetAFSToken no\n\n# GSSAPI options\n#GSSAPIAuthentication no\n#GSSAPICleanupCredentials yes\n\n# Set this to 'no' to disable PAM authentication, account processing,\n# and session processing. If this is enabled, PAM authentication will\n# be allowed through the KbdInteractiveAuthentication and\n# PasswordAuthentication.  Depending on your PAM configuration,\n# PAM authentication via KbdInteractiveAuthentication may bypass\n# the setting of \"PermitRootLogin prohibit-password\".\n# If you just want the PAM account and session checks to run without\n# PAM authentication, then enable this but set PasswordAuthentication\n# and KbdInteractiveAuthentication to 'no'.\nUsePAM no\n\nAllowAgentForwarding no\nAllowTcpForwarding no\nGatewayPorts no\nX11Forwarding no\n#X11DisplayOffset 10\n#X11UseLocalhost yes\n#PermitTTY yes\n#PrintMotd yes\n#PrintLastLog yes\n#TCPKeepAlive yes\nPermitUserEnvironment no\n#Compression delayed\nClientAliveInterval 10\nClientAliveCountMax 6\n#UseDNS yes\nPidFile /var/run/sshd.pid\nMaxStartups 10:30:100\nPermitTunnel no\nChrootDirectory %h\nUseBlacklist no\nVersionAddendum none\n\n# no default banner path\n#Banner none\n\n# override default of no subsystems\n#Subsystem      sftp    /usr/libexec/sftp-server\n\n# Example of overriding settings on a per-user basis\n#Match User anoncvs\n#       X11Forwarding no\n#       AllowTcpForwarding no\n#       PermitTTY no\n#       ForceCommand cvs server\n\nSubsystem sftp internal-sftp -u 0027\n\nAllowGroups wheel admin sshusers sftponly\n\nMatch User root\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group admin\n    ChrootDirectory none\n    PasswordAuthentication yes\n\nMatch Group sshusers\n    ChrootDirectory none\n    PasswordAuthentication no\n\nMatch Group sftponly\n    ChrootDirectory /home\n    PasswordAuthentication yes\n    ForceCommand internal-sftp -d %u\n\nEOF\n\nrm -f /etc/ssh/ssh_host_*_key*\nssh-keygen -q -t rsa -b 4096 -f \"/etc/ssh/ssh_host_rsa_key\" -N \"\"\nssh-keygen -l -f \"/etc/ssh/ssh_host_rsa_key.pub\"\nssh-keygen -q -t ecdsa -b 384 -f \"/etc/ssh/ssh_host_ecdsa_key\" -N \"\"\nssh-keygen -l -f \"/etc/ssh/ssh_host_ecdsa_key.pub\"\nssh-keygen -q -t ed25519 -f \"/etc/ssh/ssh_host_ed25519_key\" -N \"\"\nssh-keygen -l -f \"/etc/ssh/ssh_host_ed25519_key.pub\"\n\nmkdir -p /root/.ssh\nchmod 0700 /root/.ssh\nssh-keygen -t ed25519 -O clear -O permit-pty -f \"/root/.ssh/id_ed25519\" -N \"\"\ncat /root/.ssh/id_ed25519.pub &gt;&gt; /root/.ssh/authorized_keys\nssh-keygen -t ecdsa -b 384 -O clear -O permit-pty -f \"/root/.ssh/id_ecdsa\" -N \"\"\ncat /root/.ssh/id_ecdsa.pub &gt;&gt; /root/.ssh/authorized_keys\nssh-keygen -t rsa -b 4096 -O clear -O permit-pty -f \"/root/.ssh/id_rsa\" -N \"\"\ncat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#etcsysctlconf-anpassen","title":"/etc/sysctl.conf anpassen","text":"<p>In der <code>sysctl.conf</code> k\u00f6nnen die meisten Kernel-Parameter ver\u00e4ndert werden. Wir wollen dies nutzen, um unser System etwas robuster und sicherer zu machen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/sysctl.conf\n# https://calomel.org/freebsd_network_tuning.html\nkern.ipc.maxsockbuf=16777216\nnet.inet.tcp.recvbuf_max=4194304  # (default 2097152)\nnet.inet.tcp.recvspace=65536      # (default 65536)\nnet.inet.tcp.sendbuf_inc=65536    # (default 8192)\nnet.inet.tcp.sendbuf_max=4194304  # (default 2097152)\nnet.inet.tcp.sendspace=65536      # (default 32768)\nnet.inet.tcp.mssdflt=1240  # Option 2 (default 536)\nnet.inet.tcp.minmss=536  # (default 216)\nnet.inet.tcp.abc_l_var=52  # (default 2) if net.inet.tcp.mssdflt = 1240\nnet.inet.tcp.initcwnd_segments=52           # (default 10 for FreeBSD 11.2) if net.inet.tcp.mssdflt = 1240\nnet.inet.tcp.cc.abe=1  # (default 0, disabled)\nnet.inet.tcp.rfc6675_pipe=1  # (default 0)\nnet.inet.tcp.syncache.rexmtlimit=0  # (default 3)\nnet.inet.ip.maxfragpackets=0     # (default 63474)\nnet.inet.ip.maxfragsperpacket=0  # (default 16)\nnet.inet6.ip6.maxfragpackets=0   # (default 507715)\nnet.inet6.ip6.maxfrags=0         # (default 507715)\nnet.inet.tcp.syncookies=0  # (default 1)\nnet.inet.tcp.isn_reseed_interval=4500  # (default 0, disabled)\nnet.inet.tcp.tso=0  # (default 1)\nkern.random.fortuna.minpoolsize=128  # (default 64)\nkern.random.harvest.mask=33119   # (default 33247, FreeBSD 13 with Intel Secure Key RNG)\nhw.kbd.keymap_restrict_change=4    # disallow keymap changes for non-privileged users (default 0)\nkern.elf32.allow_wx=0              # disallow pages to be mapped writable and executable, enforce W^X memory mapping policy for 32 bit user processes (default 1, enabled/allow needed for chrome, libreoffice and go apps)\nkern.elf64.allow_wx=0              # disallow pages to be mapped writable and executable, enforce W^X memory mapping policy for 64 bit user processes (default 1, enabled/allow needed for chrome, libreoffice and go apps)\nkern.ipc.shm_use_phys=1            # lock shared memory into RAM and prevent it from being paged out to swap (default 0, disabled)\nkern.msgbuf_show_timestamp=1       # display timestamp in msgbuf (default 0)\nkern.randompid=1                   # calculate PIDs by the modulus of an integer, set to one(1) to auto random (default 0)\nnet.bpf.optimize_writers=1         # bpf is write-only unless program explicitly specifies the read filter (default 0)\nnet.inet.icmp.drop_redirect=1      # no redirected ICMP packets (default 0)\nnet.inet.ip.check_interface=1      # verify packet arrives on correct interface (default 0)\nnet.inet.ip.portrange.first=32768  # use ports 32768 to portrange.last for outgoing connections (default 10000)\nnet.inet.ip.portrange.randomcps=9999 # use random port allocation if less than this many ports per second are allocated (default 10)\nnet.inet.ip.portrange.randomtime=1 # seconds to use sequental port allocation before switching back to random (default 45 secs)\nnet.inet.ip.random_id=1            # assign a random IP id to each packet leaving the system (default 0)\nnet.inet.ip.redirect=0             # do not send IP redirects (default 1)\nnet.inet6.ip6.redirect=0           # do not send IPv6 redirects (default 1)\nnet.inet.tcp.blackhole=2           # drop tcp packets destined for closed ports (default 0)\nnet.inet.tcp.drop_synfin=1         # SYN/FIN packets get dropped on initial connection (default 0)\nnet.inet.tcp.fast_finwait2_recycle=1 # recycle FIN/WAIT states quickly, helps against DoS, but may cause false RST (default 0)\nnet.inet.tcp.fastopen.client_enable=0 # disable TCP Fast Open client side, enforce three way TCP handshake (default 1, enabled)\nnet.inet.tcp.fastopen.server_enable=0 # disable TCP Fast Open server side, enforce three way TCP handshake (default 0)\nnet.inet.tcp.finwait2_timeout=1000 # TCP FIN_WAIT_2 timeout waiting for client FIN packet before state close (default 60000, 60 sec)\nnet.inet.tcp.icmp_may_rst=0        # icmp may not send RST to avoid spoofed icmp/udp floods (default 1)\nnet.inet.tcp.keepcnt=2             # amount of tcp keep alive probe failures before socket is forced closed (default 8)\nnet.inet.tcp.keepidle=62000        # time before starting tcp keep alive probes on an idle, TCP connection (default 7200000, 7200 secs)\nnet.inet.tcp.keepinit=5000         # tcp keep alive client reply timeout (default 75000, 75 secs)\nnet.inet.tcp.msl=2500              # Maximum Segment Lifetime, time the connection spends in TIME_WAIT state (default 30000, 2*MSL = 60 sec)\nnet.inet.tcp.path_mtu_discovery=0  # disable for mtu=1500 as most paths drop ICMP type 3 packets, but keep enabled for mtu=9000 (default 1)\nnet.inet.udp.blackhole=1           # drop udp packets destined for closed sockets (default 0)\nnet.inet.udp.recvspace=1048576     # UDP receive space, HTTP/3 webserver, \"netstat -sn -p udp\" and increase if full socket buffers (default 42080)\nsecurity.bsd.hardlink_check_gid=1  # unprivileged processes may not create hard links to files owned by other groups, DISABLE for mailman (default 0)\nsecurity.bsd.hardlink_check_uid=1  # unprivileged processes may not create hard links to files owned by other users,  DISABLE for mailman (default 0)\nsecurity.bsd.see_other_gids=0      # groups only see their own processes. root can see all (default 1)\nsecurity.bsd.see_other_uids=0      # users only see their own processes. root can see all (default 1)\nsecurity.bsd.stack_guard_page=1    # insert a stack guard page ahead of growable segments, stack smashing protection (SSP) (default 0)\nsecurity.bsd.unprivileged_proc_debug=0 # unprivileged processes may not use process debugging (default 1)\nsecurity.bsd.unprivileged_read_msgbuf=0 # unprivileged processes may not read the kernel message buffer (default 1)\nvfs.zfs.delay_min_dirty_percent=98  # write throttle when dirty \"modified\" data reaches 98% of dirty_data_max (default 60%)\nvfs.zfs.dirty_data_sync_percent=95  # force commit Transaction Group (TXG) if dirty_data reaches 95% of dirty_data_max (default 20%)\nvfs.zfs.min_auto_ashift=12          # newly created pool ashift, set to 12 for 4K and 13 for 8k alignment, zdb (default 9, 512 byte, ashift=9)\nvfs.zfs.trim.txg_batch=128          # max number of TRIMs per top-level vdev (default 32)\nvfs.zfs.txg.timeout=75              # force commit Transaction Group (TXG) at 75 secs, increase to aggregated more data (default 5 sec)\nvfs.zfs.vdev.def_queue_depth=128    # max number of outstanding I/Os per top-level vdev (default 32)\nvfs.zfs.vdev.write_gap_limit=0      # max gap between any two aggregated writes, 0 to minimize frags (default 4096, 4KB)\nnet.inet.raw.maxdgram=16384       # (default 9216)\nnet.inet.raw.recvspace=16384      # (default 9216)\nnet.local.stream.sendspace=16384  # (default 8192)\nnet.local.stream.recvspace=16384  # (default 8192)\nkern.ipc.soacceptqueue=1024\nkern.ipc.somaxconn=1024\nnet.inet.icmp.icmplim=1\nnet.inet.icmp.icmplim_output=0\nkern.maxfiles=65536\nkern.maxprocperuid=65535\nkern.ps_arg_cache_limit=4096\nkern.threads.max_threads_per_proc=4096\nnet.inet.ip.ttl=128\nnet.inet.tcp.syncookies_only=1\nnet.inet6.icmp6.nodeinfo=0\nnet.inet6.icmp6.rediraccept=0\nsecurity.bsd.see_jail_proc=0\nvfs.read_max=128\nvfs.ufs.dirhash_maxmem=67108864\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#st\u00e4rkere-passwort-hashes-verwenden","title":"St\u00e4rkere Passwort-Hashes verwenden","text":"<p>Um Bruteforce-Attacken erheblich auszubremsen setzen wir f\u00fcr die Passworte der Systemuser eine Mindestl\u00e4nge (minpasswordlen) von 12 Zeichen in einem Mix aus Gross- und Kleinschreibung (mixpasswordcase) fest. Desweiteren lassen wir User nach 30 Minuten Inaktivit\u00e4t automatisch ausloggen (idletime). Wir bearbeiten hierzu mit dem Editor <code>ee</code> (<code>ee /etc/login.conf</code>) in der Datei <code>/etc/login.conf</code> die Login-Klasse <code>default</code>, indem wir vor der vorletzten Zeile folgende Zeilen hinzuf\u00fcgen.</p> Text Only<pre><code>        :mixpasswordcase=true:\\\n        :minpasswordlen=12:\\\n        :idletime=30:\\\n</code></pre> <p>Anschliessend muss die Datei in eine Systemdatenbank umgewandelt werden.</p> Bash<pre><code>cap_mkdb /etc/login.conf\n</code></pre> <p>Die neuen Einstellungen werden erst wirksam, wenn das Passwort eines Benutzers ge\u00e4ndert wird. Deshalb m\u00fcssen wir jetzt die Passw\u00f6rter f\u00fcr <code>root</code> und alle anderen bisher von uns angelegten User \u00e4ndern.</p> Bash<pre><code># Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for systemuser root: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"$newpw\" | xargs -I % sed -e 's|__PASSWORD__|%|g' -i '' /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\npasswd root\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#terminals-absichern","title":"Terminals absichern","text":"<p>Um zu verhindern, dass das System im Single User Mode ohne jeglichen Schutz benutzbar ist, \u00e4ndern wir in der Datei <code>/etc/ttys</code> die Zeile <code>console none...</code> wie folgt ab.</p> Text Only<pre><code>console none                            unknown off insecure\n</code></pre> <p>Dadurch wird die Eingabe des root-Kennworts erforderlich, um das System im Single User Mode booten zu k\u00f6nnen. Den Rest sollten wir hingegen unver\u00e4ndert lassen.</p> <p>Zus\u00e4tzlich k\u00f6nnen wir veranlassen, dass die Konsole bei jedem Logout gel\u00f6scht wird, so dass nicht versehentlich vertrauliche Informationen auf dem Bildschirm sichtbar bleiben. Dazu \u00e4ndern wir in der Datei <code>/etc/gettytab</code> den Eintrag <code>P|Pc|Pc console</code> (circa Zeile 170) wie folgt ab.</p> Text Only<pre><code>P|Pc|Pc console:\\\n        :ht:np:sp#115200:\\\n        :cl=\\E[H\\E[2J:\n</code></pre> <p>Wir passen auch unsere Login-Begr\u00fcssung (motd) an.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/motd.template\n\n      ______                                 ,        ,\n     |  ____| __ ___  ___                   /(        )`\n     | |__ | '__/ _ \\/ _ \\                  \\ \\___   / |\n     |  __|| | |  __/  __/                  /- _  `-/  '\n     | |   | | |    |    |                 (/\\/ \\ \\   /\\\n     |_|   |_|  \\___|\\___|                 / /   | `    \\\n      ____   _____ _____                   O O   ) /    |\n     |  _ \\ / ____|  __ \\                  `-^--'`&lt;     '\n     | |_) | (___ | |  | |                (_.)  _  )   /\n     |  _ &lt; \\___ \\| |  | |                 `.___/`    /\n     | |_) |____) | |__| |                   `-----' /\n     |     |      |      |      &lt;----.     __ / __   \\\n     |____/|_____/|_____/       &lt;----|====O)))==) \\) /====\n                                &lt;----'    `--' `.__,' \\\n                                             |        |\n     Welcome to our Server                    \\       /       /\\\n                                         ______( (_  / \\______/\n                                       ,'  ,-----'   |\n                                       `--{__________)\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#system-konfigurieren","title":"System konfigurieren","text":"<p>Die aliases-Datenbank f\u00fcr FreeBSDs DMA m\u00fcssen wir mittels <code>newaliases</code> anlegen, auch wenn wir sp\u00e4ter DMA gar nicht verwenden m\u00f6chten.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/mail/aliases\n#       @(#)aliases     5.3 (Berkeley) 5/24/90\n#\n#  Aliases in this file will NOT be expanded in the header from\n#  Mail, but WILL be visible over networks.\n#\n#       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      The program \"newaliases\" must be run after\n#       &gt;&gt; NOTE &gt;&gt;      this file is updated for any changes to\n#       &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      show through to sendmail.\n#\n#\n# See also RFC 2142, `MAILBOX NAMES FOR COMMON SERVICES, ROLES\n# AND FUNCTIONS', May 1997\n#       http://tools.ietf.org/html/rfc2142\n\n# Pretty much everything else in this file points to \"root\", so\n# you would do well in either reading root's mailbox or forwarding\n# root's email from here.\n\nroot:    admin@example.com\n\n# Basic system aliases -- these MUST be present\nMAILER-DAEMON: postmaster\npostmaster: root\n\n# General redirections for pseudo accounts\n_dhcp:  root\n_pflogd: root\nauditdistd:     root\nbin:    root\nbind:   root\ndaemon: root\ngames:  root\nhast:   root\nkmem:   root\nmailnull: postmaster\nman:    root\nnews:   root\nnobody: root\noperator: root\npop:    root\nproxy:  root\nsmmsp:  postmaster\nsshd:   root\nsystem: root\ntoor:   root\ntty:    root\nusenet: news\nuucp:   root\n\n# Well-known aliases -- these should be filled in!\n# manager:\n# dumper:\n\n# BUSINESS-RELATED MAILBOX NAMES\n# info:\n# marketing:\n# sales:\n# support:\n\n# NETWORK OPERATIONS MAILBOX NAMES\nabuse:  root\n# noc:          root\nsecurity:       root\n\n# SUPPORT MAILBOX NAMES FOR SPECIFIC INTERNET SERVICES\nftp:            root\nftp-bugs:       ftp\nhostmaster:     root\nwebmaster:      root\nwww:            webmaster\n\n# NOTE: /var/msgs and /var/msgs/bounds must be owned by sendmail's\n#       DefaultUser (defaults to mailnull) for the msgs alias to work.\n#\n# msgs: \"| /usr/bin/msgs -s\"\n\n# bit-bucket: /dev/null\n# dev-null: bit-bucket\nvmail: root\nclamav: root\nvscan: root\n\nEOF\n\nnewaliases\n</code></pre> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/nscd.conf\n#\n# Default caching daemon configuration file\n#\n\nenable-cache passwd yes\nenable-cache group yes\nenable-cache hosts yes\nenable-cache services yes\nenable-cache protocols yes\nenable-cache rpc yes\nenable-cache networks yes\nkeep-hot-count hosts 16384\n\nEOF\n</code></pre> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/nsswitch.conf\n#\n# nsswitch.conf(5) - name service switch configuration file\n#\ngroup: files\n# group_compat: nis\nhosts: files dns\nnetgroup: files\nnetworks: files\npasswd: files\n# passwd_compat: nis\nshells: files\nservices: files\n# services_compat: nis\nprotocols: files\nrpc: files\n\nEOF\n</code></pre> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/ntp.conf\n#\n#\n# Default NTP servers for the FreeBSD operating system.\n#\n# Don't forget to enable ntpd in /etc/rc.conf with:\n# ntpd_enable=\"YES\"\n#\n# The driftfile is by default /var/db/ntpd.drift, check\n# /etc/defaults/rc.conf on how to change the location.\n#\n\n#\n# Set the target and limit for adding servers configured via pool statements\n# or discovered dynamically via mechanisms such as broadcast and manycast.\n# Ntpd automatically adds maxclock-1 servers from configured pools, and may\n# add as many as maxclock*2 if necessary to ensure that at least minclock\n# servers are providing good consistent time.\n#\ntos minclock 3 maxclock 6\n\n#\n# The following pool statements will give you a random set of IPv4 and IPv6\n# NTP servers geographically close to you.  A single pool statement adds\n# multiple servers from the pool, according to the tos minclock/maxclock\n# targets.\n# See http://www.pool.ntp.org/ for details.  Note, pool.ntp.org encourages\n# users with a static IP and good upstream NTP servers to add a server\n# to the pool.  See http://www.pool.ntp.org/join.html if you are interested.\n#\n# The option `iburst' is used for faster initial synchronization.\n#\npool 2.freebsd.pool.ntp.org iburst\n\n#\n# If you want to pick yourself which country's public NTP server\n# you want to sync against, comment out the above pool statements,\n# uncomment the next ones, and replace CC with the country's abbreviation.\n# Make sure that the hostnames resolves to a proper IP address!\n#\npool 0.de.pool.ntp.org iburst\n\n#\n# To configure a specific server, such as an organization-wide local\n# server, add lines similar to the following.  One or more specific\n# servers can be configured in addition to, or instead of, any server\n# pools specified above.  When both are configured, ntpd first adds all\n# the specific servers, then adds servers from the pool until the tos\n# minclock/maxclock targets are met.\n#\nserver ptbtime3.ptb.de iburst\nserver ptbtime2.ptb.de iburst\nserver ptbtime1.ptb.de iburst\n\n\n#\n# Security:\n#\n# By default, only allow time queries and block all other requests\n# from unauthenticated clients.\n#\n# The \"restrict source\" line allows peers to be mobilized when added by\n# ntpd from a pool, but does not enable mobilizing a new peer association\n# by other dynamic means (broadcast, manycast, ntpq commands, etc).\n#\n# See http://support.ntp.org/bin/view/Support/AccessRestrictions\n# for more information.\n#\nrestrict default limited kod nomodify notrap noquery nopeer\nrestrict source  limited kod nomodify notrap noquery\n\n#\n# Alternatively, the following rules would block all unauthorized access.\n#\n#restrict default ignore\n#\n# In this case, all remote NTP time servers also need to be explicitly\n# allowed or they would not be able to exchange time information with\n# this server.\n#\n# Please note that this example doesn't work for the servers in\n# the pool.ntp.org domain since they return multiple A records.\n#\n#restrict 0.pool.ntp.org nomodify nopeer noquery notrap\n#restrict 1.pool.ntp.org nomodify nopeer noquery notrap\n#restrict 2.pool.ntp.org nomodify nopeer noquery notrap\n#\n# The following settings allow unrestricted access from the localhost\n#\nrestrict 127.0.0.1\nrestrict ::1\n\n#\n# If a server loses sync with all upstream servers, NTP clients\n# no longer follow that server. The local clock can be configured\n# to provide a time source when this happens, but it should usually\n# be configured on just one server on a network. For more details see\n# http://support.ntp.org/bin/view/Support/UndisciplinedLocalClock\n# The use of Orphan Mode may be preferable.\n#\n#server 127.127.1.0\n#fudge 127.127.1.0 stratum 10\n\n# See http://support.ntp.org/bin/view/Support/ConfiguringNTP#Section_6.14.\n# for documentation regarding leapfile. Updates to the file can be obtained\n# from ftp://time.nist.gov/pub/ or ftp://tycho.usno.navy.mil/pub/ntp/.\n# Use either leapfile in /etc/ntp or periodically updated leapfile in /var/db.\n#\nleapfile \"/var/db/ntpd.leap-seconds.list\"\n\n# Specify the number of megabytes of memory that should be allocated and\n# locked. -1 (default) means \"do not lock the process into memory\".\n# 0 means \"lock whatever memory the process wants into memory\". Any other\n# number means to lock up to that number of megabytes into memory.\n# 0 may result in a segfault when ASLR with stack gap randomization\n# is enabled.\n#\n#rlimit memlock 32\n#\ninterface ignore wildcard\ninterface listen 127.0.0.1\ninterface listen ::1\n\nEOF\n</code></pre> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/resolvconf.conf\nresolvconf=NO\n\nEOF\n\nresolvconf -u\n</code></pre> <p>Die <code>/etc/periodic.conf</code> legen wir mit folgendem Inhalt an.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/periodic.conf\ndaily_clean_hoststat_enable=\"NO\"\ndaily_clean_tmps_enable=\"YES\"\ndaily_status_gmirror_enable=\"YES\"\ndaily_status_include_submit_mailq=\"NO\"\ndaily_status_mail_rejects_enable=\"NO\"\ndaily_status_ntpd_enable=\"YES\"\ndaily_submit_queuerun=\"NO\"\nweekly_noid_enable=\"YES\"\ndaily_backup_pkg_enable=\"YES\"\ndaily_status_pkg_changes_enable=\"YES\"\nweekly_status_pkg_enable=\"YES\"\nsecurity_status_pkgaudit_enable=\"YES\"\nsecurity_status_pkgchecksum_enable=\"YES\"\n\nEOF\n</code></pre> <p>Die <code>/etc/fstab</code> legen wir entsprechend unserem Partitionslayout an.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/fstab\n# Device           Mountpoint    FStype     Options      Dump    Pass\n# Custom /etc/fstab for FreeBSD VM images\n/dev/mirror/rootfs    /             ufs        rw           1       1\n/dev/mirror/swapfs    none          swap       sw           0       0\n/dev/mirror/efiesp    /boot/efi     msdosfs    rw           2       2\n\nEOF\n</code></pre> <p>In der <code>/etc/rc.conf</code> werden diverse Grundeinstellungen f\u00fcr das System und die installierten Dienste vorgenommen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/rc.conf\n##############################################################\n###  Important initial Boot-time options  ####################\n##############################################################\n#kern_securelevel_enable=\"YES\"\n#kern_securelevel=\"1\"\nkld_list=\"accf_data accf_http accf_dns\"\nfsck_y_enable=\"YES\"\ngrowfs_enable=\"YES\"\ndmesg_enable=\"YES\"\nzfs_enable=\"YES\"\nzpool_reguid=\"zroot\"\nzpool_upgrade=\"zroot\"\ndumpdev=\"AUTO\"\ncloudinit_enable=\"YES\"\nqemu_guest_agent_enable=\"YES\"\n\n##############################################################\n###  Network configuration sub-section  ######################\n##############################################################\nhostname=\"devnull.example.com\"\n\n##### IPv4\ndefaultrouter=\"__GATEWAY4__\"\nifconfig_DEFAULT=\"inet __IPADDR4__\"\n\n##### IPv6\nipv6_defaultrouter=\"__GATEWAY6__\"\nifconfig_DEFAULT_ipv6=\"inet6 __IPADDR6__ accept_rtadv\"\n\n##### Additional IP Addresses\n### specify additional IPv4 and IPv6 addresses one per line\n#ifconfig_DEFAULT_aliases=\"\\\n#        inet IPV4 netmask NETMASK \\\n#        inet IPV4 netmask NETMASK \\\n#        inet6 IPV6 prefixlen PREFLEN \\\n#        inet6 IPV6 prefixlen PREFLEN\"\n\n##############################################################\n###  Paketfilter (PF) options  ###############################\n##############################################################\npf_enable=\"YES\"\npf_rules=\"/etc/pf.conf\"\npflog_enable=\"YES\"\n\n##############################################################\n###  System console options  #################################\n##############################################################\nkeymap=\"de.acc.kbd\"\n\n##############################################################\n###  Mail Transfer Agent (MTA) options  ######################\n##############################################################\nsendmail_enable=\"NONE\"\nsendmail_cert_create=\"NO\"\nsendmail_submit_enable=\"NO\"\nsendmail_outbound_enable=\"NO\"\nsendmail_msp_queue_enable=\"NO\"\nsendmail_rebuild_aliases=\"NO\"\ndma_flushq_enable=\"YES\"\n\n##############################################################\n###  Miscellaneous administrative options  ###################\n##############################################################\nsyslogd_flags=\"-ss\"\nclear_tmp_enable=\"YES\"\ncron_flags=\"$cron_flags -j 0 -J 0 -m root\"\nupdate_motd=\"YES\"\nnscd_enable=\"YES\"\nntpd_enable=\"YES\"\nntpd_sync_on_start=\"YES\"\nresolv_enable=\"NO\"\n\n##############################################################\n### Jail Configuration #######################################\n##############################################################\n\n##############################################################\n###  System services options  ################################\n##############################################################\nlocal_unbound_enable=\"YES\"\nlocal_unbound_tls=\"NO\"\nblacklistd_enable=\"NO\"\nsshd_enable=\"YES\"\n\nEOF\n</code></pre> <p>Es folgt ein wenig Voodoo, um die Netzwerkkonfiguration in der <code>/etc/rc.conf</code> zu vervollst\u00e4ndigen.</p> Bash<pre><code># Default Interface\nroute -n get -inet default | awk '/interface/ {print $2}' | \\\n    xargs -I % sed -e 's|DEFAULT|%|g' -i '' /etc/rc.conf\n\n# IPv4\nroute -n get -inet default | awk '/gateway/ {print $2}' | \\\n    xargs -I % sed -e 's|__GATEWAY4__|%|g' -i '' /etc/rc.conf\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /etc/rc.conf\n\n# IPv6\nroute -n get -inet6 default | awk '/gateway/ {print $2}' | \\\n    xargs -I % sed -e 's|__GATEWAY6__|%|g' -i '' /etc/rc.conf\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /etc/rc.conf\n</code></pre> <p>Wir richten die <code>/etc/hosts</code> ein.</p> Bash<pre><code># localhost\nsed -e 's|my.domain/example.com/g' -i '' /etc/hosts\n\n# IPv4\necho '__IPADDR4__   devnull.example.com   devnull' &gt;&gt; /etc/hosts\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /etc/hosts\n\n# IPv6\necho '__IPADDR6__   devnull.example.com   devnull' &gt;&gt; /etc/hosts\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /etc/hosts\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#systemgruppen-anlegen","title":"Systemgruppen anlegen","text":"<p>Zur besseren Trennung beziehungsweise Gruppierung unterschiedlicher Nutzungszwecke legen wir ein paar Gruppen an (admin f\u00fcr rein administrative Nutzer, users f\u00fcr normale Nutzer, sshusers f\u00fcr Nutzer mit SSH-Zugang und sftponly f\u00fcr reine SFTP-Nutzer).</p> Bash<pre><code>pw groupadd -n admin -g 1000\npw groupadd -n users -g 2000\npw groupadd -n sshusers -g 3000\npw groupadd -n sftponly -g 4000\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#systembenutzer-anlegen","title":"Systembenutzer anlegen","text":"<p>Um nicht st\u00e4ndig mit dem root-User arbeiten zu m\u00fcssen, legen wir uns einen Administrations-User an, den wir praktischerweise \"admin\" nennen. Diesem User verpassen wir die Standard-Systemgruppe \"admin\" und nehmen ihn zus\u00e4tzlich in die Systemgruppe \"wheel\" auf, damit dieser User sp\u00e4ter per <code>su</code> zum root-User wechseln kann. Das Home-Verzeichnis des admin-Users lassen wir automatisch anlegen und setzen seine Standard-Shell auf <code>/bin/tcsh</code>. Ein sicheres Passwort bekommt er selbstverst\u00e4ndlich auch noch.</p> Bash<pre><code>pw useradd -n admin -u 1000 -g admin -G wheel -c 'Administrator' -m -w no\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for systemuser admin: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\npasswd admin\n</code></pre> <p>Wir richten unserem <code>admin</code> noch die Shell und die zum zuk\u00fcnftigen Einloggen zwingend n\u00f6tigten SSH-Keys ein.</p> Bash<pre><code>su - admin\n\nmkdir -p .ssh\nchmod 0700 .ssh\n\nssh-keygen -t ed25519 -O clear -O permit-pty -f \".ssh/id_ed25519\" -N \"\"\ncat .ssh/id_ed25519.pub &gt;&gt; .ssh/authorized_keys\nssh-keygen -t ecdsa -b 384 -O clear -O permit-pty -f \".ssh/id_ecdsa\" -N \"\"\ncat .ssh/id_ecdsa.pub &gt;&gt; .ssh/authorized_keys\nssh-keygen -t rsa -b 4096 -O clear -O permit-pty -f \".ssh/id_rsa\" -N \"\"\ncat .ssh/id_rsa.pub &gt;&gt; .ssh/authorized_keys\n\nexit\n</code></pre> <p>Einen normalen User mit SSH-Zugang legen wir ebenfalls an, ihn nennen wir \"joeuser\". Diesem User verpassen wir die Standard-Systemgruppe \"users\" und nehmen ihn zus\u00e4tzlich in die Systemgruppe \"sshusers\" auf, damit sich dieser User sp\u00e4ter per <code>SSH</code> einloggen kann. Das Home-Verzeichnis des Users lassen wir automatisch anlegen und setzen seine Standard-Shell auf <code>/bin/tcsh</code>. Ein sicheres Passwort bekommt er selbstverst\u00e4ndlich auch noch.</p> Bash<pre><code>pw useradd -n joeuser -u 2000 -g users -G sshusers -c 'Joe User' -m -w no\n\n# Password erzeugen und in /root/_passwords speichern\nchmod 0600 /root/_passwords\nnewpw=\"`openssl rand -hex 64 | openssl passwd -5 -stdin | tr -cd '[[:print:]]' | cut -c 2-17`\"\necho \"Password for systemuser joeuser: $newpw\" &gt;&gt; /root/_passwords\nchmod 0400 /root/_passwords\necho \"Password: $newpw\"\nunset newpw\n\n\npasswd joeuser\n</code></pre> <p>Wir richten unserem <code>joeuser</code> noch die Shell und die zum zuk\u00fcnftigen Einloggen zwingend n\u00f6tigten SSH-Keys ein.</p> Bash<pre><code>su - joeuser\n\nmkdir -p .ssh\nchmod 0700 .ssh\n\nssh-keygen -t ed25519 -O clear -O permit-pty -f \".ssh/id_ed25519\" -N \"\"\ncat .ssh/id_ed25519.pub &gt;&gt; .ssh/authorized_keys\nssh-keygen -t ecdsa -b 384 -O clear -O permit-pty -f \".ssh/id_ecdsa\" -N \"\"\ncat .ssh/id_ecdsa.pub &gt;&gt; .ssh/authorized_keys\nssh-keygen -t rsa -b 4096 -O clear -O permit-pty -f \".ssh/id_rsa\" -N \"\"\ncat .ssh/id_rsa.pub &gt;&gt; .ssh/authorized_keys\n\nexit\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#buildsystem-konfigurieren","title":"Buildsystem konfigurieren","text":"Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/make.conf\nKERNCONF?=GENERIC MYKERNEL\nPRINTERDEVICE=ascii\nLICENSES_ACCEPTED+=EULA DCC\nDISABLE_VULNERABILITIES=yes\nMAKE_JOBS_NUMBER=4\nMAKE_JOBS_NUMBER_LIMIT=6\nWITH_BIND_NOW=YES\nWITH_PIE=YES\n.if ${.CURDIR:M/usr/ports/*}\nOPTIONS_SET=BASH BDB BDB5 BROTLI CDB CRYPTO CURL FILTER GMP GOST GSSAPI_NONE HTTP2 HTTP3 ICONV ICU IDN IDN2 IMAP IPV6 LCMS2 LDNS LIBEDIT LMDB LZ4 MAN3 MANPAGES MYSQL MYSQLND NLS OPENMP OPENSSL PCRE2 PGSQL PNG PROXY READLINE SESSION SHARED SOCKS SSL STRIP THREADS TRIO WEBP XML ZSTD\nOPTIONS_UNSET=BLACKLISTD DEBUG DOCS DOXYGEN DTRACE EXAMPLES GDBM GNUTLS GSSAPI GSSAPI_BASE GSSAPI_HEIMDAL GSSAPI_MIT INFO LDAP MEM_DEBUG ODBC OPTIMIZED_CFLAGS PAM SASL SNMP SQLITE STATIC TCL TEST TESTS TRACE X11\n.endif\nDEFAULT_VERSIONS+=ssl=openssl35\n\nEOF\n</code></pre> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/src.conf\nMAKE_JOBS_NUMBER=4\nMAKE_JOBS_NUMBER_LIMIT=6\nWITHOUT_APM=YES\nWITHOUT_BHYVE=YES\nWITH_BIND_NOW=YES\nWITHOUT_BLUETOOTH=YES\nWITHOUT_BOOTPARAMD=YES\nWITHOUT_BOOTPD=YES\nWITHOUT_BSNMP=YES\nWITHOUT_CALENDAR=YES\nWITHOUT_CCD=YES\nWITH_CLANG_EXTRAS=YES\nWITH_CLANG_FORMAT=YES\nWITHOUT_CROSS_COMPILER=YES\nWITHOUT_CUSE=YES\nWITHOUT_DEBUG_FILES=YES\nWITH_DETECT_TZ_CHANGES=YES\nWITHOUT_DOCCOMPRESS=YES\nWITHOUT_FINGER=YES\nWITHOUT_FLOPPY=YES\nWITHOUT_FTP=YES\nWITHOUT_GAMES=YES\nWITHOUT_GPIO=YES\nWITHOUT_HTML=YES\nWITHOUT_HYPERV=YES\nWITHOUT_INETD=YES\nWITHOUT_KERBEROS=YES\nWITH_KERNEL_RETPOLINE=YES\nWITH_LLVM_BINUTILS=YES\nWITHOUT_LLVM_TARGET_ALL=YES\nWITH_LLVM_TARGET_AARCH64=YES\nWITH_LLVM_TARGET_X86=YES\nWITHOUT_LPR=YES\nWITHOUT_MANCOMPRESS=YES\nWITHOUT_NIS=YES\nWITH_PIE=YES\nWITHOUT_PMC=YES\nWITHOUT_PPP=YES\nWITHOUT_RADIUS_SUPPORT=YES\nWITHOUT_RBOOTD=YES\nWITH_REPRODUCIBLE_BUILD=YES\nWITH_RETPOLINE=YES\nWITHOUT_SENDMAIL=YES\nWITHOUT_SHAREDOCS=YES\nWITH_SORT_THREAD=YES\nWITHOUT_TALK=YES\nWITHOUT_TESTS=YES\nWITHOUT_TFTP=YES\nWITHOUT_WIRELESS=YES\nWITH_ZONEINFO_LEAPSECONDS_SUPPORT=YES\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#kernel-konfigurieren","title":"Kernel konfigurieren","text":"<p>Kernel Parameter in <code>/boot/loader.conf</code> setzen.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /boot/loader.conf\n# Loader options\nboot_verbose=\"YES\"\nverbose_loading=\"YES\"\nloader_logo=\"orb\"\n\n# Microcode updates\n#cpu_microcode_load=\"YES\"\n#cpu_microcode_name=\"/boot/firmware/intel-ucode.bin\"\n#cpu_microcode_name=\"/usr/local/share/cpucontrol/microcode_amd.bin\"\n\n# Kernel selection\n#kernel=\"GENERIC\"\n#kernels=\"GENERIC MYKERNEL\"\n\n# Kernel modules\namdtemp_load=\"YES\"\ncoretemp_load=\"YES\"\ngeom_mirror_load=\"YES\"\naccf_http_load=\"YES\"\naccf_data_load=\"YES\"\naccf_dns_load=\"YES\"\n\n# Kernel parameters\n#debug.acpi.disabled=\"thermal\"\nsecurity.bsd.stack_guard_page=\"1\"\nsecurity.bsd.allow_destructive_dtrace=\"0\"\nkern.geom.label.disk_ident.enable=\"0\"\nkern.geom.label.gptid.enable=\"0\"\nkern.geom.label.gpt.enable=\"1\"\nkern.maxproc=\"65536\"\nkern.maxusers=\"512\"\nkern.ipc.semmni=\"256\"\nkern.ipc.semmns=\"512\"\nkern.ipc.semmnu=\"256\"\nkern.ipc.shmmax=\"2147483648\"\nkern.msgbufsize=\"2097152\"\nkern.random.fortuna.minpoolsize=\"256\"\nkern.sync_on_panic=\"0\"\nmachdep.hyperthreading_allowed=\"0\"\nnet.inet.tcp.hostcache.enable=\"0\"\nnet.inet.tcp.hostcache.cachelimit=\"0\"\nnet.inet.tcp.soreceive_stream=\"1\"\nnet.inet.tcp.syncache.hashsize=\"1024\"\nnet.inet.tcp.syncache.bucketlimit=\"100\"\nnet.inet.tcp.tcbhashsize=\"524288\"\nnet.isr.bindthreads=\"1\"\nnet.isr.maxthreads=\"-1\"\nnet.isr.defaultqlimit=\"2048\"\nnet.link.ifqmaxlen=\"2048\"\n\n# PF options\npf_load=\"YES\"\npflog_load=\"YES\"\nnet.pf.source_nodes_hashsize=\"1048576\"\n\n# ZFS options\nzfs_load=\"YES\"\nvfs.zfs.dirty_data_max_max=\"17179869184\"\nvfs.zfs.dirty_data_max_percent=\"25\"\n\n# ROOTFS\n#vfs.root.mountfrom=\"zfs:zroot\"\n\nEOF\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#packet-filter-pf-einrichten","title":"Packet Filter (PF) einrichten","text":"Bash<pre><code>cat &lt;&lt;'EOF' &gt; /etc/pf.conf\n##### MACROS #####\next_if = \"{ DEFAULT }\"\n\n##### TABLES #####\ntable &lt;internal&gt; persist counters file \"/etc/pf.internal\"\ntable &lt;badhosts_drop&gt; persist counters file \"/etc/pf.badhosts_drop\"\ntable &lt;badhosts_torp&gt; persist counters file \"/etc/pf.badhosts_torp\"\ntable &lt;badhosts_misc&gt; persist counters file \"/etc/pf.badhosts_misc\"\ntable &lt;badhosts_priv&gt; persist counters file \"/etc/pf.badhosts_priv\"\ntable &lt;badhosts_sshd&gt; persist counters file \"/etc/pf.badhosts_sshd\"\ntable &lt;badhosts_mail&gt; persist counters file \"/etc/pf.badhosts_mail\"\ntable &lt;badhosts_http&gt; persist counters file \"/etc/pf.badhosts_http\"\n\n##### OPTIONS #####\nset skip on lo0\nset debug urgent\nset loginterface DEFAULT\nset block-policy return\nset optimization aggressive\nset ruleset-optimization none\nset timeout { frag 5, interval 2, tcp.established 3600, adaptive.start 60000, adaptive.end 120000 }\nset timeout { tcp.first 5, tcp.opening 5, tcp.closing 5, tcp.finwait 5, tcp.closed 5, tcp.tsdiff 5 }\nset timeout { udp.first 5, udp.single 5, udp.multiple 5 }\nset timeout { icmp.first 5, icmp.error 5 }\nset timeout { other.first 5, other.single 5, other.multiple 5 }\nset limit { states 1000000, src-nodes 1000000, frags 500000, table-entries 20000000 }\nset state-policy if-bound\nset hostid 100\n\n##### NORMALIZATION #####\nscrub on $ext_if all random-id fragment reassemble no-df max-mss 1440\nantispoof for $ext_if\n\n##### QUEUEING #####\n\n##### TRANSLATION #####\n\n##### FILTERING #####\npass   in log quick on $ext_if                       from &lt;internal&gt; to &lt;internal&gt;\n\nblock  in log quick on $ext_if                       from &lt;badhosts_drop&gt; to any\nblock  in log quick on $ext_if                       from &lt;badhosts_torp&gt; to any\nblock  in log quick on $ext_if                       from &lt;badhosts_misc&gt; to any\nblock  in log quick on $ext_if                       from &lt;badhosts_priv&gt; to any\nblock  in log quick on $ext_if                       from &lt;badhosts_sshd&gt; to any\nblock  in log quick on $ext_if                       from &lt;badhosts_mail&gt; to any\nblock  in log quick on $ext_if                       from &lt;badhosts_http&gt; to any\n\nblock  in log       on $ext_if                       from any to any\n\npass   in     quick on $ext_if inet  proto icmp      from any to any                     keep state\npass   in     quick on $ext_if inet  proto udp       from any to any port 67             keep state\npass   in     quick on $ext_if inet  proto udp       from any to any port 68             keep state\npass   in     quick on $ext_if inet  proto udp       from any to any port 53             keep state\npass   in     quick on $ext_if inet  proto udp       from any to any port 123            keep state\npass   in     quick on $ext_if inet  proto tcp       from any to any port 53             modulate state\npass   in     quick on $ext_if inet  proto tcp       from any to any port 853            modulate state\npass   in     quick on $ext_if inet  proto tcp       from any to any port 80             modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 443            modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 8080           modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 8443           modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 25             modulate state (max  200, source-track rule, max-src-conn 200, max-src-nodes 200, max-src-conn-rate 100/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 465            modulate state (max  100, source-track rule, max-src-conn 100, max-src-nodes 100, max-src-conn-rate  50/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 587            modulate state (max  100, source-track rule, max-src-conn 100, max-src-nodes 100, max-src-conn-rate  50/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 993            modulate state (max  100, source-track rule, max-src-conn 100, max-src-nodes 100, max-src-conn-rate  50/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 22             modulate state (max   25, source-track rule, max-src-conn  25, max-src-nodes  25, max-src-conn-rate  5/300, overload &lt;badhosts_sshd&gt; flush global)\npass   in     quick on $ext_if inet  proto tcp       from any to any port 2222           modulate state (max   25, source-track rule, max-src-conn  25, max-src-nodes  25, max-src-conn-rate  5/300, overload &lt;badhosts_sshd&gt; flush global)\n\npass   in     quick on $ext_if inet6 proto icmp6     from any to any                     keep state\npass   in     quick on $ext_if inet6 proto udp       from any to any port 546            keep state\npass   in     quick on $ext_if inet6 proto udp       from any to any port 547            keep state\npass   in     quick on $ext_if inet6 proto udp       from any to any port 53             keep state\npass   in     quick on $ext_if inet6 proto udp       from any to any port 123            keep state\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 53             modulate state\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 853            modulate state\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 80             modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 443            modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 8080           modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 8443           modulate state (max  500, source-track rule, max-src-conn 500, max-src-nodes 500, max-src-conn-rate 250/30, overload &lt;badhosts_http&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 25             modulate state (max  200, source-track rule, max-src-conn 200, max-src-nodes 200, max-src-conn-rate 100/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 465            modulate state (max  100, source-track rule, max-src-conn 100, max-src-nodes 100, max-src-conn-rate  50/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 587            modulate state (max  100, source-track rule, max-src-conn 100, max-src-nodes 100, max-src-conn-rate  50/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 993            modulate state (max  100, source-track rule, max-src-conn 100, max-src-nodes 100, max-src-conn-rate  50/30, overload &lt;badhosts_mail&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 22             modulate state (max   25, source-track rule, max-src-conn  25, max-src-nodes  25, max-src-conn-rate  5/300, overload &lt;badhosts_sshd&gt; flush global)\npass   in     quick on $ext_if inet6 proto tcp       from any to any port 2222           modulate state (max   25, source-track rule, max-src-conn  25, max-src-nodes  25, max-src-conn-rate  5/300, overload &lt;badhosts_sshd&gt; flush global)\n\nblock out log       on $ext_if                       from any to any\n\npass  out     quick on $ext_if inet  proto icmp      from any to any                     keep state\npass  out     quick on $ext_if inet  proto udp       from any to any port 67             keep state\npass  out     quick on $ext_if inet  proto udp       from any to any port 68             keep state\npass  out     quick on $ext_if inet  proto udp       from any to any port 53             keep state\npass  out     quick on $ext_if inet  proto udp       from any to any port 123            keep state\npass  out     quick on $ext_if inet  proto udp       from any to any port 33433 &gt;&lt; 33626 keep state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 53             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 853            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 80             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 443            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 8080           modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 8443           modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 25             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 465            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 587            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 993            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 22             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 2222           modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 43             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 20             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 21             modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 989            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 990            modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 3690           modulate state\npass  out     quick on $ext_if inet  proto tcp       from any to any port 9418           modulate state\n\npass  out     quick on $ext_if inet6 proto icmp6     from any to any                     keep state\npass  out     quick on $ext_if inet6 proto udp       from any to any port 546            keep state\npass  out     quick on $ext_if inet6 proto udp       from any to any port 547            keep state\npass  out     quick on $ext_if inet6 proto udp       from any to any port 53             keep state\npass  out     quick on $ext_if inet6 proto udp       from any to any port 123            keep state\npass  out     quick on $ext_if inet6 proto udp       from any to any port 33433 &gt;&lt; 33626 keep state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 53             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 853            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 80             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 443            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 8080           modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 8443           modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 25             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 465            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 587            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 993            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 22             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 2222           modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 43             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 20             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 21             modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 989            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 990            modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 3690           modulate state\npass  out     quick on $ext_if inet6 proto tcp       from any to any port 9418           modulate state\n\nEOF\n\ncat &lt;&lt;'EOF' &gt; /etc/pf.internal\nfe80::/10\n10.0.0.0/8\n#__IPADDR4__\n#__IPADDR6__\n\nEOF\n\n# Default Interface\nroute -n get -inet default | awk '/interface/ {print $2}' | \\\n    xargs -I % sed -e 's|DEFAULT|%|g' -i '' /etc/pf.conf\n\n# IPv4\nifconfig -u -f cidr `route -n get -inet default | awk '/interface/ {print $2}'` inet | \\\n    awk 'tolower($0) ~ /inet[\\ \\t]+((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,3)!=127) print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR4__|%|g' -i '' /etc/pf.internal\n\n# IPv6\nifconfig -u -f cidr `route -n get -inet6 default | awk '/interface/ {print $2}'` inet6 | \\\n    awk 'tolower($0) ~ /inet6[\\ \\t]+(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/ {if(substr($2,1,1)!=\"f\") print $2}' | \\\n    head -n 1 | xargs -I % sed -e 's|__IPADDR6__|%|g' -i '' /etc/pf.internal\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#abschluss-der-installation","title":"Abschluss der Installation","text":"<p>Um uns k\u00fcnftig mit unserem Arbeitsuser einloggen zu k\u00f6nnen, m\u00fcssen wir uns dessen SSH-Key (id_ed25519) auf unser lokales System kopieren und ihn dann mit Hilfe der PuTTYgen Dokumentation in einen f\u00fcr PuTTY lesbaren Private Key umwandeln (id_ed25519.ppk).</p> PowerShell<pre><code>pscp -P 2222 -r root@127.0.0.1:/mnt/home/admin/.ssh \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\\ssh\"\n\nputtygen \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\\ssh\\id_ed25519\"\n</code></pre> <p>Nun ist es endlich soweit: Wir verlassen das Chroot, unmounten die Partitionen und rebooten zum ersten Mal in unser neues FreeBSD Basis-System.</p> Bash<pre><code>exit\n\nrm /mnt/root/.sh_history\nrm /mnt/home/*/.sh_history\nchmod 0700 /mnt/root\n\numount /mnt/dev\numount /mnt\n\nshutdown -r now\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#einloggen-und-zu-root-werden","title":"Einloggen und zu <code>root</code> werden","text":"<p>Einloggen ab hier nur noch mit Public-Key</p> PowerShell<pre><code>putty -ssh -P 2222 -i \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\\ssh\\id_ed25519.ppk\" admin@127.0.0.1\n</code></pre> Bash<pre><code>su - root\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#system-aktualisieren","title":"System aktualisieren","text":"<p>Nach dem Reboot aktualisieren und entschlacken wir das System.</p>"},{"location":"howtos/freebsd/remote_install/basesystem/#ports-mgmtpkg-installieren","title":"ports-mgmt/pkg installieren","text":"<p>Wir installieren als Erstes <code>pkg</code>.</p> Bash<pre><code>pkg bootstrap -y\npkg install -y ports-mgmt/pkg\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#git-installieren","title":"Git installieren","text":"<p>Wir installieren als N\u00e4chstes <code>git</code> und seine Abh\u00e4ngigkeiten.</p> Bash<pre><code>pkg install -y devel/git@default\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#source-tree-auschecken","title":"Source Tree auschecken","text":"<p>Am Besten funktioniert bei FreeBSD immer noch die Aktualisierung \u00fcber die System-Sourcen. Auf diesem Wege kann man ein System \u00fcber viele Release-Generationen hinweg aktuell halten, ohne eine Neuinstallation durchzuf\u00fchren. Das Verfahren ist zwar etwas zeitaufw\u00e4ndig, aber erprobt und f\u00fchrt bei richtiger Anwendung zu einem sauberen, aktuellen System.</p> <p>Zun\u00e4chst wird hierzu das aktuelle Quellenverzeichnis von FreeBSD ben\u00f6tigt, weshalb wir es mittels git auschecken.</p> Bash<pre><code># Neues Quellenverzeichnis anlegen (clone)\nrm -r /usr/src\ngit clone -o freebsd -b releng/`/bin/freebsd-version -u | cut -d- -f1` https://git.FreeBSD.org/src.git /usr/src\ngit -C /usr/src pull --rebase\netcupdate extract\n\n\n# Vorhandenes Quellenverzeichnis aktualisieren (pull)\ngit -C /usr/src pull --rebase\n\n\n# Vorhandenes Quellenverzeichnis zu FreeBSD 14-STABLE wechseln (checkout)\ngit -C /usr/src checkout stable/14\netcupdate extract\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#portstree-auschecken","title":"Portstree auschecken","text":"<p>Um unser Basissystem sp\u00e4ter um sinnvolle Programme erweitern zu k\u00f6nnen, fehlt uns noch der sogenannte Portstree. Diesen checken wir nun ebenfalls mittels <code>git</code> aus (kann durchaus eine Stunde oder l\u00e4nger dauern).</p> Bash<pre><code>rm -r /usr/ports\ngit clone --depth 1 https://git.FreeBSD.org/ports.git /usr/ports\ngit -C /usr/ports pull --rebase\nmake -C /usr/ports fetchindex\n</code></pre> <p>Damit ist der Portstree einsatzbereit. Um den Tree k\u00fcnftig zu aktualisieren gen\u00fcgt der folgende Befehl.</p> Bash<pre><code>git -C /usr/ports pull --rebase\nmake -C /usr/ports fetchindex\n</code></pre> <p>Wichtige Informationen zu neuen Paketversionen finden sich in <code>/usr/ports/UPDATING</code> und sollten dringend beachtet werden.</p> Bash<pre><code>less /usr/ports/UPDATING\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#git-deinstallieren","title":"Git deinstallieren","text":"<p>Wir deinstallieren <code>git</code> und seine Abh\u00e4ngigkeiten nun vorerst wieder.</p> Bash<pre><code>pkg delete -y -a\npkg clean -y -a\npkg delete -y -f \\*\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#konfiguration-anpassen","title":"Konfiguration anpassen","text":"<p>In den Abschnitten Buildsystem konfigurieren und Kernel konfigurieren haben wir uns bereits eine geeignete <code>make.conf</code> und gegebenenfalls auch eine individuelle Kernel-Konfiguration erstellt. Dennoch sei an dieser Stelle nochmals auf das FreeBSD Handbuch verwiesen. Insbesondere Chapter 8. Configuring the FreeBSD Kernel und 24.6. Updating FreeBSD from Source seien Jedem FreeBSD Administratoren ans Herz gelegt.</p> <p>Ausserdem empfiehlt es sich vor einem Update des Basissystems die Datei <code>/usr/src/UPDATING</code> zu lesen. Alle Angaben und Hinweise in dieser Datei sind aktueller und zutreffender als das Handbuch und sollten unbedingt befolgt werden.</p>"},{"location":"howtos/freebsd/remote_install/basesystem/#vorbereitende-arbeiten","title":"Vorbereitende Arbeiten","text":"Hint <p>F\u00fcr die sp\u00e4tere Installation des neu kompilierten Basissystems darf <code>/tmp</code> nicht mit der Option <code>noexec</code> gemounted</p> <p>sein. Da zwischendrin noch mal ein Reboot erfolgt, k\u00f6nnen wir bei Bedarf bereits jetzt die entsprechende Zeile in der <code>fstab</code> anpassen, sofern vorhanden.</p> <p>Zun\u00e4chst m\u00fcssen eventuell vorhandene Object-Dateien im Verzeichnis <code>/usr/obj</code> gel\u00f6scht werden, damit <code>make</code> sp\u00e4ter wirklich das gesamte System neu erstellt.</p> Bash<pre><code>cd /usr/src\n\nmake cleanuniverse\n\ngit -C /usr/src pull --rebase\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#basissystem-rekompilieren","title":"Basissystem rekompilieren","text":"<p>Das Kompilieren des Basissystems kann durchaus eine Stunde oder l\u00e4nger dauern.</p> Bash<pre><code>make -j4 buildworld\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#kernel-rekompilieren-und-installieren","title":"Kernel rekompilieren und installieren","text":"<p>Wenn die eigene Kernel-Konfiguration wie bei uns bereits in der <code>/etc/make.conf</code> eingetragen ist, wird sie automatisch verwendet, andernfalls wird die Konfiguration des generischen FreeBSD-Kernels verwendet. Das Kompilieren des Kernels kann durchaus eine Stunde oder l\u00e4nger dauern.</p> Bash<pre><code>mkdir -p /root/kernels\n\ncat &lt;&lt;'EOF' &gt; /root/kernels/MYKERNEL\ninclude         GENERIC\nident           MYKERNEL\nEOF\n\nln -s /root/kernels/MYKERNEL /usr/src/sys/amd64/conf/\nln -s /root/kernels/MYKERNEL /usr/src/sys/arm64/conf/\n\nmake -j4 KERNCONF=GENERIC INSTALLKERNEL=GENERIC INSTKERNNAME=GENERIC kernel\n\nmake -j4 KERNCONF=MYKERNEL INSTALLKERNEL=MYKERNEL INSTKERNNAME=MYKERNEL kernel\n\nsed -e 's/^#*\\(kernels=\\).*$/\\1\"MYKERNEL GENERIC\"/' -i '' /boot/loader.conf\nsed -e 's/^#*\\(kernel=\\).*$/\\1\"MYKERNEL\"/' -i '' /boot/loader.conf\n\nrm -r /boot/kernel /boot/kernel.old\n</code></pre> <p>Normalerweise w\u00e4re nun ein Reboot in den Single User Mode an der Reihe. Da sich ein Remote-System in diesem Modus ohne KVM-L\u00f6sung aber nicht bedienen l\u00e4sst, begn\u00fcgen wir uns damit, das System regul\u00e4r neu zu starten.</p> Bash<pre><code>shutdown -r now\n</code></pre> <p>Wenn wir unser System zu einem sp\u00e4teren Zeitpunkt nochmals aktualisieren, sollten wir zuden zuvor alle Dienste ausser OpenSSH, sowie s\u00e4mtliche Jails in der Datei <code>/etc/rc.conf</code> deaktivieren.</p> <p>Einloggen und zu <code>root</code> werden</p> PowerShell<pre><code>putty -ssh -P 2222 -i \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\\ssh\\id_ed25519.ppk\" admin@127.0.0.1\n</code></pre> Bash<pre><code>su - root\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basesystem/#basissystem-installieren","title":"Basissystem installieren","text":"<p>Wir installieren das neue Basissystem.</p> <p>Ausserdem sollte etcupdate im Pre-Build-Mode angeworfen werden, damit es w\u00e4hrend der Aktualisierung nicht zu Fehlern kommt, weil z. B. bestimmte User oder Gruppen noch nicht vorhanden sind.</p> Bash<pre><code>cd /usr/src\n\netcupdate -p\n\nmake installworld\n</code></pre> <p>Als letzten Schritt m\u00fcssen nun noch die Neuerungen in den Konfigurationsdateien gemerged werden. Dabei unterst\u00fctzt uns das Tool <code>etcupdate</code>. Wir m\u00fcssen selbstverst\u00e4ndlich darauf achten, dass wir hierbei nicht versehentlich unsere zuvor gemachten Anpassungen an den diversen Konfigurationsdateien wieder r\u00fcckg\u00e4ngig machen.</p> Bash<pre><code>etcupdate -B\n</code></pre> <p>Wir entsorgen nun noch eventuell vorhandene veraltete und \u00fcberfl\u00fcssige Dateien.</p> Bash<pre><code>make BATCH_DELETE_OLD_FILES=yes delete-old-files\nmake BATCH_DELETE_OLD_FILES=yes delete-old-libs\nmake BATCH_DELETE_OLD_FILES=yes delete-old-dirs\nmake BATCH_DELETE_OLD_FILES=yes delete-old\n</code></pre> <p>Anschliessend m\u00fcssen wir noch die f\u00fcr die Installation gegebenenfalls vorgenommenen \u00c4nderungen in der <code>fstab</code> sowie <code>rc.conf</code> r\u00fcckg\u00e4ngig machen und das System nochmals durchstarten.</p> Bash<pre><code>shutdown -r now\n</code></pre> <p>Viel Spass mit dem neuen FreeBSD BaseSystem.</p>"},{"location":"howtos/freebsd/remote_install/basetools/","title":"BaseTools","text":""},{"location":"howtos/freebsd/remote_install/basetools/#einleitung","title":"Einleitung","text":"<p>In diesem HowTo beschreibe ich step-by-step die Installation einiger Tools (Ports / Packages / Pakete) welche auf keinem FreeBSD 64Bit BaseSystem auf einem dedizierten Server fehlen sollten.</p> <p>Unsere BaseTools werden am Ende folgende Dienste umfassen.</p> <ul> <li>Sudo 1.9.17p1</li> <li>Bind-Tools 9.20.10</li> <li>QEmu GuestAgent 10.0.2</li> <li>Cloud-Init 24.1.4</li> <li>SMARTMonTools 7.5</li> <li>wget 1.25.0</li> <li>GIT 2.50.0</li> <li>GnuPG 2.4.7</li> <li>SQLite 3.46.1</li> <li>Subversion 1.14.5</li> <li>Nano 8.4</li> </ul>"},{"location":"howtos/freebsd/remote_install/basetools/#voraussetzungen","title":"Voraussetzungen","text":"<p>Zu den Voraussetzungen f\u00fcr dieses HowTo siehe bitte: Remote Installation</p>"},{"location":"howtos/freebsd/remote_install/basetools/#einloggen-und-zu-root-werden","title":"Einloggen und zu root werden","text":"PowerShell<pre><code>putty -ssh -P 2222 -i \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\\ssh\\id_ed25519.ppk\" admin@127.0.0.1\n</code></pre> Bash<pre><code>su - root\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basetools/#software-installieren","title":"Software installieren","text":"<p>Wir installieren <code>security/sudo</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/security_sudo\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_sudo/options\n_OPTIONS_READ=sudo-1.9.17\n_FILE_COMPLETE_OPTIONS_LIST=AUDIT DISABLE_AUTH DISABLE_ROOT_SUDO DOCS EXAMPLES INSULTS LDAP NLS NOARGS_SHELL OPIE PAM PYTHON SSL GSSAPI_BASE GSSAPI_HEIMDAL GSSAPI_MIT\nOPTIONS_FILE_SET+=AUDIT\nOPTIONS_FILE_UNSET+=DISABLE_AUTH\nOPTIONS_FILE_UNSET+=DISABLE_ROOT_SUDO\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_UNSET+=INSULTS\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=NOARGS_SHELL\nOPTIONS_FILE_UNSET+=OPIE\nOPTIONS_FILE_UNSET+=PAM\nOPTIONS_FILE_UNSET+=PYTHON\nOPTIONS_FILE_SET+=SSL\nOPTIONS_FILE_UNSET+=GSSAPI_BASE\nOPTIONS_FILE_UNSET+=GSSAPI_HEIMDAL\nOPTIONS_FILE_UNSET+=GSSAPI_MIT\n\nEOF\n\n\nportmaster -w -B -g --force-config security/sudo@default  -n\n</code></pre> <p>Wir konfigurieren <code>sudo</code> und erlauben Mitgliedern der Gruppe <code>wheel</code> beliebige Kommandos als beliebiger User ohne Passwortabfrage auszuf\u00fchren.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/etc/sudoers.d/00_defaults\n## Uncomment to allow any user to run sudo if they know the password\n## of the user they are running the command as (root by default).\nDefaults targetpw  # Ask for the password of the target user\nALL ALL=(ALL:ALL) ALL  # WARNING: only use this together with 'Defaults targetpw'\n\n## Uncomment to show on password prompt which users' password is being expected\nDefaults passprompt=\"%p's password:\"\nEOF\nchmod 0440 /usr/local/etc/sudoers.d/00_defaults\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/sudoers.d/01_wheel\n%wheel ALL = (ALL:ALL) NOPASSWD: ALL\nEOF\nchmod 0440 /usr/local/etc/sudoers.d/01_wheel\n\ncat &lt;&lt;'EOF' &gt; /usr/local/etc/sudoers.d/20_joeuser\njoeuser ALL = (ALL:ALL) NOPASSWD: ALL\nEOF\nchmod 0440 /usr/local/etc/sudoers.d/20_joeuser\n</code></pre> <p>Wir installieren <code>dns/bind-tools</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_fstrm\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_fstrm/options\n_OPTIONS_READ=fstrm-0.6.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS DOXYGEN\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=DOXYGEN\n\nEOF\n\nmkdir -p /var/db/ports/devel_libevent\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_libevent/options\n_OPTIONS_READ=libevent-2.1.12\n_FILE_COMPLETE_OPTIONS_LIST=OPENSSL THREADS\nOPTIONS_FILE_SET+=OPENSSL\nOPTIONS_FILE_SET+=THREADS\n\nEOF\n\nmkdir -p /var/db/ports/devel_protobuf-c\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_protobuf-c/options\n_OPTIONS_READ=protobuf-c-1.5.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS DOXYGEN\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=DOXYGEN\n\nEOF\n\nmkdir -p /var/db/ports/dns_bind-tools\ncat &lt;&lt;'EOF' &gt; /var/db/ports/dns_bind-tools/options\n_OPTIONS_READ=bind-tools-9.20.10\n_FILE_COMPLETE_OPTIONS_LIST=DNSTAP FIXED_RRSET IDN LARGE_FILE GSSAPI_BASE GSSAPI_HEIMDAL GSSAPI_MIT GSSAPI_NONE\nOPTIONS_FILE_SET+=DNSTAP\nOPTIONS_FILE_UNSET+=FIXED_RRSET\nOPTIONS_FILE_SET+=IDN\nOPTIONS_FILE_SET+=LARGE_FILE\nOPTIONS_FILE_UNSET+=GSSAPI_BASE\nOPTIONS_FILE_UNSET+=GSSAPI_HEIMDAL\nOPTIONS_FILE_UNSET+=GSSAPI_MIT\nOPTIONS_FILE_SET+=GSSAPI_NONE\n\nEOF\n\n\nportmaster -w -B -g --force-config dns/bind-tools  -n\n</code></pre> <p>Wir installieren <code>emulators/qemu@guestagent</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/devel_glib20\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_glib20/options\n_OPTIONS_READ=glib-2.84.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS FAM_ALTBACKEND MANPAGES NLS TEST\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=FAM_ALTBACKEND\nOPTIONS_FILE_SET+=MANPAGES\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/textproc_py-docutils\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_py-docutils/options\n_OPTIONS_READ=py311-docutils-0.21.2\n_FILE_COMPLETE_OPTIONS_LIST=PYGMENTS\nOPTIONS_FILE_SET+=PYGMENTS\n\nEOF\n\nmkdir -p /var/db/ports/emulators_qemu\ncat &lt;&lt;'EOF' &gt; /var/db/ports/emulators_qemu/options\n_OPTIONS_READ=qemu-guest-agent-10.0.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS STRIP\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=STRIP\n\nEOF\n\n\nportmaster -w -B -g --force-config emulators/qemu@guestagent  -n\n</code></pre> <p>Wir installieren <code>net/cloud-init</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/comms_py-pyserial\ncat &lt;&lt;'EOF' &gt; /var/db/ports/comms_py-pyserial/options\n_OPTIONS_READ=py311-pyserial-3.5\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/devel_py-Jinja2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_py-Jinja2/options\n_OPTIONS_READ=py311-Jinja2-3.1.6\n_FILE_COMPLETE_OPTIONS_LIST=BABEL EXAMPLES\nOPTIONS_FILE_SET+=BABEL\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/devel_py-babel\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_py-babel/options\n_OPTIONS_READ=py311-Babel-2.17.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_py-pyyaml\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_py-pyyaml/options\n_OPTIONS_READ=py311-pyyaml-6.0.1\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES LIBYAML\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=LIBYAML\n\nEOF\n\nmkdir -p /var/db/ports/security_py-oauthlib\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_py-oauthlib/options\n_OPTIONS_READ=py311-oauthlib-3.2.2\n_FILE_COMPLETE_OPTIONS_LIST=RSA SIGNALS SIGNEDTOKEN\nOPTIONS_FILE_SET+=RSA\nOPTIONS_FILE_SET+=SIGNALS\nOPTIONS_FILE_SET+=SIGNEDTOKEN\n\nEOF\n\nmkdir -p /var/db/ports/security_py-cryptography\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_py-cryptography/options\n_OPTIONS_READ=py311-cryptography-44.0.3\n_FILE_COMPLETE_OPTIONS_LIST=SSH\nOPTIONS_FILE_UNSET+=SSH\n\nEOF\n\nmkdir -p /var/db/ports/www_py-pyjwt\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_py-pyjwt/options\n_OPTIONS_READ=py311-pyjwt-2.10.1\n_FILE_COMPLETE_OPTIONS_LIST=CRYPTO\nOPTIONS_FILE_SET+=CRYPTO\n\nEOF\n\nmkdir -p /var/db/ports/www_py-requests\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_py-requests/options\n_OPTIONS_READ=py311-requests-2.32.4\n_FILE_COMPLETE_OPTIONS_LIST=SOCKS\nOPTIONS_FILE_SET+=SOCKS\n\nEOF\n\nmkdir -p /var/db/ports/net_py-urllib3\ncat &lt;&lt;'EOF' &gt; /var/db/ports/net_py-urllib3/options\n_OPTIONS_READ=py311-urllib3-1.26.20\n_FILE_COMPLETE_OPTIONS_LIST=BROTLI SOCKS SSL\nOPTIONS_FILE_SET+=BROTLI\nOPTIONS_FILE_SET+=SOCKS\nOPTIONS_FILE_SET+=SSL\n\nEOF\n\n\nportmaster -w -B -g --force-config net/cloud-init  -n\n</code></pre> <p>Wir installieren <code>sysutils/smartmontools</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/sysutils_smartmontools\ncat &lt;&lt;'EOF' &gt; /var/db/ports/sysutils_smartmontools/options\n_OPTIONS_READ=smartmontools-7.5\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\n\nportmaster -w -B -g --force-config sysutils/smartmontools  -n\n</code></pre> <p>Wir konfigurieren <code>smartmontools</code>.</p> Bash<pre><code>sed 's/^DEVICESCAN/#DEVICESCAN/' /usr/local/etc/smartd.conf.sample &gt; /usr/local/etc/smartd.conf\necho '/dev/nvme0 -d nvme -a -o on -S on -s (S/../.././02|L/../../6/03)' &gt;&gt; /usr/local/etc/smartd.conf\necho '/dev/nvme1 -d nvme -a -o on -S on -s (S/../.././02|L/../../6/03)' &gt;&gt; /usr/local/etc/smartd.conf\n\n\nsysrc smartd_enable=YES\n</code></pre> <p>Die <code>/etc/periodic.conf</code> wird um folgenden Inhalt erweitert.</p> Bash<pre><code>cat &lt;&lt;'EOF' &gt;&gt; /etc/periodic.conf\ndaily_status_smart_enable=\"YES\"\ndaily_status_smart_devices=\"/dev/nvme0 /dev/nvme1\"\nEOF\n</code></pre> <p>Wir installieren <code>security/expiretable</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>portmaster -w -B -g --force-config security/expiretable  -n\n</code></pre> <p>Wir installieren <code>ftp/wget</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/ftp_wget\ncat &lt;&lt;'EOF' &gt; /var/db/ports/ftp_wget/options\n_OPTIONS_READ=wget-1.25.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS IDN IPV6 MANPAGES METALINK NLS NTLM PCRE2 PSL GNUTLS OPENSSL\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=IDN\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_SET+=MANPAGES\nOPTIONS_FILE_UNSET+=METALINK\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=NTLM\nOPTIONS_FILE_SET+=PCRE2\nOPTIONS_FILE_SET+=PSL\nOPTIONS_FILE_UNSET+=GNUTLS\nOPTIONS_FILE_SET+=OPENSSL\n\nEOF\n\n\nportmaster -w -B -g --force-config ftp/wget  -n\n</code></pre> <p>Wir installieren <code>devel/git@default</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/security_p5-Authen-SASL\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_p5-Authen-SASL/options\n_OPTIONS_READ=p5-Authen-SASL-2.18\n_FILE_COMPLETE_OPTIONS_LIST=KERBEROS\nOPTIONS_FILE_UNSET+=KERBEROS\n\nEOF\n\nmkdir -p /var/db/ports/security_p5-IO-Socket-SSL\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_p5-IO-Socket-SSL/options\n_OPTIONS_READ=p5-IO-Socket-SSL-2.094\n_FILE_COMPLETE_OPTIONS_LIST=CERTS EXAMPLES IDN\nOPTIONS_FILE_SET+=CERTS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=IDN\n\nEOF\n\nmkdir -p /var/db/ports/security_p5-Net-SSLeay\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_p5-Net-SSLeay/options\n_OPTIONS_READ=p5-Net-SSLeay-1.94\n_FILE_COMPLETE_OPTIONS_LIST=EXAMPLES\nOPTIONS_FILE_UNSET+=EXAMPLES\n\nEOF\n\nmkdir -p /var/db/ports/textproc_xmlto\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_xmlto/options\n_OPTIONS_READ=xmlto-0.0.28\n_FILE_COMPLETE_OPTIONS_LIST=DOCS DBLATEX FOP PASSIVETEX\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=DBLATEX\nOPTIONS_FILE_UNSET+=FOP\nOPTIONS_FILE_UNSET+=PASSIVETEX\n\nEOF\n\nmkdir -p /var/db/ports/misc_getopt\ncat &lt;&lt;'EOF' &gt; /var/db/ports/misc_getopt/options\n_OPTIONS_READ=getopt-1.1.6\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/textproc_xmlcatmgr\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_xmlcatmgr/options\n_OPTIONS_READ=xmlcatmgr-2.2\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/textproc_docbook-xsl\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_docbook-xsl/options\n_OPTIONS_READ=docbook-xsl-1.79.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS ECLIPSE EPUB EXTENSIONS HIGHLIGHTING HTMLHELP JAVAHELP PROFILING ROUNDTRIP SLIDES TEMPLATE TESTS TOOLS WEBSITE XHTML11\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=ECLIPSE\nOPTIONS_FILE_SET+=EPUB\nOPTIONS_FILE_SET+=EXTENSIONS\nOPTIONS_FILE_SET+=HIGHLIGHTING\nOPTIONS_FILE_SET+=HTMLHELP\nOPTIONS_FILE_SET+=JAVAHELP\nOPTIONS_FILE_SET+=PROFILING\nOPTIONS_FILE_SET+=ROUNDTRIP\nOPTIONS_FILE_SET+=SLIDES\nOPTIONS_FILE_SET+=TEMPLATE\nOPTIONS_FILE_UNSET+=TESTS\nOPTIONS_FILE_SET+=TOOLS\nOPTIONS_FILE_SET+=WEBSITE\nOPTIONS_FILE_SET+=XHTML11\n\nEOF\n\nmkdir -p /var/db/ports/textproc_libxml2\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_libxml2/options\n_OPTIONS_READ=libxml2-2.14.4\n_FILE_COMPLETE_OPTIONS_LIST=DOCS ICU READLINE STATIC THREAD_ALLOC HTTP LZMA ZLIB\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=ICU\nOPTIONS_FILE_SET+=READLINE\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_UNSET+=THREAD_ALLOC\nOPTIONS_FILE_SET+=HTTP\nOPTIONS_FILE_SET+=LZMA\nOPTIONS_FILE_SET+=ZLIB\n\nEOF\n\nmkdir -p /var/db/ports/textproc_libxslt\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_libxslt/options\n_OPTIONS_READ=libxslt-1.1.43\n_FILE_COMPLETE_OPTIONS_LIST=CRYPTO PLUGINS STATIC\nOPTIONS_FILE_SET+=CRYPTO\nOPTIONS_FILE_SET+=PLUGINS\nOPTIONS_FILE_UNSET+=STATIC\n\nEOF\n\nmkdir -p /var/db/ports/security_libgcrypt\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_libgcrypt/options\n_OPTIONS_READ=libgcrypt-1.11.1\n_FILE_COMPLETE_OPTIONS_LIST=DOCS INFO STATIC\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=INFO\nOPTIONS_FILE_UNSET+=STATIC\n\nEOF\n\nmkdir -p /var/db/ports/security_libgpg-error\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_libgpg-error/options\n_OPTIONS_READ=libgpg-error-1.55\n_FILE_COMPLETE_OPTIONS_LIST=DOCS NLS TEST\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=TEST\n\nEOF\n\nmkdir -p /var/db/ports/www_w3m\ncat &lt;&lt;'EOF' &gt; /var/db/ports/www_w3m/options\n_OPTIONS_READ=w3m-0.5.3.20250305\n_FILE_COMPLETE_OPTIONS_LIST=DOCS INLINE_IMAGE JAPANESE KEY_LYNX NLS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=INLINE_IMAGE\nOPTIONS_FILE_UNSET+=JAPANESE\nOPTIONS_FILE_UNSET+=KEY_LYNX\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\nmkdir -p /var/db/ports/devel_boehm-gc\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_boehm-gc/options\n_OPTIONS_READ=boehm-gc-8.2.8\n_FILE_COMPLETE_OPTIONS_LIST=DEBUG DOCS\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_libatomic_ops\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_libatomic_ops/options\n_OPTIONS_READ=libatomic_ops-7.8.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_git\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_git/options\n_OPTIONS_READ=git-2.50.0\n_FILE_COMPLETE_OPTIONS_LIST=CONTRIB CURL DOCS GITWEB ICONV NLS PCRE2 PERL SEND_EMAIL SUBTREE SYSINFO\nOPTIONS_FILE_SET+=CONTRIB\nOPTIONS_FILE_SET+=CURL\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=GITWEB\nOPTIONS_FILE_SET+=ICONV\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_SET+=PCRE2\nOPTIONS_FILE_SET+=PERL\nOPTIONS_FILE_SET+=SEND_EMAIL\nOPTIONS_FILE_SET+=SUBTREE\nOPTIONS_FILE_UNSET+=SYSINFO\n\nEOF\n\n\nportmaster -w -B -g --force-config devel/git@default  -n\n</code></pre> <p>Wir installieren <code>security/gnupg</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/security_pinentry\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_pinentry/options\n_OPTIONS_READ=pinentry-1.3.1\n_FILE_COMPLETE_OPTIONS_LIST= EFL FLTK GNOME GTK2 NCURSES QT5 QT6 TTY\nOPTIONS_FILE_UNSET+=EFL\nOPTIONS_FILE_UNSET+=FLTK\nOPTIONS_FILE_UNSET+=GNOME\nOPTIONS_FILE_UNSET+=GTK2\nOPTIONS_FILE_UNSET+=NCURSES\nOPTIONS_FILE_UNSET+=QT5\nOPTIONS_FILE_UNSET+=QT6\nOPTIONS_FILE_SET+=TTY\n\nEOF\n\nmkdir -p /var/db/ports/security_pinentry-tty\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_pinentry-tty/options\n_OPTIONS_READ=pinentry-tty-1.3.1\n_FILE_COMPLETE_OPTIONS_LIST=LIBSECRET\nOPTIONS_FILE_UNSET+=LIBSECRET\n\nEOF\n\nmkdir -p /var/db/ports/security_gnupg\ncat &lt;&lt;'EOF' &gt; /var/db/ports/security_gnupg/options\n_OPTIONS_READ=gnupg-2.4.7\n_FILE_COMPLETE_OPTIONS_LIST=DOCS GNUTLS LARGE_RSA LDAP NLS SCDAEMON SUID_GPG WKS_SERVER\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=GNUTLS\nOPTIONS_FILE_SET+=LARGE_RSA\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=SCDAEMON\nOPTIONS_FILE_UNSET+=SUID_GPG\nOPTIONS_FILE_UNSET+=WKS_SERVER\n\nEOF\n\n\nportmaster -w -B -g --force-config security/gnupg  -n\n</code></pre> <p>Wir installieren <code>databases/sqlite3</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_sqlite3\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_sqlite3/options\n_OPTIONS_READ=sqlite3-3.46.1\n_FILE_COMPLETE_OPTIONS_LIST=ARMOR DBPAGE DBSTAT DIRECT_READ DQS EXAMPLES EXTENSION FTS3_TOKEN FTS4 FTS5 LIKENOTBLOB MEMMAN METADATA NORMALIZE NULL_TRIM RBU SECURE_DELETE SORT_REF STATIC STMT STRIP TCL THREADS TRUSTED_SCHEMA UNKNOWN_SQL UNLOCK_NOTIFY UPDATE_LIMIT URI URI_AUTHORITY TS0 TS1 TS2 TS3 STAT3 STAT4 LIBEDIT READLINE SESSION OFFSET SOUNDEX GEOPOLY RTREE RTREE_INT ICU UNICODE61\nOPTIONS_FILE_UNSET+=ARMOR\nOPTIONS_FILE_SET+=DBPAGE\nOPTIONS_FILE_SET+=DBSTAT\nOPTIONS_FILE_SET+=DIRECT_READ\nOPTIONS_FILE_UNSET+=DQS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=EXTENSION\nOPTIONS_FILE_SET+=FTS3_TOKEN\nOPTIONS_FILE_SET+=FTS4\nOPTIONS_FILE_SET+=FTS5\nOPTIONS_FILE_UNSET+=LIKENOTBLOB\nOPTIONS_FILE_UNSET+=MEMMAN\nOPTIONS_FILE_SET+=METADATA\nOPTIONS_FILE_UNSET+=NORMALIZE\nOPTIONS_FILE_UNSET+=NULL_TRIM\nOPTIONS_FILE_UNSET+=RBU\nOPTIONS_FILE_SET+=SECURE_DELETE\nOPTIONS_FILE_UNSET+=SORT_REF\nOPTIONS_FILE_UNSET+=STATIC\nOPTIONS_FILE_UNSET+=STMT\nOPTIONS_FILE_SET+=STRIP\nOPTIONS_FILE_UNSET+=TCL\nOPTIONS_FILE_SET+=THREADS\nOPTIONS_FILE_UNSET+=TRUSTED_SCHEMA\nOPTIONS_FILE_UNSET+=UNKNOWN_SQL\nOPTIONS_FILE_SET+=UNLOCK_NOTIFY\nOPTIONS_FILE_UNSET+=UPDATE_LIMIT\nOPTIONS_FILE_SET+=URI\nOPTIONS_FILE_UNSET+=URI_AUTHORITY\nOPTIONS_FILE_UNSET+=TS0\nOPTIONS_FILE_SET+=TS1\nOPTIONS_FILE_UNSET+=TS2\nOPTIONS_FILE_UNSET+=TS3\nOPTIONS_FILE_UNSET+=STAT3\nOPTIONS_FILE_UNSET+=STAT4\nOPTIONS_FILE_SET+=LIBEDIT\nOPTIONS_FILE_UNSET+=READLINE\nOPTIONS_FILE_SET+=SESSION\nOPTIONS_FILE_UNSET+=OFFSET\nOPTIONS_FILE_UNSET+=SOUNDEX\nOPTIONS_FILE_UNSET+=GEOPOLY\nOPTIONS_FILE_SET+=RTREE\nOPTIONS_FILE_UNSET+=RTREE_INT\nOPTIONS_FILE_SET+=ICU\nOPTIONS_FILE_UNSET+=UNICODE61\n\nEOF\n\n\nportmaster -w -B -g --force-config databases/sqlite3@default  -n\n</code></pre> <p>Wir installieren <code>devel/subversion</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/databases_db5\ncat &lt;&lt;'EOF' &gt; /var/db/ports/databases_db5/options\n_OPTIONS_READ=db5-5.3.28\n_FILE_COMPLETE_OPTIONS_LIST=CRYPTO DEBUG DOCS JAVA L10N TCL\nOPTIONS_FILE_SET+=CRYPTO\nOPTIONS_FILE_UNSET+=DEBUG\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=JAVA\nOPTIONS_FILE_UNSET+=L10N\nOPTIONS_FILE_UNSET+=TCL\n\nEOF\n\nmkdir -p /var/db/ports/devel_apr1\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_apr1/options\n_OPTIONS_READ=apr-1.7.5.1.6.3\n_FILE_COMPLETE_OPTIONS_LIST=IPV6 BDB1 BDB5 BDB18 SSL NSS GDBM LDAP MYSQL NDBM ODBC PGSQL SQLITE\nOPTIONS_FILE_SET+=IPV6\nOPTIONS_FILE_UNSET+=BDB1\nOPTIONS_FILE_SET+=BDB5\nOPTIONS_FILE_UNSET+=BDB18\nOPTIONS_FILE_SET+=SSL\nOPTIONS_FILE_UNSET+=NSS\nOPTIONS_FILE_UNSET+=GDBM\nOPTIONS_FILE_UNSET+=LDAP\nOPTIONS_FILE_UNSET+=MYSQL\nOPTIONS_FILE_UNSET+=NDBM\nOPTIONS_FILE_UNSET+=ODBC\nOPTIONS_FILE_UNSET+=PGSQL\nOPTIONS_FILE_UNSET+=SQLITE\n\nEOF\n\nmkdir -p /var/db/ports/textproc_utf8proc\ncat &lt;&lt;'EOF' &gt; /var/db/ports/textproc_utf8proc/options\n_OPTIONS_READ=utf8proc-2.10.0\n_FILE_COMPLETE_OPTIONS_LIST=DOCS\nOPTIONS_FILE_UNSET+=DOCS\n\nEOF\n\nmkdir -p /var/db/ports/devel_subversion\ncat &lt;&lt;'EOF' &gt; /var/db/ports/devel_subversion/options\n_OPTIONS_READ=subversion-1.14.5\n_FILE_COMPLETE_OPTIONS_LIST=BDB DOCS GPG_AGENT NLS SASL SERF SVNSERVE_WRAPPER TEST TOOLS\nOPTIONS_FILE_SET+=BDB\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_SET+=GPG_AGENT\nOPTIONS_FILE_SET+=NLS\nOPTIONS_FILE_UNSET+=SASL\nOPTIONS_FILE_UNSET+=SERF\nOPTIONS_FILE_UNSET+=SVNSERVE_WRAPPER\nOPTIONS_FILE_UNSET+=TEST\nOPTIONS_FILE_UNSET+=TOOLS\n\nEOF\n\n\nportmaster -w -B -g --force-config devel/subversion  -n\n</code></pre> <p>Wir installieren <code>editors/nano</code> und dessen Abh\u00e4ngigkeiten.</p> Bash<pre><code>mkdir -p /var/db/ports/editors_nano\ncat &lt;&lt;'EOF' &gt; /var/db/ports/editors_nano/options\n_OPTIONS_READ=nano-8.4\n_FILE_COMPLETE_OPTIONS_LIST=DOCS EXAMPLES NLS\nOPTIONS_FILE_UNSET+=DOCS\nOPTIONS_FILE_UNSET+=EXAMPLES\nOPTIONS_FILE_SET+=NLS\n\nEOF\n\n\nportmaster -w -B -g --force-config editors/nano  -n\n</code></pre> <p>Wenn wir ein Programm nicht kennen, dann finden wir zu jedem Port eine Datei <code>pkg-descr</code>, die eine kurze Beschreibung sowie (meistens) einen Link zur Projekt-Homepage der Software enth\u00e4lt. F\u00fcr <code>smartmontools</code> zum Beispiel w\u00fcrden wir die Beschreibung unter <code>/usr/ports/sysutils/smartmontools/pkg-descr</code> finden.</p>"},{"location":"howtos/freebsd/remote_install/basetools/#software-updaten","title":"Software updaten","text":"Important <p>Da wir die Pakete/Ports nicht als vorkompilierte Binary-Pakete installieren sondern selbst kompilieren, m\u00fcssen wir</p> <p>nat\u00fcrlich auch die Updates der Ports selbst kompilieren. Um uns das dazu notwendige Aufl\u00f6sen der Abh\u00e4ngigkeiten und etwas Tipparbeit zu ersparen, \u00fcberlassen wir dies k\u00fcnftig einfach einem kleinen Shell-Script. Dieses Script k\u00f6nnen wir einfach mittels <code>update-ports</code> ausf\u00fchren und es erledigt dann folgende Arbeiten f\u00fcr uns:</p> <ul> <li>Aktualisieren des Portstree mittels <code>git</code></li> <li>Anzeigen neuer Eintr\u00e4ge in <code>/usr/ports/UPDATING</code></li> <li>Ermitteln der zu aktualisierenden Ports und deren Abh\u00e4ngigkeiten</li> <li>Aktualisieren der Ports und Abh\u00e4ngigkeiten mittels portmaster</li> <li>Aufr\u00e4umen des Portstree und der Distfiles mittels portmaster</li> </ul> Bash<pre><code>cat &lt;&lt;'EOF' &gt; /usr/local/sbin/update-ports\n#!/bin/sh -eu\n#\n#  **********************************************************************************\n#  *                                update-ports.sh                                 *\n#  *                            ------------------------                            *\n#  *                                                                                *\n#  **********************************************************************************\n#  *                                                                                *\n#  * MIT License                                                                    *\n#  *                                                                                *\n#  * Copyright \u00a9 2016-2025 Markus Kohlmeyer &lt;rootservice@gmail.com&gt;                 *\n#  *                                                                                *\n#  * Permission is hereby granted, free of charge, to any person obtaining a copy   *\n#  * of this software and associated documentation files (the \"Software\"), to deal  *\n#  * in the Software without restriction, including without limitation the rights   *\n#  * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell      *\n#  * copies of the Software, and to permit persons to whom the Software is          *\n#  * furnished to do so, subject to the following conditions:                       *\n#  *                                                                                *\n#  * The above copyright notice and this permission notice shall be included in all *\n#  * copies or substantial portions of the Software.                                *\n#  *                                                                                *\n#  * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR     *\n#  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,       *\n#  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE    *\n#  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER         *\n#  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,  *\n#  * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE  *\n#  * SOFTWARE.                                                                      *\n#  *                                                                                *\n#  **********************************************************************************\n#\n\n# Environment\nexport TZ=UTC\nexport LC_ALL=C\nset -o nounset\nset -o pipefail\n\n####################################################################################\n#                               Configurable Variables                             #\n####################################################################################\nVERSION=\"1.0.0\"\nAUTHORS=\"Markus Kohlmeyer\"\nCONTACT=\"&lt;rootservice@gmail.com&gt;\"\nCOPYRIGHT=\"Copyright (C) 2016-2025 Markus Kohlmeyer\"\nREPORTS=\"https://github.com/RootService/mkdocs\"\n\nALLOWEDOPTS=\"\"\nUSAGEOPTIONS=\"\"\n\n# Files\nLOG_FILE=\"/var/log/$(basename \"$0\").log\"\nTMP_FILE=\"$(mktemp -q /tmp/$(basename \"$0\").XXXXXX)\" || { show_error \"Failed to create temp file\"; exit 1; }\n\n# Directories\nTMP_DIR=\"$(mktemp -d -q /tmp/$(basename \"$0\").XXXXXX)\" || { show_error \"Failed to create temp dir\"; exit 1; }\nPORTS_DIR=\"/usr/ports\"\n\n# Variables\n\n# Commands\nPORTMASTER_CMD=\"/usr/local/sbin/portmaster\"\nPKG_CMD=\"/usr/local/sbin/pkg\"\nGIT_CMD=\"/usr/local/bin/git\"\n\n####################################################################################\n#                                   Color Output                                   #\n####################################################################################\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nWHITE='\\033[0;37m'\nNC='\\033[0m'\n\ncecho() { # color, message\n  color=\"$1\"; shift\n  eval printf \\\"%b%s%b\\\\n\\\" \\\"\\$$color\\\" \\\"\\$*\\\" \\\"\\$NC\\\"\n}\ncechon() { # color, message (no newline)\n  color=\"$1\"; shift\n  eval printf \\\"%b%s%b\\\" \\\"\\$$color\\\" \\\"\\$*\\\" \\\"\\$NC\\\"\n}\n\n####################################################################################\n#                                    Logging                                       #\n####################################################################################\nlog() {\n  local level=\"$1\"; shift\n  local message=\"$*\"\n  printf \"%s [%s] %s\\n\" \"$(date '+%Y-%m-%d %H:%M:%S')\" \"${level}\" \"${message}\" &gt;&gt; \"$LOG_FILE\"\n}\n\nshow_text()  { cecho WHITE \"$*\"; log TEXT \"$*\"; }\nshow_info()  { cecho GREEN \"$*\"; log INFO \"$*\"; }\nshow_warn()  { cecho YELLOW \"$*\"; log WARN \"$*\"; }\nshow_error() { cecho RED \"$*\"; log ERROR \"$*\"; }\n\n####################################################################################\n#                               Dependency Checks                                  #\n####################################################################################\nrequire_cmd() {\n  for cmd; do\n    if ! command -v \"$cmd\" &gt;/dev/null 2&gt;&amp;1; then\n      show_error \"Missing dependency: $cmd\"\n      exit 1\n    fi\n  done\n}\nrequire_cmd whoami cat date tr awk sed grep find xargs cut sort uniq head tail\nrequire_cmd cp mv rm chmod chown mktemp service wc make pfctl whois\nrequire_cmd \"$PORTMASTER_CMD\" \"$PKG_CMD\" \"$GIT_CMD\"\n\n####################################################################################\n#                                 Utility Functions                                #\n####################################################################################\ntolower() { [ -n \"${1:-}\" ] &amp;&amp; echo \"$*\" | tr '[:upper:]' '[:lower:]'; }\ntoupper() { [ -n \"${1:-}\" ] &amp;&amp; echo \"$*\" | tr '[:lower:]' '[:upper:]'; }\n\nread_prompt() {\n  local prompt=\"${1}\"\n  local var=\"${2:-REPLY}\"\n  local input=\"\"\n  while :; do\n    read -r -p \"$(cechon WHITE \"$prompt \")\" input\n    if [ -z \"$(printf '%s' \"$input\" | tr -d '\\040-\\176')\" ]; then\n      eval \"$var=\\\"\\$input\\\"\"\n      break\n    else\n      show_warn \"Non-printable char(s) detected! Please retry...\"\n    fi\n  done\n}\n\nread_passwd() {\n  local prompt=\"${1}\"\n  local var=\"${2:-REPLY}\"\n  local input=\"\"\n  while :; do\n    read -s -p \"$(cechon WHITE \"$prompt \")\" input\n    echo\n    if [ -z \"$(printf '%s' \"$input\" | tr -d '\\040-\\176')\" ]; then\n      eval \"$var=\\\"\\$input\\\"\"\n      break\n    else\n      show_warn \"Non-printable char(s) detected! Please retry...\"\n    fi\n  done\n}\n\nrootonly() {\n  [ \"$(id -u)\" = \"0\" ] || { show_error \"You must be root to run this script!\"; exit 1; }\n}\n\nprint_separator() {\n  printf \"================================================================================\\n\"\n}\n\ntrap 'show_error \"Script interrupted. Exiting.\"; exit 1' INT TERM\ntrap 'rm -rf \"$TMP_DIR\" \"$TMP_FILE\"' EXIT\n\n####################################################################################\n#                                 Argument Parsing                                 #\n####################################################################################\nshow_usage() {\n  cat &lt;&lt;EOF &gt;&amp;2\nUsage: $(basename \"$0\") [OPTIONS]\n\nOPTIONS:\n${USAGEOPTIONS}\n  --help            Display this help and exit\n  --version         Output version information and exit\n\n${COPYRIGHT} ${CONTACT}\n\nWritten by ${AUTHORS}\n\nReport any bugs to: ${REPORTS}\nEOF\n  exit 1\n}\n\nshow_version() {\n  cat &lt;&lt;EOF &gt;&amp;2\n$(basename \"$0\") ${VERSION}\n\n${COPYRIGHT} ${CONTACT}\n\nWritten by ${AUTHORS}\n\nMIT License\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\nEOF\n  exit 0\n}\n\nparse_args() {\n  while [ $# -gt 0 ]; do\n    case \"$1\" in\n      --*=*)\n        tmpopt=\"${1#--}\"\n        cmdopt=\"${tmpopt%%=*}\"\n        cmdval=\"${tmpopt#*=}\"\n        if echo \"$ALLOWEDOPTS\" | grep -q -w \"$cmdopt\"; then\n          eval \"$cmdopt=\\\"\\$cmdval\\\"\"\n        else\n          show_usage\n        fi\n        ;;\n      --version|-V) show_version ;;\n      --help|-h) show_usage ;;\n      *) show_usage ;;\n    esac\n    shift\n  done\n}\n\n####################################################################################\n#                                   Main Logic                                     #\n####################################################################################\nrootonly\n\nparse_args \"$@\"\n\nprint_separator\n\nshow_info \"Started updating the ports tree and installed packages.\"\n\nprint_separator\n\n# Update ports tree\nshow_info \"Updating ports tree...\"\nif ! \"$GIT_CMD\" -C \"$PORTS_DIR\" pull --rebase; then\n  show_error \"Failed to update ports tree.\"\n  exit 1\nfi\n\n# Fetch latest ports index\nshow_info \"Fetching latest ports index...\"\nif ! make -C \"$PORTS_DIR\" fetchindex; then\n  show_error \"Failed to fetch ports index.\"\n  exit 1\nfi\n\n# Update package repository\nshow_info \"Updating package repository...\"\nif ! \"$PKG_CMD\" update -f; then\n  show_error \"Failed repository update.\"\n  exit 1\nfi\n\n# Checking packages database\nshow_info \"Checking packages database...\"\nif ! \"$PKG_CMD\" check -Ba -da -sa -ra; then\n  show_error \"Failed checking packages database.\"\n  exit 1\nfi\n\nprint_separator\n\n# Show recent pkg changes (last 2 months)\nshow_info \"Recent package changes (last 2 months):\"\nif ! \"$PKG_CMD\" updating -d \"$(date -u -v-2m '+%Y%m%d')\"; then\n  show_warn \"Could not retrieve recent pkg updating logs.\"\nfi\n\nprint_separator\n\n# Ask user to continue\nread_prompt \"Do you want to continue? [y/N]\" USER_CONFIRMATION\nUSER_CONFIRMATION=\"${USER_CONFIRMATION:-N}\"\ncase \"$(tolower \"$USER_CONFIRMATION\")\" in\n  y|yes) ;;\n  *) show_warn \"Aborted by user.\"; exit 1 ;;\nesac\n\nprint_separator\n\n# Upgrade installed packages\nshow_info \"Upgrading installed packages...\"\nif ! \"$PORTMASTER_CMD\" --index-first -b -g -w -d -R -a -y; then\n  show_error \"Package upgrade failed.\"\n  exit 1\nfi\n\n# Cleanup ports distfiles\nshow_info \"Cleanup ports distfiles...\"\nif ! \"$PORTMASTER_CMD\" --no-confirm --no-term-title --no-index-fetch --index-first --clean-distfiles -y; then\n  show_error \"Distfiles cleanup failed.\"\n  exit 1\nfi\n\n# Cleanup ports packages\nshow_info \"Cleanup ports packages...\"\nif ! \"$PORTMASTER_CMD\" --no-confirm --no-term-title --no-index-fetch --index-first --clean-packages -y; then\n  show_error \"Packages cleanup failed.\"\n  exit 1\nfi\n\n# Check ports dependencies\nshow_info \"Check ports dependencies...\"\nif ! \"$PORTMASTER_CMD\" --no-confirm --no-term-title --no-index-fetch --index-first --check-depends -y; then\n  show_error \"Dependencies check failed.\"\n  exit 1\nfi\n\n# Check ports dbdir\n#show_info \"Check ports dbdir...\"\n#if ! \"$PORTMASTER_CMD\" --no-confirm --no-term-title --check-port-dbdir -y; then\n#  show_error \"Dbdir check failed.\"\n#  exit 1\n#fi\n\n# Checking packages database\nshow_info \"Checking packages database...\"\nif ! \"$PKG_CMD\" check -Ba -da -sa -ra; then\n  show_error \"Failed checking packages database.\"\n  exit 1\nfi\n\nprint_separator\n\nshow_info \"Finished updating the ports tree and installed packages.\"\n\nprint_separator\n\nexit 0\n\nEOF\n\nchmod 0755 /usr/local/sbin/update-ports\n</code></pre>"},{"location":"howtos/freebsd/remote_install/basetools/#wie-geht-es-weiter","title":"Wie geht es weiter?","text":"<p>Viel Spass mit den neuen FreeBSD BaseTools.</p>"},{"location":"howtos/freebsd/remote_install/intro/","title":"Remote Installation","text":""},{"location":"howtos/freebsd/remote_install/intro/#einleitung","title":"Einleitung","text":"<p>Unser BaseSystem wird am Ende folgende Dienste umfassen.</p> <ul> <li>FreeBSD 14.3-RELEASE 64Bit</li> <li>OpenSSL 3.0.16</li> <li>OpenSSH 9.9p2</li> <li>Unbound 1.22.0</li> </ul> <p>Unsere BasePorts werden am Ende folgende Dienste umfassen.</p> <ul> <li>Portmaster 3.30</li> <li>Perl 5.40.2</li> <li>OpenSSL 3.5.0</li> <li>LUA 5.4.7</li> <li>TCL 8.6.16</li> <li>Python 3.11.13</li> <li>Bash 5.2.37</li> <li>cURL 8.14.1</li> <li>LLVM 19.1.7</li> <li>Rust 1.87.0</li> <li>Ruby 3.3.8</li> <li>Go 1.24.4</li> </ul> <p>Unsere BaseTools werden am Ende folgende Dienste umfassen.</p> <ul> <li>Sudo 1.9.17p1</li> <li>Bind-Tools 9.20.10</li> <li>QEmu GuestAgent 10.0.2</li> <li>Cloud-Init 24.1.4</li> <li>SMARTMonTools 7.5</li> <li>wget 1.25.0</li> <li>GIT 2.50.0</li> <li>GnuPG 2.4.7</li> <li>SQLite 3.46.1</li> <li>Subversion 1.14.5</li> <li>Nano 8.4</li> </ul> <p>Folgende Punkte sind in allen folgenden HowTos zu beachten.</p> <ul> <li>Alle Dienste werden mit einem m\u00f6glichst minimalen und bew\u00e4hrten Funktionsumfang installiert.</li> <li>Alle Dienste werden mit einer m\u00f6glichst sicheren und dennoch flexiblen Konfiguration versehen.</li> <li>Alle Konfigurationen sind selbstst\u00e4ndig auf notwendige individuelle Anpassungen zu kontrollieren.</li> <li>Alle Benutzernamen werden als <code>__USERNAME__</code> dargestellt und sind selbstst\u00e4ndig passend zu ersetzen.</li> <li>Alle Passworte werden als <code>__PASSWORD__</code> dargestellt und sind selbstst\u00e4ndig durch sichere Passworte zu ersetzen.</li> <li>Die Domain des Servers lautet <code>example.com</code> und ist selbstst\u00e4ndig durch die eigene Domain zu ersetzen.</li> <li>Der Hostname des Servers lautet <code>devnull</code> und ist selbstst\u00e4ndig durch den eigenen Hostnamen zu ersetzen   (FQDN=devnull.example.com).</li> <li>Es wird der FQDN <code>devnull.example.com</code> verwendet und ist selbstst\u00e4ndig im DNS zu registrieren.</li> <li>Die prim\u00e4re IPv4 Adresse des Systems wird als <code>__IPADDR4__</code> dargestellt und ist selbstt\u00e4ndig zu ersetzen.</li> <li>Die prim\u00e4re IPv6 Adresse des Systems wird als <code>__IPADDR6__</code> dargestellt und ist selbstt\u00e4ndig zu ersetzen.</li> </ul>"},{"location":"howtos/freebsd/remote_install/intro/#voraussetzungen","title":"Voraussetzungen","text":"<p>Die Installation des FreeBSD BaseSystem setzt ein wie in mfsBSD Image beschriebenes, bereits fertig erstelltes mfsBSD Image voraus.</p>"},{"location":"howtos/freebsd/remote_install/intro/#dns-records","title":"DNS Records","text":"<p>F\u00fcr diese HowTos m\u00fcssen zuvor folgende DNS-Records angelegt werden, sofern sie noch nicht existieren, oder entsprechend ge\u00e4ndert werden, sofern sie bereits existieren.</p> Text Only<pre><code>example.com.            IN  A       __IPADDR4__\nexample.com.            IN  AAAA    __IPADDR6__\n\ndevnull.example.com.    IN  A       __IPADDR4__\ndevnull.example.com.    IN  AAAA    __IPADDR6__\n</code></pre>"},{"location":"howtos/freebsd/remote_install/intro/#das-referenzsystem","title":"Das Referenzsystem","text":"<p>Als Referenzsystem f\u00fcr dieses HowTo habe ich mich f\u00fcr eine virtuelle Maschine auf Basis von Oracle VirtualBox unter Microsoft Windows 11 Pro (64Bit) entschieden. So l\u00e4sst sich ohne gr\u00f6sseren Aufwand ein handels\u00fcblicher dedizierter Server simulieren und anschliessend kann diese virtuelle Maschine als kosteng\u00fcnstiges lokales Testsystem weiter genutzt werden.</p> <p>Trotzdem habe ich dieses HowTo so ausgelegt, dass es sich nahezu unver\u00e4ndert auf handels\u00fcbliche dedizierte Server \u00fcbertragen l\u00e4sst und dieses auch auf mehreren dedizierten Servern getestet.</p> <p>Obwohl Microsoft Windows 11 Pro einen eigenen OpenSSH-Client mitbringt, greife ich lieber auf das sehr empfehlenswerte PuTTY (64 Bit) zur\u00fcck.</p> <p>VirtualBox (inklusive dem Extensionpack) und PuTTY werden mit den jeweiligen Standardoptionen installiert.</p> PowerShell<pre><code>winget install PuTTY.PuTTY\nwinget install Oracle.VirtualBox\n\n$Env:vbox_ver=((winget show Oracle.VirtualBox) -match '^Version:' -split '\\s+' | Select-Object -Last 1)\ncurl -o \"Oracle_VM_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\" -L \"https://download.virtualbox.org/virtualbox/${Env:vbox_ver}/Oracle_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" extpack install --replace Oracle_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\nrm Oracle_VirtualBox_Extension_Pack-${Env:vbox_ver}.vbox-extpack\n$Env:vbox_ver=''\n</code></pre>"},{"location":"howtos/freebsd/remote_install/intro/#die-virtuelle-maschine","title":"Die Virtuelle Maschine","text":"<p>Als Erstes \u00f6ffnen wir eine neue PowerShell und legen manuell eine neue virtuelle Maschine an. Diese virtuelle Maschine bekommt den Namen <code>FreeBSD</code> und wird mit einer UEFI-Firmware, einem Quad-Core Prozessor, Intels ICH9-Chipsatz, 8192MB RAM, 64MB VideoRAM, zwei 64GB SSD-Festplatten, einem DVD-Player, einer Netzwerkkarte, einem NVMe-Controller sowie einem AHCI-Controller und einem TPM 2.0 ausgestattet. Zudem setzen wir die RTC (Real-Time Clock) der virtuellen Maschine auf UTC (Coordinated Universal Time), aktivieren den HPET (High Precision Event Timer) und legen die Bootreihenfolge fest.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createvm --name \"FreeBSD\" --ostype FreeBSD_64 --register\n\ncd \"${Env:USERPROFILE}\\VirtualBox VMs\\FreeBSD\"\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createmedium disk --filename \"FreeBSD1.vdi\" --format VDI --size 64536\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createmedium disk --filename \"FreeBSD2.vdi\" --format VDI --size 64536\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"FreeBSD\" --firmware efi --memory 8192 --vram 64 --cpus 4 --hpet on --hwvirtex on --chipset ICH9 --iommu automatic --tpm-type 2.0 --rtc-use-utc on\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"FreeBSD\" --cpu-profile host --apic on --ioapic on --x2apic on --pae on --long-mode on --nested-paging on --large-pages on --vtx-vpid on --vtx-ux on\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"FreeBSD\" --nic1 nat --nic-type1 virtio --nat-pf1 \"VBoxSSH,tcp,,2222,,22\" --nat-pf1 \"VBoxHTTP,tcp,,8080,,80\" --nat-pf1 \"VBoxHTTPS,tcp,,8443,,443\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"FreeBSD\" --graphicscontroller vmsvga --audio-enabled off --usb-ehci off --usb-ohci off --usb-xhci off --boot1 dvd --boot2 disk --boot3 none --boot4 none\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storagectl \"FreeBSD\" --name \"NVMe Controller\" --add pcie --controller NVMe --portcount 4 --bootable on --hostiocache off\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storagectl \"FreeBSD\" --name \"AHCI Controller\" --add sata --controller IntelAHCI --portcount 4 --bootable on --hostiocache off\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"FreeBSD\" --storagectl \"NVMe Controller\" --port 0 --device 0 --type hdd --nonrotational on --medium \"FreeBSD1.vdi\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"FreeBSD\" --storagectl \"NVMe Controller\" --port 1 --device 0 --type hdd --nonrotational on --medium \"FreeBSD2.vdi\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"FreeBSD\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type dvddrive --medium emptydrive\n</code></pre> <p>Nachdem die virtuelle Maschine nun konfiguriert ist, wird es Zeit diese zu booten.</p>"},{"location":"howtos/freebsd/remote_install/intro/#los-geht-es","title":"Los geht es","text":"<p>Die einzelnen HowTos bauen aufeinander auf, daher sollten sie in der Reihenfolge von oben nach unten bis zum Ende abgearbeitet werden.</p> <p>Viel Spass und Erfolg</p>"},{"location":"howtos/general/getting_started/","title":"Pro und Contra dedizierter Server","text":""},{"location":"howtos/general/getting_started/#einleitung","title":"Einleitung","text":"<p>In diesem HowTo wird eine kleine Checkliste pro und contra dedizierter Server gegeben.</p>"},{"location":"howtos/general/getting_started/#ist-ein-dedizierter-server-das-richtige-f\u00fcr-mich","title":"Ist ein dedizierter Server das Richtige f\u00fcr mich?","text":"<p>Um Dir die Beantwortung dieser Frage etwas leichter zu machen, haben wir Dir eine kleine Checkliste zusammengestellt. Diese Checkliste ist dabei lediglich als Entscheidungshilfe gedacht, denn die Entscheidung musst letztendlich Du selbst treffen, die k\u00f6nnen und wollen wir Dir nicht abnehmen.</p>"},{"location":"howtos/general/getting_started/#probleme","title":"Probleme","text":"<p>Du wirst fr\u00fcher oder sp\u00e4ter mit den folgenden Problemen konfrontiert sein, das sollte Dir immer bewusst sein.</p>"},{"location":"howtos/general/getting_started/#erstes-problem-der-zeitaufwand","title":"Erstes Problem: Der Zeitaufwand","text":"<p>Untersch\u00e4tze niemals den notwendigen Zeitaufwand um einen Server zu administrieren! Ein Server ist wie ein kleines Baby, er ben\u00f6tigt rund um die Uhr Aufmerksamkeit. Das bedeutet, dass Du selbst bei der Verwendung von guten Monitoringwerkzeugen circa zwei Stunden t\u00e4glich f\u00fcr die Administration des Servers einplanen musst. Wenn dann auch noch etwas Unplanm\u00e4ssiges auftaucht, was im IT-Bereich h\u00e4ufiger der Fall ist, werden es schnell mal vier Stunden und mehr.</p> <p>Kannst Du diese Zeit t\u00e4glich aufbringen?</p>"},{"location":"howtos/general/getting_started/#zweites-problem-das-grundlagenwissen","title":"Zweites Problem: Das Grundlagenwissen","text":"<p>Um einen dedizierten Server vern\u00fcnftig administrieren zu k\u00f6nnen, gen\u00fcgt es nicht, sich zu Hause eine Linux-Distribution mit grafischer Oberfl\u00e4che zu installieren und ein paar Wochen zu nutzen. Ein dedizierter Server hat keine grafische Oberfl\u00e4che und auch Adminpanels wie zum Beispiel Plesk k\u00f6nnen einem die Arbeit an der Shell nicht abnehmen. Sp\u00e4testens wenn das Adminpanel nicht mehr so funktioniert wie es soll, oder wenn Du etwas umsetzen m\u00f6chtest was vom Adminpanel nicht abgedeckt wird, dann stehst Du ohne hinreichende Shellkenntnisse schnell auf dem Schlauch. Erschwerend kommt hinzu, das die Shell nur ein sehr kleiner Teil des ben\u00f6tigten Grundlagenwissens ist, dazu kommen zum Beispiel noch die Verzeichnisstruktur, das Paketmanagment, der Umgang mit Compiler und Patches, Netzwerkprotokolle, etc.</p> <p>Hast Du Dir dieses Wissen bereits angeeignet?</p>"},{"location":"howtos/general/getting_started/#drittes-problem-die-sicherheit","title":"Drittes Problem: Die Sicherheit","text":"<p>Ein Server ist kein Desktop, daher kannst Du nahezu Alles was Du \u00fcber das Absichern eines Desktops weisst schlicht vergessen. Insbesondere werden Dir Firewalls und Anti-Virus-Programme auf einem Server keine grosse Hilfe sein, im Gegenteil, sie werden Deinen Server eher unsicherer machen. Diese Produkte sind im Allgemeinen daf\u00fcr gedacht ein System so abzuschotten, das weder Gut noch B\u00f6se von aussen auf das System zugreifen kann. Bei einem Server willst Du aber gerade den Zugriff von aussen haben, andernfalls k\u00f6nnte ja Niemand Deine Website besuchen, Dir E-Mails schicken, auf Deinem Gameserver spielen oder was auch immer Du Deinen Besuchern anbieten willst. Tja und wie sicherst Du jetzt Deinen Server vor unbefugten Zugriffen? Zun\u00e4chst einmal mit regelm\u00e4ssigen vollst\u00e4ndigen Updates des Systems und aller installierten Software insbesondere der Webapplikationen. Dazu kommt eine gr\u00fcndliche Konfiguration jeder einzelnen installierten Software und das st\u00e4ndige Kontrollieren dieser Konfiguration auf notwendige \u00c4nderungen. Zudem solltest Du s\u00e4mtliche nicht (mehr) verwendete Software rigeros von dem System entfernen, denn was nicht vorhanden ist, kann auch nicht angegriffen werden.</p> <p>Stelle Dir einfach vor, das Dein Server ein Schlachtfeld in einem grossen Kriegsgebiet ist und baue Dir dementsprechend mehrere Verteidigungslinien auf. So kann ein Angreifer durchaus mal die erste Verteidigungslinie durchbrechen ohne gleich die Schlacht oder gar den Krieg gewonnen zu haben. Aber bedenke: Grosse Feldherren lernen immer aus fremden und ihren eigenen Fehlern und begehen diese kein zweites Mal. Lege Dir also ein Sicherheitskonzept an und \u00fcberarbeite dieses permanent, sonst verlierst Du.</p> <p>Kannst Du diese Sicherheit gew\u00e4hrleisten?</p>"},{"location":"howtos/general/getting_started/#viertes-problem-die-rechtslage","title":"Viertes Problem: Die Rechtslage","text":"<p>Fangen wir mit der leichtesten Frage an: Gewerblich oder Privat? Sobald Du auch nur einen Cent mit Deinem Angebot verdienst und wenn es nur ein Werbebanner oder Partnerprogramm ist, gilt Dein Angebot nach aktueller Rechtssprechung mehrerer Gerichte bereits als gewerbliches Angebot. Gewerbliche Angebote m\u00fcssen einige gesetzliche Auflagen erf\u00fcllen, angefangen beim ordnungsgem\u00e4ssen Impressum und gegebenenfalls bis hin zum eigenen Datenschutzbeauftragten und anderen rechtlichen Stolperfallen. Selbst bei manchem privaten Angebot k\u00f6nnen die Impressumspflicht und andere gesetzliche Bestimmungen greifen.</p> <p>Unabh\u00e4ngig davon bist Du generell f\u00fcr Alles was auf Deinem Server passiert rechtlich in vollem Umfang verantwortlich. Schafft es bespielsspeise ein Script-Kiddie oder Cracker (in den Medien auch gerne Hacker genannt) in Dein System einzubrechen und dort Warez, Pornos, Malware oder sonstiges verbotenes Zeugs abzulegen, so bist ausschliesslich Du daf\u00fcr rechtlich haftbar. Das Schlimmste daran ist, dass man Dir nicht die Schuld sondern Du Deine Unschuld nachweisen musst und das ist auch f\u00fcr Profis und mit Hilfe eines guten Anwalts nicht einfach. Rechtsschutzversicherungen helfen einem hier \u00fcbrigens in der Regel auch nicht, da diese F\u00e4lle meist nicht abgedeckt sind. Im g\u00fcnstigsten Fall kommst Du einer schmerzhaften Geldstrafe davon und im schlimmsten Fall bedeutet dies eine mehrj\u00e4hrige Gef\u00e4ngnisstrafe.</p> <p>Bist Du Dir Deiner Verantwortung bewusst?</p>"},{"location":"howtos/general/getting_started/#f\u00fcnftes-problem-der-mensch","title":"F\u00fcnftes Problem: Der Mensch","text":"<p>Stelle Dir vor Du willst mit Deiner Familie einen entspannten zweiw\u00f6chigen Urlaub in der Karibik verbringen. Oder Du rutscht ungl\u00fccklich beim Duschen aus und brichst Dir ein paar Rippen. Oder Du wirst von Deinem Arbeitgeber auf Dienstreise geschickt. Oder es passiert sonstetwas Unvorhergesehenes und Du kannst Dich daher l\u00e4ngere Zeit nicht um Deinen Server k\u00fcmmern. Wer betreut in dieser Zeit den Server? Ist Derjenige vertrauensw\u00fcrdig genug, das Du ihm das Passwort f\u00fcr root anvertrauen kannst? Kennt er Dein System und Sicherheitskonzept ausreichend um sich schnell zurechtzufinden und Nichts kaputtzumachen? Wie und wann benachrichtigst Du oder im schlimmsten Fall ein Anderer (Familienangeh\u00f6riger, Arbeitskollege, etc.) ihn?</p> <p>Hast Du an mindestens einen Ersatzadmin gedacht?</p>"},{"location":"howtos/general/getting_started/#probleml\u00f6sungen","title":"Probleml\u00f6sungen","text":"<p>So, genug \u00fcber Probleme geschrieben, kommen wir zu ein paar kleinen Hilfestellungen.</p>"},{"location":"howtos/general/getting_started/#wo-fange-ich-mit-dem-lernen-an","title":"Wo fange ich mit dem Lernen an?","text":"<p>Diese Frage ist schwer zu beantworten, da wir Deinen aktuellen Wissensstand nicht kennen. Aus diesem Grund fangen wir mal mit dem Grundaufbau einer Linux-Distribution an. Dies ist bereits ein derart weitreichendes Thema, das wir es hier gar nicht ausf\u00fchrlich behandeln k\u00f6nnen. Gl\u00fccklicherweise brauchen wir das auch gar nicht, denn das haben Andere bereits vor einigen Jahren begonnen und daraus ein sehr empfehlenswertes Online-Buch gemacht, zu finden unter LinuxFromScratch.org. Nimm Dir f\u00fcr dieses Buch bitte ein paar Wochen Zeit und lerne daraus so viel wie irgend m\u00f6glich, Du wirst es sp\u00e4ter garantiert zu sch\u00e4tzen wissen. Danach solltest Du Deine Shellkenntnisse stark erweitern, denn die Shell wird Dein schweizer Taschenmesser werden. Auch zu diesem Thema haben wir eine sehr empfehlenswerte und umfangreiche Informationsquelle, n\u00e4mlich den Advanced Bash-Scripting Guide. Weitere gute HowTos findest Du unter Anderem beim Linux Documentation Project und den diversen Projektseiten der Linux-Distributionen. Stellvertretend f\u00fcr Letztere seien an dieser Stelle die Gentoo Linux Documentation Resources, die openSUSE Documentation und die Debian Documentation genannt.</p>"},{"location":"howtos/general/getting_started/#wo-fange-ich-mit-dem-\u00fcben-an","title":"Wo fange ich mit dem \u00dcben an?","text":"<p>Selbstverst\u00e4ndlich wie ein Arzt: Nie am lebenden Objekt! Wenn Du zu Hause noch einen zweiten Computer rumstehen hast und dieser nicht gerade f\u00fcr die Familie gedacht ist, dann nimm diesen und installiere dort zun\u00e4chst das bereits erw\u00e4hnte LinuxFromScratch. Alternativ zum Zweitrechner kannst Du auch eine virtuelle Maschine wie zum Beispiel VirtualBox oder VMWare Workstation nutzen. Wenn Du glaubst Dich damit ausreichend auseinandergesetzt zu haben, dann f\u00e4ngst Du mit dem sogenannten Distro-Hopping an, das heisst Du installierst Dir nach und nach die g\u00e4ngigen Server-Distributionen (Gentoo, openSUSE, CentOS, Ubuntu, Debian) und lernst diese n\u00e4her kennen. Du wirst dabei schnell feststellen, das jede Distribution ihre Vor- und Nachteile hat und Du mit der Einen besser zurecht kommst, als mit der Anderen. Nimm Dir f\u00fcr die Entscheidung welche Distribution Du letztendlich auf Deinem Server einsetzen m\u00f6chtest bitte Zeit, denn ein sp\u00e4terer Wechsel zu einer anderen Distribution ist nicht so unproblematisch, wie es im ersten Moment scheinen mag.</p>"},{"location":"howtos/general/getting_started/#wo-finde-ich-weitere-hilfe","title":"Wo finde ich weitere Hilfe?","text":"<p>Zun\u00e4chst nat\u00fcrlich in der Dokumentation der jeweiligen Software. Wie Du aber schnell feststellen wirst, ist Diese leider nicht immer ausreichend oder ungenau oder unvollst\u00e4ndig oder einfach nur unverst\u00e4ndlich formuliert. Auch Suchmaschinen helfen Dir nur bedingt weiter, da etliche dar\u00fcber zu findenden Hilfestellungen veraltet sind, oder Du schlicht nicht die passenden Suchbegriffe findest. In diesen F\u00e4llen helfen Dir neben den, sofern vorhanden, direkten Support-Angeboten der jeweiligen Software-Hersteller auch unabh\u00e4ngige Stellen wie die RootForum Community gerne weiter.</p>"},{"location":"howtos/general/getting_started/#welche-alternativen-habe-ich","title":"Welche Alternativen habe ich?","text":"<p>Du hast zwei Alternativen: Webhosting und managed Server.</p>"},{"location":"howtos/general/getting_started/#erste-alternative-webhosting","title":"Erste Alternative: Webhosting","text":"<p>Webhosting ist der Klassiker schlechthin und bereitet Dir am wenigsten Arbeit. Beim Webhosting musst Du Dich nur um den Inhalt Deiner Website und das Updaten Deiner Webapplikationen k\u00fcmmern, den Rest nimmt Dir Dein Webhosting-Anbieter ab. Der Nachteil dieser Alternative ist, das Du keinerlei Einfluss auf das zugrundeliegende System hast und nur die Dinge nutzen kannst, die Dir Dein Webhosting-Anbieter zur Verf\u00fcgung stellt. F\u00fcr gut 80% aller privaten und kleinen gewerblichen Websites ist das Webhosting allerdings mehr als ausreichend und kosteng\u00fcnstig dazu.</p>"},{"location":"howtos/general/getting_started/#zweite-alternative-managed-server","title":"Zweite Alternative: Managed Server","text":"<p>Ein managed Server ist im Prinzip ein Zwitter aus dediziertem Server und dem klassischen Webhosting. Auch hier wird Dir die Administration des zugrundeliegenden Systems vom Anbieter abgenommen. Im Gegensatz zum Webhosting hast Du hier aber je nach Anbieter die M\u00f6glichkeit ein wenig Einfluss auf das System auszu\u00fcben. So kannst Du beispielsweise den Anbieter darum Bitten eine bestimmte Konfiguration vorzunehmen oder eine von Dir ben\u00f6tigte Software zu installieren. Der Nachteil dieser Alternative ist, das Du f\u00fcr viele Deiner Sonderw\u00fcnsche auch gesondert zur Kasse gebeten wirst und Dir mancher Anbieter nicht jeden Sonderwunsch erf\u00fcllen kann oder m\u00f6chte. Dennoch sind managed Server f\u00fcr weitere 15% aller privaten und kleinen bis mittleren gewerblichen Websites die richtige Wahl.</p>"},{"location":"howtos/general/getting_started/#weitere-hilfe","title":"Weitere Hilfe","text":"<p>Abschliessend m\u00f6chten wir noch auf weitere Entscheidungshilfen verweisen, denn wir stehen mit unserer Sichtweise auf das Thema Pro und Contra dedizierter Server nicht alleine da und haben vermutlich auch nicht alle Aspekte ausreichend ber\u00fccksichtigt. Die Nachfolgende Auflistung erhebt dabei keinen Anspruch auf Vollst\u00e4ndigkeit:</p> <ul> <li>Missverst\u00e4ndnisse \u00fcber dedizierte root-Server</li> <li>Rootserver Checkliste</li> <li>Admins haften f\u00fcr ihre Server</li> <li>Dein neuer Linux-Server</li> </ul> <p>Wie Du siehst, ist das Thema dedizierter Server sehr komplex und erfordert kontinuirlich viel Arbeit. Es liegt nun an Dir Dich Pro oder Contra dedizierter Server zu entscheiden.</p> <p>Wir hoffen, das wir Dir bei Deiner Entscheidung etwas weiterhelfen konnten.</p> <p>Dein RootService Team</p>"},{"location":"howtos/gentoo/hosting_system/","title":"Hosting System","text":""},{"location":"howtos/gentoo/hosting_system/#einleitung","title":"Einleitung","text":"Warning <p>Dieses HowTo wird seit 2014-09-01 nicht mehr aktiv gepflegt und entspricht daher nicht mehr dem aktuellen Stand.</p> <p>Die Verwendung dieses HowTo geschieht somit auf eigene Gefahr!</p> <p>Dieses HowTo setzt ein wie in Remote Installation beschriebenes, installiertes und konfiguriertes Gentoo Linux Basissystem voraus.</p> <p>Folgende Punkte sind in diesem HowTo zu beachten:</p> <ul> <li>Alle Dienste werden mit einem m\u00f6glichst minimalen und bew\u00e4hrten Funktionsumfang installiert.</li> <li>Alle Dienste werden mit einer m\u00f6glichst sicheren und dennoch flexiblen Konfiguration versehen.</li> <li>Alle Konfigurationen sind selbstst\u00e4ndig auf notwendige individuelle Anpassungen zu kontrollieren.</li> <li>Alle Passworte werden als <code>__PASSWORD__</code> dargestellt und sind selbstst\u00e4ndig durch sichere Passworte zu ersetzen.</li> <li>Alle Domainangaben werden als <code>example.com</code> dargestellt und sind selbstst\u00e4ndig durch die eigene Domain zu ersetzen.</li> <li>Die IP-Adresse des Servers wird als <code>10.0.2.15</code> dargestellt und ist selbstst\u00e4ndig durch die eigene IP-Adresse zu   ersetzen.</li> <li>Postfix und Dovecot teilen sich sowohl den Hostnamen <code>mail.example.com</code> als auch das SSL-Zertifikat.</li> </ul> <p>Unser Hosting System wird folgende Dienste umfassen:</p> <ul> <li>MySQL</li> <li>Postfix</li> <li>Dovecot</li> <li>Apache</li> <li>mod_php</li> </ul> <p>Desweiteren werden wir folgende Applikationen installieren:</p> <ul> <li>phpMyAdmin</li> <li>PostfixAdmin</li> <li>RoundCube</li> </ul>"},{"location":"howtos/gentoo/hosting_system/#openssl","title":"OpenSSL","text":""},{"location":"howtos/gentoo/hosting_system/#openssl-konfigurieren","title":"OpenSSL konfigurieren","text":"<p>Sofern noch nicht w\u00e4hrend der Remote Installation erledigt, m\u00fcssen folgende Optionen in der <code>/etc/ssl/openssl.cnf</code> im Abschnitt <code>[ req_distinguished_name ]</code> angepasst werden:</p> Text Only<pre><code>[ req_distinguished_name ]\ncountryName_default             = DE\nstateOrProvinceName_default     = Bundesland\nlocalityName_default            = Stadt\n0.organizationName_default      = Example Organization\norganizationalUnitName_default  = Administration\ncommonName_default              = example.com\nemailAddress_default            = admin@example.com\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#openssl-ca","title":"OpenSSL CA","text":"<p>Sofern noch nicht w\u00e4hrend der Remote Installation erledigt, wird als N\u00e4chstes ein eigenes CA Zertifikat erstellt und selbst signiert. Hierzu werden jeweils die Default-Werte \u00fcbernommen und sehr sichere Passworte gew\u00e4hlt. Die Option <code>A challenge password</code> sollte jedoch leer gelassen werden, andernfalls kann es zu Problemen mit einigen Diensten kommen:</p> Bash<pre><code>cd /etc/ssl\nmkdir -p demoCA\nmkdir -p demoCA/certs\nmkdir -p demoCA/crl\nmkdir -p demoCA/newcerts\nmkdir -p demoCA/private\ntouch demoCA/index.txt\n\nopenssl req -new -keyout demoCA/private/cakey.pem -out demoCA/careq.pem\nopenssl ca -create_serial -out demoCA/cacert.pem -batch -keyfile demoCA/private/cakey.pem -selfsign -extensions v3_ca -infiles demoCA/careq.pem\ncd\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#openssl-zertifikate","title":"OpenSSL Zertifikate","text":"<p>Wir erstellen uns die nachfolgend ben\u00f6tigten selbstsignierten Zertifikate. Dabei verwenden wir f\u00fcr das Mailserver-Zertifikat <code>mail.example.com</code> und f\u00fcr das Webserver-Zertifikat <code>ssl.example.com</code> als <code>Common Name</code>. Die anderen Fragen beantworten wir jeweils mit den Default-Vorgaben.</p> Bash<pre><code>cd /etc/ssl\nopenssl dhparam -out dh_512.pem -2 -rand /dev/urandom 512\nopenssl dhparam -out dh_1024.pem -2 -rand /dev/urandom 1024\n\nopenssl req -new -keyout mailserver_key.pem -out mailserver_req.pem\nopenssl ca -policy policy_anything -out mailserver_cert.pem -infiles mailserver_req.pem\nopenssl rsa -in mailserver_key.pem -out mailserver_keyrsa.pem\n\nopenssl req -new -keyout webserver_key.pem -out webserver_req.pem\nopenssl ca -policy policy_anything -out webserver_cert.pem -infiles webserver_req.pem\nopenssl rsa -in webserver_key.pem -out webserver_keyrsa.pem\ncd\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#mysql","title":"MySQL","text":"<p>MySQL unterst\u00fctzt mehrere Engines, dieses HowTo beschr\u00e4nkt sich allerdings auf die Beiden am H\u00e4ufigsten verwendeten: MyISAM und InnoDB. Werden weitere Engines ben\u00f6tigt, m\u00fcssen die entsprechenden USE-Flags manuell gesetzt werden.</p> Note <p>Sollen bereits existierende Datenbanken importiert werden, m\u00fcssen diese, sofern noch nicht geschehen, zuvor nach</p> <p>UTF-8 konvertiert werden. Ist dies nicht m\u00f6glich, weil beispielsweise eine Client-Applikation noch kein UTF-8 \u00fcnterst\u00fctzt, so ist in der folgenden <code>/etc/mysql/my.cnf</code> jeweils <code>utf8</code> durch <code>latin1</code> zu ersetzen. Desweiteren muss in diesem Fall f\u00fcr <code>dev-db/mysql</code> in der <code>/etc/portage/package.use</code> zus\u00e4tzlich das USE-Flag <code>latin1</code> gesetzt werden.</p>"},{"location":"howtos/gentoo/hosting_system/#mysql-installieren","title":"MySQL installieren","text":"Bash<pre><code>cat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\ndev-db/mysql  -ssl\nEOF\n\nemerge mysql\n\nrc-update add mysql default\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#mysql-konfigurieren","title":"MySQL konfigurieren","text":"Bash<pre><code>cat &gt; /etc/mysql/my.cnf &lt;&lt; \"EOF\"\n[client]\nport                            = 3306\n\n[mysql]\nprompt                          = \\u@\\h [\\d]&gt;\\_\nno_auto_rehash\n\n[mysqld_safe]\nerr_log                         = /var/log/mysql/mysql.err\n\n[mysqld]\nuser                            = mysql\nport                            = 3306\nbind-address                    = 127.0.0.1\nbasedir                         = /usr\ndatadir                         = /var/lib/mysql\ntmpdir                          = /var/tmp\nlanguage                        = /usr/share/mysql/english\nlog_error                       = /var/log/mysql/mysqld.err\nserver-id                       = 1\nlower_case_table_names          = 1\nsafe-user-create                = 1\nEOF\n\nemerge --config dev-db/mysql\n\ncat &gt; /etc/mysql/my.cnf &lt;&lt; \"EOF\"\n[client]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\nport                            = 3306\n\n[mysql]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\nprompt                          = \\u@\\h [\\d]&gt;\\_\nno_auto_rehash\n\n[mysqladmin]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\n\n[mysqlcheck]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\n\n[mysqldump]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\nmax_allowed_packet              = 32M\nquote_names\nquick\n\n[mysqlimport]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\n\n[mysqlshow]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\n\n[isamchk]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\nkey_buffer_size                 = 256M\n\n[myisamchk]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\nkey_buffer_size                 = 256M\n\n[myisampack]\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\n\n[mysqld_safe]\nerr_log                         = /var/log/mysql/mysql.err\n\n[mysqld]\nuser                            = mysql\nport                            = 3306\nbind-address                    = 127.0.0.1\nsocket                          = /var/run/mysqld/mysqld.sock\npid_file                        = /var/run/mysqld/mysqld.pid\ncharacter-sets-dir              = /usr/share/mysql/charsets\ncharacter-set-server            = utf8\ncollation-server                = utf8_bin\ndefault-storage-engine          = InnoDB\nbasedir                         = /usr\ndatadir                         = /var/lib/mysql\ntmpdir                          = /var/tmp\nslave-load-tmpdir               = /var/tmp\nlanguage                        = /usr/share/mysql/english\nlog_error                       = /var/log/mysql/mysqld.err\nlog-bin                         = /var/lib/mysql/mysql-bin\nrelay-log                       = /var/lib/mysql/relay.log\nrelay-log-index                 = /var/lib/mysql/relay.index\nrelay-log-info-file             = /var/lib/mysql/relay.info\nmaster-info-file                = /var/lib/mysql/master.info\n#master-host                     = &lt;hostname&gt;\n#master-user                     = &lt;username&gt;\n#master-password                 = &lt;password&gt;\n#master-port                     = 3306\n#auto_increment_increment        = 10\n#auto_increment_offset           = 1\nserver-id                       = 1\nback_log                        = 50\nsync_binlog                     = 1\nbinlog_cache_size               = 1M\nmax_binlog_size                 = 100M\nbinlog-format                   = MIXED\nexpire_logs_days                = 7\nslow-query-log                  = 1\nslow-query-log-file             = /var/lib/mysql/slow-query.log\nslave_compressed_protocol       = 1\nlower_case_table_names          = 1\nsafe-user-create                = 1\ndelay-key-write                 = ALL\nmyisam-recover                  = FORCE,BACKUP\nkey_buffer_size                 = 256M\njoin_buffer_size                = 2M\nsort_buffer_size                = 2M\nread_buffer_size                = 2M\nread_rnd_buffer_size            = 8M\nmyisam_sort_buffer_size         = 64M\nmax_allowed_packet              = 32M\nmax_heap_table_size             = 64M\ntmp_table_size                  = 64M\ntable_cache                     = 1024\ntable_definition_cache          = 1024\nquery_cache_type                = 1\nquery_cache_size                = 128M\nquery_cache_limit               = 16M\nthread_concurrency              = 8\nthread_cache_size               = 24\nmax_connections                 = 24\nft_max_word_len                 = 20\nft_min_word_len                 = 3\nlong_query_time                 = 2\nlocal-infile                    = 0\nlog-warnings                    = 2\nlog-slave-updates\nlog-queries-not-using-indexes\nskip-external-locking\nskip-character-set-client-handshake\ninnodb_thread_concurrency       = 8\ninnodb_buffer_pool_size         = 2G\ninnodb_additional_mem_pool_size = 128M\ninnodb_data_home_dir            = /var/lib/mysql\ninnodb_log_group_home_dir       = /var/lib/mysql\ninnodb_data_file_path           = ibdata1:2000M;ibdata2:10M:autoextend\ninnodb_log_file_size            = 128M\ninnodb_log_buffer_size          = 16M\ninnodb_log_files_in_group       = 2\ninnodb_flush_log_at_trx_commit  = 2\ninnodb_max_dirty_pages_pct      = 90\ninnodb_lock_wait_timeout        = 120\ninnodb_file_per_table           = 1\n\n[mysqlhotcopy]\ninteractive_timeout\nEOF\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#mysql-absichern","title":"MySQL absichern","text":"<p>MySQL wird nun zum ersten Mal gestartet, was durch das Erzeugen der InnoDB-Files einige Minuten dauern und zu einer falschen Fehlermeldung des Init-Scripts f\u00fchren kann. Daher warten wir bis im <code>tail -f</code> eine Zeile \u00e4hnlich der folgenden erscheint und beenden <code>tail</code> mittels <code>^C</code> (STRG+C).</p> Bash<pre><code>Version: '5.1.50-log'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  Gentoo Linux mysql-5.1.50-r1\n</code></pre> <p>Abschliessend wird MySQL mittels <code>mysql_secure_installation</code> abgesichert. Hierzu werden alle Fragen, abgesehen vom zuvor gesetztem root-Passwort, jeweils mit einem beherzten Druck auf die Return-Taste beantwortet.</p> Bash<pre><code>/etc/init.d/mysql start\n\ntail -f /var/log/mysql/mysqld.err\n\nmysql_secure_installation\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#dovecot","title":"Dovecot","text":"<p>Dovecot wird inklusive MySQL und TLS/SSL Support installiert und f\u00fcr das Zusammenspiel mit PostfixAdmin konfiguriert.</p>"},{"location":"howtos/gentoo/hosting_system/#dovecot-installieren","title":"Dovecot installieren","text":"Bash<pre><code>cat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\nnet-mail/dovecot  maildir\nEOF\n\nemerge dovecot\n\nrc-update add dovecot default\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#dovecot-konfigurieren","title":"Dovecot konfigurieren","text":"<p><code>dovecot.conf</code> einrichten:</p> Bash<pre><code>cat &gt; /etc/dovecot/dovecot.conf &lt;&lt; \"EOF\"\nprotocols = imap pop3 imaps pop3s\nlisten = 10.0.2.15\ndisable_plaintext_auth = no\nssl = yes\nssl_cert_file = /etc/ssl/mailserver_cert.pem\nssl_key_file = /etc/ssl/mailserver_keyrsa.pem\nssl_cipher_list = RSA:!EXP:!NULL:+HIGH:+MEDIUM:-LOW:-SSLv2\nlogin_process_per_connection = yes\nlogin_processes_count = 3\nlogin_max_processes_count = 128\nmail_location = maildir:/var/vmail/%d/%n\nmail_privileged_group = mail\ndotlock_use_excl = yes\nverbose_proctitle = yes\nfirst_valid_uid = 207\nlast_valid_uid = 207\nfirst_valid_gid = 207\nlast_valid_gid = 207\nmaildir_copy_with_hardlinks = yes\nprotocol imap {\n  mail_plugins = quota imap_quota\n  imap_client_workarounds = delay-newmail netscape-eoh tb-extra-mailbox-sep\n}\nprotocol pop3 {\n  pop3_uidl_format = %08Xu%08Xv\n  mail_plugins = quota\n  pop3_client_workarounds = outlook-no-nuls oe-ns-eoh\n}\nprotocol lda {\n  postmaster_address = postmaster@example.com\n  hostname = mail.example.com\n  quota_full_tempfail = no\n  sendmail_path = /usr/sbin/sendmail\n}\nauth_username_format = %Lu\nauth default {\n  mechanisms = plain login\n  passdb sql {\n    args = /etc/dovecot/dovecot-sql.conf\n  }\n  userdb sql {\n    args = /etc/dovecot/dovecot-sql.conf\n  }\n  user = root\n  socket listen {\n    master {\n      path = /var/run/dovecot/auth-master\n      mode = 0600\n    }\n    client {\n      path = /var/spool/postfix/private/auth\n      mode = 0660\n      user = postfix\n      group = postfix\n    }\n  }\n}\ndict {\n}\nplugin {\n  quota = maildir\n  quota_rule = *:storage=1048576\n}\nEOF\n</code></pre> <p><code>dovecot-sql.conf</code> einrichten:</p> Bash<pre><code>cat &gt; /etc/dovecot/dovecot-sql.conf &lt;&lt; \"EOF\"\ndriver = mysql\nconnect = host=localhost dbname=postfix user=postfix password=__PASSWORD__\ndefault_pass_scheme = MD5-CRYPT\npassword_query = SELECT password FROM mailbox WHERE username = '%u'\nuser_query = SELECT maildir, 207 AS uid, 207 AS gid, CONCAT('maildir:storage=', FLOOR( quota / 1024 ) ) AS quota FROM mailbox WHERE username = '%u' AND active = '1'\nEOF\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#postfix","title":"Postfix","text":"<p>Postfix wird inklusive MySQL, Dovecot-SASL und TLS/SSL Support installiert und f\u00fcr das Zusammenspiel mit PostfixAdmin konfiguriert. Zudem werden die Empfehlungen aus dem Postfix Anti-UCE Cheat Sheet umgesetzt. Zus\u00e4tzlich wird als gute und recht zuverl\u00e4ssige Anti-Spam L\u00f6sung <code>policyd-weight</code> eingerichtet.</p>"},{"location":"howtos/gentoo/hosting_system/#postfix-installieren","title":"Postfix installieren","text":"Bash<pre><code>cat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\nmail-mta/postfix  dovecot-sasl vda\nEOF\n\nemerge -C ssmtp\nemerge postfix\n\nrc-update add postfix default\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#policyd-weight-installieren","title":"policyd-weight installieren","text":"Bash<pre><code>cat &gt;&gt; /etc/portage/package.keywords &lt;&lt; \"EOF\"\nmail-filter/policyd-weight ~amd64\nEOF\n\nemerge policyd-weight\n\nrc-update add policyd-weight default\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#postfix-konfigurieren","title":"Postfix konfigurieren","text":"<p>Aliases einrichten:</p> Bash<pre><code>cat &gt; /etc/mail/aliases &lt;&lt; \"EOF\"\n# Basic system aliases -- these MUST be present.\nMAILER-DAEMON:      postmaster\npostmaster:         root\n\n# General redirections for pseudo accounts.\nadm:                root\nbin:                root\ndaemon:             root\nexim:               root\nlp:                 root\nmail:               root\nnamed:              root\nnobody:             root\npostfix:            root\n\n# Well-known aliases -- these should be filled in!\nroot:               admin@example.com\noperator:           admin@example.com\n\n# Standard RFC2142 aliases\nabuse:              postmaster\nftp:                root\nhostmaster:         root\nnews:               usenet\nnoc:                root\nsecurity:           root\nusenet:             root\nuucp:               root\nwebmaster:          root\nwww:                webmaster\n\n# trap decode to catch security attacks\ndecode:             /dev/null\nEOF\n\n/usr/bin/newaliases\n</code></pre> <p><code>main.cf</code> einrichten:</p> Bash<pre><code>cat &gt; /etc/postfix/main.cf &lt;&lt; \"EOF\"\nallow_percent_hack = no\nbiff = no\nbroken_sasl_auth_clients = yes\ncommand_directory = /usr/sbin\nconfig_directory = /etc/postfix\ndaemon_directory = /usr/lib64/postfix\ndata_directory = /var/lib/postfix\ndisable_vrfy_command = yes\nhome_mailbox = .maildir/\n#html_directory = /usr/share/doc/postfix-2.6.6/html\ninet_interfaces = 127.0.0.1, 10.0.2.15\nmail_owner = postfix\nmailq_path = /usr/bin/mailq\nmanpage_directory = /usr/share/man\nmydestination = $myhostname, localhost.$mydomain, localhost\nmydomain = example.com\nmyhostname = mail.$mydomain\nmynetworks = 127.0.0.0/8, 10.0.2.15/32\nmyorigin = $mydomain\nnewaliases_path = /usr/bin/newaliases\nproxy_read_maps =\n  $local_recipient_maps\n  $mydestination\n  $virtual_alias_maps\n  $virtual_alias_domains\n  $virtual_mailbox_maps\n  $virtual_mailbox_domains\n  $relay_recipient_maps\n  $relay_domains\n  $canonical_maps\n  $sender_canonical_maps\n  $recipient_canonical_maps\n  $relocated_maps\n  $transport_maps\n  $mynetworks\n  $sender_bcc_maps\n  $recipient_bcc_maps\n  $smtp_generic_maps\n  $lmtp_generic_maps\n  $virtual_mailbox_limit_maps\nqueue_directory = /var/spool/postfix\n#readme_directory = /usr/share/doc/postfix-2.6.6/readme\nrelay_domains = proxy:mysql:/etc/postfix/sql/mysql_relay_domains_maps.cf\nsample_directory = /etc/postfix\nsendmail_path = /usr/sbin/sendmail\nsetgid_group = postdrop\nsmtp_tls_ciphers = high\nsmtp_tls_exclude_ciphers = aNULL, RC4, MD5\nsmtp_tls_mandatory_ciphers = high\nsmtp_tls_mandatory_exclude_ciphers = aNULL, RC4, MD5\nsmtp_tls_mandatory_protocols = SSLv3, TLSv1, !SSLv2\nsmtp_tls_note_starttls_offer = yes\nsmtp_tls_protocols = SSLv3, TLSv1, !SSLv2\nsmtp_tls_received_header = yes\nsmtp_tls_security_level = may\nsmtp_tls_session_cache_database = btree:/var/lib/postfix/smtp_scache\nsmtp_tls_session_cache_timeout = 3600s\nsmtpd_client_restrictions =\n  permit_mynetworks,\n  permit_sasl_authenticated,\n  reject_unknown_reverse_client_hostname,\n  reject_unauth_pipelining,\n  permit\nsmtpd_data_restrictions =\n  permit_mynetworks,\n  permit_sasl_authenticated,\n  reject_unauth_pipelining,\n  permit\nsmtpd_helo_required = yes\nsmtpd_helo_restrictions =\n  permit_mynetworks,\n  permit_sasl_authenticated,\n  reject_invalid_helo_hostname,\n  reject_non_fqdn_helo_hostname,\n  reject_unauth_pipelining,\n  permit\nsmtpd_recipient_restrictions =\n  permit_mynetworks,\n  permit_sasl_authenticated,\n  reject_non_fqdn_recipient,\n  reject_unknown_recipient_domain,\n  check_recipient_mx_access cidr:/etc/postfix/mx_access,\n  reject_unauth_destination,\n  check_recipient_access pcre:/etc/postfix/recipient_checks.pcre,\n  check_policy_service inet:127.0.0.1:12525,\n  reject_unauth_pipelining,\n  permit\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_authenticated_header = yes\nsmtpd_sasl_path = private/auth\nsmtpd_sender_restrictions =\n  permit_mynetworks,\n  permit_sasl_authenticated,\n  reject_non_fqdn_sender,\n  reject_unknown_sender_domain,\n  reject_unauth_pipelining,\n  permit\nsmtpd_tls_CAfile = /etc/ssl/demoCA/cacert.pem\nsmtpd_tls_auth_only = yes\nsmtpd_tls_cert_file = /etc/ssl/mailserver_cert.pem\nsmtpd_tls_ciphers = high\nsmtpd_tls_dh1024_param_file = /etc/ssl/dh_1024.pem\nsmtpd_tls_dh512_param_file = /etc/ssl/dh_512.pem\nsmtpd_tls_exclude_ciphers = aNULL, RC4, MD5\nsmtpd_tls_key_file = /etc/ssl/mailserver_keyrsa.pem\nsmtpd_tls_mandatory_ciphers = high\nsmtpd_tls_mandatory_exclude_ciphers = aNULL, RC4, MD5\nsmtpd_tls_mandatory_protocols = SSLv3, TLSv1, !SSLv2\nsmtpd_tls_protocols = SSLv3, TLSv1, !SSLv2\nsmtpd_tls_received_header = yes\nsmtpd_tls_security_level = may\nsmtpd_tls_session_cache_database = btree:/var/lib/postfix/smtpd_scache\nsmtpd_tls_session_cache_timeout = 3600s\nstrict_rfc821_envelopes = yes\ntransport_maps = hash:/etc/postfix/transport\nunknown_local_recipient_reject_code = 450\nvirtual_minimum_uid = 125\nvirtual_uid_maps = static:125\nvirtual_gid_maps = static:125\nvirtual_mailbox_base = /var/vmail\nvirtual_mailbox_domains = proxy:mysql:/etc/postfix/sql/mysql_virtual_domains_maps.cf\nvirtual_alias_maps =\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf\nvirtual_mailbox_maps =\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf\nvirtual_create_maildirsize = yes\nvirtual_mailbox_extended = yes\nvirtual_mailbox_limit_maps = mysql:/etc/postfix/sql/mysql_virtual_mailbox_limit_maps.cf\nvirtual_mailbox_limit_override = yes\nvirtual_maildir_limit_message = Sorry, the user's maildir has overdrawn his diskspace quota, please try again later.\nvirtual_overquota_bounce = yes\nEOF\n</code></pre> <p><code>master.cf</code> einrichten:</p> Bash<pre><code>cat &gt; /etc/postfix/master.cf &lt;&lt; \"EOF\"\n#\n# Postfix master process configuration file.  For details on the format\n# of the file, see the master(5) manual page (command: \"man 5 master\").\n#\n# Do not forget to execute \"postfix reload\" after editing this file.\n#\n# ==========================================================================\n# service type  private unpriv  chroot  wakeup  maxproc command + args\n#               (yes)   (yes)   (yes)   (never) (100)\n# ==========================================================================\nsmtp      inet  n       -       n       -       -       smtpd\nsubmission inet n       -       n       -       -       smtpd\n  -o smtpd_tls_security_level=encrypt\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_client_restrictions=permit_sasl_authenticated,reject\n  -o milter_macro_daemon_name=ORIGINATING\nsmtps     inet  n       -       n       -       -       smtpd\n  -o smtpd_tls_wrappermode=yes\n  -o smtpd_sasl_auth_enable=yes\n  -o smtpd_client_restrictions=permit_sasl_authenticated,reject\n  -o milter_macro_daemon_name=ORIGINATING\n#628      inet  n       -       n       -       -       qmqpd\npickup    fifo  n       -       n       60      1       pickup\ncleanup   unix  n       -       n       -       0       cleanup\nqmgr      fifo  n       -       n       300     1       qmgr\n#qmgr     fifo  n       -       n       300     1       oqmgr\ntlsmgr    unix  -       -       n       1000?   1       tlsmgr\nrewrite   unix  -       -       n       -       -       trivial-rewrite\nbounce    unix  -       -       n       -       0       bounce\ndefer     unix  -       -       n       -       0       bounce\ntrace     unix  -       -       n       -       0       bounce\nverify    unix  -       -       n       -       1       verify\nflush     unix  n       -       n       1000?   0       flush\nproxymap  unix  -       -       n       -       -       proxymap\nproxywrite unix -       -       n       -       1       proxymap\nsmtp      unix  -       -       n       -       -       smtp\n# When relaying mail as backup MX, disable fallback_relay to avoid MX loops\nrelay     unix  -       -       n       -       -       smtp\n        -o smtp_fallback_relay=\n#       -o smtp_helo_timeout=5 -o smtp_connect_timeout=5\nshowq     unix  n       -       n       -       -       showq\nerror     unix  -       -       n       -       -       error\nretry     unix  -       -       n       -       -       error\ndiscard   unix  -       -       n       -       -       discard\nlocal     unix  -       n       n       -       -       local\nvirtual   unix  -       n       n       -       -       virtual\nlmtp      unix  -       -       n       -       -       lmtp\nanvil     unix  -       -       n       -       1       anvil\nscache    unix  -       -       n       -       1       scache\n#\n# ====================================================================\n# Interfaces to non-Postfix software. Be sure to examine the manual\n# pages of the non-Postfix software to find out what options it wants.\n#\n# Many of the following services use the Postfix pipe(8) delivery\n# agent.  See the pipe(8) man page for information about ${recipient}\n# and other message envelope options.\n# ====================================================================\n#\n# maildrop. See the Postfix MAILDROP_README file for details.\n# Also specify in main.cf: maildrop_destination_recipient_limit=1\n#\n#maildrop  unix  -       n       n       -       -       pipe\n#  flags=DRhu user=vmail argv=/usr/bin/maildrop -d ${recipient}\n#\n# ====================================================================\n#\n# The Cyrus deliver program has changed incompatibly, multiple times.\n#\n#old-cyrus unix  -       n       n       -       -       pipe\n#  flags=R user=cyrus argv=/cyrus/bin/deliver -e -m ${extension} ${user}\n#\n# ====================================================================\n#\n# Cyrus 2.1.5 (Amos Gouaux)\n# Also specify in main.cf: cyrus_destination_recipient_limit=1\n#\n#cyrus     unix  -       n       n       -       -       pipe\n#  user=cyrus argv=/cyrus/bin/deliver -e -r ${sender} -m ${extension} ${user}\n#\n# ====================================================================\n#\n# See the Postfix UUCP_README file for configuration details.\n#\n#uucp      unix  -       n       n       -       -       pipe\n#  flags=Fqhu user=uucp argv=uux -r -n -z -a$sender - $nexthop!rmail ($recipient)\n#\n# ====================================================================\n#\n# Other external delivery methods.\n#\n#ifmail    unix  -       n       n       -       -       pipe\n#  flags=F user=ftn argv=/usr/lib/ifmail/ifmail -r $nexthop ($recipient)\n#\n#bsmtp     unix  -       n       n       -       -       pipe\n#  flags=Fq. user=bsmtp argv=/usr/sbin/bsmtp -f $sender $nexthop $recipient\n#\n#scalemail-backend unix -       n       n       -       2       pipe\n#  flags=R user=scalemail argv=/usr/lib/scalemail/bin/scalemail-store\n#  ${nexthop} ${user} ${extension}\n#\n#mailman   unix  -       n       n       -       -       pipe\n#  flags=FR user=list argv=/usr/lib/mailman/bin/postfix-to-mailman.py\n#  ${nexthop} ${user}\nEOF\n</code></pre> <p><code>mysql_*_maps.cf</code> einrichten:</p> Note <p>Bitte jeweils das gleiche Passwort wie in der <code>dovecot-sql.conf</code> aus der Dovecot Konfiguration verwenden.</p> Bash<pre><code>mkdir -p /etc/postfix/sql\n\ncat &gt; /etc/postfix/sql/mysql_relay_domains_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT domain FROM domain WHERE domain = '%s' AND backupmx = '1' AND active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('@', alias_domain.target_domain) AND alias.active = '1' AND alias_domain.active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT maildir FROM mailbox,alias_domain WHERE alias_domain.alias_domain = '%d' and mailbox.username = CONCAT('%u', '@', alias_domain.target_domain) AND mailbox.active = '1' AND alias_domain.active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_alias_domain_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('%u', '@', alias_domain.target_domain) AND alias.active = '1' AND alias_domain.active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_alias_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias WHERE address = '%s' AND active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_domains_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT domain FROM domain WHERE domain = '%s' AND backupmx = '0' AND active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_mailbox_limit_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT quota FROM mailbox WHERE username = '%s' AND active = '1'\nEOF\n\ncat &gt; /etc/postfix/sql/mysql_virtual_mailbox_maps.cf &lt;&lt; \"EOF\"\nuser = postfix\npassword = __PASSWORD__\nhosts = localhost\ndbname = postfix\nquery = SELECT maildir FROM mailbox WHERE username = '%s' AND active = '1'\nEOF\n\nchown root:postfix /etc/postfix/sql/mysql_*_maps.cf\nchmod 0640 /etc/postfix/sql/mysql_*_maps.cf\n</code></pre> <p>Transport map einrichten:</p> Bash<pre><code>cat &gt;&gt; /etc/postfix/transport &lt;&lt; \"EOF\"\nautoreply.example.com   vacation:\nEOF\n\npostmap /etc/postfix/transport\n</code></pre> <p>Restriktionen einrichten:</p> Bash<pre><code>cat &gt; /etc/postfix/recipient_checks.pcre &lt;&lt; \"EOF\"\n/^\\@/             550 Invalid address format.\n/[!%\\@].*\\@/      550 This server disallows weird address syntax.\n/^postmaster\\@/   OK\n/^hostmaster\\@/   OK\n/^security\\@/     OK\n/^abuse\\@/        OK\n/^admin\\@/        OK\nEOF\n\ncat &gt; /etc/postfix/mx_access &lt;&lt; \"EOF\"\n0.0.0.0/8            REJECT MX in RFC 5735 broadcast network\n10.0.0.0/8           REJECT MX in RFC 5735 private network\n127.0.0.0/8          REJECT MX in RFC 5735 loopback network\n169.254.0.0/16       REJECT MX in RFC 5735 link local network\n172.16.0.0/12        REJECT MX in RFC 5735 private network\n192.0.0.0/24         REJECT MX in RFC 5735 IETF protocol assignments network\n192.0.2.0/24         REJECT MX in RFC 5735 TEST-NET-1 network\n192.88.99.0/24       REJECT MX in RFC 5735 6to4 relay anycast network\n192.168.0.0/16       REJECT MX in RFC 5735 private network\n198.18.0.0/15        REJECT MX in RFC 5735 interconnect device benchmark testing network\n198.51.100.0/24      REJECT MX in RFC 5735 TEST-NET-2 network\n203.0.113.0/24       REJECT MX in RFC 5735 TEST-NET-3 network\n224.0.0.0/4          REJECT MX in RFC 5735 multicast network\n240.0.0.0/4          REJECT MX in RFC 5735 reserved network\n255.255.255.255/32   REJECT MX in RFC 5735 limited broadcast destination address\nEOF\n\npostmap /etc/postfix/mx_access\n</code></pre> <p>Abschliessende Arbeiten:</p> Bash<pre><code>gpasswd -a postfix mail\n\nmkdir -p /var/vmail\nchmod 0750 /var/vmail\nchown postfix:postfix /var/vmail\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#apache","title":"Apache","text":"<p>Die folgende Konfiguration verwendet f\u00fcr den Default-Host den Pfad <code>/var/www/vhosts/www.example.com</code>, f\u00fcr den Default-SSL-Host den Pfad <code>/var/www/vhosts/ssl.example.com</code> und f\u00fcr die regul\u00e4ren Virtual-Hosts den Pfad <code>/var/www/vhosts/sub.domain.tld</code>.</p>"},{"location":"howtos/gentoo/hosting_system/#apache-installieren","title":"Apache installieren","text":"Bash<pre><code>cat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\ndev-libs/apr-util  -mysql\nwww-servers/apache  -threads suexec\nEOF\n\ncat &gt;&gt; /etc/make.conf &lt;&lt; \"EOF\"\nAPACHE2_MODULES=\"*\"\nAPACHE2_MPMS=\"prefork\"\nEOF\n\nemerge apache\n\nrc-update add apache2 default\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#apache-konfigurieren","title":"Apache konfigurieren","text":"<p>Docroots f\u00fcr die Default-Hosts erstellen:</p> Bash<pre><code>mkdir -p /var/www/vhosts/www.example.com/logs\nmkdir -p /var/www/vhosts/www.example.com/data\nchmod 0750 /var/www/vhosts/www.example.com/data\nchown apache:apache /var/www/vhosts/www.example.com/data\n\nmkdir -p /var/www/vhosts/ssl.example.com/logs\nmkdir -p /var/www/vhosts/ssl.example.com/data\nchmod 0750 /var/www/vhosts/ssl.example.com/data\nchown apache:apache /var/www/vhosts/ssl.example.com/data\n</code></pre> <p>Grundkonfiguration:</p> Bash<pre><code>emerge --config apache\n\nsed 's@^APACHE2_OPTS\\(.*\\)@#APACHE2_OPTS\\1\\\nAPACHE2_OPTS=\"\"@' -i /etc/conf.d/apache2\nsed 's@^#RELOAD_TYPE@RELOAD_TYPE@' -i /etc/conf.d/apache2\n</code></pre> <p><code>httpd.conf</code> einrichten:</p> Bash<pre><code>cat &gt; /etc/apache2/httpd.conf &lt;&lt; \"EOF\"\nServerRoot \"/usr/lib64/apache2\"\nPidFile \"/var/run/apache2.pid\"\nLockFile \"/var/run/apache2.lock\"\nTimeout 30\nKeepAlive On\nKeepAliveTimeout 2\nMaxKeepAliveRequests 100\n&lt;IfModule mpm_prefork_module&gt;\n    StartServers         10\n    MinSpareServers      10\n    MaxSpareServers      10\n    MaxClients          200\n    MaxRequestsPerChild 500\n&lt;/IfModule&gt;\n&lt;IfModule mpm_worker_module&gt;\n    StartServers          2\n    MinSpareThreads      25\n    MaxSpareThreads      75\n    ThreadsPerChild      25\n    MaxClients          150\n    MaxRequestsPerChild 500\n&lt;/IfModule&gt;\nListen 10.0.2.15:80\nLoadModule actions_module modules/mod_actions.so\nLoadModule alias_module modules/mod_alias.so\n#LoadModule asis_module modules/mod_asis.so\nLoadModule auth_basic_module modules/mod_auth_basic.so\n#LoadModule auth_digest_module modules/mod_auth_digest.so\n#LoadModule authn_alias_module modules/mod_authn_alias.so\n#LoadModule authn_anon_module modules/mod_authn_anon.so\n#LoadModule authn_dbd_module modules/mod_authn_dbd.so\n#LoadModule authn_dbm_module modules/mod_authn_dbm.so\nLoadModule authn_default_module modules/mod_authn_default.so\nLoadModule authn_file_module modules/mod_authn_file.so\n#LoadModule authz_dbm_module modules/mod_authz_dbm.so\nLoadModule authz_default_module modules/mod_authz_default.so\nLoadModule authz_groupfile_module modules/mod_authz_groupfile.so\nLoadModule authz_host_module modules/mod_authz_host.so\n#LoadModule authz_owner_module modules/mod_authz_owner.so\nLoadModule authz_user_module modules/mod_authz_user.so\nLoadModule autoindex_module modules/mod_autoindex.so\n#LoadModule cache_module modules/mod_cache.so\n#LoadModule cern_meta_module modules/mod_cern_meta.so\nLoadModule cgi_module modules/mod_cgi.so\n#LoadModule cgid_module modules/mod_cgid.so\n#LoadModule charset_lite_module modules/mod_charset_lite.so\n#LoadModule dav_module modules/mod_dav.so\n#LoadModule dav_fs_module modules/mod_dav_fs.so\n#LoadModule dav_lock_module modules/mod_dav_lock.so\n#LoadModule dbd_module modules/mod_dbd.so\nLoadModule deflate_module modules/mod_deflate.so\nLoadModule dir_module modules/mod_dir.so\n#LoadModule disk_cache_module modules/mod_disk_cache.so\n#LoadModule dumpio_module modules/mod_dumpio.so\nLoadModule env_module modules/mod_env.so\nLoadModule expires_module modules/mod_expires.so\n#LoadModule ext_filter_module modules/mod_ext_filter.so\n#LoadModule file_cache_module modules/mod_file_cache.so\n#LoadModule filter_module modules/mod_filter.so\nLoadModule headers_module modules/mod_headers.so\n#LoadModule ident_module modules/mod_ident.so\n#LoadModule imagemap_module modules/mod_imagemap.so\nLoadModule include_module modules/mod_include.so\nLoadModule info_module modules/mod_info.so\nLoadModule log_config_module modules/mod_log_config.so\n#LoadModule log_forensic_module modules/mod_log_forensic.so\n#LoadModule logio_module modules/mod_logio.so\n#LoadModule mem_cache_module modules/mod_mem_cache.so\nLoadModule mime_module modules/mod_mime.so\n#LoadModule mime_magic_module modules/mod_mime_magic.so\n#LoadModule negotiation_module modules/mod_negotiation.so\n#LoadModule proxy_module modules/mod_proxy.so\n#LoadModule proxy_ajp_module modules/mod_proxy_ajp.so\n#LoadModule proxy_balancer_module modules/mod_proxy_balancer.so\n#LoadModule proxy_connect_module modules/mod_proxy_connect.so\n#LoadModule proxy_ftp_module modules/mod_proxy_ftp.so\n#LoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule setenvif_module modules/mod_setenvif.so\n#LoadModule speling_module modules/mod_speling.so\nLoadModule ssl_module modules/mod_ssl.so\nLoadModule status_module modules/mod_status.so\n#LoadModule substitute_module modules/mod_substitute.so\nLoadModule suexec_module modules/mod_suexec.so\nLoadModule unique_id_module modules/mod_unique_id.so\n#LoadModule userdir_module modules/mod_userdir.so\n#LoadModule usertrack_module modules/mod_usertrack.so\n#LoadModule version_module modules/mod_version.so\n#LoadModule vhost_alias_module modules/mod_vhost_alias.so\nUser apache\nGroup apache\nServerTokens OS\nServerSignature On\nUseCanonicalName On\nTraceEnable off\n&lt;Directory \"/\"&gt;\n    Options -All +FollowSymLinks\n    AllowOverride None\n    Order Deny,Allow\n    Deny from all\n&lt;/Directory&gt;\nServerName www.example.com\nServerAdmin webmaster@example.com\nDocumentRoot \"/var/www/vhosts/www.example.com/data\"\n&lt;Directory \"/var/www/vhosts/www.example.com/data\"&gt;\n    Options -All +FollowSymLinks +ExecCGI\n    AllowOverride Options FileInfo AuthConfig Limit\n    Order Allow,Deny\n    Allow from all\n&lt;/Directory&gt;\nDirectoryIndex index.html index.htm index.php\nAccessFileName .htaccess\n&lt;FilesMatch \"^[\\._]ht\"&gt;\n    Order Allow,Deny\n    Deny from all\n&lt;/FilesMatch&gt;\nTypesConfig \"/etc/mime.types\"\nDefaultType text/plain\n&lt;IfModule mime_magic_module&gt;\n    MIMEMagicFile \"/etc/apache2/magic\"\n&lt;/IfModule&gt;\nHostnameLookups On\n&lt;IfModule logio_module&gt;\n    LogFormat \"%h %l %u %t \\\"%r\\\" %&gt;s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\" combinedio\n&lt;/IfModule&gt;\nLogFormat \"%h %l %u %t \\\"%r\\\" %&gt;s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined\nLogFormat \"%h %l %u %t \\\"%r\\\" %&gt;s %b\" common\nCustomLog \"/var/www/vhosts/www.example.com/logs/access_log\" combined\nErrorLog \"/var/www/vhosts/www.example.com/logs/error_log\"\nLogLevel warn\n&lt;IfModule cgid_module&gt;\n    Scriptsock \"/var/run/cgisock\"\n&lt;/IfModule&gt;\nReadmeName README.html\nHeaderName HEADER.html\nIndexOptions FancyIndexing VersionSort FoldersFirst IgnoreCase IgnoreClient NameWidth=* SuppressDescription XHTML\nIndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t .svn\nIndexOrderDefault Ascending Name\nAlias \"/icons/\" \"/usr/share/apache2/icons/\"\n&lt;Directory \"/usr/share/apache2/icons\"&gt;\n    Options -All +MultiViews\n    AllowOverride None\n    Order Allow,Deny\n    Allow from all\n&lt;/Directory&gt;\nAddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip\nAddIconByType (TXT,/icons/text.gif) text/*\nAddIconByType (IMG,/icons/image2.gif) image/*\nAddIconByType (SND,/icons/sound2.gif) audio/*\nAddIconByType (VID,/icons/movie.gif) video/*\nAddIcon /icons/binary.gif .bin .exe\nAddIcon /icons/binhex.gif .hqx\nAddIcon /icons/tar.gif .tar\nAddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv\nAddIcon /icons/compressed.gif .Z .z .tgz .gz .zip\nAddIcon /icons/a.gif .ps .ai .eps\nAddIcon /icons/layout.gif .html .shtml .htm .pdf\nAddIcon /icons/text.gif .txt\nAddIcon /icons/c.gif .c\nAddIcon /icons/p.gif .pl .py\nAddIcon /icons/f.gif .for\nAddIcon /icons/dvi.gif .dvi\nAddIcon /icons/uuencoded.gif .uu\nAddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl\nAddIcon /icons/tex.gif .tex\nAddIcon /icons/bomb.gif core\nAddIcon /icons/back.gif ..\nAddIcon /icons/hand.right.gif README\nAddIcon /icons/folder.gif ^^DIRECTORY^^\nAddIcon /icons/blank.gif ^^BLANKICON^^\nDefaultIcon /icons/unknown.gif\nAddType application/x-httpd-php-source .phps\nAddType application/x-httpd-php .php\nAddType application/x-gzip .gz .tgz\nAddType application/x-compress .Z\nAddType text/x-component .htc\nAddType text/html .shtml\nAddOutputFilter INCLUDES .shtml\nAddHandler php5-script .php .phps\nAddHandler cgi-script .cgi .pl\nFileETag None\nHeader unset ETag\nHeader unset Pragma\nHeader set Vary \"Accept-Encoding, User-Agent\"\nHeader set Cache-Control \"public, proxy-revalidate, must-revalidate\"\nExpiresActive On\nExpiresDefault A604800\nExpiresByType text/cache-manifest A0\n&lt;FilesMatch \"\\.(phps|php|pl|py|cgi)$\"&gt;\n    ExpiresDefault A0\n&lt;/FilesMatch&gt;\n&lt;FilesMatch \"favicon\\.(ico|png)$\"&gt;\n    AddType image/vnd.microsoft.icon .ico\n    ExpiresDefault A2592000\n&lt;/FilesMatch&gt;\n&lt;FilesMatch \"\\.(ico|gif|png|jpe?g|css)$\"&gt;\n    RequestHeader unset Cookie\n    Header unset Set-Cookie\n&lt;/FilesMatch&gt;\n&lt;IfModule dav_module&gt;\n    &lt;IfModule dav_fs_module&gt;\n        DavLockDB \"/var/lib/dav/lockdb\"\n        Alias \"/uploads/\" \"/var/www/uploads/\"\n        &lt;Directory \"/var/www/uploads\"&gt;\n            Dav On\n            AuthType Digest\n            AuthName DAV-upload\n            AuthUserFile \"/var/www/.htpasswd-dav\"\n            Order allow,deny\n            Allow from all\n            &lt;LimitExcept GET OPTIONS&gt;\n                require user admin\n            &lt;/LimitExcept&gt;\n        &lt;/Directory&gt;\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\n&lt;IfModule cache_module&gt;\n    &lt;IfModule mem_cache_module&gt;\n        CacheEnable mem \"/\"\n        MCacheSize 131072\n        MCacheMaxObjectCount 1000\n        MCacheMinObjectSize 1\n        MCacheMaxObjectSize 2048\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\n&lt;IfModule userdir_module&gt;\n    UserDir public_html\n    UserDir disabled root toor daemon operator bin tty kmem games news man sshd bind proxy _pflogd _dhcp uucp pop www nobody mailnull smmsp admin\n    &lt;Directory \"/home/*/public_html\"&gt;\n        AllowOverride FileInfo AuthConfig Limit Indexes\n        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec\n        &lt;Limit GET POST OPTIONS&gt;\n            Order Allow,Deny\n            Allow from all\n        &lt;/Limit&gt;\n        &lt;LimitExcept GET POST OPTIONS&gt;\n            Order Deny,Allow\n            Deny from all\n        &lt;/LimitExcept&gt;\n    &lt;/Directory&gt;\n    &lt;Directory /home/*/public_html/cgi-bin&gt;\n        Options ExecCGI\n        SetHandler cgi-script\n    &lt;/Directory&gt;\n&lt;/IfModule&gt;\n&lt;IfModule info_module&gt;\n    &lt;IfModule status_module&gt;\n        &lt;Location \"/server-status\"&gt;\n            SetHandler server-status\n            Order Deny,Allow\n            Deny from all\n            Allow from localhost\n        &lt;/Location&gt;\n        ExtendedStatus On\n        &lt;Location \"/server-info\"&gt;\n            SetHandler server-info\n            Order Deny,Allow\n            Deny from all\n            Allow from localhost\n        &lt;/Location&gt;\n    &lt;/IfModule&gt;\n&lt;/IfModule&gt;\n&lt;Location \"/\"&gt;\n    SetEnvIfNoCase Request_URI \\.(?:ico|gif|jpe?g|png|pdf|flv|bz2|gz|tgz|zip|htc)$ no-gzip\n    SetOutputFilter DEFLATE\n&lt;/Location&gt;\n&lt;IfModule ssl_module&gt;\n    Listen 10.0.2.15:443\n    AddType application/x-x509-ca-cert .crt\n    AddType application/x-pkcs7-crl .crl\n    SSLRandomSeed startup builtin\n    SSLRandomSeed connect builtin\n    SSLPassPhraseDialog builtin\n    SSLSessionCache \"shmcb:/var/run/ssl_scache(512000)\"\n    SSLSessionCacheTimeout 300\n    SSLMutex \"file:/var/run/ssl_mutex\"\n    &lt;VirtualHost 10.0.2.15:443&gt;\n        ServerName ssl.example.com\n        ServerAdmin webmaster@example.com\n        CustomLog \"/var/www/vhosts/ssl.example.com/logs/ssl_request_log\" \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \\\"%r\\\" %b\"\n        TransferLog \"/var/www/vhosts/ssl.example.com/logs/access_log\"\n        ErrorLog \"/var/www/vhosts/ssl.example.com/logs/error_log\"\n        DocumentRoot \"/var/www/vhosts/ssl.example.com/data\"\n        &lt;Directory \"/var/www/vhosts/ssl.example.com/data\"&gt;\n            Options -All +FollowSymLinks +ExecCGI\n            AllowOverride Options FileInfo AuthConfig Limit\n            Order Allow,Deny\n            Allow from all\n        &lt;/Directory&gt;\n        SSLEngine on\n        SSLProtocol all -SSLv2\n        SSLCipherSuite RSA:!EXP:!NULL:+HIGH:+MEDIUM:-LOW:-SSLv2\n        SSLCertificateFile \"/etc/ssl/webserver_cert.pem\"\n        SSLCertificateKeyFile \"/etc/ssl/webserver_keyrsa.pem\"\n        &lt;FilesMatch \"\\.(phps|php|pl|py|cgi|shtml)$\"&gt;\n            SSLOptions +StdEnvVars\n        &lt;/FilesMatch&gt;\n        BrowserMatch \".*MSIE.*\" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0\n    &lt;/VirtualHost&gt;\n    AcceptPathInfo On\n&lt;/IfModule&gt;\nNameVirtualHost 10.0.2.15:80\n&lt;VirtualHost 10.0.2.15:80&gt;\n    ServerName www.example.com\n    CustomLog \"/var/www/vhosts/www.example.com/logs/access_log\" combined\n    ErrorLog \"/var/www/vhosts/www.example.com/logs/error_log\"\n    DocumentRoot \"/var/www/vhosts/www.example.com/data\"\n    &lt;Directory \"/var/www/vhosts/www.example.com/data\"&gt;\n        Options -All +FollowSymLinks +ExecCGI\n        AllowOverride Options FileInfo AuthConfig Limit\n        Order Allow,Deny\n        Allow from all\n    &lt;/Directory&gt;\n    AcceptPathInfo On\n&lt;/VirtualHost&gt;\n&lt;VirtualHost 10.0.2.15:80&gt;\n    ServerName example.com\n    Redirect 301 / https://www.example.com/\n&lt;/VirtualHost&gt;\nEOF\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#php","title":"PHP","text":"<p>Die Konfiguration entspricht weitestgehend den Empfehlungen der PHP-Entwickler und ist somit sowohl auf Security als auch auf Performance getrimmt.</p>"},{"location":"howtos/gentoo/hosting_system/#php-installieren","title":"PHP installieren","text":"Bash<pre><code>cat &gt;&gt; /etc/portage/package.keywords &lt;&lt; \"EOF\"\ndev-lang/php ~amd64\nEOF\n\ncat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\ndev-db/sqlite  threadsafe\ndev-lang/php  apache2 calendar ctype curl curlwrappers discard-path flatfile fileinfo filter force-cgi-redirect hash inifile intl json pcntl pdo phar simplexml soap sqlite sqlite3 suhosin sysvipc wddx xmlreader xmlwriter zip -gdbm -readline -threads\nEOF\n\nemerge php\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#php-konfigurieren","title":"PHP konfigurieren","text":"<p><code>php.ini</code> einrichten:</p> Bash<pre><code>cat &gt; /etc/php/cgi-php5/php.ini &lt;&lt; \"EOF\"\n[PHP]\nuser_ini.filename =\nuser_ini.cache_ttl = 300\nengine = On\nshort_open_tag = Off\nasp_tags = Off\nprecision = 14\ny2k_compliance = On\noutput_buffering = 4096\noutput_handler =\nzlib.output_compression = Off\nzlib.output_compression_level = -1\nzlib.output_handler =\nimplicit_flush = Off\nunserialize_callback_func =\nserialize_precision = 100\nallow_call_time_pass_reference = Off\nsafe_mode = Off\nsafe_mode_gid = Off\nsafe_mode_include_dir =\nsafe_mode_exec_dir =\nsafe_mode_allowed_env_vars = PHP_\nsafe_mode_protected_env_vars = LD_LIBRARY_PATH\nopen_basedir =\ndisable_functions =\ndisable_classes =\nhighlight.string = #DD0000\nhighlight.comment = #FF9900\nhighlight.keyword = #007700\nhighlight.bg = #FFFFFF\nhighlight.default = #0000BB\nhighlight.html = #000000\nignore_user_abort = Off\nrealpath_cache_size = 16k\nrealpath_cache_ttl = 120\nexpose_php = Off\nmax_execution_time = 30\nmax_input_time = 60\nmax_input_nesting_level = 64\nmemory_limit = 128M\nerror_reporting = E_ALL &amp; ~E_DEPRECATED\ndisplay_errors = Off\ndisplay_startup_errors = Off\nlog_errors = On\nlog_errors_max_len = 1024\nignore_repeated_errors = Off\nignore_repeated_source = Off\nreport_memleaks = On\n;report_zend_debug = 0\ntrack_errors = Off\n;xmlrpc_errors = 0\n;xmlrpc_error_number = 0\nhtml_errors = Off\n;docref_root = \"/phpmanual/\"\n;docref_ext = .html\n;error_prepend_string = \"&lt;font color=#ff0000&gt;\"\n;error_append_string = \"&lt;/font&gt;\"\n;error_log = php_errors.log\narg_separator.output = \"&amp;\"\narg_separator.input = \";&amp;\"\nvariables_order = \"GPCS\"\nrequest_order = \"GP\"\nregister_globals = Off\nregister_long_arrays = Off\nregister_argc_argv = Off\nauto_globals_jit = On\npost_max_size = 8M\nmagic_quotes_gpc = Off\nmagic_quotes_runtime = Off\nmagic_quotes_sybase = Off\nauto_prepend_file =\nauto_append_file =\ndefault_mimetype = \"text/html\"\n;default_charset = \"iso-8859-1\"\n;always_populate_raw_post_data = On\ninclude_path = \".:/usr/share/php\"\ndoc_root =\nuser_dir =\n;extension_dir = \"./\"\nenable_dl = Off\ncgi.force_redirect = 1\n;cgi.nph = 1\n;cgi.redirect_status_env = ;\ncgi.fix_pathinfo=1\n;fastcgi.impersonate = 1;\n;fastcgi.logging = 0\n;cgi.rfc2616_headers = 0\nfile_uploads = On\nupload_tmp_dir = \"/tmp\"\nupload_max_filesize = 2M\nmax_file_uploads = 20\nallow_url_fopen = On\nallow_url_include = Off\nfrom = \"anonymous@example.com\"\nuser_agent = \"\"\ndefault_socket_timeout = 60\n;auto_detect_line_endings = Off\n\n[Date]\ndate.timezone = Europe/Berlin\n;date.default_latitude = 31.7667\n;date.default_longitude = 35.2333\n;date.sunrise_zenith = 90.583333\n;date.sunset_zenith = 90.583333\n\n[filter]\n;filter.default = unsafe_raw\n;filter.default_flags =\n\n[iconv]\n;iconv.input_encoding = ISO-8859-1\n;iconv.internal_encoding = ISO-8859-1\n;iconv.output_encoding = ISO-8859-1\n\n[intl]\n;intl.default_locale =\n;intl.error_level = E_WARNING\n\n[sqlite]\n;sqlite.assoc_case = 0\n\n[sqlite3]\n;sqlite3.extension_dir =\n\n[Pcre]\n;pcre.backtrack_limit = 100000\n;pcre.recursion_limit = 100000\n\n[Pdo]\n;pdo_odbc.connection_pooling = strict\n;pdo_odbc.db2_instance_name =\n\n[Pdo_mysql]\npdo_mysql.cache_size = 2000\npdo_mysql.default_socket =\n\n[Phar]\n;phar.readonly = On\n;phar.require_hash = On\n;phar.cache_list =\n\n[Syslog]\ndefine_syslog_variables  = Off\n\n[mail function]\nSMTP = localhost\nsmtp_port = 25\n;sendmail_from = me@example.com\n;sendmail_path =\n;mail.force_extra_parameters =\nmail.add_x_header = On\n;mail.log =\n\n[SQL]\nsql.safe_mode = Off\n\n[ODBC]\n;odbc.default_cursortype =\nodbc.allow_persistent = On\nodbc.check_persistent = On\nodbc.max_persistent = -1\nodbc.max_links = -1\nodbc.defaultlrl = 4096\nodbc.defaultbinmode = 1\n;birdstep.max_links = -1\n\n[Interbase]\nibase.allow_persistent = 1\nibase.max_persistent = -1\nibase.max_links = -1\n;ibase.default_db =\n;ibase.default_user =\n;ibase.default_password =\n;ibase.default_charset =\nibase.timestampformat = \"%Y-%m-%d %H:%M:%S\"\nibase.dateformat = \"%Y-%m-%d\"\nibase.timeformat = \"%H:%M:%S\"\n\n[MySQL]\nmysql.allow_local_infile = On\nmysql.allow_persistent = On\nmysql.cache_size = 2000\nmysql.max_persistent = -1\nmysql.max_links = -1\nmysql.default_port =\nmysql.default_socket =\nmysql.default_host =\nmysql.default_user =\nmysql.default_password =\nmysql.connect_timeout = 60\nmysql.trace_mode = Off\n\n[MySQLi]\nmysqli.max_persistent = -1\nmysqli.allow_local_infile = On\nmysqli.allow_persistent = On\nmysqli.max_links = -1\nmysqli.cache_size = 2000\nmysqli.default_port = 3306\nmysqli.default_socket =\nmysqli.default_host =\nmysqli.default_user =\nmysqli.default_pw =\nmysqli.reconnect = Off\n\n[mysqlnd]\nmysqlnd.collect_statistics = On\nmysqlnd.collect_memory_statistics = Off\n;mysqlnd.net_cmd_buffer_size = 2048\n;mysqlnd.net_read_buffer_size = 32768\n\n[OCI8]\n;oci8.privileged_connect = Off\n;oci8.max_persistent = -1\n;oci8.persistent_timeout = -1\n;oci8.ping_interval = 60\n;oci8.connection_class =\n;oci8.events = Off\n;oci8.statement_cache_size = 20\n;oci8.default_prefetch = 100\n;oci8.old_oci_close_semantics = Off\n\n[PostgresSQL]\npgsql.allow_persistent = On\npgsql.auto_reset_persistent = Off\npgsql.max_persistent = -1\npgsql.max_links = -1\npgsql.ignore_notice = 0\npgsql.log_notice = 0\n\n[Sybase-CT]\nsybct.allow_persistent = On\nsybct.max_persistent = -1\nsybct.max_links = -1\nsybct.min_server_severity = 10\nsybct.min_client_severity = 10\n;sybct.timeout =\n;sybct.packet_size =\n;sybct.login_timeout =\n;sybct.hostname =\n;sybct.deadlock_retry_count =\n\n[bcmath]\nbcmath.scale = 0\n\n[browscap]\n;browscap = extra/browscap.ini\n\n[Session]\nsession.save_handler = files\nsession.save_path = \"/tmp\"\nsession.use_cookies = 1\n;session.cookie_secure =\nsession.use_only_cookies = 1\nsession.name = PHPSESSID\nsession.auto_start = 0\nsession.cookie_lifetime = 0\nsession.cookie_path = /\nsession.cookie_domain =\nsession.cookie_httponly =\nsession.serialize_handler = php\nsession.gc_probability = 1\nsession.gc_divisor = 1000\nsession.gc_maxlifetime = 1440\nsession.bug_compat_42 = Off\nsession.bug_compat_warn = Off\nsession.referer_check =\nsession.entropy_file = /dev/urandom\nsession.entropy_length = 16\nsession.cache_limiter = nocache\nsession.cache_expire = 180\nsession.use_trans_sid = 0\nsession.hash_function = 1\nsession.hash_bits_per_character = 6\nurl_rewriter.tags = \"a=href,area=href,frame=src,input=src,form=fakeentry,fieldset=\"\n\n[MSSQL]\nmssql.allow_persistent = On\nmssql.max_persistent = -1\nmssql.max_links = -1\nmssql.min_error_severity = 10\nmssql.min_message_severity = 10\nmssql.compatability_mode = Off\n;mssql.connect_timeout = 5\n;mssql.timeout = 60\n;mssql.textlimit = 4096\n;mssql.textsize = 4096\n;mssql.batchsize = 0\n;mssql.datetimeconvert = On\nmssql.secure_connection = Off\n;mssql.max_procs = -1\n;mssql.charset = \"ISO-8859-1\"\n\n[Assertion]\n;assert.active = On\n;assert.warning = On\n;assert.bail = Off\n;assert.callback = 0\n;assert.quiet_eval = 0\n\n[COM]\n;com.typelib_file =\n;com.allow_dcom = true\n;com.autoregister_typelib = true\n;com.autoregister_casesensitive = false\n;com.autoregister_verbose = true\n;com.code_page =\n\n[mbstring]\n;mbstring.language = Japanese\n;mbstring.internal_encoding = EUC-JP\n;mbstring.http_input = auto\n;mbstring.http_output = SJIS\n;mbstring.encoding_translation = Off\n;mbstring.detect_order = auto\n;mbstring.substitute_character = none;\n;mbstring.func_overload = 0\n;mbstring.strict_detection = Off\n;mbstring.http_output_conv_mimetype =\n;mbstring.script_encoding =\n\n[gd]\n;gd.jpeg_ignore_warning = 0\n\n[exif]\n;exif.encode_unicode = ISO-8859-15\n;exif.decode_unicode_motorola = UCS-2BE\n;exif.decode_unicode_intel = UCS-2LE\n;exif.encode_jis =\n;exif.decode_jis_motorola = JIS\n;exif.decode_jis_intel = JIS\n\n[Tidy]\n;tidy.default_config = /usr/lib64/php5/default.tcfg\ntidy.clean_output = Off\n\n[soap]\nsoap.wsdl_cache_enabled = 1\nsoap.wsdl_cache_dir = \"/tmp\"\nsoap.wsdl_cache_ttl = 86400\nsoap.wsdl_cache_limit = 5\n\n[sysvshm]\n;sysvshm.init_mem = 10000\n\n[ldap]\nldap.max_links = -1\n\n[mcrypt]\n;mcrypt.algorithms_dir =\n;mcrypt.modes_dir =\n\n[dba]\n;dba.default_handler =\nEOF\n\ncp /etc/php/cgi-php5/php.ini /etc/php/cli-php5/php.ini\ncp /etc/php/cgi-php5/php.ini /etc/php/apache2-php5/php.ini\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#php-pear-installieren","title":"PHP-PEAR installieren","text":"Bash<pre><code>echo \"dev-php/pear ~amd64\" &gt;&gt; /etc/portage/package.keywords\nfor pkg in `ls /usr/portage/dev-php | grep PEAR` ; do echo \"dev-php/${pkg} ~amd64\" &gt;&gt; /etc/portage/package.keywords ; done\n\nemerge pear\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#phpmyadmin","title":"phpMyAdmin","text":""},{"location":"howtos/gentoo/hosting_system/#phpmyadmin-installieren","title":"phpMyAdmin installieren","text":"Bash<pre><code>wget -O 'phpMyAdmin-3.3.7-all-languages.tar.gz' https://files.phpmyadmin.net/phpMyAdmin//3.3.7/phpMyAdmin-3.3.7-all-languages.tar.gz\n\ntar xzf phpMyAdmin-3.3.7-all-languages.tar.gz\nmv phpMyAdmin-3.3.7-all-languages /var/www/vhosts/ssl.example.com/data/phpmyadmin\nmkdir -p /var/www/vhosts/ssl.example.com/data/phpmyadmin/save\nmkdir -p /var/www/vhosts/ssl.example.com/data/phpmyadmin/upload\nchown -R www:www /var/www/vhosts/ssl.example.com/data/phpmyadmin\nfind /var/www/vhosts/ssl.example.com/data/phpmyadmin -type d -print0 | xargs -0 chmod 0750\nfind /var/www/vhosts/ssl.example.com/data/phpmyadmin -type f -print0 | xargs -0 chmod 0640\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#phpmyadmin-konfigurieren","title":"phpMyAdmin konfigurieren","text":"Bash<pre><code>mkdir -p /var/www/vhosts/ssl.example.com/data/phpmyadmin/config\nchown www:www /var/www/vhosts/ssl.example.com/data/phpmyadmin/config\n</code></pre> <p>Nun bitte <code>https://ssl.example.com/phpmyadmin/setup/index.php</code> im Browser aufrufen und phpMyAdmin konfigurieren. Danach muss die <code>config.inc.php</code> noch installiert werden:</p> Bash<pre><code>mv /var/www/vhosts/ssl.example.com/data/phpmyadmin/config/config.inc.php /var/www/vhosts/ssl.example.com/data/phpmyadmin/config.inc.php\nchmod 0640 /var/www/vhosts/ssl.example.com/data/phpmyadmin/config.inc.php\nrm -r /var/www/vhosts/ssl.example.com/data/phpmyadmin/config\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#postfixadmin","title":"PostfixAdmin","text":""},{"location":"howtos/gentoo/hosting_system/#postfixadmin-installieren","title":"PostfixAdmin installieren","text":"Bash<pre><code># FIXME MIME::EncWords is masked by keyword\nemerge Email-Valid Mail-Sender Mail-Sendmail MIME-tools log-dispatch Log-Log4perl TimeDate\n\nwget -O 'postfixadmin-2.3.3.tar.gz' https://github.com/postfixadmin/postfixadmin/archive/postfixadmin-2.3.3.tar.gz\n\ntar xzf postfixadmin-2.3.3.tar.gz\nmv postfixadmin-2.3.3 /var/www/vhosts/ssl.example.com/data/postfixadmin\nchown -R www:www /var/www/vhosts/ssl.example.com/data/postfixadmin\nfind /var/www/vhosts/ssl.example.com/data/postfixadmin -type d -print0 | xargs -0 chmod 0750\nfind /var/www/vhosts/ssl.example.com/data/postfixadmin -type f -print0 | xargs -0 chmod 0640\n</code></pre> <p>Anlegen der Datenbank und der Datenbank-User:</p> Note <p>Bitte jeweils das gleiche Passwort wie in der <code>dovecot-sql.conf</code> aus der Dovecot Konfiguration verwenden.</p> Bash<pre><code>mysql -uroot -p\nCREATE DATABASE postfix DEFAULT CHARACTER SET utf8;\nGRANT ALL PRIVILEGES ON postfix.* TO 'postfix'@'localhost' IDENTIFIED BY '__PASSWORD__';\nGRANT ALL PRIVILEGES ON postfix.* TO 'postfixadmin'@'localhost' IDENTIFIED BY '__PASSWORD__';\nFLUSH PRIVILEGES;\nQUIT;\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#postfixadmin-konfigurieren","title":"PostfixAdmin konfigurieren","text":"<p>Anlegen der <code>config.local.php</code>:</p> Bash<pre><code>cat &gt; /var/www/vhosts/ssl.example.com/data/postfixadmin/config.local.php &lt;&lt; \"EOF\"\n&lt;?php\n$CONF['configured'] = true;\n$CONF['postfix_admin_url'] = 'https://ssl.example.com/postfixadmin/';\n$CONF['database_type'] = 'mysqli';\n$CONF['database_password'] = '__PASSWORD__'; // Password of database-user postfix\n$CONF['admin_email'] = 'postmaster@example.com';\n$CONF['min_password_length'] = 8;\n$CONF['default_aliases'] = array (\n    'abuse' =&gt; 'abuse@example.com',\n    'admin' =&gt; 'admin@example.com',\n    'hostmaster' =&gt; 'hostmaster@example.com',\n    'postmaster' =&gt; 'postmaster@example.com',\n    'webmaster' =&gt; 'webmaster@example.com'\n);\n$CONF['domain_path'] = 'YES';\n$CONF['domain_in_mailbox'] = 'NO';\n$CONF['aliases'] = '50';\n$CONF['mailboxes'] = '50';\n$CONF['maxquota'] = '1024';\n$CONF['quota'] = 'YES';\n$CONF['quota_multiplier'] = '1048576';\n$CONF['vacation_domain'] = 'autoreply.example.com';\n$CONF['alias_control'] = 'YES';\n$CONF['alias_control_admin'] = 'YES';\n$CONF['fetchmail'] = 'NO';\n$CONF['user_footer_link'] = \"https://www.example.com/\";\n$CONF['show_footer_text'] = 'YES';\n$CONF['footer_text'] = 'Return to Homepage';\n$CONF['footer_link'] = 'https://www.example.com';\n$CONF['show_status'] = 'YES';\n$CONF['show_status_key'] = 'YES';\nEOF\n\nchmod 0640 /var/www/vhosts/ssl.example.com/data/postfixadmin/config.local.php\nchown www:www /var/www/vhosts/ssl.example.com/data/postfixadmin/config.local.php\n</code></pre> <p>Nun bitte <code>https://ssl.example.com/postfixadmin/setup.php</code> im Browser aufrufen, am Ende der Seite das Setup-Passwort generieren und in der <code>config.local.php</code> nachtragen:</p> Bash<pre><code>cat &gt;&gt; /var/www/vhosts/ssl.example.com/data/postfixadmin/config.local.php &lt;&lt; \"EOF\"\n$CONF['setup_password'] = '__PASSWORD__';\nEOF\n</code></pre> <p>Abschliessend mit den Anweisungen auf der Webseite fortfahren.</p> <p>Die Installation der <code>vacation.pl</code> ist Optional und nicht getestet!</p> <p><code>vacation.pl</code> installieren:</p> Bash<pre><code>groupadd -g 65001 vacation\nuseradd -u 65001 -g vacation -c \"virtual vacation\" -d /nonexistent -s /sbin/nologin vacation\nmkdir -p /var/spool/vacation\ncp /var/www/vhosts/ssl.example.com/data/postfixadmin/VIRTUAL_VACATION/vacation.pl /var/spool/vacation/\nchmod -R 0750 /var/spool/vacation\nchown -R vacation:vacation /var/spool/vacation\n</code></pre> <p><code>vacation.pl</code> konfigurieren:</p> Bash<pre><code>sed -e \"s/^\\(my \\$db_type = 'Pg';\\)/#\\1/\" \\\n    -e \"s/^#\\(my \\$db_type = 'mysql';\\)/\\1/\" \\\n    -e \"s/^\\(my \\$db_host =\\).*$/\\1 'localhost';/\" \\\n    -e \"s/^\\(my \\$db_username =\\).*$/\\1 'postfix';/\" \\\n    -e \"s/^\\(my \\$db_password =\\).*$/\\1 '__PASSWORD__';/\" \\\n    -i /var/spool/vacation/vacation.pl\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#roundcube","title":"RoundCube","text":""},{"location":"howtos/gentoo/hosting_system/#roundcube-installieren","title":"RoundCube installieren","text":"Bash<pre><code>wget -O 'roundcubemail-0.4.1.tar.gz' https://github.com/roundcube/roundcubemail/archive/v0.4.1.tar.gz\n\ntar xzf roundcubemail-0.4.1.tar.gz\nmv roundcubemail-0.4.1 /var/www/vhosts/ssl.example.com/data/roundcube\nchown -R www:www /var/www/vhosts/ssl.example.com/data/roundcube\nfind /var/www/vhosts/ssl.example.com/data/roundcube -type d -print0 | xargs -0 chmod 0750\nfind /var/www/vhosts/ssl.example.com/data/roundcube -type f -print0 | xargs -0 chmod 0640\n</code></pre> <p>Anlegen der Datenbank und des Datenbank-User:</p> Bash<pre><code>mysql -uroot -p\nCREATE DATABASE roundcube DEFAULT CHARACTER SET utf8;\nGRANT ALL PRIVILEGES ON roundcube.* TO 'roundcube'@'localhost' IDENTIFIED BY '__PASSWORD__';\nFLUSH PRIVILEGES;\nQUIT;\n</code></pre>"},{"location":"howtos/gentoo/hosting_system/#roundcube-konfigurieren","title":"RoundCube konfigurieren","text":"Bash<pre><code>mysql -uroot -p roundcube &lt; /var/www/vhosts/ssl.example.com/data/roundcube/SQL/mysql.initial.sql\nrm /var/www/vhosts/ssl.example.com/data/roundcube/.htaccess\nmv /var/www/vhosts/ssl.example.com/data/roundcube/config/db.inc.php.dist /var/www/vhosts/ssl.example.com/data/roundcube/config/db.inc.php\nmv /var/www/vhosts/ssl.example.com/data/roundcube/config/main.inc.php.dist /var/www/vhosts/ssl.example.com/data/roundcube/config/main.inc.php\n</code></pre> <p>Folgende Zeile muss in der <code>config/db.inc.php</code> angepasst werden:</p> Bash<pre><code>$rcmail_config['db_dsnw'] = 'mysqli://roundcube:__PASSWORD__@localhost/roundcube';\n</code></pre> <p>Folgende Zeilen m\u00fcssen in der <code>config/main.inc.php</code> angepasst werden:</p> Bash<pre><code>$rcmail_config['default_host'] = 'ssl://mail.example.com';\n$rcmail_config['default_port'] = 993;\n$rcmail_config['imap_auth_type'] = plain;\n$rcmail_config['smtp_server'] = 'tls://mail.example.com';\n$rcmail_config['smtp_user'] = '%u';\n$rcmail_config['smtp_pass'] = '%p';\n$rcmail_config['smtp_helo_host'] = 'mail.example.com';\n$rcmail_config['force_https'] = true;\n$rcmail_config['des_key'] = 'rcmail-!24ByteDESkey*Str';\n$rcmail_config['max_recipients'] = 50;\n$rcmail_config['max_group_members'] = 50;\n$rcmail_config['mime_magic'] = '/usr/share/misc/magic';\n$rcmail_config['prefer_html'] = false;\n</code></pre>"},{"location":"howtos/gentoo/remote_install/","title":"Remote Installation","text":""},{"location":"howtos/gentoo/remote_install/#einleitung","title":"Einleitung","text":"Warning <p>Dieses HowTo wird seit 2014-09-01 nicht mehr aktiv gepflegt und entspricht daher nicht mehr dem aktuellen Stand.</p> <p>Die Verwendung dieses HowTo geschieht somit auf eigene Gefahr!</p> <p>In diesem HowTo beschreibe ich step-by-step die Remote Installation von Gentoo Linux Hardened 64Bit auf einem dedizierten Server. Um eine weitere Republikation der offiziellen Gentoo Linux Dokumentation zu vermeiden, werde ich in diesem HowTo nicht alle Punkte bis ins Detail erl\u00e4utern.</p> <p>Folgende Punkte sind in diesem HowTo zu beachten.</p> <ul> <li>Alle Dienste werden mit einem m\u00f6glichst minimalen und bew\u00e4hrten Funktionsumfang installiert.</li> <li>Alle Dienste werden mit einer m\u00f6glichst sicheren und dennoch flexiblen Konfiguration versehen.</li> <li>Alle Konfigurationen sind selbstst\u00e4ndig auf notwendige individuelle Anpassungen zu kontrollieren.</li> <li>Alle Passworte werden als <code>__PASSWORD__</code> dargestellt und sind selbstst\u00e4ndig durch sichere Passworte zu ersetzen.</li> <li>Die Domain des Servers lautet <code>example.com</code> und ist selbstst\u00e4ndig durch die eigene Domain zu ersetzen.</li> <li>Der Hostname des Servers lautet <code>devnull</code> und ist selbstst\u00e4ndig durch den eigenen Hostnamen zu ersetzen   (FQDN=devnull.example.com).</li> <li>Es wird der FQDN <code>devnull.example.com</code> verwendet und ist selbstst\u00e4ndig im DNS zu registrieren.</li> </ul>"},{"location":"howtos/gentoo/remote_install/#das-referenzsystem","title":"Das Referenzsystem","text":"<p>Als Referenzsystem f\u00fcr dieses HowTo habe ich mich f\u00fcr eine virtuelle Maschine auf Basis von Oracle VM VirtualBox unter Microsoft Windows 7 Professional (64 Bit) entschieden. So l\u00e4sst sich ohne gr\u00f6sseren Aufwand ein handels\u00fcblicher dedizierter Server simulieren und anschliessend kann diese virtuelle Maschine als kosteng\u00fcnstiges lokales Testsystem weiter genutzt werden.</p> <p>Trotzdem habe ich dieses HowTo so ausgelegt, dass es sich nahezu unver\u00e4ndert auf dedizierte Server \u00fcbertragen l\u00e4sst und dieses auch auf mehreren dedizierten Servern getestet.</p> <p>Leider bringt Microsoft Windows keinen eigenen SSH-Client mit, so dass ich auf das sehr empfehlenswerte PuTTY (64 Bit) zur\u00fcckgreife. Zur Simulation des bei nahezu allen Anbietern dedizierter Server vorhandene Rettungssystem, nachfolgend RescueSystem genannt, wird in diesem HowTo die auf Gentoo Linux basierende SystemRescueCD eingesetzt.</p> <p>VirtualBox und PuTTY werden mit den jeweiligen Standardoptionen installiert.</p> PowerShell<pre><code>winget install PuTTY.PuTTY\nwinget install Oracle.VirtualBox\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#die-virtuelle-maschine","title":"Die Virtuelle Maschine","text":"<p>Als Erstes \u00f6ffnen wir eine neue PowerShell und legen manuell eine neue virtuelle Maschine an. Diese virtuelle Maschine bekommt den Namen <code>Gentoo</code> und wird mit 2048MB RAM, 32MB VideoRAM, zwei 32GB SATA-Festplatte, einem DVD-Player, sowie einer Intel-Netzwerkkarte ausgestattet. Zudem setzen wir die RTC (Real-Time Clock) der virtuellen Maschine auf UTC (Coordinated Universal Time), aktivieren den HPET (High Precision Event Timer) und legen die Bootreihenfolge fest.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createvm --name \"Gentoo\" --ostype Gentoo_64 --register\n\ncd \"${Env:USERPROFILE}\\VirtualBox VMs\\Gentoo\"\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createhd --filename \"Gentoo1.vdi\" --size 32768\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" createhd --filename \"Gentoo2.vdi\" --size 32768\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"Gentoo\" --firmware bios --cpus 2 --cpuexecutioncap 100 --cpuhotplug off\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"Gentoo\" --chipset ICH9 --graphicscontroller vmsvga --audio none --usb off\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"Gentoo\" --hwvirtex on --ioapic on --hpet on --rtcuseutc on --memory 4096 --vram 64\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"Gentoo\" --nic1 nat --nictype1 82540EM --natnet1 \"192.168/16\" --cableconnected1 on\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"Gentoo\" --boot1 dvd --boot2 disk --boot3 none --boot4 none\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storagectl \"Gentoo\" --name \"IDE Controller\" --add ide --controller ICH6 --portcount 2\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storagectl \"Gentoo\" --name \"AHCI Controller\" --add sata --controller IntelAHCI --portcount 4\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"Gentoo\" --storagectl \"AHCI Controller\" --port 0 --device 0 --type hdd --medium \"Gentoo1.vdi\"\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"Gentoo\" --storagectl \"AHCI Controller\" --port 1 --device 0 --type hdd --medium \"Gentoo2.vdi\"\n</code></pre> <p>Die virtuelle Maschine, genauer die virtuelle Netzwerkkarte, kann dank NAT zwar problemlos mit der Aussenwelt, aber leider nicht direkt mit dem Hostsystem kommunizieren. Aus diesem Grund richten wir nun f\u00fcr den SSH-Zugang noch ein Portforwarding ein, welches den Port 2222 des Hostsystems auf den Port 22 der virtuellen Maschine weiterleitet.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" modifyvm \"Gentoo\" --natpf1 SSH,tcp,,2222,,22\n</code></pre> <p>Nachdem die virtuelle Maschine nun konfiguriert ist, wird es Zeit diese zu booten.</p>"},{"location":"howtos/gentoo/remote_install/#rescuesystem-booten","title":"RescueSystem booten","text":"<p>Um unser Gentoo Linux Hardened installieren zu k\u00f6nnen, m\u00fcssen wir unsere virtuelle Maschine mit einem RescueSystem booten. Hierf\u00fcr eignet sich die auf Gentoo Linux basierende SystemRescueCD am Besten, welche wir mittels des mit Windows mitgelieferten FTP-Client herunterladen und unserer virtuellen Maschine als Bootmedium zuweisen.</p> PowerShell<pre><code>cd \"${Env:USERPROFILE}\\VirtualBox VMs\\Gentoo\"\n\nftp -A ftp.halifax.rwth-aachen.de\ncd osdn/storage/g/s/sy/systemrescuecd/releases/7.01\nbinary\nget systemrescue-7.01-amd64.iso\nquit\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"Gentoo\" --storagectl \"IDE Controller\" --port 0 --device 0 --type dvddrive --medium \"systemrescue-7.01-amd64.iso\"\n</code></pre> <p>Wir k\u00f6nnen das RescueSystem jetzt booten.</p> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" startvm \"Gentoo\"\n</code></pre> <p>Im Bootmen\u00fc w\u00e4hlen wir die erste Option \"boot with default options\" aus.</p> <p>Wer mit dem amerikanischen Tastaturlayout nicht zurechtkommt, sollte w\u00e4hrend des Bootens die Frage nach der Keymap mit <code>de</code> beantworten.</p> <p>Ist der Bootvorgang abgeschlossen, wird als Erstes das root-Passwort f\u00fcr das RescueSystem gesetzt.</p> Bash<pre><code>passwd root\n</code></pre> <p>Jetzt sollten wir uns mittels PuTTY als <code>root</code> in das RescueSystem einloggen und mit der Installation unseres Gentoo Linux Hardened fortfahren k\u00f6nnen.</p> PowerShell<pre><code>putty -ssh -P 2222 root@127.0.0.1\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#partitionieren-der-festplatte","title":"Partitionieren der Festplatte","text":"<p>Bevor wir anfangen, bereinigen wir die Festplatten von jeglichen Datenr\u00fcckst\u00e4nden, indem wir sie mit Nullen \u00fcberschreiben. Je nach Festplattengr\u00f6sse kann dies einige Stunden bis Tage in Anspruch nehmen. Aus diesem Grund verlegen wir diese Jobs mittels <code>nohup</code> in den Hintergrund, so dass wir uns zwischenzeitlich ausloggen k\u00f6nnen ohne dass dabei die Jobs automatisch von der Shell abgebrochen werden. Ob die Jobs fertig sind, l\u00e4sst dann mittels <code>ps -auxfwww</code> und <code>top -atCP</code> ermitteln.</p> Bash<pre><code>nohup dd if=/dev/zero of=/dev/sda bs=512  &amp;\nnohup dd if=/dev/zero of=/dev/sdb bs=512  &amp;\n</code></pre> <p>Da jeder Administrator andere Pr\u00e4ferenzen an sein Partitionslayout stellt und wir andernfalls mit diesem HowTo nicht weiterkommen, verwenden wir im Folgenden ein Standard-Partitionslayout. Fortgeschrittenere Linux-Administratoren k\u00f6nnen dieses Partitionslayout selbstverst\u00e4ndlich an ihre eigenen Bed\u00fcrfnisse anpassen.</p> Partition Mountpunkt Filesystem Gr\u00f6sse /dev/sda1 /dev/sdb1 none [bootloader] 2 MB /dev/sda2 /dev/sdb2 /boot EXT2 512 MB /dev/sda3 /dev/sdb3 / EXT3 16 GB /dev/sda4 /dev/sdb4 /data EXT3 8 GB /dev/sda5 /dev/sdb5 none [swap] 4 GB <p>Die Partitionen legen wir nun mittels parted an.</p> Bash<pre><code>parted -s -a optimal /dev/sda\nparted -s -a optimal /dev/sdb\n\nparted -s /dev/sda mklabel gpt\nparted -s /dev/sdb mklabel gpt\n\nparted -s /dev/sda mkpart primary 4096s 8191s\nparted -s /dev/sdb mkpart primary 4096s 8191s\n\nparted -s /dev/sda mkpart primary 8192s 1056767s\nparted -s /dev/sdb mkpart primary 8192s 1056767s\n\nparted -s /dev/sda mkpart primary 1056768s 34611199s\nparted -s /dev/sdb mkpart primary 1056768s 34611199s\n\nparted -s /dev/sda mkpart primary 34611200s 51388415s\nparted -s /dev/sdb mkpart primary 34611200s 51388415s\n\nparted -s /dev/sda mkpart primary 51388416s 59777023s\nparted -s /dev/sdb mkpart primary 51388416s 59777923s\n\nparted -s /dev/sda name 1 grub\nparted -s /dev/sdb name 1 grub\n\nparted -s /dev/sda name 2 boot\nparted -s /dev/sdb name 2 boot\n\nparted -s /dev/sda name 3 rootfs\nparted -s /dev/sdb name 3 rootfs\n\nparted -s /dev/sda name 4 data\nparted -s /dev/sdb name 4 data\n\nparted -s /dev/sda name 5 swap\nparted -s /dev/sdb name 5 swap\n\nparted -s /dev/sda set 1 bios_grub on\nparted -s /dev/sdb set 1 bios_grub on\n</code></pre> <p>F\u00fcr eine leicht erh\u00f6hte Datensicherheit legen wir nun noch mittels <code>mdadm</code> ein Software-RAID1 an.</p> Bash<pre><code>mknod /dev/md2 b 9 2\nmknod /dev/md3 b 9 3\nmknod /dev/md4 b 9 4\nmknod /dev/md5 b 9 5\n\ncat &gt;&gt; /etc/mdadm.conf &lt;&lt; \"EOF\"\nMAILADDR root@localhost\nMAILFROM root@localhost\nCREATE metadata=1.2\nHOMEHOST &lt;none&gt;\nDEVICE /dev/sd*[0-9]\nEOF\n\nmdadm --create /dev/md2 --name=boot --bitmap=internal --level=raid1 --raid-devices=2 --metadata=1.2 /dev/sd[ab]2\nmdadm --create /dev/md3 --name=root --bitmap=internal --level=raid1 --raid-devices=2 --metadata=1.2 /dev/sd[ab]3\nmdadm --create /dev/md4 --name=data --bitmap=internal --level=raid1 --raid-devices=2 --metadata=1.2 /dev/sd[ab]4\nmdadm --create /dev/md5 --name=swap --bitmap=internal --level=raid1 --raid-devices=2 --metadata=1.2 /dev/sd[ab]5\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#formatieren-der-partitionen","title":"Formatieren der Partitionen","text":"<p>Die frisch angelegten Partitionen m\u00fcssen selbstverst\u00e4ndlich noch formatiert werden. Normalerweise formatiere ich die Rootpartition mit XFS, da allerdings nicht jeder Administrator XFS f\u00fcr seine Rootpartition verwenden m\u00f6chte, werden wir ein manuell optimiertes EXT3 anlegen. Dieses ist n\u00f6tig, da die e2fsprogs bei einigen Distributionen und somit auch RescueSystemen oft veraltet oder suboptimal konfiguriert sind und daher nicht immer ein f\u00fcr Server optimiertes EXT3 erzeugen.</p> <p>Die Bootpartition sollte grunds\u00e4tzlich mit EXT2 formatiert weren, da dieses Filesystem als Einziges von allen g\u00e4ngigen Linux-Bootloadern fehlerfrei unterst\u00fctzt wird.</p> Bash<pre><code>mke2fs -c -b 4096 -t ext2 /dev/md2\ntune2fs -c 0 -i 0 /dev/md2\ntune2fs -e continue /dev/md2\ntune2fs -O dir_index /dev/md2\ntune2fs -o user_xattr,acl /dev/md2\ne2fsck -D /dev/md2\n\nmke2fs -c -b 4096 -t ext3 -j /dev/md3\ntune2fs -c 0 -i 0 /dev/md3\ntune2fs -e continue /dev/md3\ntune2fs -O dir_index,large_file /dev/md3\ntune2fs -o user_xattr,acl,journal_data /dev/md3\ne2fsck -D /dev/md3\n\nmke2fs -c -b 4096 -t ext3 -j /dev/md4\ntune2fs -c 0 -i 0 /dev/md4\ntune2fs -e continue /dev/md4\ntune2fs -O dir_index,large_file /dev/md4\ntune2fs -o user_xattr,acl,journal_data /dev/md4\ne2fsck -D /dev/md4\n\nmkswap -c /dev/md5\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#mounten-der-partitionen","title":"Mounten der Partitionen","text":"<p>Nun werden die Partitionen f\u00fcr unsere zur Installation ben\u00f6tigten Chroot-Umgebung gemountet und der Swapspace aktiviert.</p> Bash<pre><code>swapon /dev/md5\n\nmkdir -p /mnt/gentoo\nmount -t ext3 -o defaults,relatime,barrier=1 /dev/md3 /mnt/gentoo\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#entpacken-des-stage-tarballs","title":"Entpacken des Stage-Tarballs","text":"<p>Der Stage3-Tarball enth\u00e4lt ein minimalistisches Gentoo Linux Hardened, welches alle zur Installation notwendigen Tools enth\u00e4lt und uns als Chroot-Umgebung dient. Wir m\u00fcssen nun den aktuellen Stage3-Tarball ermitteln, wozu wir die entsprechende Angabe vom Gentoo Linux Master Mirror verwenden und diese in dem folgenden zweiten wget-Aufruf entsprechend ersetzen. Den Stage3-Tarball werden wir bereits w\u00e4hrend des Download direkt nach <code>/mnt/gentoo</code> entpacken.</p> Bash<pre><code>wget -q -O - \"https://gentoo.osuosl.org/releases/amd64/autobuilds/latest-stage3-amd64-hardened+nomultilib.txt\" | tail -n 1 | \\\n     xargs -I % wget -q -O - \"https://gentoo.osuosl.org/releases/amd64/autobuilds/%\" | tar xpjvf - -C /mnt/gentoo/\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#vorbereiten-der-chroot-umgebung","title":"Vorbereiten der Chroot-Umgebung","text":"<p>Vor dem Wechsel in die Chroot-Umgebung m\u00fcssen wir noch die <code>resolv.conf</code> und <code>mdadm.conf</code> in die Chroot-Umgebung kopieren und die f\u00fcr eine erfolgreiche Installation noch fehlenden Filesysteme mounten.</p> Bash<pre><code>cp /etc/resolv.conf /mnt/gentoo/etc/resolv.conf\n\nmount -t proc none /mnt/gentoo/proc\nmount -o bind /sys /mnt/gentoo/sys\nmount -o bind /dev /mnt/gentoo/dev\nmount -o bind /dev/pts /mnt/gentoo/dev/pts\nmount -o bind /dev/shm /mnt/gentoo/dev/shm\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#betreten-der-chroot-umgebung","title":"Betreten der Chroot-Umgebung","text":"<p>Beim Betreten der Chroot-Umgebung setzen wir mittels <code>/bin/env -i</code> erstmal alle Environment-Variablen zur\u00fcck. Andererseits ben\u00f6tigen wir aber die Environment-Variablen <code>HOME</code>, <code>TERM</code>, <code>PS1</code> und <code>PATH</code>, welche wir manuell auf sinnvolle Defaults setzen.</p> Bash<pre><code>chroot /mnt/gentoo /bin/env -i HOME=/root TERM=$TERM PS1='\\u:\\w\\$ ' PATH=/sbin:/bin:/usr/sbin:/usr/bin /bin/bash +h\n\nmkdir /data\n\nmount -t ext2 -o defaults,relatime /dev/md2 /boot\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#setup-der-chroot-umgebung","title":"Setup der Chroot-Umgebung","text":"<p>Wir setzen die Timezone, legen die <code>mtab</code> an und aktualisieren das Environment.</p> Bash<pre><code>echo \"Europe/Berlin\" &gt; /etc/timezone\nemerge --config sys-libs/timezone-data\n\ngrep -v rootfs /proc/mounts &gt; /etc/mtab\n\nenv-update\nsource /etc/profile\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#portage-konfigurieren","title":"Portage konfigurieren","text":"<p>Mittels der <code>/etc/portage/make.conf</code> wird Portage konfiguriert.</p> Bash<pre><code>cat &gt; /etc/portage/make.conf &lt;&lt; \"EOF\"\nCHOST=\"x86_64-pc-linux-gnu\"\nCFLAGS=\"-O2 -pipe -fomit-frame-pointer -march=native\"\nCXXFLAGS=\"${CFLAGS}\"\nFFLAGS=\"${CFLAGS}\"\nFCFLAGS=\"${FFLAGS}\"\nPORTDIR=\"/usr/portage\"\nDISTDIR=\"${PORTDIR}/distfiles\"\nPKGDIR=\"${PORTDIR}/packages\"\nACCEPT_KEYWORDS=\"amd64\"\nMAKEOPTS=\"-j2\"\nLINGUAS=\"en de\"\nPAX_MARKINGS=\"XT\"\nUSE=\"-* acl berkdb bzip2 caps crypt cxx ecdsa fam fdformat filecaps \\\n    firmware-loader gcrypt gd gdbm gmp hardened iconv icu idn ipc ipv6 \\\n    ithreads jpeg kmod ldns libedit libssp lzma magic mime mktemp mmx \\\n    mpfr mudflap multicall ncurses net netifrc newnet nls nptl nscd \\\n    openmp openssl pax_kernel pci pcre pcre16 pcre32 perl pic png posix \\\n    ptpax python python2 python3 recursion-limit right_timezone sha512 \\\n    sharedmem sockets sse sse2 ssh ssl threads tiff tools truetype \\\n    tty-helpers udev unicode urandom usb utils xattr xml xsl xtpax zlib\"\nPYTHON_TARGETS=\"python2_7 python3_3 python3_4\"\nPYTHON_SINGLE_TARGET=\"python2_7\"\nCURL_SSL=\"openssl\"\nEOF\n</code></pre> <p>Mittels <code>/etc/portage/package.use</code> werden einzelnen Paketen von der <code>/etc/portage/make.conf</code> abweichende USE-Flags zugewiesen.</p> Bash<pre><code>cat &gt; /etc/portage/package.use &lt;&lt; \"EOF\"\nEOF\n</code></pre> <p>Als N\u00e4chstes legen wir mittels <code>emerge-webrsync</code> den Portage-Tree an.</p> Bash<pre><code>emerge-webrsync\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#locales-setzen","title":"Locales setzen","text":"<p>Da das System sp\u00e4ter weltweit erreichbar sein wird und die Standardsystemsprache amerikanisch ist, werden die Locales auf <code>en_US.utf8</code> gesetzt und neu erzeugt.</p> Bash<pre><code>cat &gt; /etc/env.d/02locale &lt;&lt; \"EOF\"\nLC_ALL=\"en_US.UTF-8\"\nLANG=\"en_US.UTF-8\"\nEOF\n\ncat &gt;&gt; /etc/locale.gen &lt;&lt; \"EOF\"\nen_US ISO-8859-1\nen_US.UTF-8 UTF-8\nde_DE ISO-8859-1\nde_DE@euro ISO-8859-15\nde_DE.UTF-8 UTF-8\nEOF\n\nlocale-gen -c /etc/locale.gen\n\nenv-update\nsource /etc/profile\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#basissystem-kompilieren","title":"Basissystem kompilieren","text":"<p>Nun muss das komplette Basissystem neu kompiliert werden. Dieser Vorgang ist zwar zeitaufwendig, aber f\u00fcr diese Installationsvariante zwingend notwendig. Auch die Reihenfolge ist sehr wichtig, da das System ansonsten unbrauchbar beziehungsweise instabil wird. W\u00e4hrend dieses Vorgangs werden nur wenige Konfigurationsdateien automatisch aktualisiert, alle anderen m\u00fcssen manuell mittels <code>dispatch-conf</code> aktualisiert werden.</p> Note <p>Die folgenden Schritte sind n\u00f6tig, da dieses HowTo eine angepasste Portage-Konfiguration verwendet und zudem seit</p> <p>dem Release des Stage3-Tarballs eventuell ein paar f\u00fcr diese Installationvariante wichtige Basispakete im Portage-Tree aktualisiert wurden.</p> Bash<pre><code>emerge portage portage-utils\n\nemerge -C cracklib pam pambase virtual/pam tcp-wrappers\nemerge @preserved-rebuild\n\nemerge glibc\n\nemerge binutils gcc\n\nenv-update\nsource /etc/profile\n\nemerge hardened-sources\n\nemerge -e -D @world\n\ndispatch-conf\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#basissystem-rekompilieren","title":"Basissystem rekompilieren","text":"<p>Um sicherzustellen, dass das Basissystem ab diesem Punkt keine veraltete Konfiguration oder (speicheresistente) Software nutzt, wird sicherheitshalber kurz die Chroot-Umgebung verlassen und gleich wieder betreten. Im Anschluss wird das Basissystem ein zweites Mal vollst\u00e4ndig rekompiliert, damit sichergestellt ist, dass auch wirklich jedes Paket nur noch gegen die aktuell vorhanden Libraries gelinkt ist und somit keine veralteten und/oder nicht mehr vorhandenen Funktionen nutzt.</p> Bash<pre><code>exit\n\nchroot /mnt/gentoo /bin/env -i HOME=/root TERM=$TERM PS1='\\u:\\w\\$ ' PATH=/sbin:/bin:/usr/sbin:/usr/bin /bin/bash +h\n\nenv-update\nsource /etc/profile\n\nemerge -e -D @world\n\nemerge --depclean\n\ndispatch-conf\n\nenv-update\nsource /etc/profile\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#fstab-erstellen","title":"fstab erstellen","text":"<p>Ohne fstab wird das System sp\u00e4ter nicht booten ;-)</p> Bash<pre><code>cat &gt; /etc/fstab &lt;&lt; \"EOF\"\n/dev/disk/by-id/md-name-root   /          ext3    defaults,relatime,barrier=1    1 1\n/dev/disk/by-id/md-name-boot   /boot      ext2    defaults,relatime              1 2\n/dev/disk/by-id/md-name-data   /data      ext3    defaults,relatime,barrier=1    2 2\n/dev/disk/by-id/md-name-swap   none       swap    sw                             0 0\nEOF\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#openssl-konfigurieren","title":"OpenSSL konfigurieren","text":"<p>Folgende Optionen m\u00fcssen mit dem Editor <code>ee</code> (<code>ee /etc/ssl/openssl.cnf</code>) in der <code>/etc/ssl/openssl.cnf</code> im Abschnitt <code>[ req_distinguished_name ]</code> angepasst beziehungsweise erg\u00e4nzt werden.</p> Text Only<pre><code>countryName_default             = DE\nstateOrProvinceName_default     = Bundesland\nlocalityName_default            = Ort\n0.organizationName_default      = Example Corporation\norganizationalUnitName_default  = Certification Authority\nemailAddress_default            = admin@example.com\n</code></pre> <p>Folgende Optionen m\u00fcssen im Abschnitt <code>[ CA_default ]</code> angepasst werden.</p> Text Only<pre><code>default_days            = 730\ndefault_md              = sha256\n</code></pre> <p>Folgende Optionen m\u00fcssen im Abschnitt <code>[ req ]</code> angepasst werden.</p> Text Only<pre><code>default_bits            = 4096\nstring_mask             = utf8only\n</code></pre> <p>DH Param Files erzeugen</p> Bash<pre><code>openssl genpkey -genparam -algorithm DH -pkeyopt dh_paramgen_prime_len:4096 -out /etc/ssl/dh_params.pem\nopenssl genpkey -genparam -algorithm EC -pkeyopt ec_paramgen_curve:secp384r1 -out /etc/ssl/ec_params.pem\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#openssh-konfigurieren","title":"OpenSSH konfigurieren","text":"<p>Da wir gerade ein Produktiv-System aufsetzen, werden wir den SSH-Dienst recht restriktiv konfigurieren, unter Anderem werden wir den Login per Passwort verbieten und nur per PublicKey zulassen.</p> Bash<pre><code>sed -e 's/^#\\(Protocol\\).*$/\\1 2/' \\\n    -e 's/^#\\(RekeyLimit\\).*$/\\1 500M 1h/' \\\n    -e 's/^#\\(LoginGraceTime\\).*$/\\1 1m/' \\\n    -e 's/^#\\(PermitRootLogin\\).*$/\\1 yes/' \\\n    -e 's/^#\\(StrictModes\\).*$/\\1 yes/' \\\n    -e 's/^#\\(MaxAuthTries\\).*$/\\1 3/' \\\n    -e 's/^#\\(MaxSessions\\).*$/\\1 10/' \\\n    -e 's/^#\\(RSAAuthentication\\).*$/\\1 no/' \\\n    -e 's/^#\\(PubkeyAuthentication\\).*$/\\1 yes/' \\\n    -e 's/^#\\(IgnoreRhosts\\).*$/\\1 yes/' \\\n    -e 's/^#\\(PasswordAuthentication\\).*$/\\1 no/' \\\n    -e 's/^#\\(PermitEmptyPasswords\\).*$/\\1 no/' \\\n    -e 's/^#\\(ChallengeResponseAuthentication\\).*$/\\1 no/' \\\n    -e 's/^#\\(UsePAM\\).*$/\\1 no/' \\\n    -e 's/^#\\(AllowAgentForwarding\\).*$/\\1 no/' \\\n    -e 's/^#\\(AllowTcpForwarding\\).*$/\\1 no/' \\\n    -e 's/^#\\(GatewayPorts\\).*$/\\1 no/' \\\n    -e 's/^#\\(X11Forwarding\\).*$/\\1 no/' \\\n    -e 's/^#\\(PermitTTY\\).*$/\\1 yes/' \\\n    -e 's/^#\\(UseLogin\\).*$/\\1 no/' \\\n    -e 's/^#\\(UsePrivilegeSeparation\\).*$/\\1 sandbox/' \\\n    -e 's/^#\\(PermitUserEnvironment\\).*$/\\1 no/' \\\n    -e 's/^#\\(UseDNS\\).*$/\\1 yes/' \\\n    -e 's/^#\\(MaxStartups\\).*$/\\1 10:30:100/' \\\n    -e 's/^#\\(PermitTunnel\\).*$/\\1 no/' \\\n    -e 's/^#\\(ChrootDirectory\\).*$/\\1 %h/' \\\n    -e 's/^\\(Subsystem\\).*$/\\1 sftp internal-sftp -u 0027/' \\\n    -i /etc/ssh/sshd_config\n\ncat &gt;&gt; /etc/ssh/sshd_config &lt;&lt; \"EOF\"\nAllowGroups wheel admin sftponly users\n\nMatch Group wheel\n        ChrootDirectory none\n\nMatch Group admin\n        PasswordAuthentication yes\n\nMatch Group sftponly\n        ForceCommand internal-sftp\nEOF\n\nsed -e '/^# Ciphers and keying/ a\\\nCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-cbc,aes256-ctr\\\nMacs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256\\\nKexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1' -i /etc/ssh/sshd_config\n\ncat &gt;&gt; /etc/ssh/ssh_config &lt;&lt; \"EOF\"\nHost *\n        Protocol 2\n        RekeyLimit 500M 1h\n        Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes256-cbc\n        Macs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256\n        KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1\n        HostKeyAlgorithms ssh-ed25519-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp521,ecdsa-sha2-nistp384,ecdsa-sha2-nistp256\n        VisualHostKey yes\nEOF\n\nrc-update add sshd default\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#systemprogramme-installieren","title":"Systemprogramme installieren","text":"<p>Jetzt werden wichtige Systemprogramme installiert.</p> Bash<pre><code>cat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\nsys-fs/lvm2  lvm1 lvm2create_initrd\nEOF\n\nemerge syslog-ng logrotate cronie iproute2 dhcpcd mdadm lvm2 mcelog\n\nrc-update add mdraid boot\nrc-update add cronie default\nrc-update add syslog-ng default\n\ncat &gt;&gt; /etc/mdadm.conf &lt;&lt; \"EOF\"\nMAILADDR root@localhost\nMAILFROM root@localhost\nCREATE metadata=1.2\nHOMEHOST &lt;none&gt;\nDEVICE /dev/sd*[0-9]\nEOF\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#netzwerk-konfigurieren","title":"Netzwerk konfigurieren","text":"<p>Das Netzwerk konfigurieren wir statisch</p> Bash<pre><code>sed -e 's/^\\(hostname=\\).*$/\\1\"devnull\"/' -i /etc/conf.d/hostname\n\ncat &gt;&gt; /etc/conf.d/net &lt;&lt; \"EOF\"\n#\n# Setup eth0\nconfig_eth0=\"__IPADDR4__ netmask NETMASK4\"\nroutes_eth0=\"default via GATEWAY4\"\nEOF\n\nln -s net.lo /etc/init.d/net.eth0\n\nrc-update add net.eth0 boot\n</code></pre> <p>Es folgt ein wenig Voodoo, um die Netzwerkkonfiguration in der <code>/etc/conf.d/network</code> zu vervollst\u00e4ndigen.</p> Bash<pre><code># IPv4\nifconfig `ip -f inet route show scope global | awk '/default/ {print $5}'` | \\\n    awk '/inet/ {print $2}' | xargs -I % sed -e 's/__IPADDR4__/%/g' -i /etc/conf.d/net\nifconfig `ip -f inet route show scope global | awk '/default/ {print $5}'` | \\\n    awk '/inet/ {print $4}' | xargs -I % sed -e 's/NETMASK4/%/g' -i /etc/conf.d/net\nip -f inet route show scope global | awk '/default/ {print $3}' | \\\n    xargs -I % sed -e 's/GATEWAY4/%/g' -i /etc/conf.d/net\n</code></pre> <p>Wir richten die <code>/etc/hosts</code> ein.</p> Bash<pre><code># localhost\nsed -e 's/my.domain/example.com/g' -i /etc/hosts\n\n# IPv4\necho '__IPADDR4__   devnull.example.com' &gt;&gt; /etc/hosts\n\nifconfig `ip -f inet route show scope global | awk '/default/ {print $5}'` | \\\n    awk '/inet/ {print $2}' | xargs -I % sed -e 's/__IPADDR4__/%/g' -i /etc/hosts\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#kernelsourcen-installieren","title":"Kernelsourcen installieren","text":"<p>Wir installieren nun die Gentoo Linux Hardened Kernelsourcen und das Gentoo Linux Tool <code>genkernel</code> zum automatisierten Erstellen des Kernel und des zugeh\u00f6rigen Initramfs.</p> Bash<pre><code>cat &gt;&gt; /etc/portage/package.keywords &lt;&lt; \"EOF\"\nsys-kernel/genkernel  ~amd64\nEOF\n\ncat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\nsys-kernel/genkernel  -crypt\nEOF\n\nemerge hardened-sources genkernel\n\nsed -e 's/^#\\(SYMLINK=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(CLEAR_CACHE_DIR=\\).*$/\\1\"yes\"/' \\\n    -e 's/^#\\(POSTCLEAR=\\).*$/\\1\"yes\"/' \\\n    -e 's/^#\\(LVM=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(LUKS=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(GPG=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(DMRAID=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(BUSYBOX=\\).*$/\\1\"yes\"/' \\\n    -e 's/^#\\(MDADM=\\).*$/\\1\"yes\"/' \\\n    -e 's/^#\\(MULTIPATH=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(ISCSI=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(E2FSPROGS=\\).*$/\\1\"yes\"/' \\\n    -e 's/^#\\(UNIONFS=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(ZFS=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(FIRMWARE=\\).*$/\\1\"no\"/' \\\n    -e 's/^#\\(BUILD_STATIC=\\).*$/\\1\"yes\"/' \\\n    -i /etc/genkernel.conf\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#kernelsourcen-konfigurieren","title":"Kernelsourcen konfigurieren","text":"Bash<pre><code>mkdir -p /root/kernels\n\nwget -q -O /root/kernels/MYKERNEL \"https://raw.githubusercontent.com/RootService/configs/master/gentoo/kernel_config_hardened.txt\"\n\ncd /usr/src/linux\nmake mrproper\ncp /root/kernels/MYKERNEL /usr/src/linux/.config\nmake oldconfig\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#kernelsourcen-kompilieren","title":"Kernelsourcen kompilieren","text":"<p>Die Kernelkonfiguration, insbesondere die Hardware-Optionen, muss Abseits der virtuellen Maschine an das eigene System angepasst werden. Dies erm\u00f6glicht uns die Angabe der Option <code>--menuconfig</code> beim genkernel-Aufruf. F\u00fcr die Verwendung des Kernels in der virtuelle Maschine ist allerdings kein weiteres Anpassen der Kernelkonfiguration notwendig.</p> Bash<pre><code>make\nmake firmware_install\nmake modules_install\nmake install\ncp /usr/src/linux/.config /root/kernels/MYKERNEL\ncd /root\n\ngenkernel --kernel-config=/root/kernels/MYKERNEL --no-ramdisk-modules --mdadm --install initramfs\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#bootloader-installieren","title":"Bootloader installieren","text":"<p>Als Bootloader kommt <code>grub</code> zum Einsatz.</p> Bash<pre><code>cat &gt;&gt; /etc/portage/make.conf &lt;&lt; \"EOF\"\nGRUB_PLATFORMS=\"emu efi-32 efi-64 pc\"\nEOF\n\ncat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\nsys-boot/grub  -truetype efiemu mount\nEOF\n\nemerge grub\n\nmount -o remount,rw /boot\n\nchmod -x /etc/grub.d/{20_linux_xen,30_os-prober,40_custom,41_custom}\n\nsed -e 's/^#\\(GRUB_CMDLINE_LINUX=\\).*$/\\1\"pax_softmode=1 domdadm\"/' \\\n    -e 's/^#\\(GRUB_CMDLINE_LINUX_DEFAULT=\\).*$/\\1\"quiet\"/' \\\n    -e 's/^#\\(GRUB_TERMINAL=\\).*$/\\1console/' \\\n    -i /etc/default/grub\n\ngrub-install --grub-setup=/bin/true /dev/sdb\ngrub-install --grub-setup=/bin/true /dev/sda\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#bootloader-konfigurieren","title":"Bootloader konfigurieren","text":"<p>Grub muss noch konfiguriert werden.</p> Bash<pre><code>grub-mkconfig -o /boot/grub/grub.cfg\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#systemtools-installieren","title":"Systemtools installieren","text":"<p>Als N\u00e4chstes installieren wir noch ein paar notwendige beziehungsweise n\u00fctzliche Systemtools.</p> Bash<pre><code>cat &gt;&gt; /etc/portage/package.use &lt;&lt; \"EOF\"\napp-crypt/gnupg  -usb\nnet-dns/bind-tools  -xml\nsys-apps/smartmontools  minimal\nEOF\n\nemerge gradm app-crypt/gnupg bind-tools ntp smartmontools\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#systemtools-konfigurieren","title":"Systemtools konfigurieren","text":"<p>Wir sorgen nun daf\u00fcr, dass unsere Systemzeit mittels <code>cron</code> st\u00fcndlich mit dem Timeserver der PTB in Braunschweig, dem Betreiber der deutschen Atomuhr, synchronisiert wird. Zudem aktivieren die regelm\u00e4ssige \u00dcberwachung der SMART-Werte unserer Festplatten.</p> Bash<pre><code>cat &gt; /etc/cron.hourly/ntpdate &lt;&lt; \"EOF\"\n#!/bin/sh\n/usr/sbin/ntpdate -4 -b -s ptbtime2.ptb.de\nEOF\n\nchmod 0755 /etc/cron.hourly/ntpdate\n\necho '/dev/sda -a -o on -S on -s (S/../.././02|L/../../6/03)' &gt;&gt; /etc/smartd.conf\necho '/dev/sdb -a -o on -S on -s (S/../.././02|L/../../6/03)' &gt;&gt; /etc/smartd.conf\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#sysctlconf-einrichten","title":"sysctl.conf einrichten","text":"<p>Mit diesem <code>sed</code> werden ein paar Kernelparameter f\u00fcr die Netzwersicherheit gesetzt.</p> Bash<pre><code>sed -e 's/^#net.ipv4/net.ipv4/g' -i /etc/sysctl.conf\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#root-passwort-setzen","title":"Root-Passwort setzen","text":"<p>Das Passwort f\u00fcr root sollte mindestens 8 Zeichen lang sein und neben Gross/Klein-Schreibung auch Ziffern und/oder Sonderzeichen enthalten.</p> Bash<pre><code>passwd root\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#arbeitsuser-anlegen","title":"Arbeitsuser anlegen","text":"<p>Wir legen uns nun einen Arbeitsuser f\u00fcr administrative Aufgaben an. Diesen Arbeitsuser stecken wir in die Systemgruppen <code>admin</code>, <code>users</code> und <code>wheel</code>. Das Passwort f\u00fcr den Arbeitsuser sollte wie das root-Passwort aufgebaut sein, sich von diesem aber deutlich unterscheiden.</p> Bash<pre><code>groupadd -g 1000 admin\nuseradd -u 1000 -g admin -G users,wheel -c 'Administrator' -m -s /bin/bash admin\n\npasswd admin\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#ssh-keys-installieren","title":"SSH-Keys installieren","text":"<p>F\u00fcr den eben angelegten Arbeitsuser m\u00fcssen nun noch die SSH-Keys erzeugt werden.</p> Bash<pre><code>su - admin\n\nssh-keygen -t ed25519 -O clear -O permit-pty\ncat .ssh/id_ed25519.pub &gt;&gt; .ssh/authorized_keys\nssh-keygen -t ecdsa -b 384 -O clear -O permit-pty\ncat .ssh/id_ecdsa.pub &gt;&gt; .ssh/authorized_keys\nssh-keygen -t rsa -b 4096 -O clear -O permit-pty\ncat .ssh/id_rsa.pub &gt;&gt; .ssh/authorized_keys\n\nexit\n</code></pre> <p>Um uns k\u00fcnftig mit unserem Arbeitsuser einloggen zu k\u00f6nnen, m\u00fcssen wir uns dessen SSH-Key (id_rsa) auf unser lokales System kopieren und ihn dann mit Hilfe der PuTTYgen Dokumentation in einen f\u00fcr PuTTY lesbaren Key umwandeln.</p> PowerShell<pre><code>pscp -P 2222 -r root@127.0.0.1:/mnt/gentoo/home/admin/.ssh \"${Env:USERPROFILE}\\VirtualBox VMs\\Gentoo\\ssh\"\n\nputtygen \"${Env:USERPROFILE}\\VirtualBox VMs\\Gentoo\\ssh\\id_rsa\"\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#reboot-ins-neue-system","title":"Reboot ins neue System","text":"<p>Die Basisinstallation ist nun endlich abgeschlossen und wir k\u00f6nnen das neue System zum ersten Mal booten.</p> Bash<pre><code>umount /boot\n\nexit\n\numount /mnt/gentoo/dev/shm\numount /mnt/gentoo/dev/pts\numount /mnt/gentoo/dev\numount /mnt/gentoo/sys\numount /mnt/gentoo/proc\numount /mnt/gentoo\n\nshutdown -P now\n</code></pre> PowerShell<pre><code>&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" storageattach \"Gentoo\" --storagectl \"IDE Controller\" --port 0 --device 0 --type dvddrive --medium emptydrive\n\n&amp; \"${Env:ProgramFiles}\\Oracle\\VirtualBox\\VBoxManage.exe\" startvm \"Gentoo\"\n\nputty -ssh -P 2222 admin@127.0.0.1\n</code></pre> Bash<pre><code>su - root\n\ngradm -P\n\nemerge -e -D @world\n\ndispatch-conf\n</code></pre>"},{"location":"howtos/gentoo/remote_install/#wie-geht-es-weiter","title":"Wie geht es weiter?","text":"<p>Nat\u00fcrlich mit der Hosting System.</p> <p>Viel Spass mit dem neuen Gentoo Basissystem.</p>"},{"location":"howtos/security/server_hacked/","title":"Vorgehensweise bei gehacktem Server","text":""},{"location":"howtos/security/server_hacked/#einleitung","title":"Einleitung","text":"<p>In diesem HowTo werden ein paar grundlegende Vorgehensweisen bei gehackten Servern gegeben.</p> <p>Dein Server wurde gehackt und Du weisst nicht so recht wie Du nun weiter vorgehen sollst? Wir haben Dir nachfolgend ein paar Punkte zusammengestellt, die Dir unserer Erfahrung nach in diesem Fall am Besten weiterhelfen sollten.</p>"},{"location":"howtos/security/server_hacked/#ruhe-bewahren","title":"Ruhe bewahren","text":"<p>Bitte bewahre erstmal Ruhe, denn ein hektischer Admin und ein gehackter Server sind eine gef\u00e4hrliche hochexplosive Mischung. Das Kind ist ohnehin schon in den Brunnen gefallen, also bringt Dir ein \u00fcberhastetes Handeln jetzt nur noch weiteren vermeidbaren \u00c4rger ein. Besorge Dir erstmal eine Kanne Kaffee oder Tee und lies Dir zun\u00e4chst die folgenden Punkte mindestens einmal durch, bevor Du anf\u00e4ngst diese nach und nach umzusetzen.</p>"},{"location":"howtos/security/server_hacked/#beweise-sichern","title":"Beweise sichern","text":"<p>Dieser sehr wichtige Punkt wird gerne vergessen, daher f\u00fchren wir ihn gleich als Erstes durch. Hierzu bootest Du den Server mit einem Rescuesystem und legst ein vollst\u00e4ndiges Festplatten-Image des Systems an. Dieses l\u00e4sst sich sp\u00e4ter in einer virtuellen Maschine gefahrlos analysieren und so sowohl das Einfallstor als auch die vorgenommenen Manipulationen aufsp\u00fcren. Schliesslich n\u00fctzt es Dir ja Nichts, wenn Du nicht weisst wie der Angreifer in Dein System eingedrungen ist und was er dort getrieben hat.</p> <p>Alternativ zum Festplatten-Image kannst Du auch vom Rescuesystem aus ein Vollbackup des Systems mittels <code>tar</code> anlegen, dieses eignet sich zwar ebenfalls zur Analyse, aber nicht mehr f\u00fcr eine rechtliche Verfolgung des T\u00e4ters. Daher empfehlen wir grunds\u00e4tzlich das Festplatten-Image zu bevorzugen.</p>"},{"location":"howtos/security/server_hacked/#nutzdaten-sichern","title":"Nutzdaten sichern","text":"<p>Als N\u00e4chstes sicherst Du die Nutzdaten, also Alles was man nicht installieren kann. Dies sind zum Beispiel statische Webseiten, Bilder, Videos, Datenbankinhalte, E-Mails und Zugangsdaten. In keinem Fall sicherst Du in diesem Schritt irgendwelche Software, also Programme und Scripte, denn diese sind nach einem erfolgreichen Einbruch nicht mehr vertrauensw\u00fcrdig.</p>"},{"location":"howtos/security/server_hacked/#server-reinstallieren","title":"Server reinstallieren","text":"<p>Nachdem Du die obigen Sicherungen angelegt hast, setzt Du den Server komplett neu auf. Dieser Schritt ist wichtig, da Du nicht wissen kannst ob und welche Software vom Angreifer manipuliert wurde. Selbst wenn Du glaubst dies zu wissen, kannst Du Dir nie zu 100% sicher sein, daher gilt es wieder eine vertrauensw\u00fcrdige Basis, sprich ein sauberes Grundsystem zu schaffen. L\u00f6sche zun\u00e4chst die Festplatte(n) vom Rescuesystem aus mittels <code>dd if=/dev/zero of=/dev/sda</code> (Linux) beziehungsweise <code>dd if=/dev/zero of=/dev/ad1</code> (FreeBSD), wobei /dev/sda beziehungsweise /dev/ad1 durch die jeweilige Festplattenbezeichnung zu ersetzen ist. Dies f\u00fchrst Du bitte f\u00fcr alle vorhandenen Festplatten mindestens einmal besser zweimal durch. Danach kannst Du das Betriebssystem in seiner Minimal-Version neu installieren und konfigurieren. Es sollte nun also maximal das Basissystem installiert und der SSH-Daemon gestartet sein, mehr nicht. Der Rest folgt sp\u00e4ter.</p>"},{"location":"howtos/security/server_hacked/#nutzdaten-analysieren","title":"Nutzdaten analysieren","text":"<p>Nun beginnt die eigentliche Arbeit, das Analysieren der gesicherten Daten. Bei den Nutzdaten ist es noch relativ leicht, denn diese brauchst Du nur mit einem 100% sauberen Backup zu vergleichen und die seitdem Backup hinzugekommenen Nutzdaten manuell zu sichten. Wenn Du Dir zu 100% sicher bist, das die Nutzdaten sauber sind, kannst Du mit dem Analysieren der Beweise weitermachen.</p>"},{"location":"howtos/security/server_hacked/#beweise-analysieren","title":"Beweise analysieren","text":"<p>Jetzt kommt der schwierigste und zeitaufwendigste Teil der Arbeit, das Analysieren der Beweissicherung. Dazu legst Du Dir zun\u00e4chst ein weiteres Backup des Festplatten-Images an, das ben\u00f6tigen n\u00e4mlich unter Umst\u00e4nden die Strafverfolgungsbeh\u00f6rden f\u00fcr eigene Analysen. Du legst Dir nun mittels VirtualBox oder VMWare Workstation eine neue virtuelle Maschine an und weist dieser das Festplatten-Image zu (Wie das im Einzelnen geht, steht in der jeweiligen Dokumentation). Achte darauf, das Du der virtuellen Maschine kein Netzwerkinterface zuweist, denn Du weisst ja noch nicht, was der Angreifer mit Deinem System gemacht hat. Etwaige Bootprobleme musst Du mit Hilfe der Dokumentation zu Deinem Betriebssystem selbst l\u00f6sen, das ist im Rahmen dieses Leitfadens nicht m\u00f6glich. H\u00e4ufige Stolpersteine sind hier die Hardwarekonfiguration (z. B. udev unter Linux), der Kernel und seine Module oder das fehlende Netzwerkinterface. Zum Beheben dieser Probleme empfiehlt sich der Einsatz einer RescueCD wie der SystemRescueCD. Nachdem Du diese H\u00fcrde gemeistert hast, f\u00e4ngst Du zun\u00e4chst damit an, das Einfallstor zu finden, damit Dein neues System dar\u00fcber nicht gleich wieder kompromittiert wird. H\u00e4ufig werden Webapplikationen, also PHP, Perl, Rails und andere Scripts als Einfallstor genutzt, daher solltest Du dort als Erstes nachsehen. Dar\u00fcberhinaus werden gerne bekannte Sicherheitsl\u00fccken in Systemsoftware ausgenutzt, das w\u00e4re also die n\u00e4chste zu \u00fcberpr\u00fcfende Baustelle.</p> <p>All dies ist eine sehr komplexe und schwere Aufgabe und es ist kein Grund sich zu sch\u00e4men wenn man sie nicht allein gel\u00f6st bekommt. Selbst viele langj\u00e4hrige professionelle System-Administratoren haben hierbei ihre kleinen und grosse Probleme. In diesem Fall muss man sich dann aber konsequenterweise auch eingestehen, dass man es selbst nicht schafft und etwas Geld in die Hand nehmen und ein darauf spezialisiertes Unternehmen mit der Aufgabe betreuen. Das ist letztendlich immer g\u00fcnstiger als wenn das System in kurzer Zeit erneut kompromittiert wird und dar\u00fcber illegale Aktivit\u00e4ten wie (D)DoS, Brute-Force und andere Angriffe durchgef\u00fchrt oder Spam, Warez, Musik, Filme oder gar Kinder-Pornos verbreitet werden. Denn f\u00fcr all dies wirst zun\u00e4chst Du als Besitzer des Servers haftbar gemacht und das wird sehr schnell sehr teuer!</p>"},{"location":"howtos/security/server_hacked/#sicherheitskonzept-anpassen","title":"Sicherheitskonzept anpassen","text":"<p>Jeder gute Administrator hat ein eigenes auf den jeweiligen Server angepasstes Sicherheitskonzept. Dieses Sicherheitskonzept erweitert er st\u00e4ndig, um mit den t\u00e4glichen Fortschritten der b\u00f6sen Buben (BlackHats) Schritt zu halten und so die meisten \u00e4lteren und aktuellen bekannten Bedrohungen im Vorfeld von seinem Server abwenden zu k\u00f6nnen. Auf Basis der Erkenntnisse aus der vorherigen Analyse wirst Du nun also auch Dein Sicherheitskonzept erweitern und darauf achten, das dieses Sicherheitsproblem k\u00fcnftig auf Deinem Server nicht mehr auftritt.</p>"},{"location":"howtos/security/server_hacked/#software-installieren","title":"Software installieren","text":"<p>Nun kannst Du die von Dir ben\u00f6tigte Software installieren und konfigurieren. Achte aber bitte darauf, wirlich nur die zwingend ben\u00f6tigte Software zu installieren, denn jede einzelne Software birgt das Risiko einer unbekannten Sicherheitsl\u00fccke. Anders ausgedr\u00fcckt: Jede Datei, die nicht auf Deinem Server existiert, kann auch nicht f\u00fcr einen neuen Einbruch genutzt werden. Auch bei der Konfiguration lasse bitte Vorsicht walten und informiere Dich vorher was jede einzelne Konfigurationsoption bewirkt. Auch die Wechselwirkungen zwischen den Anwendungen und Konfigurationen solltest Du ber\u00fccksichtigen, denn manche ungl\u00fcckliche Kombinationen machen einen Angriff erst m\u00f6glich. Vergesse bitte auch die Softwareupdates nicht, spiele diese immer sofort und regelm\u00e4ssig ein!</p>"},{"location":"howtos/security/server_hacked/#nutzdaten-einspielen","title":"Nutzdaten einspielen","text":"<p>Es ist nun an der Zeit die Nutzdaten wiederherzustellen. Auch hier gilt wieder: Weniger ist mehr. Nutzdaten sind zwar im Regelfall eher unkritisch, aber bei dieser Gelegenheit kann man sich auch gleich von veralteten, unn\u00f6tigen Daten trennen. Das tr\u00e4gt nicht nur zum Datenschutz bei sondern verk\u00fcrzt auch die Analyse bei einem etwaigen zuk\u00fcnftigen Einbruch.</p>"},{"location":"howtos/security/server_hacked/#server-online-nehmen","title":"Server online nehmen","text":"<p>Du hast es geschafft und kannst den Server wieder f\u00fcr den Normalbetrieb online nehmen.</p>"},{"location":"howtos/security/server_hacked/#abschliesssende-worte","title":"Abschliesssende Worte","text":"<p>Wir hoffen, das wir Dir etwas weiterhelfen konnten.</p> <p>Dein RootService Team</p>"},{"location":"projects/certbot_wrapper/","title":"CertBot Wrapper","text":""},{"location":"projects/certbot_wrapper/#einleitung","title":"Einleitung","text":"<p>CertBot Wrapper Script f\u00fcr den offiziellen ACME-Client CertBot mit angepasster Ablagestruktur und Unterst\u00fctzng von selbsterstellter CSR f\u00fcr unsere FreeBSD HowTos.</p>"},{"location":"projects/mysql_tuning_primer/","title":"MySQL Tuning Primer","text":""},{"location":"projects/mysql_tuning_primer/#einleitung","title":"Einleitung","text":"<p>Modernisiertes MySQL performance tuning primer script f\u00fcr MySQL &gt;= 5.5 &lt;= 5.7</p> <p>Basierend auf dem MySQL performance tuning primer script Version 1.6-r1 ver\u00f6ffentlicht am 2011-08-06 von Matthew Montgomery und lizensiert unter der GPLv2.</p>"},{"location":"projects/rootforum_community/","title":"RootForum Community","text":""},{"location":"projects/rootforum_community/#einleitung","title":"Einleitung","text":"<p>Neben einem sehr guten Forum bietet die RootForum Community auch verschiedene HowTos und andere n\u00fctzliche Informationen zur Verwaltung von FreeBSD- und Linux-basierten Servern.</p>"}]}